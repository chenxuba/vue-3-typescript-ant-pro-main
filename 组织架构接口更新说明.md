# 组织架构接口更新说明

## 概述
已成功将组织架构管理页面从模拟数据更新为调用真实接口。

## 接口信息

### 接口地址
```
POST http://101.200.13.193:8080/web/api/user/allOrgList
```

### 请求参数
```json
{
  "limit": 10000,
  "orderbyFiled": "orgCode:asc",
  "page": 1,
  "startNum": 0
}
```

### 响应格式
```json
{
  "result": 1,
  "msg": "",
  "data": {
    "total": 9737,
    "pageSize": 20,
    "currentPage": 1,
    "list": [
      {
        "orgID": 2038604063,
        "orgName": "办公厅",
        "orgCode": "119000",
        "parentOrgID": 2,
        "parentOrgName": "中国科学院",
        "status": 1,
        "sortID": 0,
        "isOrg": 1,
        "isVirOrg": 0,
        "orglevel": 0,
        "orgTypeID": "",
        "logo": "//resource.casmooc.cn/web1/uploadFile/userFile/492649007.png",
        "orgSEQ": "1.2.2038604063.",
        "attachedOrgId": 0
      }
    ]
  }
}
```

## 修改文件列表

### 1. `/src/api/system/organization.ts`
- 新增 `RawOrganizationModel` 接口：定义原始 API 返回的组织数据类型
- 新增 `OrganizationListParams` 接口：定义列表请求参数类型
- 新增 `OrganizationListResponse` 接口：定义列表响应数据类型
- 新增 `ExternalApiResponse` 接口：定义外部 API 响应格式
- 新增 `getAllOrganizationListApi` 函数：调用真实的组织列表接口

### 2. `/src/pages/dashboard/system-management/organization-management.vue`
- 导入新的 API 函数和类型
- 新增 `loading` 状态管理加载过程
- 新增 `convertRawToOrganization` 函数：将原始 API 数据转换为组件使用的格式
- 新增 `buildTree` 函数：将扁平的列表数据构建为树形结构
- 更新 `initData` 函数：改为调用真实接口而非使用模拟数据
- 更新模板：添加加载状态显示

### 3. `/vite.config.ts`
- 添加 `/web` 路径的代理配置，转发到 `http://101.200.13.193:8080`
- 配置 `changeOrigin: true` 以避免跨域问题

## 数据转换逻辑

### 原始数据到内部模型的映射
```typescript
{
  orgID → id
  orgName → name
  orgCode → code
  parentOrgID → parentId
  parentOrgName → parentName
  status (1/0) → isActive (true/false)
  sortID → order
  attachedOrgId === 0 → isIndependentTraining
  isVirOrg (1/0) → isVirtual (true/false)
}
```

### 树形结构构建
1. 将所有节点放入 Map 中，以 ID 为键
2. 遍历所有节点，根据 `parentId` 建立父子关系
3. 没有父节点或父节点不存在的节点作为根节点
4. 返回根节点数组

## 功能特性

### ✅ 已实现
- ✅ 调用真实接口获取组织数据
- ✅ 自动构建树形结构
- ✅ 支持搜索组织名称和编号
- ✅ 默认展开所有节点
- ✅ 加载状态提示
- ✅ 错误处理和用户提示
- ✅ 跨域代理配置

### 🎯 特色功能
- 📊 显示加载的组织总数
- 🔍 实时搜索过滤
- 🌳 树形结构展示
- 📝 详细信息查看
- 🎨 美观的 UI 设计

## 使用方法

### 启动开发服务器
```bash
npm run dev
# 或
pnpm dev
```

### 访问页面
打开浏览器访问：`http://localhost:6678`

导航到：系统管理 → 组织机构管理

## 注意事项

1. **代理配置**：开发环境下，所有 `/web` 开头的请求会自动代理到 `http://101.200.13.193:8080`

2. **数据量**：当前设置为获取 10000 条数据，如果实际数据量更大，可能需要调整或实现分页加载

3. **性能优化**：对于大量数据，已经实现了虚拟滚动和懒加载机制

4. **错误处理**：如果接口调用失败，会在控制台输出详细错误信息，并显示用户友好的错误提示

## 测试建议

### 正常流程测试
1. ✅ 页面加载时显示加载动画
2. ✅ 成功加载后显示组织树形结构
3. ✅ 点击节点查看详细信息
4. ✅ 使用搜索功能过滤组织

### 异常流程测试
1. ⚠️ 网络断开时的错误提示
2. ⚠️ 接口返回错误时的处理
3. ⚠️ 空数据的显示

## 未来优化建议

1. **分页加载**：对于超大数据量，实现分页或虚拟滚动
2. **缓存机制**：添加数据缓存，避免重复请求
3. **编辑功能**：增加组织的新增、编辑、删除功能
4. **权限控制**：根据用户权限显示不同的操作按钮
5. **数据导出**：支持导出组织架构数据为 Excel 或其他格式

## 技术栈

- Vue 3 + TypeScript
- Ant Design Vue
- Vite
- Pinia (状态管理)
- Axios (HTTP 请求)

## 联系方式

如有问题或建议，请联系开发团队。

