import{d as L,a9 as z,am as W,f as c,w as K,c as U,o as Q,_ as g,a1 as m,$ as p,k as o,a7 as l,G as d,ad as k,F as R,aa as H,a6 as N}from"./vue-C8C4cLDH.js";import{R as X}from"./RichTextEditor-C_T8lz-z.js";import{g as Y,a as Z}from"./dictionary-Bk8jJhEY.js";import{e as ee,a as ae}from"./index-H3_z31XN.js";import{a7 as u,ac as te,ad as oe,a0 as ne,U as re,V as le,$ as se,w as ue,H as ie,al as de}from"./antd-BIZT1SGM.js";import{_ as ve}from"./index-DUZqzru9.js";const ce={class:"edit-project-page"},pe={class:"page-content"},me={class:"project-type-section"},fe={class:"project-type-desc"},ye={class:"project-form-section"},_e={class:"form-title"},ge={key:0},be={class:"page-footer"},ke=L({name:"EditRainingProject",__name:"edit",setup(Te){const _=z(),E=W(),f=c(),C=c(),T=c(!1),h=c(!1),j=c(!1),n=c(1),v=c(null),a=c({name:"",description:"",difficulty:void 0,environment:void 0,secondType:void 0,classHour:"",showTaskRequire:!1}),P={name:[{required:!0,message:"请输入名称",trigger:"blur"}],description:[{required:!0,validator:(t,e)=>!e||!e.replace(/<[^>]*>/g,"").trim()?Promise.reject("请输入简介"):Promise.resolve(),trigger:"blur"}],difficulty:[{required:!0,message:"请选择难度",trigger:"change"}],environment:[{required:!0,message:"请选择实验环境",trigger:"change"}],secondType:[{required:!0,message:"请选择小类别",trigger:"change"}]},M=[{label:"简单",value:1},{label:"适中",value:2},{label:"困难",value:3}],b=c({1:[],2:[],3:[]}),V=()=>(b.value[n.value]||[]).map(r=>({label:r.name,value:r.value})),D=async t=>{if(!(b.value[t].length>0))try{h.value=!0;const e=Y(t);if(!e)return;const r=await Z({code:e});r&&r.list&&(b.value[t]=r.list)}catch{u.error("加载实验环境选项失败")}finally{h.value=!1}},B=()=>n.value!==2&&n.value!==3?[]:[{label:"Bwapp",value:1},{label:"CSS",value:2},{label:"DataTurks",value:3}],S=async()=>{if(!f.value){u.error("缺少项目ID"),_.back();return}try{T.value=!0;const t=await ee({id:f.value});v.value=t,t.projectType&&(n.value=t.projectType,await D(t.projectType)),a.value={name:t.name||"",description:t.description||"",difficulty:t.difficulty||void 0,environment:t.environment||void 0,secondType:t.secondType||void 0,classHour:t.classHour?String(t.classHour):"",showTaskRequire:t.showTaskRequire===1}}catch(t){u.error(t.message||"获取项目详情失败"),_.back()}finally{T.value=!1}},I=()=>{_.back()},O=async()=>{var e,r;try{await((e=C.value)==null?void 0:e.validate())}catch{return}if(!a.value.name){u.error("请输入名称");return}if(!(((r=a.value.description)==null?void 0:r.replace(/<[^>]*>/g,"").trim())||"")){u.error("请输入简介");return}if(!a.value.difficulty){u.error("请选择难度");return}if(!a.value.environment){u.error("请选择实验环境");return}if((n.value===2||n.value===3)&&!a.value.secondType){u.error("请选择小类别");return}if(!f.value||!v.value){u.error("项目信息缺失");return}try{j.value=!0;const y={id:f.value,name:a.value.name,tag:v.value.tag||"",fieldType:a.value.secondType,difficulty:a.value.difficulty,classHour:a.value.classHour,topCover:v.value.topCover||"",cover:v.value.cover||"",description:a.value.description,showTaskRequire:a.value.showTaskRequire?1:2,authType:v.value.authType||1,enableCodeRepository:v.value.enableCodeRepository||!1,repositoryType:v.value.repositoryType||"",gitUrl:v.value.gitUrl||"",environment:a.value.environment};await ae(y),u.success("保存成功");const i={1:"/dashboard/raining-project-management/edit-full-stack",2:"/dashboard/raining-project-management/edit-jupyter-notebook",3:"/dashboard/raining-project-management/edit-jupyter-lab"}[n.value];i?_.push({path:i,query:{id:f.value}}):u.error("未知的项目类型")}catch(y){u.error(y.message||"保存失败")}finally{j.value=!1}};K(n,t=>{a.value.environment=void 0,a.value.secondType=void 0,a.value.showTaskRequire=!1,D(t)});const F=U(()=>({1:"全栈环境",2:"JupyterNotebook环境",3:"JupyterLab环境"})[n.value]||""),J=U(()=>{if(!a.value.environment)return"";const e=(b.value[n.value]||[]).find(r=>r.value===a.value.environment);return(e==null?void 0:e.name)||""});return Q(()=>{const t=E.query.id;t?(f.value=Number(t),S()):(u.error("缺少项目ID"),_.back())}),(t,e)=>{const r=oe,y=te,w=le,i=re,A=se,q=ue,$=ne,x=ie,G=de;return m(),g("div",ce,[e[14]||(e[14]=p("div",{class:"page-header"},[p("h2",null,"编辑实训项目")],-1)),o(G,{spinning:T.value},{default:l(()=>[p("div",pe,[p("div",me,[o(y,{value:n.value,"onUpdate:value":e[0]||(e[0]=s=>n.value=s),class:"custom-radio",disabled:""},{default:l(()=>[o(r,{value:1},{default:l(()=>e[8]||(e[8]=[d("全栈环境实训项目")])),_:1,__:[8]}),o(r,{value:2},{default:l(()=>e[9]||(e[9]=[d("JupyterNotebook环境实训项目")])),_:1,__:[9]}),o(r,{value:3},{default:l(()=>e[10]||(e[10]=[d("JupyterLab环境实训项目")])),_:1,__:[10]})]),_:1},8,["value"])]),p("div",fe,[n.value===1?(m(),g(R,{key:0},[d(" 多功能新型实战项目模式，支持图形化桌面、Web IDE、命令行、提供仿真拟真等种实验场景，适用于各类复杂工程项目研发。 ")],64)):n.value===2?(m(),g(R,{key:1},[d(" 多功能实时交互实验模式，支持实时代码、数学方程、可视化和MarkDown等。 适用于数据清理、数值模拟、统计建模、机器学习等系列实验。 ")],64)):n.value===3?(m(),g(R,{key:2},[d(" 多功能实时交互实验模式，支持实时代码、数学方程、可视化和MarkDown等。 适用于数据清理、数值模拟、统计建模、机器学习等系列实验。 ")],64)):k("",!0)]),p("div",ye,[p("div",_e,[d(H(F.value)+"实训项目 ",1),a.value.environment?(m(),g("span",ge," 实验环境: "+H(J.value),1)):k("",!0)]),o($,{ref_key:"formRef",ref:C,model:a.value,rules:P,layout:"horizontal","label-col":{span:3},"wrapper-col":{span:18}},{default:l(()=>[o(i,{label:"名称",name:"name",required:""},{default:l(()=>[o(w,{value:a.value.name,"onUpdate:value":e[1]||(e[1]=s=>a.value.name=s),placeholder:"请输入名称"},null,8,["value"])]),_:1}),o(i,{label:"简介",name:"description",required:""},{default:l(()=>[o(X,{modelValue:a.value.description,"onUpdate:modelValue":e[2]||(e[2]=s=>a.value.description=s),placeholder:"请输入简介内容",height:200},null,8,["modelValue"])]),_:1}),n.value===2?(m(),N(i,{key:0,label:"任务要求",name:"showTaskRequire"},{default:l(()=>[o(A,{checked:a.value.showTaskRequire,"onUpdate:checked":e[3]||(e[3]=s=>a.value.showTaskRequire=s)},{default:l(()=>e[11]||(e[11]=[d(" 显示任务要求（勾选后，将简介作为任务要求显示在实践项目挑战页面） ")])),_:1,__:[11]},8,["checked"])]),_:1})):k("",!0),o(i,{label:"难度",name:"difficulty",required:""},{default:l(()=>[o(q,{value:a.value.difficulty,"onUpdate:value":e[4]||(e[4]=s=>a.value.difficulty=s),placeholder:"请选择难度",options:M},null,8,["value"])]),_:1}),o(i,{label:"实验环境",name:"environment",required:""},{default:l(()=>[o(q,{value:a.value.environment,"onUpdate:value":e[5]||(e[5]=s=>a.value.environment=s),placeholder:"请选择实验环境",options:V(),loading:h.value},null,8,["value","options","loading"])]),_:1}),n.value===2||n.value===3?(m(),N(i,{key:1,label:"小类别",name:"secondType",required:""},{default:l(()=>[o(q,{value:a.value.secondType,"onUpdate:value":e[6]||(e[6]=s=>a.value.secondType=s),placeholder:"请选择小类别",options:B()},null,8,["value","options"])]),_:1})):k("",!0),o(i,{label:"学时",name:"classHour"},{default:l(()=>[o(w,{value:a.value.classHour,"onUpdate:value":e[7]||(e[7]=s=>a.value.classHour=s),placeholder:"配置任务后自动计算",disabled:""},null,8,["value"])]),_:1})]),_:1},8,["model"])]),p("div",be,[o(x,{onClick:I},{default:l(()=>e[12]||(e[12]=[d("返回")])),_:1,__:[12]}),o(x,{type:"primary",loading:j.value,onClick:O},{default:l(()=>e[13]||(e[13]=[d("下一步")])),_:1,__:[13]},8,["loading"])])])]),_:1},8,["spinning"])])}}}),xe=ve(ke,[["__scopeId","data-v-dade02ab"]]);export{xe as default};
