import{d as pe,ak as ve,am as me,f as p,c as fe,o as ke,_ as f,a1 as v,$ as o,k as l,a9 as m,a7 as n,G as d,ac as G,F as S,ab as E,a6 as Y,u as W,ag as _e}from"./vue-PnzzEkKE.js";import{f as ge,p as ye,q as be,r as Ne,t as he}from"./index-BiGxzIPP.js";import{g as we}from"./organization-CNLoRQ3V.js";import{H as Se,s as Te,a4 as Ie,a5 as xe,z as Ce,I as je,a6 as Le,an as $e,ao as ze,ap as Ue,T as Pe,a1 as h}from"./antd-Cme2pY03.js";import{_ as Oe}from"./index-DuoXNLgb.js";const De={class:"project-statistics-page"},Ae={class:"page-header"},Fe={class:"page-content"},Ee={class:"filter-section"},Re={class:"filter-form"},Be={class:"filter-actions"},Me={class:"table-section"},Ke={class:"table-header"},Ve={class:"table-info"},qe={class:"total-info"},He={class:"total-number"},Je={key:0,class:"user-link"},Qe={key:2,class:"status-cell"},Ge={class:"filter-section"},Ye={class:"filter-form"},We={class:"filter-actions"},Xe={class:"task-completion-container"},Ze={class:"task-level-sidebar"},et={class:"task-level-search"},tt={class:"task-level-list"},at=["onClick"],st={class:"task-table-area"},lt={class:"table-header"},nt={class:"table-info"},ot={class:"total-info"},rt={class:"total-number"},it={key:1,class:"user-link"},ut=pe({name:"ProjectStatistics",__name:"statistics",setup(dt){const X=ve(),R=me(),P=p(R.query.name||"é¡¹ç›®ç®¡ç†è¯¦æƒ…"),w=p("participation"),a=p({userNumber:"",userName:"",unit:void 0,status:void 0}),L=p([]),T=p(!1),B=async(t="")=>{T.value=!0;try{const e=await we({limit:50,page:1,startNum:0,orderbyFiled:"orgCode:asc",orgName:t||void 0});e&&e.data&&e.data.list&&(L.value=e.data.list.map(r=>({label:r.orgName,value:r.orgName})))}catch(e){console.error("èŽ·å–ç»„ç»‡åˆ—è¡¨å¤±è´¥:",e),h.error("èŽ·å–ç»„ç»‡åˆ—è¡¨å¤±è´¥"),L.value=[]}finally{T.value=!1}};let O=null;const M=t=>{O&&clearTimeout(O),O=setTimeout(()=>{B(t)},300)},Z=[{label:"å·²å®Œæˆ",value:"1"},{label:"è¿›è¡Œä¸­",value:"2"},{label:"æœªå¼€å§‹",value:"3"}],I=p([]),b=p(null),$=p(""),ee=fe(()=>$.value?I.value.filter(t=>t.name.toLowerCase().includes($.value.toLowerCase())):I.value),te=t=>{b.value=t,k.value.current=1,j()},ae=[{title:"ç”¨æˆ·ç¼–å·",dataIndex:"userId",key:"userId",width:150},{title:"ç”¨æˆ·å§“å",dataIndex:"nickName",key:"nickName",width:150},{title:"å•ä½",dataIndex:"orgName",key:"orgName",width:300},{title:"å‚è®­æ—¶é—´",dataIndex:"joinTime",key:"joinTime",width:200},{title:"å‚è®­çŠ¶æ€",dataIndex:"currentTask",key:"currentTask",width:150,align:"center"}],se=[{title:"ç”¨æˆ·ç¼–å·",dataIndex:"userNumber",key:"userNumber",width:150},{title:"ç”¨æˆ·å§“å",dataIndex:"userName",key:"userName",width:150},{title:"å•ä½",dataIndex:"unit",key:"unit",width:250},{title:"ä»»åŠ¡å¼€å§‹æ—¶é—´",dataIndex:"taskStartTime",key:"taskStartTime",width:180},{title:"ä»»åŠ¡ç»“æŸæ—¶é—´",dataIndex:"taskEndTime",key:"taskEndTime",width:180},{title:"ç´¯è®¡æ—¶é—´",dataIndex:"totalTime",key:"totalTime",width:120},{title:"å®žéªŒçŠ¶æ€",dataIndex:"experimentStatus",key:"experimentStatus",width:120}],K=p([]),V=p([]),g=p({current:1,pageSize:20,total:0,showSizeChanger:!0,showQuickJumper:!0,showTotal:t=>`æ•°æ®å…± ${t} æ¡`}),k=p({current:1,pageSize:20,total:0,showSizeChanger:!0,showQuickJumper:!0,showTotal:t=>`æ•°æ®å…± ${t} æ¡`}),D=p(!1),A=p(!1),C=p(Number(R.query.id)||0),z=p(0),le=async()=>{try{const t={projectId:C.value,orderbyFiled:"task_id:asc"},e=await ge(t);e&&Array.isArray(e)&&(z.value=e.length,I.value=e.map(r=>({taskId:r.taskId,name:r.name})),I.value.length>0&&(b.value=I.value[0].taskId))}catch(t){console.error("èŽ·å–é¡¹ç›®ä»»åŠ¡åˆ—è¡¨å¤±è´¥:",t),h.error("èŽ·å–é¡¹ç›®ä»»åŠ¡åˆ—è¡¨å¤±è´¥")}},F=t=>{if(!t)return"-";const e=t<1e10?t*1e3:t,r=new Date(e),_=r.getFullYear(),u=String(r.getMonth()+1).padStart(2,"0"),i=String(r.getDate()).padStart(2,"0"),y=String(r.getHours()).padStart(2,"0"),N=String(r.getMinutes()).padStart(2,"0"),x=String(r.getSeconds()).padStart(2,"0");return`${_}-${u}-${i} ${y}:${N}:${x}`},U=async()=>{D.value=!0;try{const t={limit:g.value.pageSize,page:g.value.current,projectId:C.value};a.value.userNumber&&(t.userId=a.value.userNumber),a.value.userName&&(t.nickName=a.value.userName),a.value.unit&&(t.orgName=a.value.unit),a.value.status&&(t.status=a.value.status);const e=await ye(t);e&&e.list&&(K.value=e.list,g.value.total=e.total)}catch(t){console.error("èŽ·å–å‚è®­æ•°æ®å¤±è´¥:",t),h.error("èŽ·å–å‚è®­æ•°æ®å¤±è´¥")}finally{D.value=!1}},ne=(t,e)=>{if(!t||!e)return"-";const r=t<1e10?t*1e3:t,_=e<1e10?e*1e3:e,u=Math.floor((_-r)/1e3);if(u<0)return"-";const i=Math.floor(u/3600),y=Math.floor(u%3600/60),N=u%60;return`${String(i).padStart(2,"0")}:${String(y).padStart(2,"0")}:${String(N).padStart(2,"0")}`},oe=t=>t===10?"å·²å®Œæˆ":t>0&&t<10?"è¿›è¡Œä¸­":"æœªå¼€å§‹",re=t=>t===10?"completed":t>0&&t<10?"inProgress":"notStarted",j=async()=>{if(b.value){A.value=!0;try{const t={limit:k.value.pageSize,page:k.value.current,projectId:C.value,taskId:b.value,orderbyFiled:"id:desc"};a.value.userNumber&&(t.userId=a.value.userNumber),a.value.userName&&(t.nickName=a.value.userName),a.value.unit&&(t.orgName=a.value.unit);const e=await be(t);e&&e.list&&(V.value=e.list,k.value.total=e.total)}catch(t){console.error("èŽ·å–ä»»åŠ¡å®Œæˆæƒ…å†µå¤±è´¥:",t),h.error("èŽ·å–ä»»åŠ¡å®Œæˆæƒ…å†µå¤±è´¥")}finally{A.value=!1}}},q=()=>{console.log("æŸ¥è¯¢",a.value),w.value==="participation"?(g.value.current=1,U()):w.value==="task"&&(k.value.current=1,j())},H=()=>{a.value={userNumber:"",userName:"",unit:void 0,status:void 0},w.value==="participation"?(g.value.current=1,U()):w.value==="task"&&(k.value.current=1,j())},J=async()=>{var t;try{h.loading({content:"æ­£åœ¨å¯¼å‡º...",key:"export",duration:0});let e,r;if(w.value==="participation"){const i={limit:g.value.pageSize,page:g.value.current,projectId:C.value};a.value.userNumber&&(i.userId=a.value.userNumber),a.value.userName&&(i.nickName=a.value.userName),a.value.unit&&(i.orgName=a.value.unit),a.value.status&&(i.status=a.value.status),e=await Ne(i);const y=new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5);r=`${P.value||"é¡¹ç›®ç»Ÿè®¡"}_å‚è®­æ•´ä½“æƒ…å†µ_${y}.xlsx`}else{if(!b.value){h.error({content:"è¯·å…ˆé€‰æ‹©ä»»åŠ¡å…³å¡",key:"export"});return}const i={limit:k.value.pageSize,page:k.value.current,projectId:C.value,taskId:b.value,orderbyFiled:"id:desc"};a.value.userNumber&&(i.userId=a.value.userNumber),a.value.userName&&(i.nickName=a.value.userName),a.value.unit&&(i.orgName=a.value.unit),e=await he(i);const y=((t=I.value.find(x=>x.taskId===b.value))==null?void 0:t.name)||"ä»»åŠ¡",N=new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5);r=`${P.value||"é¡¹ç›®ç»Ÿè®¡"}_${y}_${N}.xlsx`}const _=window.URL.createObjectURL(e),u=document.createElement("a");u.href=_,u.download=r,document.body.appendChild(u),u.click(),document.body.removeChild(u),window.URL.revokeObjectURL(_),h.success({content:"å¯¼å‡ºæˆåŠŸ",key:"export"})}catch(e){console.error("å¯¼å‡ºå¤±è´¥:",e),h.error({content:e.message||"å¯¼å‡ºå¤±è´¥",key:"export"})}},ie=()=>{X.back()},ue=t=>{g.value.current=t.current,g.value.pageSize=t.pageSize,U()},de=t=>{k.value.current=t.current,k.value.pageSize=t.pageSize,j()};return ke(async()=>{B(),await le(),U(),b.value&&j()}),(t,e)=>{const r=Se,_=je,u=Ce,i=xe,y=Le,N=Ie,x=$e,Q=Te,ce=Pe;return v(),f("div",De,[o("div",Ae,[o("h2",null,m(P.value),1),l(r,{onClick:ie},{default:n(()=>e[9]||(e[9]=[d("è¿”å›ž")])),_:1,__:[9]})]),o("div",Fe,[l(ce,{activeKey:w.value,"onUpdate:activeKey":e[8]||(e[8]=s=>w.value=s),class:"statistics-tabs"},{default:n(()=>[l(Q,{key:"participation",tab:"å‚è®­æ•´ä½“æƒ…å†µ"},{default:n(()=>[o("div",Ee,[e[12]||(e[12]=o("div",{class:"filter-title"},"ç­›é€‰æŸ¥è¯¢",-1)),o("div",Re,[l(N,{gutter:16,align:"middle"},{default:n(()=>[l(i,{span:5},{default:n(()=>[l(u,{label:"ç”¨æˆ·ç¼–å·ï¼š","label-col":{span:9},"wrapper-col":{span:15}},{default:n(()=>[l(_,{value:a.value.userNumber,"onUpdate:value":e[0]||(e[0]=s=>a.value.userNumber=s),placeholder:"è¯·è¾“å…¥"},null,8,["value"])]),_:1})]),_:1}),l(i,{span:5},{default:n(()=>[l(u,{label:"ç”¨æˆ·å§“åï¼š","label-col":{span:9},"wrapper-col":{span:15}},{default:n(()=>[l(_,{value:a.value.userName,"onUpdate:value":e[1]||(e[1]=s=>a.value.userName=s),placeholder:"è¯·è¾“å…¥"},null,8,["value"])]),_:1})]),_:1}),l(i,{span:5},{default:n(()=>[l(u,{label:"å•ä½ï¼š","label-col":{span:6},"wrapper-col":{span:18}},{default:n(()=>[l(y,{value:a.value.unit,"onUpdate:value":e[2]||(e[2]=s=>a.value.unit=s),placeholder:"è¯·è¾“å…¥å•ä½åç§°æœç´¢",options:L.value,"allow-clear":"","show-search":"","filter-option":!1,loading:T.value,"not-found-content":T.value?"åŠ è½½ä¸­...":"æš‚æ— æ•°æ®",onSearch:M},null,8,["value","options","loading","not-found-content"])]),_:1})]),_:1}),l(i,{span:5},{default:n(()=>[l(u,{label:"å‚è®­çŠ¶æ€ï¼š","label-col":{span:9},"wrapper-col":{span:15}},{default:n(()=>[l(y,{value:a.value.status,"onUpdate:value":e[3]||(e[3]=s=>a.value.status=s),placeholder:"è¯·é€‰æ‹©",options:Z,"allow-clear":""},null,8,["value"])]),_:1})]),_:1}),l(i,{span:4},{default:n(()=>[o("div",Be,[l(r,{type:"primary",onClick:q},{default:n(()=>e[10]||(e[10]=[d("æŸ¥è¯¢")])),_:1,__:[10]}),l(r,{onClick:H},{default:n(()=>e[11]||(e[11]=[d("é‡ç½®")])),_:1,__:[11]})])]),_:1})]),_:1})])]),o("div",Me,[o("div",Ke,[o("div",Ve,[e[15]||(e[15]=d(" æ•°æ®åˆ—è¡¨ ")),o("span",qe,[e[13]||(e[13]=d("æ•°æ®å…± ")),o("span",He,m(g.value.total),1),e[14]||(e[14]=d(" æ¡"))])]),l(r,{type:"primary",onClick:J},{default:n(()=>e[16]||(e[16]=[d("å¯¼å‡º")])),_:1,__:[16]})]),l(x,{columns:ae,"data-source":K.value,pagination:g.value,loading:D.value,"row-key":s=>s.id,scroll:{x:1e3},onChange:ue},{bodyCell:n(({column:s,record:c})=>[s.key==="nickName"?(v(),f("a",Je,m(c.nickName),1)):s.key==="joinTime"?(v(),f(S,{key:1},[d(m(F(c.joinTime)),1)],64)):s.key==="currentTask"?(v(),f("div",Qe,[o("span",null,m(c.currentTask)+" / "+m(z.value),1),o("span",{class:E(["status-icon",c.currentTask>=z.value?"completed":"inProgress"])},[c.currentTask>=z.value?(v(),Y(W(ze),{key:0})):(v(),Y(W(Ue),{key:1}))],2)])):G("",!0)]),_:1},8,["data-source","pagination","loading","row-key"])])]),_:1}),l(Q,{key:"task",tab:"ä»»åŠ¡å®Œæˆæƒ…å†µ"},{default:n(()=>[o("div",Ge,[e[19]||(e[19]=o("div",{class:"filter-title"},"ç­›é€‰æŸ¥è¯¢",-1)),o("div",Ye,[l(N,{gutter:16,align:"middle"},{default:n(()=>[l(i,{span:6},{default:n(()=>[l(u,{label:"ç”¨æˆ·ç¼–å·ï¼š","label-col":{span:8},"wrapper-col":{span:16}},{default:n(()=>[l(_,{value:a.value.userNumber,"onUpdate:value":e[4]||(e[4]=s=>a.value.userNumber=s),placeholder:"è¯·è¾“å…¥"},null,8,["value"])]),_:1})]),_:1}),l(i,{span:6},{default:n(()=>[l(u,{label:"ç”¨æˆ·å§“åï¼š","label-col":{span:8},"wrapper-col":{span:16}},{default:n(()=>[l(_,{value:a.value.userName,"onUpdate:value":e[5]||(e[5]=s=>a.value.userName=s),placeholder:"è¯·è¾“å…¥"},null,8,["value"])]),_:1})]),_:1}),l(i,{span:6},{default:n(()=>[l(u,{label:"å•ä½ï¼š","label-col":{span:6},"wrapper-col":{span:18}},{default:n(()=>[l(y,{value:a.value.unit,"onUpdate:value":e[6]||(e[6]=s=>a.value.unit=s),placeholder:"è¯·è¾“å…¥å•ä½åç§°æœç´¢",options:L.value,"allow-clear":"","show-search":"","filter-option":!1,loading:T.value,"not-found-content":T.value?"åŠ è½½ä¸­...":"æš‚æ— æ•°æ®",onSearch:M},null,8,["value","options","loading","not-found-content"])]),_:1})]),_:1}),l(i,{span:6},{default:n(()=>[o("div",We,[l(r,{type:"primary",onClick:q},{default:n(()=>e[17]||(e[17]=[d("æŸ¥è¯¢")])),_:1,__:[17]}),l(r,{onClick:H},{default:n(()=>e[18]||(e[18]=[d("é‡ç½®")])),_:1,__:[18]})])]),_:1})]),_:1})])]),o("div",Xe,[o("div",Ze,[o("div",et,[l(_,{value:$.value,"onUpdate:value":e[7]||(e[7]=s=>$.value=s),placeholder:"è¯·è¾“å…¥å†…å®¹","allow-clear":""},{suffix:n(()=>e[20]||(e[20]=[o("span",{class:"search-icon"},"ðŸ”",-1)])),_:1},8,["value"])]),o("div",tt,[(v(!0),f(S,null,_e(ee.value,s=>(v(),f("div",{key:s.taskId,class:E(["task-level-item",{active:b.value===s.taskId}]),onClick:c=>te(s.taskId)},m(s.name),11,at))),128))])]),o("div",st,[o("div",lt,[o("div",nt,[e[23]||(e[23]=d(" æ•°æ®åˆ—è¡¨ ")),o("span",ot,[e[21]||(e[21]=d("æ•°æ®å…± ")),o("span",rt,m(k.value.total),1),e[22]||(e[22]=d(" æ¡"))])]),l(r,{type:"primary",onClick:J},{default:n(()=>e[24]||(e[24]=[d("å¯¼å‡º")])),_:1,__:[24]})]),l(x,{columns:se,"data-source":V.value,pagination:k.value,loading:A.value,"row-key":s=>s.id,scroll:{x:1200},onChange:de},{bodyCell:n(({column:s,record:c})=>[s.key==="userNumber"?(v(),f(S,{key:0},[d(m(c.userId),1)],64)):s.key==="userName"?(v(),f("a",it,m(c.nickName),1)):s.key==="unit"?(v(),f(S,{key:2},[d(m(c.orgName||"-"),1)],64)):s.key==="taskStartTime"?(v(),f(S,{key:3},[d(m(F(c.beginTime)),1)],64)):s.key==="taskEndTime"?(v(),f(S,{key:4},[d(m(F(c.endTime)),1)],64)):s.key==="totalTime"?(v(),f(S,{key:5},[d(m(ne(c.beginTime,c.endTime)),1)],64)):s.key==="experimentStatus"?(v(),f("span",{key:6,class:E(["status-tag",re(c.status)])},m(oe(c.status)),3)):G("",!0)]),_:1},8,["data-source","pagination","loading","row-key"])])])]),_:1})]),_:1},8,["activeKey"])])])}}}),kt=Oe(ut,[["__scopeId","data-v-d51839ef"]]);export{kt as default};
