import{d as pe,ak as ve,am as me,f as m,c as ke,o as fe,_ as k,a1 as p,$ as o,k as l,a9 as v,a7 as n,G as u,ac as G,F as N,ab as F,a6 as Y,u as W,ag as _e}from"./vue-PnzzEkKE.js";import{f as ge,t as ye,v as be,w as Ne,x as he}from"./index-DSAepedF.js";import{g as we}from"./organization-B3Jrkacl.js";import{H as Se,s as Ie,a4 as Te,a5 as xe,z as Ce,I as je,a6 as Le,an as $e,ao as ze,ap as Ue,T as Pe,a1 as w}from"./antd-Cme2pY03.js";import{_ as Oe}from"./index-DtsGq2fy.js";const De={class:"project-statistics-page"},He={class:"page-header"},Ae={class:"page-content"},Fe={class:"filter-section"},Ee={class:"filter-form"},Re={class:"filter-actions"},Be={class:"table-section"},Me={class:"table-header"},Ke={class:"table-info"},Ve={class:"total-info"},qe={class:"total-number"},Je={key:0,class:"user-link"},Qe={key:3,class:"status-cell"},Ge={class:"filter-section"},Ye={class:"filter-form"},We={class:"filter-actions"},Xe={class:"task-completion-container"},Ze={class:"task-level-sidebar"},ea={class:"task-level-search"},aa={class:"task-level-list"},ta=["onClick"],sa={class:"task-table-area"},la={class:"table-header"},na={class:"table-info"},oa={class:"total-info"},ra={class:"total-number"},ia={key:1,class:"user-link"},ua=pe({name:"ProjectStatistics",__name:"statistics",setup(da){const X=ve(),E=me(),P=m(E.query.name||"é¡¹ç›®ç®¡ç†è¯¦æƒ…"),S=m("participation"),t=m({userNumber:"",userName:"",unit:void 0,status:void 0}),L=m([]),I=m(!1),R=async(a="")=>{I.value=!0;try{const e=await we({limit:50,page:1,startNum:0,orderbyFiled:"orgCode:asc",orgName:a||void 0});e&&e.data&&e.data.list&&(L.value=e.data.list.map(r=>({label:r.orgName,value:r.orgName})))}catch(e){console.error("èŽ·å–ç»„ç»‡åˆ—è¡¨å¤±è´¥:",e),w.error("èŽ·å–ç»„ç»‡åˆ—è¡¨å¤±è´¥"),L.value=[]}finally{I.value=!1}};let O=null;const B=a=>{O&&clearTimeout(O),O=setTimeout(()=>{R(a)},300)},Z=[{label:"å·²å®Œæˆ",value:"1"},{label:"è¿›è¡Œä¸­",value:"2"},{label:"æœªå¼€å§‹",value:"3"}],T=m([]),b=m(null),$=m(""),ee=ke(()=>$.value?T.value.filter(a=>a.name.toLowerCase().includes($.value.toLowerCase())):T.value),ae=a=>{b.value=a,f.value.current=1,j()},te=[{title:"ç”¨æˆ·ç¼–å·",dataIndex:"userId",key:"userId",width:150},{title:"ç”¨æˆ·å§“å",dataIndex:"nickName",key:"nickName",width:150},{title:"å•ä½",dataIndex:"orgName",key:"orgName",width:300},{title:"å·²å®Œæˆå­¦æ—¶",dataIndex:"classHour",key:"classHour",width:150},{title:"å‚è®­æ—¶é—´",dataIndex:"joinTime",key:"joinTime",width:200},{title:"å‚è®­çŠ¶æ€",dataIndex:"currentTask",key:"currentTask",width:150,align:"center"}],se=[{title:"ç”¨æˆ·ç¼–å·",dataIndex:"userNumber",key:"userNumber",width:150},{title:"ç”¨æˆ·å§“å",dataIndex:"userName",key:"userName",width:150},{title:"å•ä½",dataIndex:"unit",key:"unit",width:250},{title:"ä»»åŠ¡å¼€å§‹æ—¶é—´",dataIndex:"taskStartTime",key:"taskStartTime",width:180},{title:"ä»»åŠ¡ç»“æŸæ—¶é—´",dataIndex:"taskEndTime",key:"taskEndTime",width:180},{title:"ç´¯è®¡æ—¶é—´",dataIndex:"totalTime",key:"totalTime",width:120},{title:"å·²å®Œæˆå­¦æ—¶",dataIndex:"classHour",key:"classHour",width:120},{title:"å®žéªŒçŠ¶æ€",dataIndex:"experimentStatus",key:"experimentStatus",width:120}],M=m([]),K=m([]),g=m({current:1,pageSize:20,total:0,showSizeChanger:!0,showQuickJumper:!0,showTotal:a=>`æ•°æ®å…± ${a} æ¡`}),f=m({current:1,pageSize:20,total:0,showSizeChanger:!0,showQuickJumper:!0,showTotal:a=>`æ•°æ®å…± ${a} æ¡`}),D=m(!1),H=m(!1),C=m(Number(E.query.id)||0),z=m(0),le=async()=>{try{const a={projectId:C.value,orderbyFiled:"task_id:asc"},e=await ge(a);e&&Array.isArray(e)&&(z.value=e.length,T.value=e.map(r=>({taskId:r.taskId,name:r.name})),T.value.length>0&&(b.value=T.value[0].taskId))}catch(a){console.error("èŽ·å–é¡¹ç›®ä»»åŠ¡åˆ—è¡¨å¤±è´¥:",a),w.error("èŽ·å–é¡¹ç›®ä»»åŠ¡åˆ—è¡¨å¤±è´¥")}},A=a=>{if(!a)return"-";const e=a<1e10?a*1e3:a,r=new Date(e),_=r.getFullYear(),d=String(r.getMonth()+1).padStart(2,"0"),i=String(r.getDate()).padStart(2,"0"),y=String(r.getHours()).padStart(2,"0"),h=String(r.getMinutes()).padStart(2,"0"),x=String(r.getSeconds()).padStart(2,"0");return`${_}-${d}-${i} ${y}:${h}:${x}`},U=async()=>{D.value=!0;try{const a={limit:g.value.pageSize,page:g.value.current,projectId:C.value};t.value.userNumber&&(a.userId=t.value.userNumber),t.value.userName&&(a.nickName=t.value.userName),t.value.unit&&(a.orgName=t.value.unit),t.value.status&&(a.status=t.value.status);const e=await ye(a);e&&e.list&&(M.value=e.list,g.value.total=e.total)}catch(a){console.error("èŽ·å–å‚è®­æ•°æ®å¤±è´¥:",a),w.error("èŽ·å–å‚è®­æ•°æ®å¤±è´¥")}finally{D.value=!1}},ne=(a,e)=>{if(!a||!e)return"-";const r=a<1e10?a*1e3:a,_=e<1e10?e*1e3:e,d=Math.floor((_-r)/1e3);if(d<0)return"-";const i=Math.floor(d/3600),y=Math.floor(d%3600/60),h=d%60;return`${String(i).padStart(2,"0")}:${String(y).padStart(2,"0")}:${String(h).padStart(2,"0")}`},oe=a=>a===10?"å·²å®Œæˆ":a>0&&a<10?"è¿›è¡Œä¸­":"æœªå¼€å§‹",re=a=>a===10?"completed":a>0&&a<10?"inProgress":"notStarted",j=async()=>{if(b.value){H.value=!0;try{const a={limit:f.value.pageSize,page:f.value.current,projectId:C.value,taskId:b.value,orderbyFiled:"id:desc"};t.value.userNumber&&(a.userId=t.value.userNumber),t.value.userName&&(a.nickName=t.value.userName),t.value.unit&&(a.orgName=t.value.unit);const e=await be(a);e&&e.list&&(K.value=e.list,f.value.total=e.total)}catch(a){console.error("èŽ·å–ä»»åŠ¡å®Œæˆæƒ…å†µå¤±è´¥:",a),w.error("èŽ·å–ä»»åŠ¡å®Œæˆæƒ…å†µå¤±è´¥")}finally{H.value=!1}}},V=()=>{console.log("æŸ¥è¯¢",t.value),S.value==="participation"?(g.value.current=1,U()):S.value==="task"&&(f.value.current=1,j())},q=()=>{t.value={userNumber:"",userName:"",unit:void 0,status:void 0},S.value==="participation"?(g.value.current=1,U()):S.value==="task"&&(f.value.current=1,j())},J=async()=>{var a;try{w.loading({content:"æ­£åœ¨å¯¼å‡º...",key:"export",duration:0});let e,r;if(S.value==="participation"){const i={limit:g.value.pageSize,page:g.value.current,projectId:C.value};t.value.userNumber&&(i.userId=t.value.userNumber),t.value.userName&&(i.nickName=t.value.userName),t.value.unit&&(i.orgName=t.value.unit),t.value.status&&(i.status=t.value.status),e=await Ne(i);const y=new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5);r=`${P.value||"é¡¹ç›®ç»Ÿè®¡"}_å‚è®­æ•´ä½“æƒ…å†µ_${y}.xlsx`}else{if(!b.value){w.error({content:"è¯·å…ˆé€‰æ‹©ä»»åŠ¡å…³å¡",key:"export"});return}const i={limit:f.value.pageSize,page:f.value.current,projectId:C.value,taskId:b.value,orderbyFiled:"id:desc"};t.value.userNumber&&(i.userId=t.value.userNumber),t.value.userName&&(i.nickName=t.value.userName),t.value.unit&&(i.orgName=t.value.unit),e=await he(i);const y=((a=T.value.find(x=>x.taskId===b.value))==null?void 0:a.name)||"ä»»åŠ¡",h=new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5);r=`${P.value||"é¡¹ç›®ç»Ÿè®¡"}_${y}_${h}.xlsx`}const _=window.URL.createObjectURL(e),d=document.createElement("a");d.href=_,d.download=r,document.body.appendChild(d),d.click(),document.body.removeChild(d),window.URL.revokeObjectURL(_),w.success({content:"å¯¼å‡ºæˆåŠŸ",key:"export"})}catch(e){console.error("å¯¼å‡ºå¤±è´¥:",e),w.error({content:e.message||"å¯¼å‡ºå¤±è´¥",key:"export"})}},ie=()=>{X.back()},ue=a=>{g.value.current=a.current,g.value.pageSize=a.pageSize,U()},de=a=>{f.value.current=a.current,f.value.pageSize=a.pageSize,j()};return fe(async()=>{R(),await le(),U(),b.value&&j()}),(a,e)=>{const r=Se,_=je,d=Ce,i=xe,y=Le,h=Te,x=$e,Q=Ie,ce=Pe;return p(),k("div",De,[o("div",He,[o("h2",null,v(P.value),1),l(r,{onClick:ie},{default:n(()=>e[9]||(e[9]=[u("è¿”å›ž")])),_:1,__:[9]})]),o("div",Ae,[l(ce,{activeKey:S.value,"onUpdate:activeKey":e[8]||(e[8]=s=>S.value=s),class:"statistics-tabs"},{default:n(()=>[l(Q,{key:"participation",tab:"å‚è®­æ•´ä½“æƒ…å†µ"},{default:n(()=>[o("div",Fe,[e[12]||(e[12]=o("div",{class:"filter-title"},"ç­›é€‰æŸ¥è¯¢",-1)),o("div",Ee,[l(h,{gutter:16,align:"middle"},{default:n(()=>[l(i,{span:5},{default:n(()=>[l(d,{label:"ç”¨æˆ·ç¼–å·ï¼š","label-col":{span:9},"wrapper-col":{span:15}},{default:n(()=>[l(_,{value:t.value.userNumber,"onUpdate:value":e[0]||(e[0]=s=>t.value.userNumber=s),placeholder:"è¯·è¾“å…¥"},null,8,["value"])]),_:1})]),_:1}),l(i,{span:5},{default:n(()=>[l(d,{label:"ç”¨æˆ·å§“åï¼š","label-col":{span:9},"wrapper-col":{span:15}},{default:n(()=>[l(_,{value:t.value.userName,"onUpdate:value":e[1]||(e[1]=s=>t.value.userName=s),placeholder:"è¯·è¾“å…¥"},null,8,["value"])]),_:1})]),_:1}),l(i,{span:5},{default:n(()=>[l(d,{label:"å•ä½ï¼š","label-col":{span:6},"wrapper-col":{span:18}},{default:n(()=>[l(y,{value:t.value.unit,"onUpdate:value":e[2]||(e[2]=s=>t.value.unit=s),placeholder:"è¯·è¾“å…¥å•ä½åç§°æœç´¢",options:L.value,"allow-clear":"","show-search":"","filter-option":!1,loading:I.value,"not-found-content":I.value?"åŠ è½½ä¸­...":"æš‚æ— æ•°æ®",onSearch:B},null,8,["value","options","loading","not-found-content"])]),_:1})]),_:1}),l(i,{span:5},{default:n(()=>[l(d,{label:"å‚è®­çŠ¶æ€ï¼š","label-col":{span:9},"wrapper-col":{span:15}},{default:n(()=>[l(y,{value:t.value.status,"onUpdate:value":e[3]||(e[3]=s=>t.value.status=s),placeholder:"è¯·é€‰æ‹©",options:Z,"allow-clear":""},null,8,["value"])]),_:1})]),_:1}),l(i,{span:4},{default:n(()=>[o("div",Re,[l(r,{type:"primary",onClick:V},{default:n(()=>e[10]||(e[10]=[u("æŸ¥è¯¢")])),_:1,__:[10]}),l(r,{onClick:q},{default:n(()=>e[11]||(e[11]=[u("é‡ç½®")])),_:1,__:[11]})])]),_:1})]),_:1})])]),o("div",Be,[o("div",Me,[o("div",Ke,[e[15]||(e[15]=u(" æ•°æ®åˆ—è¡¨ ")),o("span",Ve,[e[13]||(e[13]=u("æ•°æ®å…± ")),o("span",qe,v(g.value.total),1),e[14]||(e[14]=u(" æ¡"))])]),l(r,{type:"primary",onClick:J},{default:n(()=>e[16]||(e[16]=[u("å¯¼å‡º")])),_:1,__:[16]})]),l(x,{columns:te,"data-source":M.value,pagination:g.value,loading:D.value,"row-key":s=>s.id,scroll:{x:1e3},onChange:ue},{bodyCell:n(({column:s,record:c})=>[s.key==="nickName"?(p(),k("a",Je,v(c.nickName),1)):s.key==="classHour"?(p(),k(N,{key:1},[u(v(c.classHour??"0"),1)],64)):s.key==="joinTime"?(p(),k(N,{key:2},[u(v(A(c.joinTime)),1)],64)):s.key==="currentTask"?(p(),k("div",Qe,[o("span",null,v(c.currentTask)+" / "+v(z.value),1),o("span",{class:F(["status-icon",c.currentTask>=z.value?"completed":"inProgress"])},[c.currentTask>=z.value?(p(),Y(W(ze),{key:0})):(p(),Y(W(Ue),{key:1}))],2)])):G("",!0)]),_:1},8,["data-source","pagination","loading","row-key"])])]),_:1}),l(Q,{key:"task",tab:"ä»»åŠ¡å®Œæˆæƒ…å†µ"},{default:n(()=>[o("div",Ge,[e[19]||(e[19]=o("div",{class:"filter-title"},"ç­›é€‰æŸ¥è¯¢",-1)),o("div",Ye,[l(h,{gutter:16,align:"middle"},{default:n(()=>[l(i,{span:6},{default:n(()=>[l(d,{label:"ç”¨æˆ·ç¼–å·ï¼š","label-col":{span:8},"wrapper-col":{span:16}},{default:n(()=>[l(_,{value:t.value.userNumber,"onUpdate:value":e[4]||(e[4]=s=>t.value.userNumber=s),placeholder:"è¯·è¾“å…¥"},null,8,["value"])]),_:1})]),_:1}),l(i,{span:6},{default:n(()=>[l(d,{label:"ç”¨æˆ·å§“åï¼š","label-col":{span:8},"wrapper-col":{span:16}},{default:n(()=>[l(_,{value:t.value.userName,"onUpdate:value":e[5]||(e[5]=s=>t.value.userName=s),placeholder:"è¯·è¾“å…¥"},null,8,["value"])]),_:1})]),_:1}),l(i,{span:6},{default:n(()=>[l(d,{label:"å•ä½ï¼š","label-col":{span:6},"wrapper-col":{span:18}},{default:n(()=>[l(y,{value:t.value.unit,"onUpdate:value":e[6]||(e[6]=s=>t.value.unit=s),placeholder:"è¯·è¾“å…¥å•ä½åç§°æœç´¢",options:L.value,"allow-clear":"","show-search":"","filter-option":!1,loading:I.value,"not-found-content":I.value?"åŠ è½½ä¸­...":"æš‚æ— æ•°æ®",onSearch:B},null,8,["value","options","loading","not-found-content"])]),_:1})]),_:1}),l(i,{span:6},{default:n(()=>[o("div",We,[l(r,{type:"primary",onClick:V},{default:n(()=>e[17]||(e[17]=[u("æŸ¥è¯¢")])),_:1,__:[17]}),l(r,{onClick:q},{default:n(()=>e[18]||(e[18]=[u("é‡ç½®")])),_:1,__:[18]})])]),_:1})]),_:1})])]),o("div",Xe,[o("div",Ze,[o("div",ea,[l(_,{value:$.value,"onUpdate:value":e[7]||(e[7]=s=>$.value=s),placeholder:"è¯·è¾“å…¥å†…å®¹","allow-clear":""},{suffix:n(()=>e[20]||(e[20]=[o("span",{class:"search-icon"},"ðŸ”",-1)])),_:1},8,["value"])]),o("div",aa,[(p(!0),k(N,null,_e(ee.value,s=>(p(),k("div",{key:s.taskId,class:F(["task-level-item",{active:b.value===s.taskId}]),onClick:c=>ae(s.taskId)},v(s.name),11,ta))),128))])]),o("div",sa,[o("div",la,[o("div",na,[e[23]||(e[23]=u(" æ•°æ®åˆ—è¡¨ ")),o("span",oa,[e[21]||(e[21]=u("æ•°æ®å…± ")),o("span",ra,v(f.value.total),1),e[22]||(e[22]=u(" æ¡"))])]),l(r,{type:"primary",onClick:J},{default:n(()=>e[24]||(e[24]=[u("å¯¼å‡º")])),_:1,__:[24]})]),l(x,{columns:se,"data-source":K.value,pagination:f.value,loading:H.value,"row-key":s=>s.id,scroll:{x:1200},onChange:de},{bodyCell:n(({column:s,record:c})=>[s.key==="userNumber"?(p(),k(N,{key:0},[u(v(c.userId),1)],64)):s.key==="userName"?(p(),k("span",ia,v(c.nickName),1)):s.key==="unit"?(p(),k(N,{key:2},[u(v(c.orgName||"-"),1)],64)):s.key==="taskStartTime"?(p(),k(N,{key:3},[u(v(A(c.beginTime)),1)],64)):s.key==="taskEndTime"?(p(),k(N,{key:4},[u(v(A(c.endTime)),1)],64)):s.key==="totalTime"?(p(),k(N,{key:5},[u(v(ne(c.beginTime,c.endTime)),1)],64)):s.key==="classHour"?(p(),k(N,{key:6},[u(v(c.classHour??"-"),1)],64)):s.key==="experimentStatus"?(p(),k("span",{key:7,class:F(["status-tag",re(c.status)])},v(oe(c.status)),3)):G("",!0)]),_:1},8,["data-source","pagination","loading","row-key"])])])]),_:1})]),_:1},8,["activeKey"])])])}}}),fa=Oe(ua,[["__scopeId","data-v-8bb0261f"]]);export{fa as default};
