import{d as H,a9 as J,f as y,c as Q,o as K,_ as p,a1 as d,$ as i,k as n,a7 as r,G as _,aa as v,ad as W,F as h,ac as N}from"./vue-C8C4cLDH.js";import{l as X,a as Y,m as Z}from"./index-H3_z31XN.js";import{a as ee}from"./dictionary-Bk8jJhEY.js";import{aa as te,ab as ae,U as ne,V as oe,w as se,H as ie,a0 as le,F as ce,aq as re,a7 as k,M as $}from"./antd-BIZT1SGM.js";import{_ as ue}from"./index-DUZqzru9.js";const pe={class:"raining-project-management"},de={class:"search-section"},me={class:"table-section"},_e={class:"table-header"},ve={class:"table-tabs"},ge={class:"tabs-left"},he={class:"data-count"},ye={class:"tabs-right"},ke={key:4,class:"public-scope-cell"},fe={key:5,class:"action-links"},be=["onClick"],Ce=["onClick"],je=["onClick"],Te=["onClick"],ze=["onClick"],Se=H({name:"RainingProjectManagement",__name:"index",setup(xe){const T=J(),f=y([]),P=async()=>{try{const e=["project#environment_1","project#environment_2","project#environment_3"],t=await Promise.all(e.map(c=>ee({code:c}))),l=[];t.forEach(c=>{c&&c.list&&l.push(...c.list)}),f.value=l}catch(e){console.error("获取环境字典失败：",e),f.value=[]}},I=e=>{if(!e&&e!==0)return"-";const t=String(e),l=f.value.find(c=>c.value===t);return l?l.name:"-"},u=y({projectName:"",environment:void 0,organizer:void 0}),D=Q(()=>f.value.map(e=>({label:e.name,value:e.value}))),F=[{label:"中国科学院计算机网络信息中心",value:"中国科学院计算机网络信息中心"}],o=y({current:1,pageSize:10,total:0}),E=[{title:"项目名称",dataIndex:"projectName",key:"projectName"},{title:"实验环境",dataIndex:"environment",key:"environment"},{title:"技能标签",dataIndex:"skillTag",key:"skillTag"},{title:"主办单位",dataIndex:"organizer",key:"organizer"},{title:"公开范围",dataIndex:"publicScope",key:"publicScope"},{title:"操作",key:"action",width:280}],b=y([]),z=y(!1),g=async()=>{z.value=!0;try{const e={page:o.value.current,limit:o.value.pageSize,startNum:(o.value.current-1)*o.value.pageSize,name:u.value.projectName||void 0,orgName:u.value.organizer||void 0,orderbyFiled:"createTime:desc"},t=await X(e);b.value=t.list,o.value.total=t.count}catch(e){k.error(e.message||"获取项目列表失败"),b.value=[],o.value.total=0}finally{z.value=!1}},U=e=>{o.value.current=e.current,o.value.pageSize=e.pageSize,g()},A=()=>{u.value={projectName:"",environment:void 0,organizer:void 0},o.value.current=1,g()},B=()=>{o.value.current=1,g()};K(()=>{P(),g()});const M=()=>{T.push("/dashboard/raining-project-management/create")},O=e=>{T.push({path:"/dashboard/raining-project-management/statistics",query:{id:e.id,name:e.name}})},x=e=>{const t=e.status===1,l=t?"取消发布":"发布",c=t?0:1;$.confirm({title:`确认${l}`,content:`确定要${l}项目"${e.name}"吗？`,okText:"确认",cancelText:"取消",onOk:async()=>{try{await Y({id:e.id,status:c}),k.success(`${l}成功`),g()}catch(m){console.error(`${l}失败：`,m),k.error(m.message||`${l}失败`)}}})},q=e=>{T.push({path:"/dashboard/raining-project-management/edit",query:{id:e.id}})},L=e=>{$.confirm({title:"确认删除",content:`确定要删除项目"${e.name}"吗？删除后数据将无法恢复！`,okText:"确认删除",okType:"danger",cancelText:"取消",onOk:async()=>{try{await Z({id:e.id}),k.success("删除成功"),b.value.length===1&&o.value.current>1&&(o.value.current-=1),g()}catch(t){console.error("删除失败：",t),k.error(t.message||"删除失败")}}})};return(e,t)=>{const l=oe,c=ne,m=ae,w=se,S=ie,R=te,V=le,C=ce,G=re;return d(),p("div",pe,[i("div",de,[t[5]||(t[5]=i("h3",{class:"section-title"},"筛选查询",-1)),n(V,{model:u.value,layout:"horizontal",class:"search-form"},{default:r(()=>[n(R,{gutter:24},{default:r(()=>[n(m,{span:6},{default:r(()=>[n(c,{label:"项目名称：",name:"projectName"},{default:r(()=>[n(l,{value:u.value.projectName,"onUpdate:value":t[0]||(t[0]=s=>u.value.projectName=s),placeholder:"请输入项目名称"},null,8,["value"])]),_:1})]),_:1}),n(m,{span:6},{default:r(()=>[n(c,{label:"实验环境：",name:"environment"},{default:r(()=>[n(w,{value:u.value.environment,"onUpdate:value":t[1]||(t[1]=s=>u.value.environment=s),placeholder:"请选择实验环境",options:D.value,"allow-clear":""},null,8,["value","options"])]),_:1})]),_:1}),n(m,{span:6},{default:r(()=>[n(c,{label:"主办单位：",name:"organizer"},{default:r(()=>[n(w,{value:u.value.organizer,"onUpdate:value":t[2]||(t[2]=s=>u.value.organizer=s),placeholder:"请选择主办单位",options:F,"allow-clear":""},null,8,["value"])]),_:1})]),_:1}),n(m,{span:6,class:"form-actions"},{default:r(()=>[n(S,{type:"primary",onClick:B},{default:r(()=>t[3]||(t[3]=[_("查询")])),_:1,__:[3]}),n(S,{onClick:A},{default:r(()=>t[4]||(t[4]=[_("重置")])),_:1,__:[4]})]),_:1})]),_:1})]),_:1},8,["model"])]),i("div",me,[i("div",_e,[i("div",ve,[i("div",ge,[t[6]||(t[6]=i("span",{class:"tab-item active"},"数据列表",-1)),i("span",he,"数据共 "+v(o.value.total)+" 条",1)]),i("div",ye,[n(S,{type:"primary",onClick:M},{default:r(()=>t[7]||(t[7]=[_("新建项目")])),_:1,__:[7]})])])]),n(G,{columns:E,"data-source":b.value,loading:z.value,"row-key":s=>s.id,pagination:{current:o.value.current,pageSize:o.value.pageSize,total:o.value.total,showSizeChanger:!0,showQuickJumper:!0,showTotal:s=>`共 ${s} 条`},onChange:U,bordered:""},{bodyCell:r(({column:s,record:a})=>[s.key==="projectName"?(d(),p(h,{key:0},[_(v(a.name),1)],64)):s.key==="environment"?(d(),p(h,{key:1},[_(v(I(a.environment)),1)],64)):s.key==="skillTag"?(d(),p(h,{key:2},[_(v(a.tag),1)],64)):s.key==="organizer"?(d(),p(h,{key:3},[_(v(a.connectUnit||"-"),1)],64)):s.key==="publicScope"?(d(),p("div",ke,[i("div",{class:N(["status-badge",{"status-published":a.status===1,"status-unpublished":a.status!==1}])},v(a.status===1?"已发布":"未发布"),3),i("div",{class:N(["scope-badge",{"scope-full":a.authType===1,"scope-academy":a.authType===2,"scope-unit":a.authType===3,"scope-private":a.authType===4}])},v(a.authType===1?"完全公开":a.authType===2?"全院公开":a.authType===3?"本单位公开":a.authType===4?"不公开":"-"),3)])):s.key==="action"?(d(),p("div",fe,[i("a",{onClick:j=>O(a)},"统计",8,be),a.status===1?(d(),p(h,{key:0},[n(C,{type:"vertical"}),i("a",{onClick:j=>x(a)},"取消发布",8,Ce),n(C,{type:"vertical"}),i("a",{onClick:j=>q(a)},"编辑",8,je)],64)):(d(),p(h,{key:1},[n(C,{type:"vertical"}),i("a",{onClick:j=>x(a)},"发布",8,Te)],64)),n(C,{type:"vertical"}),i("a",{class:"danger-link",onClick:j=>L(a)},"删除",8,ze)])):W("",!0)]),_:1},8,["data-source","loading","row-key","pagination"])])])}}}),De=ue(Se,[["__scopeId","data-v-ccb67505"]]);export{De as default};
