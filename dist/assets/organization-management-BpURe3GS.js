import{g as C}from"./organization-1AxhLWQZ.js";import{ar as G,H,ap as P,I as Y,Y as j,ad as q,ai as J,al as Q,as as R,at as W,a1 as v}from"./antd-DHaIpRVu.js";import{d as X,f,o as Z,_ as m,a1 as h,$ as n,k as s,u as K,a7 as o,G as u,a6 as ee,ac as L,a9 as d}from"./vue-PnzzEkKE.js";import{_ as ae}from"./index-CHw3NtI0.js";const te={class:"organization-management"},se={class:"content-wrapper"},le={class:"left-panel"},ne={class:"panel-header"},oe={class:"header-title"},ie={class:"title-icon"},re={class:"search-box"},ce={key:0,class:"loading-container"},de={key:1,class:"empty-search"},ue={key:2,class:"tree-container"},_e={class:"tree-node-title"},ve={class:"node-name"},pe={class:"panel-footer"},fe={class:"stats-info"},he={class:"stat-item"},ge={class:"stat-label"},me={class:"stat-value"},ye={key:0,class:"search-tip"},ke={class:"right-panel"},be={key:0,class:"detail-content"},De={key:1,class:"empty-content"},xe=X({name:"OrganizationManagement",__name:"organization-management",setup(Ie){const l=f([]),r=f(null),y=f([]),k=f([]),b=f(""),x=f(!1),g=f(!1),w=f(new Set),$=t=>{let e=0;const a=c=>{c.forEach(i=>{e++,i.children&&i.children.length>0&&a(i.children)})};return a(t),e},N=async()=>{try{g.value=!0;const t=await C({limit:1e4,page:1,startNum:0,orderbyFiled:"orgCode:asc",parentOrgID:0});if(t&&t.data&&t.data.list)if(l.value=t.data.list.map(e=>({...e,key:e.orgID,children:[],isLeaf:!1})),l.value.length>0){k.value=[l.value[0].orgID],r.value=l.value[0];const e=[];let a=0;for(const c of l.value){const i=await S(c.orgID,!0);i>0&&(e.push(c.orgID),a+=i)}y.value=e,a>0?v.success(`成功加载 ${l.value.length} 个顶级组织和 ${a} 个子组织`):v.success(`成功加载 ${l.value.length} 个顶级组织`)}else v.success(`成功加载 ${l.value.length} 个顶级组织`);else v.warning("未获取到组织数据")}catch(t){console.error("获取组织列表失败:",t),v.error("获取组织列表失败，请稍后重试")}finally{g.value=!1}},z=(t,e)=>{for(const a of t){if(a.orgID===e)return a;if(a.children&&a.children.length>0){const c=z(a.children,e);if(c)return c}}return null},S=async(t,e=!1)=>{try{w.value.add(t);const a=await C({limit:1e4,page:1,startNum:0,orderbyFiled:"orgCode:asc",parentOrgID:t});if(a&&a.data&&a.data.list){const c=a.data.list.map(D=>({...D,key:D.orgID,children:[],isLeaf:!1})),i=z(l.value,t);return i&&(i.children=c,c.length===0&&(i.isLeaf=!0)),l.value=[...l.value],c.length}return 0}catch(a){return console.error("加载子节点失败:",a),e||v.error("加载子节点失败"),0}finally{w.value.delete(t)}},B=async(t,e)=>{if(y.value=t,e.expanded){const a=e.node,c=a.orgID;if(a.children&&a.children.length===0&&!a.isLeaf){const i=await S(c);i>0&&v.success(`加载了 ${i} 个子组织`)}}},V=(t,e)=>{t.length>0&&(k.value=t,r.value=e.node)},E=async()=>{const t=b.value.trim();if(!t){I();return}try{x.value=!0,g.value=!0;const e=await C({limit:1e4,page:1,startNum:0,orderbyFiled:"orgCode:asc",orgName:t});e&&e.data&&e.data.list?(l.value=e.data.list.map(a=>({...a,key:a.orgID,children:[],isLeaf:!0})),k.value=[],r.value=null,y.value=[],v.success(`找到 ${l.value.length} 个匹配的组织`)):(l.value=[],v.warning("未找到匹配的组织"))}catch(e){console.error("搜索组织失败:",e),v.error("搜索失败，请稍后重试")}finally{g.value=!1}},I=async()=>{b.value="",x.value=!1,k.value=[],r.value=null,y.value=[],await N()},O=()=>{b.value.trim()?E():I()},A=()=>{I()};return Z(()=>{N()}),(t,e)=>{const a=H,c=Y,i=j,D=q,F=J,M=Q,_=R,U=W;return h(),m("div",te,[n("div",se,[n("div",le,[n("div",ne,[n("div",oe,[n("div",ie,[s(K(G))]),e[3]||(e[3]=n("span",{class:"title-text"}," 组织架构 ",-1))])]),n("div",re,[s(c,{value:b.value,"onUpdate:value":e[0]||(e[0]=p=>b.value=p),placeholder:"搜索组织名称...","allow-clear":"",class:"modern-search",disabled:g.value,onPressEnter:O,onClear:A},{prefix:o(()=>[s(K(P))]),suffix:o(()=>[s(a,{type:"primary",size:"small",loading:g.value,onClick:O},{default:o(()=>e[4]||(e[4]=[u(" 搜索 ")])),_:1,__:[4]},8,["loading"])]),_:1},8,["value","disabled"])]),g.value?(h(),m("div",ce,[s(i,{size:"large",tip:"加载中..."})])):l.value.length===0?(h(),m("div",de,[s(D,{description:"未找到匹配的组织"})])):(h(),m("div",ue,[s(M,{"expanded-keys":y.value,"onUpdate:expandedKeys":e[1]||(e[1]=p=>y.value=p),"selected-keys":k.value,"onUpdate:selectedKeys":e[2]||(e[2]=p=>k.value=p),"tree-data":l.value,"field-names":{title:"orgName",key:"orgID",children:"children"},"show-line":"",onExpand:B,onSelect:V},{title:o(({orgName:p,orgID:T})=>[s(F,{title:p,placement:"topLeft"},{default:o(()=>[n("div",_e,[n("span",ve,d(p),1),w.value.has(T)?(h(),ee(i,{key:0,size:"small",class:"ml-2"})):L("",!0)])]),_:2},1032,["title"])]),_:1},8,["expanded-keys","selected-keys","tree-data"])])),n("div",pe,[n("div",fe,[n("div",he,[n("span",ge,d(x.value?"搜索结果":"已加载"),1),n("span",me,d($(l.value)),1)])]),x.value?(h(),m("div",ye,[s(a,{type:"link",size:"small",onClick:I},{default:o(()=>e[5]||(e[5]=[u(" 清空搜索，返回树形结构 ")])),_:1,__:[5]})])):L("",!0)])]),n("div",ke,[e[6]||(e[6]=n("div",{class:"detail-header"},[n("h3",null,"基本信息")],-1)),r.value?(h(),m("div",be,[s(U,{bordered:"",column:1},{default:o(()=>[s(_,{label:"单位名称"},{default:o(()=>[u(d(r.value.orgName),1)]),_:1}),s(_,{label:"单位编号"},{default:o(()=>[u(d(r.value.orgCode),1)]),_:1}),s(_,{label:"组织ID"},{default:o(()=>[u(d(r.value.orgID),1)]),_:1}),s(_,{label:"上级单位ID"},{default:o(()=>[u(d(r.value.parentOrgID||"-"),1)]),_:1}),s(_,{label:"上级单位名称"},{default:o(()=>[u(d(r.value.parentOrgName||"-"),1)]),_:1}),s(_,{label:"是否有效"},{default:o(()=>[u(d(r.value.status===1?"是":"否"),1)]),_:1}),s(_,{label:"序号"},{default:o(()=>[u(d(r.value.sortID||"-"),1)]),_:1}),s(_,{label:"组织层级"},{default:o(()=>[u(d(r.value.orglevel||"-"),1)]),_:1}),s(_,{label:"是否独立组织培训机构"},{default:o(()=>[u(d(r.value.isOrg===1?"是":"否"),1)]),_:1}),s(_,{label:"是否虚拟组织机构"},{default:o(()=>[u(d(r.value.isVirOrg===1?"是":"否"),1)]),_:1})]),_:1})])):(h(),m("div",De,[s(D,{description:"请在左侧选择组织"})]))])])])}}}),Se=ae(xe,[["__scopeId","data-v-d4b61a06"]]);export{Se as default};
