import{n as S,_ as X}from"./index-L25N5W2M.js";import{g as Y}from"./role-B8n16QGd.js";import{g as Z}from"./personnel-Dmpes5vC.js";import{z as ee,I as ae,S as te,H as le,K as oe,a6 as se,ab as ne,ac as re,al as ie,a1 as ue,M as O,ae as c,ak as de}from"./antd-Drh1eHWx.js";import{d as ce,r as P,f as d,o as me,_ as y,a1 as g,$ as n,k as l,a7 as s,G as _,a9 as w,u as B,ac as pe,F as T,a6 as ge,l as _e}from"./vue-PnzzEkKE.js";async function ve(m){return S("/admin/api/roleUser/getListPager",m,{customDev:!0})}async function fe(m){return S("/admin/api/roleUser/create",m,{customDev:!0})}async function ye(m){return S("/role-assignment/batch-delete",{ids:m})}const Ne={class:"role-assignment"},ke={class:"content-wrapper"},he={class:"main-panel"},we={class:"query-form"},Ie={class:"table-header"},be={class:"table-info"},Ce={class:"info-value"},xe={class:"table-actions"},Se={class:"table-container"},Ae={key:0,class:"user-link"},Ue={key:1},Re=ce({name:"RoleAssignment",__name:"role-assignment",setup(m){const o=P({nickName:"",roleName:"",pageNum:1,pageSize:10}),I=d(!1),A=d([]),b=d(0),u=d([]),N=d([]),$=[{title:"用户ID",dataIndex:"userId",key:"userId"},{title:"用户姓名",dataIndex:"nickName",key:"nickName"},{title:"单位",dataIndex:"orgName",key:"orgName",ellipsis:!0},{title:"角色名称",dataIndex:"roleName",key:"roleName"}],k=d(!1),C=d(!1),U=d([]),R=d([]),i=P({userId:void 0,roleId:void 0}),p=async()=>{I.value=!0;try{const t={nickName:o.nickName,roleName:o.roleName,page:o.pageNum,limit:o.pageSize},e=await ve(t);e.data&&e.data.list&&(A.value=e.data.list,b.value=e.data.count)}catch{c.error("获取角色分配列表失败")}finally{I.value=!1}},q=async()=>{try{const t=await Y({page:1,limit:1e3,startNum:0});t.data&&t.data.list&&(U.value=t.data.list)}catch(t){console.error("获取角色列表失败:",t)}},V=async()=>{try{const t=await Z({page:1,limit:1e3,startNum:0});t.data&&t.data.list&&(R.value=t.data.list)}catch(t){console.error("获取用户列表失败:",t)}},x=()=>{o.pageNum=1,u.value=[],N.value=[],p()},E=()=>{o.nickName="",o.roleName="",o.pageNum=1,o.pageSize=10,u.value=[],N.value=[],p()},F=(t,e)=>{u.value=t,N.value=e},K=()=>{i.userId=void 0,i.roleId=void 0,k.value=!0},M=async()=>{if(!i.userId||!i.roleId){c.error("请填写所有必填项");return}C.value=!0;try{await fe({roleId:Number(i.roleId),userId:Number(i.userId)}),c.success("分配成功"),k.value=!1,p()}catch{c.error("分配失败")}finally{C.value=!1}},Q=()=>{if(u.value.length===0){c.warning("请选择要删除的角色分配");return}O.confirm({title:"确认批量删除",icon:_e(de),content:`确定要删除选中的 ${u.value.length} 条角色分配记录吗？`,okText:"确定",cancelText:"取消",onOk:async()=>{try{await ye(u.value),c.success("批量删除成功"),u.value=[],N.value=[],p()}catch{c.error("批量删除失败")}}})},G=t=>{o.pageNum=t.current,o.pageSize=t.pageSize,p()};return me(()=>{p(),q(),V()}),(t,e)=>{const D=ae,v=ee,h=le,H=te,L=oe,J=re,j=ie,z=ue,W=O;return g(),y("div",Ne,[n("div",ke,[n("div",he,[e[12]||(e[12]=n("div",{class:"query-header"},[n("h3",null,"筛选查询")],-1)),n("div",we,[l(L,{layout:"inline"},{default:s(()=>[l(v,{label:"用户姓名"},{default:s(()=>[l(D,{value:o.nickName,"onUpdate:value":e[0]||(e[0]=a=>o.nickName=a),placeholder:"请输入","allow-clear":"",style:{width:"200px"},onPressEnter:x},null,8,["value"])]),_:1}),l(v,{label:"角色名称"},{default:s(()=>[l(D,{value:o.roleName,"onUpdate:value":e[1]||(e[1]=a=>o.roleName=a),placeholder:"请输入","allow-clear":"",style:{width:"200px"},onPressEnter:x},null,8,["value"])]),_:1}),l(v,null,{default:s(()=>[l(H,null,{default:s(()=>[l(h,{type:"primary",onClick:x},{default:s(()=>e[5]||(e[5]=[_(" 查询 ")])),_:1,__:[5]}),l(h,{onClick:E},{default:s(()=>e[6]||(e[6]=[_(" 重置 ")])),_:1,__:[6]})]),_:1})]),_:1})]),_:1})]),n("div",Ie,[n("div",be,[e[7]||(e[7]=n("span",{class:"info-label"},"数据列表",-1)),e[8]||(e[8]=n("span",{class:"info-divider"},"数据共",-1)),n("span",Ce,w(b.value),1),e[9]||(e[9]=n("span",{class:"info-unit"},"条",-1))]),n("div",xe,[l(h,{type:"primary",onClick:K},{icon:s(()=>[l(B(se))]),default:s(()=>[e[10]||(e[10]=_(" 新增分配 "))]),_:1,__:[10]}),l(h,{danger:"",disabled:u.value.length===0,onClick:Q},{icon:s(()=>[l(B(ne))]),default:s(()=>[e[11]||(e[11]=_(" 批量删除 "))]),_:1,__:[11]},8,["disabled"])])]),n("div",Se,[l(j,{columns:$,"data-source":A.value,loading:I.value,pagination:{current:o.pageNum,pageSize:o.pageSize,total:b.value,showSizeChanger:!0,showQuickJumper:!0,showTotal:a=>`共 ${a} 条`},"row-selection":{selectedRowKeys:u.value,onChange:F},scroll:{x:1e3},"row-key":"id",onChange:G},{bodyCell:s(({column:a,record:r})=>[a.key==="nickName"?(g(),y("a",Ae,w(r.nickName||"-"),1)):a.key==="roleName"?(g(),y(T,{key:1},[r.roleName?(g(),ge(J,{key:0,color:"blue"},{default:s(()=>[_(w(r.roleName),1)]),_:2},1024)):(g(),y("span",Ue,"-"))],64)):a.key==="orgName"?(g(),y(T,{key:2},[_(w(r.orgName||"-"),1)],64)):pe("",!0)]),_:1},8,["data-source","loading","pagination","row-selection"])])])]),l(W,{open:k.value,"onUpdate:open":e[4]||(e[4]=a=>k.value=a),title:"新增角色分配",width:600,"confirm-loading":C.value,onOk:M},{default:s(()=>[l(L,{model:i,"label-col":{span:6},"wrapper-col":{span:16},style:{"margin-top":"24px"}},{default:s(()=>[l(v,{label:"选择用户",name:"userId",rules:[{required:!0,message:"请选择用户",trigger:"change"}]},{default:s(()=>[l(z,{value:i.userId,"onUpdate:value":e[2]||(e[2]=a=>i.userId=a),placeholder:"请选择用户","allow-clear":"","show-search":"","filter-option":(a,r)=>{var f;return((f=r==null?void 0:r.label)==null?void 0:f.toLowerCase().indexOf(a.toLowerCase()))>=0},options:R.value.map(a=>({label:`${a.operatorName} - ${a.userID} - ${a.orgName}`,value:a.operatorID}))},null,8,["value","filter-option","options"])]),_:1}),l(v,{label:"授予角色",name:"roleId",rules:[{required:!0,message:"请选择角色",trigger:"change"}]},{default:s(()=>[l(z,{value:i.roleId,"onUpdate:value":e[3]||(e[3]=a=>i.roleId=a),placeholder:"请选择角色","allow-clear":"","show-search":"","filter-option":(a,r)=>{var f;return((f=r==null?void 0:r.label)==null?void 0:f.toLowerCase().indexOf(a.toLowerCase()))>=0},options:U.value.map(a=>({label:a.name,value:a.roleId}))},null,8,["value","filter-option","options"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","confirm-loading"])])}}}),Be=X(Re,[["__scopeId","data-v-2fe2276d"]]);export{Be as default};
