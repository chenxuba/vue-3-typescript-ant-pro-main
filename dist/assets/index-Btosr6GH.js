import{d as ue,ak as re,f as m,c as q,o as pe,_,a1 as d,$ as o,k as n,a7 as i,G as f,a9 as h,a6 as ve,ac as de,F as b,ab as B}from"./vue-PnzzEkKE.js";import{p as me,a as R,q as _e}from"./index-B4vHWS7k.js";import{a as ge}from"./dictionary-Cogn3OR_.js";import{g as he}from"./organization-CuE9Y8nO.js";import{a4 as ye,a5 as ke,z as fe,I as be,a6 as Ce,H as Te,K as ze,aj as je,x as Ne,an as $e,a7 as we,M as F,a1 as y}from"./antd-Cme2pY03.js";import{_ as Se}from"./index-BGDR-97V.js";const xe={class:"raining-project-management"},Oe={class:"search-section"},Ie={class:"table-section"},Pe={class:"table-header"},Ae={class:"table-tabs"},Ee={class:"tabs-left"},Me={class:"data-count"},Fe={class:"tabs-right"},Le={key:4,class:"public-scope-cell"},De={key:5,class:"action-links"},Ve=["onClick"],qe=["onClick"],Be=["onClick"],Re=["onClick"],Ue=["onClick"],Ge=["onClick"],He=["onClick"],Je=["onClick"],Ke=["onClick"],Qe=["onClick"],We=["onClick"],Xe=["onClick"],Ye=["onClick"],Ze={class:"visibility-modal-content"},et={class:"project-info"},tt=ue({name:"RainingProjectManagement",__name:"index",setup(at){const w=re(),z=m([]),S=m([]),j=m(!1),U=async()=>{try{const t=["project#environment_1","project#environment_2","project#environment_3"],e=await Promise.all(t.map(l=>ge({code:l}))),u=[];e.forEach(l=>{l&&l.list&&u.push(...l.list)});const r=new Map;u.forEach(l=>{r.has(l.value)||r.set(l.value,l)}),z.value=Array.from(r.values())}catch(t){console.error("获取环境字典失败：",t),z.value=[]}},L=async(t="")=>{j.value=!0;try{const e=await he({limit:50,page:1,startNum:0,orderbyFiled:"orgCode:asc",orgName:t||void 0});e&&e.data&&e.data.list&&(S.value=e.data.list)}catch(e){console.error("获取组织列表失败：",e),S.value=[]}finally{j.value=!1}};let x=null;const G=t=>{x&&clearTimeout(x),x=setTimeout(()=>{L(t)},300)},H=t=>{if(!t&&t!==0)return"-";const e=String(t),u=z.value.find(r=>r.value===e);return u?u.name:"-"},v=m({projectName:"",environment:void 0,organizer:void 0}),J=q(()=>z.value.map(t=>({label:t.name,value:t.value}))),K=q(()=>{const t=new Map;return S.value.forEach(e=>{e.orgName&&!t.has(e.orgName)&&t.set(e.orgName,e.orgName)}),Array.from(t.values()).sort().map(e=>({label:e,value:e}))}),c=m({current:1,pageSize:10,total:0}),Q=[{title:"项目名称",dataIndex:"projectName",key:"projectName"},{title:"实验环境",dataIndex:"environment",key:"environment"},{title:"技能标签",dataIndex:"skillTag",key:"skillTag",ellipsis:!0},{title:"主办单位",dataIndex:"organizer",key:"organizer"},{title:"公开范围",dataIndex:"publicScope",key:"publicScope"},{title:"操作",key:"action",width:280}],N=m([]),O=m(!1),k=async()=>{O.value=!0;try{const t={page:c.value.current,limit:c.value.pageSize,startNum:(c.value.current-1)*c.value.pageSize,name:v.value.projectName||void 0,orgName:v.value.organizer||void 0,environment:v.value.environment||void 0,orderbyFiled:"createTime:desc"},e=await me(t);N.value=e.list,c.value.total=e.total}catch(t){y.error(t.message||"获取项目列表失败"),N.value=[],c.value.total=0}finally{O.value=!1}},W=t=>{c.value.current=t.current,c.value.pageSize=t.pageSize,k()},X=()=>{v.value={projectName:"",environment:void 0,organizer:void 0},c.value.current=1,k()},Y=()=>{c.value.current=1,k()};pe(()=>{U(),L(),k()});const Z=()=>{w.push("/dashboard/raining-project-management/create")},I=t=>{w.push({path:"/dashboard/raining-project-management/statistics",query:{id:t.id,name:t.name}})},P=t=>{const e=t.status===10,u=e?"取消发布":"发布",r=e?2:10;if(r===10&&t.authType===4){y.warning("可见范围为不公开，不支持发布");return}F.confirm({title:`确认${u}`,content:`确定要${u}项目"${t.name}"吗？`,okText:"确认",cancelText:"取消",onOk:async()=>{try{await R({id:t.id,status:r}),y.success(`${u}成功`),k()}catch(l){console.error(`${u}失败：`,l),y.error(l.message||`${u}失败`)}}})},A=t=>{w.push({path:"/dashboard/raining-project-management/edit",query:{id:t.id}})},E=t=>{F.confirm({title:"确认删除",content:`确定要删除项目"${t.name}"吗？删除后数据将无法恢复！`,okText:"确认删除",okType:"danger",cancelText:"取消",onOk:async()=>{try{await _e({id:t.id}),y.success("删除成功"),N.value.length===1&&c.value.current>1&&(c.value.current-=1),k()}catch(e){console.error("删除失败：",e),y.error(e.message||"删除失败")}}})},C=m(!1),$=m(null),T=m({authType:1}),ee=[{label:"完全公开",value:1},{label:"全院公开",value:2},{label:"本单位公开",value:3},{label:"不公开",value:4}],te=t=>{$.value=t,T.value.authType=t.authType||1,C.value=!0},ae=async()=>{try{await R({id:$.value.id,authType:T.value.authType}),y.success("可见范围修改成功"),C.value=!1,k()}catch(t){console.error("修改可见范围失败：",t),y.error(t.message||"修改可见范围失败")}},ne=()=>{C.value=!1,$.value=null};return(t,e)=>{const u=be,r=fe,l=ke,D=Ce,M=Te,oe=ye,V=ze,se=je,g=Ne,le=$e,ie=we,ce=F;return d(),_("div",xe,[o("div",Oe,[e[7]||(e[7]=o("h3",{class:"section-title"},"筛选查询",-1)),n(V,{model:v.value,layout:"horizontal",class:"search-form"},{default:i(()=>[n(oe,{gutter:24},{default:i(()=>[n(l,{span:6},{default:i(()=>[n(r,{label:"项目名称：",name:"projectName"},{default:i(()=>[n(u,{value:v.value.projectName,"onUpdate:value":e[0]||(e[0]=s=>v.value.projectName=s),placeholder:"请输入项目名称"},null,8,["value"])]),_:1})]),_:1}),n(l,{span:6},{default:i(()=>[n(r,{label:"实验环境：",name:"environment"},{default:i(()=>[n(D,{value:v.value.environment,"onUpdate:value":e[1]||(e[1]=s=>v.value.environment=s),placeholder:"请选择实验环境",options:J.value,"allow-clear":""},null,8,["value","options"])]),_:1})]),_:1}),n(l,{span:6},{default:i(()=>[n(r,{label:"主办单位：",name:"organizer"},{default:i(()=>[n(D,{value:v.value.organizer,"onUpdate:value":e[2]||(e[2]=s=>v.value.organizer=s),placeholder:"请输入主办单位名称搜索",options:K.value,"allow-clear":"","show-search":"","filter-option":!1,loading:j.value,"not-found-content":j.value?"加载中...":"暂无数据",onSearch:G},null,8,["value","options","loading","not-found-content"])]),_:1})]),_:1}),n(l,{span:6,class:"form-actions"},{default:i(()=>[n(M,{type:"primary",onClick:Y},{default:i(()=>e[5]||(e[5]=[f("查询")])),_:1,__:[5]}),n(M,{onClick:X},{default:i(()=>e[6]||(e[6]=[f("重置")])),_:1,__:[6]})]),_:1})]),_:1})]),_:1},8,["model"])]),o("div",Ie,[o("div",Pe,[o("div",Ae,[o("div",Ee,[e[8]||(e[8]=o("span",{class:"tab-item active"},"数据列表",-1)),o("span",Me,"数据共 "+h(c.value.total)+" 条",1)]),o("div",Fe,[n(M,{type:"primary",onClick:Z},{default:i(()=>e[9]||(e[9]=[f("新建项目")])),_:1,__:[9]})])])]),n(le,{columns:Q,"data-source":N.value,loading:O.value,"row-key":s=>s.id,pagination:{current:c.value.current,pageSize:c.value.pageSize,total:c.value.total,showSizeChanger:!0,showQuickJumper:!0,showTotal:s=>`共 ${s} 条`},onChange:W,bordered:""},{bodyCell:i(({column:s,record:a})=>[s.key==="projectName"?(d(),_(b,{key:0},[f(h(a.name),1)],64)):s.key==="environment"?(d(),_(b,{key:1},[f(h(H(a.environment)),1)],64)):s.key==="skillTag"?(d(),ve(se,{key:2,title:a.tag,placement:"topLeft"},{default:i(()=>[o("span",null,h(a.tag),1)]),_:2},1032,["title"])):s.key==="organizer"?(d(),_(b,{key:3},[f(h(a.orgName||"-"),1)],64)):s.key==="publicScope"?(d(),_("div",Le,[o("div",{class:B(["status-badge",{"status-published":a.status===10,"status-unpublished":a.status!==10}])},h(a.status===10?"已发布":a.status===2?"已取消发布":(a.status===1,"已中断")),3),o("div",{class:B(["scope-badge",{"scope-full":a.authType===1,"scope-academy":a.authType===2,"scope-unit":a.authType===3,"scope-private":a.authType===4}])},h(a.authType===1?"完全公开":a.authType===2?"全院公开":a.authType===3?"本单位公开":a.authType===4?"不公开":"-"),3)])):s.key==="action"?(d(),_("div",De,[a.status===1?(d(),_(b,{key:0},[o("a",{onClick:p=>A(a)},"编辑",8,Ve),n(g,{type:"vertical"}),o("a",{class:"danger-link",onClick:p=>E(a)},"删除",8,qe)],64)):a.status===10?(d(),_(b,{key:1},[o("a",{onClick:p=>I(a)},"统计",8,Be),n(g,{type:"vertical"}),o("a",{onClick:p=>te(a)},"可见范围",8,Re),n(g,{type:"vertical"}),o("a",{onClick:p=>P(a)},"取消发布",8,Ue)],64)):a.status===2?(d(),_(b,{key:2},[o("a",{onClick:p=>I(a)},"统计",8,Ge),n(g,{type:"vertical"}),o("a",{onClick:p=>P(a)},"发布",8,He),n(g,{type:"vertical"}),o("a",{onClick:p=>A(a)},"编辑",8,Je),n(g,{type:"vertical"}),o("a",{class:"danger-link",onClick:p=>E(a)},"删除",8,Ke)],64)):(d(),_(b,{key:3},[o("a",{onClick:p=>I(a)},"统计",8,Qe),n(g,{type:"vertical"}),o("a",{onClick:p=>P(a)},"发布",8,We),n(g,{type:"vertical"}),o("a",{onClick:p=>A(a)},"编辑",8,Xe),n(g,{type:"vertical"}),o("a",{class:"danger-link",onClick:p=>E(a)},"删除",8,Ye)],64))])):de("",!0)]),_:1},8,["data-source","loading","row-key","pagination"])]),n(ce,{open:C.value,"onUpdate:open":e[4]||(e[4]=s=>C.value=s),title:"修改可见范围",width:500,onOk:ae,onCancel:ne},{default:i(()=>{var s;return[o("div",Ze,[o("p",et,[e[10]||(e[10]=f(" 项目名称：")),o("strong",null,h((s=$.value)==null?void 0:s.name),1)]),n(V,{model:T.value,layout:"vertical"},{default:i(()=>[n(r,{label:"可见范围",name:"authType"},{default:i(()=>[n(ie,{value:T.value.authType,"onUpdate:value":e[3]||(e[3]=a=>T.value.authType=a),options:ee},null,8,["value"])]),_:1})]),_:1},8,["model"])])]}),_:1},8,["open"])])}}}),ut=Se(tt,[["__scopeId","data-v-a0d06513"]]);export{ut as default};
