import{n as ee,_ as te}from"./index-C3OFe7rM.js";import{g as ae}from"./organization-V3-2LX9q.js";import{ap as se,am as ne,I as oe,af as le,a8 as B,aq as re,ae as ie,ai as ce,z as de,S as ue,H as pe,K as _e,an as he,ak as me,ad as f}from"./antd-C8FlOT2N.js";import{d as ge,f as h,r as ve,w as fe,o as ye,_ as m,a1 as p,$ as s,k as r,u as T,a7 as c,ac as $,a9 as g,G as M,a6 as q}from"./vue-PnzzEkKE.js";async function ke(F){return await ee("/web/api/user/getAllUsers",F,{customDev:!0})}const Ne={class:"personnel-management"},Ie={class:"content-wrapper"},we={class:"left-panel"},be={class:"panel-header"},xe={class:"header-title"},Ce={class:"title-icon"},Se={class:"search-box"},Ee={key:0,class:"loading-container"},De={key:1,class:"empty-search"},Oe={key:2,class:"tree-container"},ze={key:0,class:"search-result-tip"},Le={class:"ml-6px"},Te={class:"tree-node-title"},Me={class:"node-name"},Ae={class:"panel-footer"},Pe={class:"stats-info"},Ue={class:"stat-item"},Fe={class:"stat-value"},Ke={class:"right-panel"},Ve={class:"query-form"},Be={class:"table-header"},$e={class:"table-info"},qe={class:"info-value"},Je={class:"table-container"},Re={key:0,class:"user-link"},Ge={key:1},Qe={key:2},He={key:3},je=ge({name:"PersonnelManagement",__name:"personnel-management",setup(F){const _=h([]),x=h([]),J=h(null),I=h([]),A=h([]),w=h(""),C=h(!1),n=ve({userID:"",operatorName:"",orgName:"",page:1,pageSize:10,orderbyFiled:"createTime:desc"}),P=h(!1),K=h([]),U=h(0),R=[{title:"用户编号",dataIndex:"operatorID",key:"operatorID",width:160},{title:"用户昵称",dataIndex:"operatorName",key:"operatorName",width:140},{title:"单位",dataIndex:"orgName",key:"orgName",width:200,ellipsis:!0},{title:"是否管理人",dataIndex:"isAdmin",key:"isAdmin",width:120},{title:"手机号",dataIndex:"mobileNO",key:"mobileNO",width:140},{title:"邮箱",dataIndex:"oEmail",key:"oEmail",width:200,ellipsis:!0},{title:"状态",dataIndex:"status",key:"status",width:100},{title:"操作",key:"action",width:150,fixed:"right"}],S=t=>{const e=[],o=l=>{l.forEach(i=>{i.id&&e.push(i.id),i.children&&i.children.length>0&&o(i.children)})};return o(t),e},E=t=>JSON.parse(JSON.stringify(t)),V=(t,e)=>{if(!e)return E(t);const o=[];return t.forEach(l=>{var d,v;const i={...l},u=(d=l.name)==null?void 0:d.toLowerCase().includes(e.toLowerCase()),y=(v=l.code)==null?void 0:v.toLowerCase().includes(e.toLowerCase());if(l.children&&l.children.length>0){const k=V(l.children,e);k.length>0?(i.children=k,o.push(i)):(u||y)&&(delete i.children,o.push(i))}else(u||y)&&o.push(i)}),o},G=(t,e)=>{if(!e)return[];const o=[],l=(i,u=[])=>{let y=!1;return i.forEach(d=>{var L,a;const v=(L=d.name)==null?void 0:L.toLowerCase().includes(e.toLowerCase()),k=(a=d.code)==null?void 0:a.toLowerCase().includes(e.toLowerCase()),O=[...u,d.id];let z=!1;d.children&&d.children.length>0&&(z=l(d.children,O)),(v||k||z)&&(o.push(...O),y=!0)}),y};return l(t),[...new Set(o)]};fe(w,t=>{if(!t||t.trim()==="")_.value=E(x.value),I.value=S(_.value);else{const e=t.trim();_.value=V(x.value,e),I.value=G(x.value,e)}});const Q=t=>({id:t.orgID,name:t.orgName,code:t.orgCode,parentId:t.parentOrgID||null,parentName:t.parentOrgName,isActive:t.status===1,order:t.sortID,isIndependentTraining:t.isOrg===1,isVirtual:t.isVirOrg===1}),H=t=>{const e=new Map,o=[];return t.forEach(l=>{e.set(l.id,{...l,children:[]})}),t.forEach(l=>{const i=e.get(l.id);if(i)if(l.parentId&&e.has(l.parentId)){const u=e.get(l.parentId);u&&(u.children||(u.children=[]),u.children.push(i))}else o.push(i)}),o},j=async()=>{try{C.value=!0;const t=await ae({limit:1e4,page:1,startNum:0,orderbyFiled:"orgCode:asc"});if(t&&t.data&&t.data.list){const e=t.data.list.map(Q),o=H(e);x.value=E(o),_.value=E(o),I.value=S(_.value),f.success(`成功加载 ${e.length} 个组织`)}else f.warning("未获取到组织数据")}catch(t){console.error("获取组织列表失败:",t),f.error("获取组织列表失败，请稍后重试")}finally{C.value=!1}},W=(t,e)=>{t.length>0&&(A.value=t,J.value=e.node,n.orgName=e.node.name||"",b())},D=async()=>{P.value=!0;try{const t={limit:n.pageSize,page:n.page,startNum:(n.page-1)*n.pageSize,orderbyFiled:n.orderbyFiled},e=await ke(t);console.log(e),e.result===1&&e.data?(K.value=e.data.list,U.value=e.data.total,f.success(`成功加载 ${e.data.list.length} 条用户数据`)):f.error(e.msg||"获取用户列表失败")}catch(t){console.error("获取全量用户列表失败:",t),f.error("获取用户列表失败，请稍后重试")}finally{P.value=!1}},b=()=>{n.page=1,D()},X=()=>{n.userID="",n.operatorName="",n.orgName="",n.page=1,n.pageSize=10,D()},Y=async t=>{try{const e=t.status===1?0:1;t.status=e,f.success(e===1?"启用成功":"禁用成功")}catch{f.error("操作失败")}},Z=t=>{n.page=t.current,n.pageSize=t.pageSize,D()};return ye(()=>{j(),D()}),(t,e)=>{const o=oe,l=le,i=B,u=ie,y=ce,d=de,v=pe,k=ue,O=_e,z=he,L=me;return p(),m("div",Ne,[s("div",Ie,[s("div",we,[s("div",be,[s("div",xe,[s("div",Ce,[r(T(se))]),e[6]||(e[6]=s("span",{class:"title-text"}," 组织架构 ",-1))])]),s("div",Se,[r(o,{value:w.value,"onUpdate:value":e[0]||(e[0]=a=>w.value=a),placeholder:"搜索组织名称...","allow-clear":"",class:"modern-search",disabled:C.value},{prefix:c(()=>[r(T(ne))]),_:1},8,["value","disabled"])]),C.value?(p(),m("div",Ee,[r(l,{size:"large",tip:"加载中..."})])):w.value&&_.value.length===0?(p(),m("div",De,[r(i,{description:"未找到匹配的组织",image:T(B).PRESENTED_IMAGE_SIMPLE},null,8,["image"])])):(p(),m("div",Oe,[w.value?(p(),m("div",ze,[r(T(re)),s("span",Le,"搜索到 "+g(S(_.value).length)+" 个匹配结果",1)])):$("",!0),r(y,{"expanded-keys":I.value,"onUpdate:expandedKeys":e[1]||(e[1]=a=>I.value=a),"selected-keys":A.value,"onUpdate:selectedKeys":e[2]||(e[2]=a=>A.value=a),"tree-data":_.value,"field-names":{title:"name",key:"id",children:"children"},"show-line":"",onSelect:W},{title:c(({name:a})=>[r(u,{title:a,placement:"topLeft"},{default:c(()=>[s("div",Te,[s("span",Me,g(a),1)])]),_:2},1032,["title"])]),_:1},8,["expanded-keys","selected-keys","tree-data"])])),s("div",Ae,[s("div",Pe,[s("div",Ue,[e[7]||(e[7]=s("span",{class:"stat-label"},"总数",-1)),s("span",Fe,g(S(_.value).length),1)])])])]),s("div",Ke,[e[13]||(e[13]=s("div",{class:"query-header"},[s("h3",null,"筛选查询")],-1)),s("div",Ve,[r(O,{layout:"inline"},{default:c(()=>[r(d,{label:"用户ID"},{default:c(()=>[r(o,{value:n.userID,"onUpdate:value":e[3]||(e[3]=a=>n.userID=a),placeholder:"请输入","allow-clear":"",style:{width:"180px"},onPressEnter:b},null,8,["value"])]),_:1}),r(d,{label:"姓名"},{default:c(()=>[r(o,{value:n.operatorName,"onUpdate:value":e[4]||(e[4]=a=>n.operatorName=a),placeholder:"请输入","allow-clear":"",style:{width:"180px"},onPressEnter:b},null,8,["value"])]),_:1}),r(d,{label:"组织名称"},{default:c(()=>[r(o,{value:n.orgName,"onUpdate:value":e[5]||(e[5]=a=>n.orgName=a),placeholder:"请输入","allow-clear":"",style:{width:"200px"},onPressEnter:b},null,8,["value"])]),_:1}),r(d,null,{default:c(()=>[r(k,null,{default:c(()=>[r(v,{type:"primary",onClick:b},{default:c(()=>e[8]||(e[8]=[M(" 查询 ")])),_:1,__:[8]}),r(v,{onClick:X},{default:c(()=>e[9]||(e[9]=[M(" 重置 ")])),_:1,__:[9]})]),_:1})]),_:1})]),_:1})]),s("div",Be,[s("div",$e,[e[10]||(e[10]=s("span",{class:"info-label"},"数据列表",-1)),e[11]||(e[11]=s("span",{class:"info-divider"},"数据共",-1)),s("span",qe,g(U.value),1),e[12]||(e[12]=s("span",{class:"info-unit"},"条",-1))])]),s("div",Je,[r(L,{columns:R,"data-source":K.value,loading:P.value,pagination:{current:n.page,pageSize:n.pageSize,total:U.value,showSizeChanger:!0,showQuickJumper:!0,showTotal:a=>`共 ${a} 条`},scroll:{x:1400},"row-key":"operatorID",onChange:Z},{bodyCell:c(({column:a,record:N})=>[a.key==="operatorName"?(p(),m("a",Re,g(N.operatorName),1)):a.key==="isAdmin"?(p(),m("span",Ge,"-")):a.key==="mobileNO"?(p(),m("span",Qe,g(N.mobileNO||"-"),1)):a.key==="oEmail"?(p(),m("span",He,g(N.oEmail||"-"),1)):a.key==="status"?(p(),q(z,{key:4,color:N.status===1?"green":"red"},{default:c(()=>[M(g(N.status===1?"启用":"禁用"),1)]),_:2},1032,["color"])):a.key==="action"?(p(),q(k,{key:5},{default:c(()=>[r(v,{type:"link",size:"small",onClick:We=>Y(N)},{default:c(()=>[M(g(N.status===1?"禁用":"启用"),1)]),_:2},1032,["onClick"])]),_:2},1024)):$("",!0)]),_:1},8,["data-source","loading","pagination"])])])])])}}}),tt=te(je,[["__scopeId","data-v-f0373834"]]);export{tt as default};
