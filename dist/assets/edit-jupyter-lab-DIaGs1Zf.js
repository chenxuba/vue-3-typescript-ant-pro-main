import{d as Ye,ak as Qe,am as We,f as v,c as ke,w as Te,o as Xe,_ as g,a1 as m,$ as s,k as a,a7 as l,ac as L,F as S,ag as Q,u as I,a6 as Ze,G as c,a9 as U,ab as Ce,y as Se}from"./vue-PnzzEkKE.js";import{R as Ue,u as xe}from"./RichTextEditor-CLMA0qC-.js";import{e as et,f as tt,a as at,b as se,g as lt,s as ot}from"./index-DtajCZ6D.js";import{g as st,a as nt}from"./dictionary-B7pEz9CT.js";import{u as rt,a as it,d as ut}from"./dictionary-1qG2q3-5.js";import{H as A,j as dt,t as vt,x as ne,c as ct,a as pt,m as ft,F as mt}from"./FileSelectModal-Cu6STetj.js";import{a1 as i,a3 as gt,a2 as _t,K as yt,z as wt,I as ht,a4 as bt,a5 as kt,a6 as Tt,a7 as Ct,a8 as St,ac as Ut,a9 as xt,H as Lt,J as It,aj as At,Y as qt,T as Rt,s as jt,ah as Vt,af as Mt}from"./antd-Cme2pY03.js";import{_ as Pt}from"./index-CTId23k1.js";const Dt={class:"edit-jupyter-lab-page"},Et={class:"page-container"},Ft={class:"steps-section"},zt={key:0},Ht={class:"form-section"},Jt={class:"flex items-top gap-16px"},Nt={class:"flex flex-col gap-12px"},$t={key:0,class:"image-preview"},Bt=["src"],Ot={class:"flex items-top gap-16px"},Gt={class:"flex flex-col gap-12px"},Kt={key:0,class:"image-preview"},Yt=["src"],Qt={class:"form-section"},Wt={key:1,class:"step-content"},Xt={class:"jupyter-header"},Zt={class:"jupyter-actions"},ea={class:"jupyter-iframe-wrapper"},ta={key:0,class:"loading-container"},aa=["src"],la={key:2,class:"step-content evaluation-step"},oa={class:"evaluation-section"},sa={class:"section-block"},na={class:"block-content"},ra={style:{display:"flex","align-items":"center",gap:"8px"}},ia={key:0,class:"section-block"},ua={class:"block-header"},da={class:"header-actions"},va={class:"block-content"},ca={class:"test-set-label"},pa={class:"tab-footer-buttons"},fa={class:"reference-section"},ma={class:"section-block"},ga={class:"block-content"},_a={class:"tab-footer-buttons"},ya={key:3,class:"step-content environment-step"},wa={class:"environment-section"},ha={class:"environment-container"},ba={class:"environment-left"},ka={class:"search-box"},Ta={class:"environment-list"},Ca=["onClick"],Sa={class:"environment-right"},Ua={class:"environment-config-header"},xa={style:{display:"flex","align-items":"center",gap:"8px"}},La={class:"page-footer"},W="http://101.200.13.193",Ia=Ye({name:"EditJupyterLab",__name:"edit-jupyter-lab",setup(Aa){A.registerLanguage("javascript",dt),A.registerLanguage("typescript",vt),A.registerLanguage("xml",ne),A.registerLanguage("html",ne),A.registerLanguage("vue",ne),A.registerLanguage("css",ct),A.registerLanguage("json",pt),A.registerLanguage("markdown",ft);const M=Qe(),Le=We(),C=v(null),w=v(null),_=v(0),R=v(!1),F=v(),re=v(),n=v({name:"",tag:"",fieldType:void 0,difficulty:1,environment:void 0,secondType:void 0,classHour:"",topCover:"",cover:"",description:"",showTaskRequire:!1,authType:1,enableCodeRepository:!1,repositoryType:"代码仓库",gitUrl:""}),z=v(""),H=v(""),J=v(!1),N=v(!1),X=v(""),j=v(!1),Z=v(!1),Ie=()=>{j.value=!j.value},ie={name:[{required:!0,message:"请输入名称",trigger:"blur"}],tag:[{required:!0,message:"请输入技能标签",trigger:"blur"}],fieldType:[{required:!0,message:"请选择领域类别",trigger:"change"}],difficulty:[{required:!0,message:"请选择难度",trigger:"change"}],environment:[{required:!0,message:"请选择实验环境",trigger:"change"}],secondType:[{required:!0,message:"请选择小类别",trigger:"change"}],classHour:[{required:!0,message:"请输入学时",trigger:"blur"}],topCover:[{required:!0,message:"请上传顶部背景图",trigger:"change"}],cover:[{required:!0,message:"请上传封面图",trigger:"change"}],authType:[{required:!0,message:"请选择培训公开范围",trigger:"change"}]},ee=rt(),ue=it(),P=ut(),T=v([]),te=v(!1),Ae=async()=>{try{te.value=!0;const t=st(3),e=await nt({code:t});e&&e.list&&(T.value=e.list.map(r=>({label:r.name,value:String(r.value)})),console.log("加载环境选项:",{environmentOptions:T.value,currentEnvironment:n.value.environment}),n.value.environment?(k.value=String(n.value.environment),y.value.dockerImage=String(n.value.environment),console.log("使用第一步的环境:",n.value.environment)):!k.value&&T.value.length>0&&(k.value=T.value[0].value,y.value.dockerImage=T.value[0].value,n.value.environment=T.value[0].value,console.log("默认选中第一个环境:",T.value[0])))}catch(t){console.error("加载实验环境选项失败：",t),i.error("加载实验环境选项失败")}finally{te.value=!1}},qe=[{title:"基本信息"},{title:"实验内容"},{title:"评测设置"},{title:"实验环境"}],ae=v(!1),de=v("settings"),u=v({openTestValidate:1,testValidateFiles:"",testValidateSh:"",timeLimitM:"",scoreRule:1,evaluationSetting:1,testSets:[]}),b=v({showAnswer:1,prohibitCopyAnswer:1,referenceAnswer:""}),$=v(!1),B=v(!1);let le=1;const Re=()=>{u.value.testSets.push({id:le++,arg:"",answer:"",select:1})},je=t=>{if(u.value.testSets.length===1){i.warning("至少保留一个测试集");return}u.value.testSets=u.value.testSets.filter(e=>e.id!==t),i.success("删除成功")},Ve=(t,e)=>{t.select=e?1:2},ve=v([]),Me=t=>{ve.value=t.map(r=>({uid:r.uid,name:r.name,status:"done",url:r.path}));const e=t.map(r=>r.path).join(",");u.value.testValidateFiles=e,i.success(`已选择 ${t.length} 个文件`),ae.value=!1},k=v(""),O=v(""),Pe=ke(()=>O.value?T.value.filter(t=>t.label.toLowerCase().includes(O.value.toLowerCase())):T.value),De=ke(()=>{const t=T.value.find(e=>e.value===k.value);return t?t.label:"未选择"}),y=v({dockerImage:"",secondType:"Css",timeLimitM:""}),Ee=t=>{k.value=t,y.value.dockerImage=t,n.value.environment!==t&&(n.value.environment=t)},Fe=async()=>{if(!C.value){i.error("缺少项目ID"),M.back();return}try{R.value=!0;const t=await et({id:C.value});n.value={name:t.name||"",tag:t.tag||"",fieldType:t.fieldType,difficulty:t.difficulty||1,environment:t.environment,secondType:t.secondType,classHour:t.classHour||"",topCover:t.topCover||"",cover:t.cover||"",description:t.description||"",showTaskRequire:t.showTaskRequire===1,authType:t.authType||1,enableCodeRepository:t.gitUrl?!0:t.enableCodeRepository||!1,repositoryType:t.repositoryType||"代码仓库",gitUrl:t.gitUrl||""},t.topCover&&(z.value=W+t.topCover),t.cover&&(H.value=W+t.cover),t.environment&&(await Se(),k.value=String(t.environment),y.value.dockerImage=String(t.environment),console.log("同步环境到第四步:",{environment:t.environment,selectedEnvironment:k.value,environmentOptions:T.value})),await ze()}catch(t){console.error("获取项目详情失败：",t),i.error(t.message||"获取项目详情失败"),M.back()}finally{R.value=!1}},ze=async()=>{if(C.value)try{const t=await tt({projectId:C.value,orderbyFiled:"weight:asc"});let e=[];if(Array.isArray(t)?e=t:t&&typeof t=="object"&&(e=t.list||t.data||t.tasks||[]),e&&e.length>0){const r=e[0];if(r){if(w.value=r.taskId,u.value={openTestValidate:r.openTestValidate||1,testValidateFiles:r.testValidateFiles||"",testValidateSh:r.testValidateSh||"",timeLimitM:r.timeLimitM||"",scoreRule:r.scoreRule||1,evaluationSetting:r.evaluationSetting||1,testSets:[]},r.testContent)try{const d=JSON.parse(r.testContent);u.value.testSets=d.map((p,f)=>({id:f+1,arg:p.arg||"",answer:p.answer||"",select:p.select||1})),le=u.value.testSets.length+1}catch(d){console.error("解析测试集失败:",d)}u.value.testSets.length===0&&(u.value.testSets=[{id:1,arg:"",answer:"",select:1},{id:2,arg:"",answer:"",select:1}],le=3),r.testValidateFiles&&(ve.value=r.testValidateFiles.split(",").map((d,p)=>({uid:`${p}`,name:d.split("/").pop()||`文件${p+1}`,status:"done",url:d,response:d}))),b.value={showAnswer:r.showAnswer||1,prohibitCopyAnswer:r.prohibitCopyAnswer||1,referenceAnswer:r.referenceAnswer||""},r.secondType&&(y.value.secondType=r.secondType),r.timeLimitM&&(y.value.timeLimitM=r.timeLimitM),$.value=!0,B.value=!0}}}catch(t){console.error("获取任务列表失败：",t)}},He=async t=>{var d;if(!(t.size/1024/1024<12))return i.error("图片大小不能超过 12MB!"),!1;if(!(t.type==="image/jpeg"||t.type==="image/png"))return i.error("只能上传 JPG/PNG 格式的图片!"),!1;try{J.value=!0;const p=await xe(t);z.value=W+p,n.value.topCover=p,(d=F.value)==null||d.validateFields(["topCover"]),i.success("顶部背景图上传成功")}catch{i.error("顶部背景图上传失败")}finally{J.value=!1}return!1},Je=async t=>{var d;if(!(t.size/1024/1024<12))return i.error("图片大小不能超过 12MB!"),!1;if(!(t.type==="image/jpeg"||t.type==="image/png"))return i.error("只能上传 JPG/PNG 格式的图片!"),!1;try{N.value=!0;const p=await xe(t);H.value=W+p,n.value.cover=p,(d=F.value)==null||d.validateFields(["cover"]),i.success("封面图上传成功")}catch{i.error("封面图上传失败")}finally{N.value=!1}return!1};Te(()=>n.value.environment,t=>{console.log("formData.environment 变化:",t,"当前 selectedEnvironment:",k.value),t&&String(t)!==k.value&&(k.value=String(t),y.value.dockerImage=String(t),console.log("已同步到第四步:",k.value))}),Te(()=>k.value,t=>{console.log("selectedEnvironment 变化为:",t)});const D=()=>{Se(()=>{window.scrollTo({top:0,behavior:"smooth"}),document.documentElement.scrollTop=0,document.body.scrollTop=0;const t=document.querySelector(".page-content");t&&(t.scrollTop=0);const e=document.querySelector(".ant-layout-content");e&&(e.scrollTop=0),document.querySelectorAll("*").forEach(d=>{d.scrollTop>0&&(d.scrollTop=0)})})},Ne=async()=>{_.value>0?(_.value--,D(),_.value===1&&w.value&&await me()):M.back()},$e=async()=>{var t,e;if(_.value===0)try{await Promise.all([(t=F.value)==null?void 0:t.validate(),(e=re.value)==null?void 0:e.validate()]),await ce(!1),_.value=1,D(),w.value&&await me()}catch{i.error("请完善必填信息"),D()}else if(_.value===1)w.value&&await Oe(),_.value=2,D();else if(_.value===2){try{await pe()}catch{return}try{await fe()}catch{return}_.value=3,D()}else _.value===3&&await Be()},ce=async(t=!1)=>{try{R.value=!0;const e={id:C.value,projectType:3,environment:n.value.environment,name:n.value.name,tag:n.value.tag,fieldType:n.value.fieldType,difficulty:n.value.difficulty,classHour:n.value.classHour,topCover:n.value.topCover,cover:n.value.cover,description:n.value.description,showTaskRequire:n.value.showTaskRequire?1:2,authType:n.value.authType,enableCodeRepository:n.value.enableCodeRepository,secondType:n.value.secondType};t&&(e.status=10),n.value.enableCodeRepository&&(e.repositoryType=n.value.repositoryType,e.gitUrl=n.value.gitUrl),await at(e),t?(i.success("项目更新成功！"),setTimeout(()=>{M.push("/dashboard/analysis")},500)):i.success("保存成功！")}catch(e){throw console.error("更新失败：",e),i.error(e.message||"项目更新失败，请稍后重试"),e}finally{R.value=!1}},pe=async()=>{if(!w.value)throw i.error("任务ID不存在，请重新创建任务"),new Error("任务ID不存在");if(u.value.openTestValidate===1){if(!u.value.timeLimitM)throw i.error("请输入评测时长限制"),new Error("请输入评测时长限制");if(!u.value.testSets||u.value.testSets.length===0)throw i.error("请至少添加一个测试集"),new Error("请至少添加一个测试集");const r=u.value.testSets.filter(d=>d.select===1);if(r.length===0)throw i.error("请至少选中一个测试集"),new Error("请至少选中一个测试集");for(let d=0;d<r.length;d++){const p=r[d];if(!p.arg||p.arg.trim()==="")throw i.error(`测试集${d+1}的输入内容不能为空`),new Error(`测试集${d+1}的输入内容不能为空`);if(!p.answer||p.answer.trim()==="")throw i.error(`测试集${d+1}的期望输出不能为空`),new Error(`测试集${d+1}的期望输出不能为空`)}}const t=u.value.testSets.map(r=>({arg:r.arg,answer:r.answer,select:r.select})),e={taskId:w.value,projectId:C.value,openTestValidate:u.value.openTestValidate,testValidateFiles:u.value.testValidateFiles,testValidateSh:u.value.testValidateSh,timeLimitM:u.value.timeLimitM,scoreRule:u.value.scoreRule,evaluationSetting:u.value.evaluationSetting,testContent:JSON.stringify(t)};try{await se(e),$.value=!0}catch(r){throw i.error("评测设置保存失败，请重试"),r}},fe=async()=>{if(!w.value)throw i.error("任务ID不存在，请重新创建任务"),new Error("任务ID不存在");if(!b.value.referenceAnswer||b.value.referenceAnswer.trim()==="")throw i.error("请输入参考答案内容"),new Error("请输入参考答案内容");if(!b.value.referenceAnswer.replace(/<[^>]*>/g,"").trim())throw i.error("请输入参考答案内容"),new Error("请输入参考答案内容");const e={taskId:w.value,projectId:C.value,showAnswer:b.value.showAnswer,prohibitCopyAnswer:b.value.prohibitCopyAnswer,referenceAnswer:b.value.referenceAnswer};try{await se(e),B.value=!0}catch(r){throw i.error("参考答案保存失败，请重试"),r}},Be=async()=>{try{if(!C.value||!w.value){i.error("项目ID或任务ID不存在");return}if(!$.value){i.error("请先保存评测设置后再完成更新");return}if(!B.value){i.error("请先保存参考答案后再完成更新");return}if(!y.value.dockerImage){i.error("请选择实验环境");return}if(!y.value.timeLimitM){i.error("请输入实验环境使用时长");return}await se({taskId:w.value,projectId:C.value,dockerImage:y.value.dockerImage,secondType:y.value.secondType,timeLimitM:y.value.timeLimitM}),await ce(!0)}catch(t){console.error("完成更新失败：",t),i.error("完成更新失败，请重试")}},me=async()=>{if(!w.value){console.log("taskId不存在，无法获取Pod配置");return}try{Z.value=!0,console.log("正在获取Pod配置，taskId:",w.value);const t=await lt({taskId:w.value});console.log("获取到Pod数据：",t),t&&t.config&&t.config.url?(X.value=t.config.url,console.log("更新Jupyter URL为：",X.value),i.success("实验环境加载成功！")):(console.error("Pod配置中没有url字段"),i.warning("未获取到实验环境URL"))}catch(t){console.error("获取Pod配置失败：",t),i.error("获取实验环境失败，请稍后重试")}finally{Z.value=!1}},Oe=async()=>{if(!w.value){console.log("taskId不存在，无法停止Pod");return}try{console.log("正在停止Pod，taskId:",w.value),await ot({taskId:w.value}),console.log("Pod停止成功"),i.success("实验环境已停止")}catch(t){console.error("停止Pod失败：",t),i.error("停止实验环境失败，请稍后重试")}};return Xe(async()=>{ee.load(),ue.load(),P.load();const t=Le.query.id;t?(C.value=Number(t),await Ae(),await Fe()):(i.error("缺少项目ID"),M.back())}),(t,e)=>{const r=_t,d=gt,p=ht,f=wt,G=kt,K=Tt,ge=bt,h=St,q=Ct,oe=Ut,x=Lt,_e=xt,ye=It,E=yt,Ge=At,we=qt,he=Vt,be=jt,Ke=Rt;return m(),g("div",Dt,[e[50]||(e[50]=s("div",{class:"page-header"},[s("h2",null,"编辑JupyterLab环境实训项目")],-1)),a(we,{spinning:R.value},{default:l(()=>[s("div",Et,[s("div",Ft,[a(d,{current:_.value,class:"custom-steps"},{default:l(()=>[(m(),g(S,null,Q(qe,(o,Y)=>a(r,{key:Y,title:o.title},null,8,["title"])),64))]),_:1},8,["current"])]),_.value===0?(m(),g("div",zt,[e[29]||(e[29]=s("div",{class:"section-title"},[s("h3",null,"基本信息")],-1)),s("div",Ht,[a(E,{ref_key:"formRef",ref:F,model:n.value,rules:ie,layout:"horizontal","label-col":{span:2},"wrapper-col":{span:18}},{default:l(()=>[a(f,{label:"名称",name:"name",required:""},{default:l(()=>[a(p,{value:n.value.name,"onUpdate:value":e[0]||(e[0]=o=>n.value.name=o),placeholder:"请输入名称"},null,8,["value"])]),_:1}),a(ge,null,{default:l(()=>[a(G,{span:12},{default:l(()=>[a(f,{label:"技能标签",name:"tag",required:"","label-col":{span:4},"wrapper-col":{span:20}},{default:l(()=>[a(p,{value:n.value.tag,"onUpdate:value":e[1]||(e[1]=o=>n.value.tag=o),placeholder:"请输入技能标签"},null,8,["value"])]),_:1})]),_:1}),a(G,{span:12},{default:l(()=>[a(f,{label:"领域类别",name:"fieldType",required:"","label-col":{span:4},"wrapper-col":{span:12}},{default:l(()=>[a(K,{value:n.value.fieldType,"onUpdate:value":e[2]||(e[2]=o=>n.value.fieldType=o),placeholder:"请选择领域类别",options:I(ee).options.value,loading:I(ee).loading.value},null,8,["value","options","loading"])]),_:1})]),_:1})]),_:1}),a(f,{label:"难度",name:"difficulty",required:""},{default:l(()=>[a(q,{value:n.value.difficulty,"onUpdate:value":e[3]||(e[3]=o=>n.value.difficulty=o),class:"custom-radio"},{default:l(()=>[(m(!0),g(S,null,Q(I(ue).data.value,o=>(m(),Ze(h,{key:o.value,value:Number(o.value)},{default:l(()=>[c(U(o.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),a(ge,null,{default:l(()=>[a(G,{span:12},{default:l(()=>[a(f,{label:"实验环境",name:"environment",required:"","label-col":{span:4},"wrapper-col":{span:20}},{default:l(()=>[a(K,{value:n.value.environment,"onUpdate:value":e[4]||(e[4]=o=>n.value.environment=o),placeholder:"请选择实验环境",options:T.value,loading:te.value},null,8,["value","options","loading"])]),_:1})]),_:1}),a(G,{span:12},{default:l(()=>[a(f,{label:"小类别",name:"secondType",required:"","label-col":{span:4},"wrapper-col":{span:12}},{default:l(()=>[a(K,{value:n.value.secondType,"onUpdate:value":e[5]||(e[5]=o=>n.value.secondType=o),placeholder:"请选择小类别",options:I(P).options.value,loading:I(P).loading.value},null,8,["value","options","loading"])]),_:1})]),_:1})]),_:1}),a(f,{label:"学时",name:"classHour",required:""},{default:l(()=>[a(oe,{min:0,class:"w-full",value:n.value.classHour,"onUpdate:value":e[6]||(e[6]=o=>n.value.classHour=o),placeholder:"请输入学时"},null,8,["value"])]),_:1}),a(f,{label:"顶部背景图",name:"topCover",required:""},{default:l(()=>[s("div",Jt,[s("div",Nt,[a(_e,{"before-upload":He,"show-upload-list":!1,accept:"image/png,image/jpeg"},{default:l(()=>[a(x,{loading:J.value},{default:l(()=>[J.value?(m(),g(S,{key:1},[c("上传中...")],64)):(m(),g(S,{key:0},[c("选择文件")],64))]),_:1},8,["loading"])]),_:1}),z.value?(m(),g("div",$t,[s("img",{src:z.value,alt:"顶部背景图预览",style:{"max-width":"290px","max-height":"218px","border-radius":"4px"}},null,8,Bt)])):L("",!0)]),e[22]||(e[22]=s("div",{class:"upload-hint"}," 说明：支持上传png/jpeg等格式文件，文件大小不能超过12M,建议使用290*218像素。 ",-1))])]),_:1}),a(f,{label:"封面图",name:"cover",required:""},{default:l(()=>[s("div",Ot,[s("div",Gt,[a(_e,{"before-upload":Je,"show-upload-list":!1,accept:"image/png,image/jpeg"},{default:l(()=>[a(x,{loading:N.value},{default:l(()=>[N.value?(m(),g(S,{key:1},[c("上传中...")],64)):(m(),g(S,{key:0},[c("选择文件")],64))]),_:1},8,["loading"])]),_:1}),H.value?(m(),g("div",Kt,[s("img",{src:H.value,alt:"封面图预览",style:{"max-width":"290px","max-height":"218px","border-radius":"4px"}},null,8,Yt)])):L("",!0)]),e[23]||(e[23]=s("div",{class:"upload-hint"}," 说明：支持上传png/jpeg等格式文件，文件大小不能超过12M,建议使用290*218像素。 ",-1))])]),_:1}),a(f,{label:"简介",name:"description"},{default:l(()=>[a(Ue,{modelValue:n.value.description,"onUpdate:modelValue":e[7]||(e[7]=o=>n.value.description=o)},null,8,["modelValue"])]),_:1}),a(f,{label:"任务要求",name:"showTaskRequire"},{default:l(()=>[a(ye,{checked:n.value.showTaskRequire,"onUpdate:checked":e[8]||(e[8]=o=>n.value.showTaskRequire=o)},{default:l(()=>e[24]||(e[24]=[c(" 显示任务要求（勾选后，将帮作为任务要求显示在任务项目政策面） ")])),_:1,__:[24]},8,["checked"])]),_:1})]),_:1},8,["model"])]),e[30]||(e[30]=s("div",{class:"section-title"},[s("h3",null,"培训公开范围")],-1)),s("div",Qt,[a(E,{ref_key:"trainingScopeFormRef",ref:re,model:n.value,rules:ie,layout:"horizontal","label-col":{span:2},"wrapper-col":{span:18}},{default:l(()=>[a(f,{label:"培训公开范围",name:"authType",required:""},{default:l(()=>[a(q,{value:n.value.authType,"onUpdate:value":e[9]||(e[9]=o=>n.value.authType=o),class:"custom-radio"},{default:l(()=>[a(h,{value:1},{default:l(()=>e[25]||(e[25]=[c("完全公开")])),_:1,__:[25]}),a(h,{value:2},{default:l(()=>e[26]||(e[26]=[c("全院公开")])),_:1,__:[26]}),a(h,{value:3},{default:l(()=>e[27]||(e[27]=[c("本单位公开")])),_:1,__:[27]}),a(h,{value:4},{default:l(()=>e[28]||(e[28]=[c("不公开")])),_:1,__:[28]})]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])])])):L("",!0),_.value===1?(m(),g("div",Wt,[s("div",{class:Ce(["jupyter-container",{fullscreen:j.value}])},[s("div",Xt,[e[31]||(e[31]=s("h3",null,"Jupyter Lab 编辑器",-1)),s("div",Zt,[a(Ge,{title:j.value?"退出全屏":"全屏"},{default:l(()=>[a(x,{type:"text",icon:j.value?"fullscreen-exit":"fullscreen",onClick:Ie},{default:l(()=>[c(U(j.value?"退出全屏":"全屏"),1)]),_:1},8,["icon"])]),_:1},8,["title"])])]),s("div",ea,[Z.value?(m(),g("div",ta,[a(we,{size:"large",tip:"正在加载实验环境..."})])):(m(),g("iframe",{key:1,src:X.value,class:"jupyter-iframe",frameborder:"0",allowfullscreen:""},null,8,aa))])],2)])):L("",!0),_.value===2?(m(),g("div",la,[a(Ke,{activeKey:de.value,"onUpdate:activeKey":e[17]||(e[17]=o=>de.value=o),class:"evaluation-tabs"},{default:l(()=>[a(be,{key:"settings",tab:"评测设置"},{default:l(()=>[s("div",oa,[s("div",sa,[e[39]||(e[39]=s("div",{class:"block-header"},"评测文件",-1)),s("div",na,[a(E,{layout:"horizontal","label-col":{span:3},"wrapper-col":{span:20}},{default:l(()=>[a(f,{label:"是否启用评测功能",required:""},{default:l(()=>[a(q,{value:u.value.openTestValidate,"onUpdate:value":e[10]||(e[10]=o=>u.value.openTestValidate=o),class:"custom-radio"},{default:l(()=>[a(h,{value:1},{default:l(()=>e[32]||(e[32]=[c("是")])),_:1,__:[32]}),a(h,{value:2},{default:l(()=>e[33]||(e[33]=[c("否")])),_:1,__:[33]})]),_:1},8,["value"])]),_:1}),u.value.openTestValidate===1?(m(),g(S,{key:0},[a(f,{label:"评测时长限制",required:""},{default:l(()=>[s("div",ra,[a(oe,{value:u.value.timeLimitM,"onUpdate:value":e[11]||(e[11]=o=>u.value.timeLimitM=o),min:1,placeholder:"请输入评测时长（分钟）",style:{width:"580px"}},null,8,["value"]),e[34]||(e[34]=s("span",null,"分钟",-1))])]),_:1}),a(f,{label:"系统评分规则"},{default:l(()=>[a(q,{value:u.value.scoreRule,"onUpdate:value":e[12]||(e[12]=o=>u.value.scoreRule=o),class:"custom-radio"},{default:l(()=>[a(h,{value:1},{default:l(()=>e[35]||(e[35]=[c(" 通过全部测试集（仅当所有测试集都正确时，获得项目学时） ")])),_:1,__:[35]}),a(h,{value:2},{default:l(()=>e[36]||(e[36]=[c(" 通过部分测试集（任意一个测试集正确时，获得项目学时） ")])),_:1,__:[36]})]),_:1},8,["value"])]),_:1}),a(f,{label:"评测设置",required:""},{default:l(()=>[a(q,{value:u.value.evaluationSetting,"onUpdate:value":e[13]||(e[13]=o=>u.value.evaluationSetting=o),class:"custom-radio"},{default:l(()=>[a(h,{value:1},{default:l(()=>e[37]||(e[37]=[c(" 通过所有代码块评测（对学员任务文件的所有非空代码块进行评测） ")])),_:1,__:[37]}),a(h,{value:2},{default:l(()=>e[38]||(e[38]=[c(" 通过指定代码块评测（对学员任务文件的指定非空代码块进行评测） ")])),_:1,__:[38]})]),_:1},8,["value"])]),_:1})],64)):L("",!0)]),_:1})])]),u.value.openTestValidate===1?(m(),g("div",ia,[s("div",ua,[e[41]||(e[41]=s("span",null,"测试集",-1)),s("div",da,[a(x,{onClick:Re},{default:l(()=>e[40]||(e[40]=[c("新增测试集")])),_:1,__:[40]})])]),s("div",va,[(m(!0),g(S,null,Q(u.value.testSets,(o,Y)=>(m(),g("div",{key:o.id,class:"test-set-item"},[a(ye,{checked:o.select===1,onChange:V=>Ve(o,V.target.checked),class:"test-set-checkbox"},null,8,["checked","onChange"]),s("span",ca,"测试集"+U(Y+1),1),a(he,{value:o.arg,"onUpdate:value":V=>o.arg=V,placeholder:"请输入输入内容",class:"test-set-input","auto-size":{minRows:3}},null,8,["value","onUpdate:value"]),a(he,{value:o.answer,"onUpdate:value":V=>o.answer=V,placeholder:"请输入期望输出",class:"test-set-input","auto-size":{minRows:3}},null,8,["value","onUpdate:value"]),a(I(Mt),{class:"delete-test-set-icon",onClick:V=>je(o.id)},null,8,["onClick"])]))),128))])])):L("",!0),s("div",pa,[a(x,{type:"primary",onClick:pe},{default:l(()=>[c(U($.value?"更新":"保存"),1)]),_:1})])])]),_:1}),a(be,{key:"reference",tab:"参考答案"},{default:l(()=>[s("div",fa,[s("div",ma,[e[46]||(e[46]=s("div",{class:"block-header"},"参考答案",-1)),s("div",ga,[a(E,{layout:"horizontal","label-col":{span:3},"wrapper-col":{span:20}},{default:l(()=>[a(f,{label:"是否显示参考答案模块",required:""},{default:l(()=>[a(q,{value:b.value.showAnswer,"onUpdate:value":e[14]||(e[14]=o=>b.value.showAnswer=o),class:"custom-radio"},{default:l(()=>[a(h,{value:1},{default:l(()=>e[42]||(e[42]=[c("是")])),_:1,__:[42]}),a(h,{value:2},{default:l(()=>e[43]||(e[43]=[c("否")])),_:1,__:[43]})]),_:1},8,["value"])]),_:1}),a(f,{label:"是否禁止复制参考答案",required:""},{default:l(()=>[a(q,{value:b.value.prohibitCopyAnswer,"onUpdate:value":e[15]||(e[15]=o=>b.value.prohibitCopyAnswer=o),class:"custom-radio"},{default:l(()=>[a(h,{value:1},{default:l(()=>e[44]||(e[44]=[c("是")])),_:1,__:[44]}),a(h,{value:2},{default:l(()=>e[45]||(e[45]=[c("否")])),_:1,__:[45]})]),_:1},8,["value"])]),_:1}),a(f,{label:"参考答案",required:""},{default:l(()=>[a(Ue,{modelValue:b.value.referenceAnswer,"onUpdate:modelValue":e[16]||(e[16]=o=>b.value.referenceAnswer=o)},null,8,["modelValue"])]),_:1})]),_:1})])]),s("div",_a,[a(x,{type:"primary",onClick:fe},{default:l(()=>[c(U(B.value?"更新":"保存"),1)]),_:1})])])]),_:1})]),_:1},8,["activeKey"])])):L("",!0),_.value===3?(m(),g("div",ya,[s("div",wa,[e[49]||(e[49]=s("h3",{class:"section-main-title"},"实验环境",-1)),s("div",ha,[s("div",ba,[s("div",ka,[a(p,{value:O.value,"onUpdate:value":e[18]||(e[18]=o=>O.value=o),placeholder:"搜索需要的实验环境","allow-clear":""},{suffix:l(()=>e[47]||(e[47]=[s("span",{class:"search-icon"},"🔍",-1)])),_:1},8,["value"])]),s("div",Ta,[(m(!0),g(S,null,Q(Pe.value,o=>(m(),g("div",{key:o.value,class:Ce(["environment-item",{active:k.value===o.value}]),onClick:Y=>Ee(o.value)},U(o.label),11,Ca))),128))])]),s("div",Sa,[s("div",Ua," 实验环境: "+U(De.value),1),a(E,{model:y.value,layout:"horizontal","label-col":{span:6},"wrapper-col":{span:16}},{default:l(()=>[a(f,{label:"附带环境"},{default:l(()=>[a(K,{value:y.value.secondType,"onUpdate:value":e[19]||(e[19]=o=>y.value.secondType=o),placeholder:"请选择附带环境",options:I(P).options.value,loading:I(P).loading.value},null,8,["value","options","loading"])]),_:1}),a(f,{label:"实验环境使用时长"},{default:l(()=>[s("div",xa,[a(oe,{value:y.value.timeLimitM,"onUpdate:value":e[20]||(e[20]=o=>y.value.timeLimitM=o),min:1,placeholder:"请输入实验环境使用时长",style:{flex:"1"}},null,8,["value"]),e[48]||(e[48]=s("span",null,"分",-1))])]),_:1})]),_:1},8,["model"])])])])])):L("",!0),s("div",La,[a(x,{onClick:Ne},{default:l(()=>[c(U(_.value===0?"返回":"上一步"),1)]),_:1}),a(x,{type:"primary",loading:R.value,onClick:$e},{default:l(()=>[c(U(_.value===3?"完成":"下一步"),1)]),_:1},8,["loading"])])])]),_:1},8,["spinning"]),a(mt,{open:ae.value,"onUpdate:open":e[21]||(e[21]=o=>ae.value=o),title:"选择评测文件","git-url":n.value.gitUrl,onConfirm:Me},null,8,["open","git-url"])])}}}),Fa=Pt(Ia,[["__scopeId","data-v-78eec992"]]);export{Fa as default};
