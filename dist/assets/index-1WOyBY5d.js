import{d as W,a9 as X,f as g,c as $,o as Y,_ as d,a1 as m,$ as s,k as n,a7 as r,G as h,aa as v,a6 as Z,ad as ee,F as y,ac as P}from"./vue-C8C4cLDH.js";import{n as te,a as ae,o as ne}from"./index--VQ4lwI-.js";import{a as oe}from"./dictionary-D3NJ42Gt.js";import{g as se}from"./organization-Dz63uAaH.js";import{a9 as ie,aa as le,U as re,V as ce,w as ue,H as pe,a0 as me,u as de,F as ve,aq as _e,ak as f,M as A}from"./antd-C7Px7a_9.js";import{_ as ge}from"./index-CHvkwZeu.js";const he={class:"raining-project-management"},ye={class:"search-section"},fe={class:"table-section"},ke={class:"table-header"},be={class:"table-tabs"},ze={class:"tabs-left"},Ce={class:"data-count"},Ne={class:"tabs-right"},je={key:4,class:"public-scope-cell"},Te={key:5,class:"action-links"},we=["onClick"],Se=["onClick"],xe=["onClick"],$e=["onClick"],Pe=["onClick"],Ae=W({name:"RainingProjectManagement",__name:"index",setup(Ie){const N=X(),k=g([]),j=g([]),I=async()=>{try{const e=["project#environment_1","project#environment_2","project#environment_3"],t=await Promise.all(e.map(o=>oe({code:o}))),c=[];t.forEach(o=>{o&&o.list&&c.push(...o.list)});const p=new Map;c.forEach(o=>{p.has(o.value)||p.set(o.value,o)}),k.value=Array.from(p.values())}catch(e){console.error("获取环境字典失败：",e),k.value=[]}},E=async()=>{try{const e=await se({limit:1e4,page:1,startNum:0,orderbyFiled:"orgCode:asc"});e&&e.data&&e.data.list&&(j.value=e.data.list)}catch(e){console.error("获取组织列表失败：",e),j.value=[]}},F=e=>{if(!e&&e!==0)return"-";const t=String(e),c=k.value.find(p=>p.value===t);return c?c.name:"-"},u=g({projectName:"",environment:void 0,organizer:void 0}),L=$(()=>k.value.map(e=>({label:e.name,value:e.value}))),M=$(()=>{const e=new Map;return j.value.forEach(t=>{t.orgName&&!e.has(t.orgName)&&e.set(t.orgName,t.orgName)}),Array.from(e.values()).sort().map(t=>({label:t,value:t}))}),i=g({current:1,pageSize:10,total:0}),O=[{title:"项目名称",dataIndex:"projectName",key:"projectName"},{title:"实验环境",dataIndex:"environment",key:"environment"},{title:"技能标签",dataIndex:"skillTag",key:"skillTag",ellipsis:!0},{title:"主办单位",dataIndex:"organizer",key:"organizer"},{title:"公开范围",dataIndex:"publicScope",key:"publicScope"},{title:"操作",key:"action",width:280}],b=g([]),T=g(!1),_=async()=>{T.value=!0;try{const e={page:i.value.current,limit:i.value.pageSize,startNum:(i.value.current-1)*i.value.pageSize,name:u.value.projectName||void 0,orgName:u.value.organizer||void 0,environment:u.value.environment||void 0,orderbyFiled:"createTime:desc"},t=await te(e);b.value=t.list,i.value.total=t.count}catch(e){f.error(e.message||"获取项目列表失败"),b.value=[],i.value.total=0}finally{T.value=!1}},D=e=>{i.value.current=e.current,i.value.pageSize=e.pageSize,_()},q=()=>{u.value={projectName:"",environment:void 0,organizer:void 0},i.value.current=1,_()},B=()=>{i.value.current=1,_()};Y(()=>{I(),E(),_()});const U=()=>{N.push("/dashboard/raining-project-management/create")},R=e=>{N.push({path:"/dashboard/raining-project-management/statistics",query:{id:e.id,name:e.name}})},S=e=>{const t=e.status===1,c=t?"取消发布":"发布",p=t?0:1;A.confirm({title:`确认${c}`,content:`确定要${c}项目"${e.name}"吗？`,okText:"确认",cancelText:"取消",onOk:async()=>{try{await ae({id:e.id,status:p}),f.success(`${c}成功`),_()}catch(o){console.error(`${c}失败：`,o),f.error(o.message||`${c}失败`)}}})},V=e=>{N.push({path:"/dashboard/raining-project-management/edit",query:{id:e.id}})},G=e=>{A.confirm({title:"确认删除",content:`确定要删除项目"${e.name}"吗？删除后数据将无法恢复！`,okText:"确认删除",okType:"danger",cancelText:"取消",onOk:async()=>{try{await ne({id:e.id}),f.success("删除成功"),b.value.length===1&&i.value.current>1&&(i.value.current-=1),_()}catch(t){console.error("删除失败：",t),f.error(t.message||"删除失败")}}})};return(e,t)=>{const c=ce,p=re,o=le,x=ue,w=pe,H=ie,J=me,Q=de,z=ve,K=_e;return m(),d("div",he,[s("div",ye,[t[5]||(t[5]=s("h3",{class:"section-title"},"筛选查询",-1)),n(J,{model:u.value,layout:"horizontal",class:"search-form"},{default:r(()=>[n(H,{gutter:24},{default:r(()=>[n(o,{span:6},{default:r(()=>[n(p,{label:"项目名称：",name:"projectName"},{default:r(()=>[n(c,{value:u.value.projectName,"onUpdate:value":t[0]||(t[0]=l=>u.value.projectName=l),placeholder:"请输入项目名称"},null,8,["value"])]),_:1})]),_:1}),n(o,{span:6},{default:r(()=>[n(p,{label:"实验环境：",name:"environment"},{default:r(()=>[n(x,{value:u.value.environment,"onUpdate:value":t[1]||(t[1]=l=>u.value.environment=l),placeholder:"请选择实验环境",options:L.value,"allow-clear":""},null,8,["value","options"])]),_:1})]),_:1}),n(o,{span:6},{default:r(()=>[n(p,{label:"主办单位：",name:"organizer"},{default:r(()=>[n(x,{value:u.value.organizer,"onUpdate:value":t[2]||(t[2]=l=>u.value.organizer=l),placeholder:"请选择主办单位",options:M.value,"allow-clear":""},null,8,["value","options"])]),_:1})]),_:1}),n(o,{span:6,class:"form-actions"},{default:r(()=>[n(w,{type:"primary",onClick:B},{default:r(()=>t[3]||(t[3]=[h("查询")])),_:1,__:[3]}),n(w,{onClick:q},{default:r(()=>t[4]||(t[4]=[h("重置")])),_:1,__:[4]})]),_:1})]),_:1})]),_:1},8,["model"])]),s("div",fe,[s("div",ke,[s("div",be,[s("div",ze,[t[6]||(t[6]=s("span",{class:"tab-item active"},"数据列表",-1)),s("span",Ce,"数据共 "+v(i.value.total)+" 条",1)]),s("div",Ne,[n(w,{type:"primary",onClick:U},{default:r(()=>t[7]||(t[7]=[h("新建项目")])),_:1,__:[7]})])])]),n(K,{columns:O,"data-source":b.value,loading:T.value,"row-key":l=>l.id,pagination:{current:i.value.current,pageSize:i.value.pageSize,total:i.value.total,showSizeChanger:!0,showQuickJumper:!0,showTotal:l=>`共 ${l} 条`},onChange:D,bordered:""},{bodyCell:r(({column:l,record:a})=>[l.key==="projectName"?(m(),d(y,{key:0},[h(v(a.name),1)],64)):l.key==="environment"?(m(),d(y,{key:1},[h(v(F(a.environment)),1)],64)):l.key==="skillTag"?(m(),Z(Q,{key:2,title:a.tag,placement:"topLeft"},{default:r(()=>[s("span",null,v(a.tag),1)]),_:2},1032,["title"])):l.key==="organizer"?(m(),d(y,{key:3},[h(v(a.orgName||"-"),1)],64)):l.key==="publicScope"?(m(),d("div",je,[s("div",{class:P(["status-badge",{"status-published":a.status===1,"status-unpublished":a.status!==1}])},v(a.status===1?"已发布":"未发布"),3),s("div",{class:P(["scope-badge",{"scope-full":a.authType===1,"scope-academy":a.authType===2,"scope-unit":a.authType===3,"scope-private":a.authType===4}])},v(a.authType===1?"完全公开":a.authType===2?"全院公开":a.authType===3?"本单位公开":a.authType===4?"不公开":"-"),3)])):l.key==="action"?(m(),d("div",Te,[s("a",{onClick:C=>R(a)},"统计",8,we),a.status===1?(m(),d(y,{key:0},[n(z,{type:"vertical"}),s("a",{onClick:C=>S(a)},"取消发布",8,Se),n(z,{type:"vertical"}),s("a",{onClick:C=>V(a)},"编辑",8,xe)],64)):(m(),d(y,{key:1},[n(z,{type:"vertical"}),s("a",{onClick:C=>S(a)},"发布",8,$e)],64)),n(z,{type:"vertical"}),s("a",{class:"danger-link",onClick:C=>G(a)},"删除",8,Pe)])):ee("",!0)]),_:1},8,["data-source","loading","row-key","pagination"])])])}}}),qe=ge(Ae,[["__scopeId","data-v-c8781a95"]]);export{qe as default};
