import{g as de,a as me,s as pe,d as ve,u as ce,c as ge,b as _e}from"./role-CECs1_rJ.js";import{t as fe,_ as ye}from"./index-D5vtKjRx.js";import{Q as ke,U as Se,S as Ce,G as we,$ as be,a7 as Ne,ai as xe,ap as Re,v as Te,w as Me,a8 as Ve,a9 as P,F as he,an as Ue,aa as d,ao as F}from"./antd-7EK-EoHB.js";import{d as ze,r as Q,f as r,o as Ke,a0 as q,a3 as R,a1 as i,k as l,a9 as t,G as s,ac as E,u as G,a8 as Pe,af as qe,l as J}from"./vue-CHyeelTQ.js";const Ee={class:"role-management"},$e={class:"content-wrapper"},Ae={class:"main-panel"},Ie={class:"query-form"},Oe={class:"table-header"},Be={class:"table-info"},De={class:"info-value"},Le={class:"table-actions"},Fe={class:"table-container"},Qe={key:0,class:"role-link"},Ge={key:1},Je={style:{padding:"20px 0"}},je={style:{"max-height":"400px",overflow:"auto",padding:"10px",background:"#fafafa","border-radius":"4px"}},He=ze({name:"RoleManagement",__name:"role-management",setup(We){const m=Q({roleName:"",pageNum:1,pageSize:10}),T=r(!1),$=r([]),M=r(0),c=r([]),w=r([]),j=[{title:"角色名称",dataIndex:"roleName",key:"roleName"},{title:"管理范围",dataIndex:"managementScope",key:"managementScope"},{title:"创建时间",dataIndex:"createTime",key:"createTime"},{title:"备注",dataIndex:"remark",key:"remark",ellipsis:!0},{title:"操作",key:"action",width:220,fixed:"right"}],y=r(!1),V=r(!1),h=r("新建角色"),b=r(!1),N=r(void 0),k=r(!1),U=r(!1),x=r(null),_=r([]),z=r([]),a=Q({roleName:"",roleCode:"",isVirtualManagerRole:void 0,managementScopeType:void 0,managementScope:void 0,remark:"",status:!0}),g=async()=>{T.value=!0;try{const n=await de(m);n.data&&($.value=n.data.list,M.value=n.data.total)}catch{d.error("获取角色列表失败")}finally{T.value=!1}},A=()=>{m.pageNum=1,c.value=[],w.value=[],g()},H=()=>{m.roleName="",m.pageNum=1,m.pageSize=10,c.value=[],w.value=[],g()},W=(n,e)=>{c.value=n,w.value=e},X=()=>{h.value="新建角色",b.value=!1,N.value=void 0,a.roleName="",a.roleCode="",a.isVirtualManagerRole=void 0,a.managementScopeType=void 0,a.managementScope=void 0,a.remark="",a.status=!0,y.value=!0},Y=n=>{h.value="编辑角色",b.value=!0,N.value=n.id,a.roleName=n.roleName,a.roleCode=n.roleCode||"",a.isVirtualManagerRole=n.isVirtualManagerRole,a.managementScopeType=n.managementScopeType,a.managementScope=n.managementScope,a.remark=n.remark||"",a.status=n.status,y.value=!0},Z=async()=>{V.value=!0;try{if(b.value&&N.value)await ce({id:N.value,roleName:a.roleName,roleCode:a.roleCode,isVirtualManagerRole:a.isVirtualManagerRole,managementScopeType:a.managementScopeType,managementScope:a.managementScope,remark:a.remark,status:a.status}),d.success("更新成功");else{if(!a.roleCode||!a.managementScopeType||!a.managementScope||a.isVirtualManagerRole===void 0){d.error("请填写所有必填项");return}await ge({roleName:a.roleName,roleCode:a.roleCode,isVirtualManagerRole:a.isVirtualManagerRole,managementScopeType:a.managementScopeType,managementScope:a.managementScope,remark:a.remark,status:a.status}),d.success("创建成功")}y.value=!1,g()}catch{d.error(b.value?"更新失败":"创建失败")}finally{V.value=!1}},I=r((()=>{const n=[];return fe.forEach(e=>{var p;const f={key:e.path,title:((p=e.meta)==null?void 0:p.title)||e.name,children:[]};e.children&&e.children.length>0&&e.children.forEach(u=>{var S;f.children.push({key:u.path,title:((S=u.meta)==null?void 0:S.title)||u.name})}),n.push(f)}),n})()),ee=async n=>{x.value=n,k.value=!0,z.value=I.value.map(e=>e.key);try{const e=await me(n.id);e.data&&(_.value=e.data)}catch(e){console.error("加载权限失败:",e),_.value=[]}},ae=async()=>{U.value=!0;try{await pe(x.value.id,_.value),d.success("权限保存成功"),k.value=!1}catch{d.error("权限保存失败")}finally{U.value=!1}},le=()=>{k.value=!1,_.value=[],x.value=null},te=n=>{P.confirm({title:"确认删除",icon:J(F),content:`确定要删除角色"${n.roleName}"吗？`,okText:"确定",cancelText:"取消",onOk:async()=>{try{await ve(n.id),d.success("删除成功"),g()}catch{d.error("删除失败")}}})},ne=()=>{if(c.value.length===0){d.warning("请选择要删除的角色");return}P.confirm({title:"确认批量删除",icon:J(F),content:`确定要删除选中的 ${c.value.length} 个角色吗？`,okText:"确定",cancelText:"取消",onOk:async()=>{try{await _e(c.value),d.success("批量删除成功"),c.value=[],w.value=[],g()}catch{d.error("批量删除失败")}}})},oe=n=>{m.pageNum=n.current,m.pageSize=n.pageSize,g()};return Ke(()=>{g()}),(n,e)=>{var D;const f=Se,p=ke,u=we,S=Ce,O=be,se=Re,v=Me,K=Te,re=Ve,B=P,ie=he,ue=Ue;return R(),q("div",Ee,[i("div",$e,[i("div",Ae,[e[21]||(e[21]=i("div",{class:"query-header"},[i("h3",null,"筛选查询")],-1)),i("div",Ie,[l(O,{layout:"inline"},{default:t(()=>[l(p,{label:"角色名称"},{default:t(()=>[l(f,{value:m.roleName,"onUpdate:value":e[0]||(e[0]=o=>m.roleName=o),placeholder:"请输入","allow-clear":"",style:{width:"200px"},onPressEnter:A},null,8,["value"])]),_:1}),l(p,null,{default:t(()=>[l(S,null,{default:t(()=>[l(u,{type:"primary",onClick:A},{default:t(()=>e[11]||(e[11]=[s(" 查询 ")])),_:1,__:[11]}),l(u,{onClick:H},{default:t(()=>e[12]||(e[12]=[s(" 重置 ")])),_:1,__:[12]})]),_:1})]),_:1})]),_:1})]),i("div",Oe,[i("div",Be,[e[13]||(e[13]=i("span",{class:"info-label"},"数据列表",-1)),e[14]||(e[14]=i("span",{class:"info-divider"},"数据共",-1)),i("span",De,E(M.value),1),e[15]||(e[15]=i("span",{class:"info-unit"},"条",-1))]),i("div",Le,[l(u,{type:"primary",onClick:X},{icon:t(()=>[l(G(Ne))]),default:t(()=>[e[16]||(e[16]=s(" 新建角色 "))]),_:1,__:[16]}),l(u,{danger:"",disabled:c.value.length===0,onClick:ne},{icon:t(()=>[l(G(xe))]),default:t(()=>[e[17]||(e[17]=s(" 批量删除 "))]),_:1,__:[17]},8,["disabled"])])]),i("div",Fe,[l(se,{columns:j,"data-source":$.value,loading:T.value,pagination:{current:m.pageNum,pageSize:m.pageSize,total:M.value,showSizeChanger:!0,showQuickJumper:!0,showTotal:o=>`共 ${o} 条`},"row-selection":{selectedRowKeys:c.value,onChange:W},scroll:{x:1e3},"row-key":"id",onChange:oe},{bodyCell:t(({column:o,record:C})=>[o.key==="roleName"?(R(),q("a",Qe,E(C.roleName),1)):o.key==="remark"?(R(),q("span",Ge,E(C.remark||"-"),1)):o.key==="action"?(R(),Pe(S,{key:2},{default:t(()=>[l(u,{type:"link",size:"small",onClick:L=>Y(C)},{default:t(()=>e[18]||(e[18]=[s(" 编辑 ")])),_:2,__:[18]},1032,["onClick"]),l(u,{type:"link",size:"small",onClick:L=>ee(C)},{default:t(()=>e[19]||(e[19]=[s(" 权限管理 ")])),_:2,__:[19]},1032,["onClick"]),l(u,{type:"link",size:"small",danger:"",onClick:L=>te(C)},{default:t(()=>e[20]||(e[20]=[s(" 删除 ")])),_:2,__:[20]},1032,["onClick"])]),_:2},1024)):qe("",!0)]),_:1},8,["data-source","loading","pagination","row-selection"])])])]),l(B,{open:y.value,"onUpdate:open":e[7]||(e[7]=o=>y.value=o),title:h.value,width:600,"confirm-loading":V.value,onOk:Z},{default:t(()=>[l(O,{model:a,"label-col":{span:8},"wrapper-col":{span:14},style:{"margin-top":"24px"}},{default:t(()=>[l(p,{label:"角色名称",name:"roleName",rules:[{required:!0,message:"请输入角色名称",trigger:"blur"}]},{default:t(()=>[l(f,{value:a.roleName,"onUpdate:value":e[1]||(e[1]=o=>a.roleName=o),placeholder:"请输入角色名称","allow-clear":""},null,8,["value"])]),_:1}),l(p,{label:"角色编号",name:"roleCode",rules:[{required:!0,message:"请输入角色编号",trigger:"blur"}]},{default:t(()=>[l(f,{value:a.roleCode,"onUpdate:value":e[2]||(e[2]=o=>a.roleCode=o),placeholder:"请输入角色编号","allow-clear":""},null,8,["value"])]),_:1}),l(p,{label:"是否虚拟机构管理员角色",name:"isVirtualManagerRole",rules:[{required:!0,message:"请选择",trigger:"change"}]},{default:t(()=>[l(K,{value:a.isVirtualManagerRole,"onUpdate:value":e[3]||(e[3]=o=>a.isVirtualManagerRole=o),placeholder:"请选择","allow-clear":""},{default:t(()=>[l(v,{value:!0},{default:t(()=>e[22]||(e[22]=[s("是")])),_:1,__:[22]}),l(v,{value:!1},{default:t(()=>e[23]||(e[23]=[s("否")])),_:1,__:[23]})]),_:1},8,["value"])]),_:1}),l(p,{label:"管理范围类型",name:"managementScopeType",rules:[{required:!0,message:"请选择",trigger:"change"}]},{default:t(()=>[l(K,{value:a.managementScopeType,"onUpdate:value":e[4]||(e[4]=o=>a.managementScopeType=o),placeholder:"请选择","allow-clear":""},{default:t(()=>[l(v,{value:"本单位"},{default:t(()=>e[24]||(e[24]=[s("本单位")])),_:1,__:[24]}),l(v,{value:"本单位及下属单位"},{default:t(()=>e[25]||(e[25]=[s("本单位及下属单位")])),_:1,__:[25]}),l(v,{value:"所有单位"},{default:t(()=>e[26]||(e[26]=[s("所有单位")])),_:1,__:[26]}),l(v,{value:"指定单位"},{default:t(()=>e[27]||(e[27]=[s("指定单位")])),_:1,__:[27]})]),_:1},8,["value"])]),_:1}),l(p,{label:"管理范围",name:"managementScope",rules:[{required:!0,message:"请选择",trigger:"change"}]},{default:t(()=>[l(K,{value:a.managementScope,"onUpdate:value":e[5]||(e[5]=o=>a.managementScope=o),placeholder:"请选择","allow-clear":""},{default:t(()=>[l(v,{value:"全部"},{default:t(()=>e[28]||(e[28]=[s("全部")])),_:1,__:[28]}),l(v,{value:"计算机网络信息中心"},{default:t(()=>e[29]||(e[29]=[s("计算机网络信息中心")])),_:1,__:[29]}),l(v,{value:"大数据技术与应用发展部"},{default:t(()=>e[30]||(e[30]=[s("大数据技术与应用发展部")])),_:1,__:[30]}),l(v,{value:"高性能计算技术与应用发展部"},{default:t(()=>e[31]||(e[31]=[s("高性能计算技术与应用发展部")])),_:1,__:[31]})]),_:1},8,["value"])]),_:1}),l(p,{label:"备注"},{default:t(()=>[l(re,{value:a.remark,"onUpdate:value":e[6]||(e[6]=o=>a.remark=o),placeholder:"请输入备注",rows:3,"allow-clear":""},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title","confirm-loading"]),l(B,{open:k.value,"onUpdate:open":e[10]||(e[10]=o=>k.value=o),title:`${((D=x.value)==null?void 0:D.roleName)||""}角色权限编辑`,width:600,maskClosable:!1},{footer:t(()=>[l(u,{onClick:le},{default:t(()=>e[32]||(e[32]=[s("取消")])),_:1,__:[32]}),l(u,{type:"primary",loading:U.value,onClick:ae},{default:t(()=>e[33]||(e[33]=[s(" 保存 ")])),_:1,__:[33]},8,["loading"])]),default:t(()=>[i("div",Je,[l(ie,{message:"请选择该角色可以访问的功能模块",type:"info","show-icon":"",style:{"margin-bottom":"20px"}}),i("div",je,[l(ue,{checkedKeys:_.value,"onUpdate:checkedKeys":e[8]||(e[8]=o=>_.value=o),expandedKeys:z.value,"onUpdate:expandedKeys":e[9]||(e[9]=o=>z.value=o),"tree-data":I.value,checkable:"","field-names":{title:"title",key:"key",children:"children"},selectable:!1},null,8,["checkedKeys","expandedKeys","tree-data"])])])]),_:1},8,["open","title"])])}}}),la=ye(He,[["__scopeId","data-v-0fec55e9"]]);export{la as default};
