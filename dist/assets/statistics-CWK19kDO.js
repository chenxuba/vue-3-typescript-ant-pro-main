import{d as ne,a9 as oe,am as ue,f as i,c as re,o as ie,_ as v,a1 as m,$ as o,k as t,aa as _,a7 as n,G as r,ad as E,F as L,ac as U,ah as de}from"./vue-C8C4cLDH.js";import{f as ce,n as pe,o as ve}from"./index-DryvssBT.js";import{g as me}from"./organization-BhKWsDzJ.js";import{H as _e,J as ke,a9 as fe,aa as ge,U as ye,V as be,w as Ne,aq as we,T as he,ak as j}from"./antd-BOMTo3h8.js";import{_ as Te}from"./index-D6cQR864.js";const Se={class:"project-statistics-page"},Ce={class:"page-header"},Ie={class:"page-content"},xe={class:"filter-section"},Le={class:"filter-form"},je={class:"filter-actions"},ze={class:"table-section"},Ue={class:"table-header"},$e={class:"table-info"},Pe={class:"total-info"},Ae={class:"total-number"},De={key:0,class:"user-link"},Be={key:2,class:"status-cell"},Fe={class:"filter-section"},Ve={class:"filter-form"},Ee={class:"filter-actions"},Ke={class:"task-completion-container"},Oe={class:"task-level-sidebar"},Re={class:"task-level-search"},qe={class:"task-level-list"},Je=["onClick"],Me={class:"task-table-area"},He={class:"table-header"},Qe={class:"table-info"},Ge={class:"total-info"},Ye={class:"total-number"},We={key:0,class:"user-link"},Xe=ne({name:"ProjectStatistics",__name:"statistics",setup(Ze){const K=oe(),$=ue(),O=i($.query.name||"实训项目管理详情"),P=i("participation"),l=i({userNumber:"",userName:"",unit:void 0,status:void 0}),z=i([]),R=async()=>{try{const a=await me({limit:1e4,page:1,startNum:0,orderbyFiled:"orgCode:asc"});a&&a.data&&a.data.list&&(z.value=a.data.list.map(e=>({label:e.orgName,value:e.orgName})))}catch(a){console.error("获取组织列表失败:",a),j.error("获取组织列表失败")}},q=[{label:"已完成",value:"1"},{label:"进行中",value:"2"},{label:"未开始",value:"3"}],b=i([]),N=i(null),h=i(""),J=re(()=>h.value?b.value.filter(a=>a.name.toLowerCase().includes(h.value.toLowerCase())):b.value),M=a=>{N.value=a,c.value.current=1,C()},H=[{title:"用户编号",dataIndex:"userId",key:"userId",width:150},{title:"用户姓名",dataIndex:"nickName",key:"nickName",width:150},{title:"单位",dataIndex:"orgName",key:"orgName",width:300},{title:"参训时间",dataIndex:"joinTime",key:"joinTime",width:200},{title:"参训状态",dataIndex:"currentTask",key:"currentTask",width:150,align:"center"}],Q=[{title:"用户编号",dataIndex:"userNumber",key:"userNumber",width:150},{title:"用户姓名",dataIndex:"userName",key:"userName",width:150},{title:"单位",dataIndex:"unit",key:"unit",width:250},{title:"任务开始时间",dataIndex:"taskStartTime",key:"taskStartTime",width:180},{title:"任务结束时间",dataIndex:"taskEndTime",key:"taskEndTime",width:180},{title:"累计时间",dataIndex:"totalTime",key:"totalTime",width:120},{title:"实验状态",dataIndex:"experimentStatus",key:"experimentStatus",width:120}],A=i([]),D=i([]),k=i({current:1,pageSize:20,total:0,showSizeChanger:!0,showQuickJumper:!0,showTotal:a=>`数据共 ${a} 条`}),c=i({current:1,pageSize:20,total:0,showSizeChanger:!0,showQuickJumper:!0,showTotal:a=>`数据共 ${a} 条`}),y=i(!1),B=i(Number($.query.id)||0),T=i(0),G=async()=>{try{const a={projectId:B.value},e=await ce(a);e&&Array.isArray(e)&&(T.value=e.length,b.value=e.map(u=>({taskId:u.taskId,name:u.name})),b.value.length>0&&(N.value=b.value[0].taskId))}catch(a){console.error("获取项目任务列表失败:",a),j.error("获取项目任务列表失败")}},Y=a=>{if(!a)return"-";const e=a<1e10?a*1e3:a,u=new Date(e),g=u.getFullYear(),f=String(u.getMonth()+1).padStart(2,"0"),d=String(u.getDate()).padStart(2,"0"),w=String(u.getHours()).padStart(2,"0"),I=String(u.getMinutes()).padStart(2,"0"),x=String(u.getSeconds()).padStart(2,"0");return`${g}-${f}-${d} ${w}:${I}:${x}`},S=async()=>{y.value=!0;try{const a={limit:k.value.pageSize,page:k.value.current,projectId:B.value};l.value.userNumber&&(a.userId=l.value.userNumber),l.value.userName&&(a.nickName=l.value.userName),l.value.unit&&(a.orgName=l.value.unit),l.value.status&&(a.status=l.value.status);const e=await pe(a);e&&e.list&&(A.value=e.list,k.value.total=e.total)}catch(a){console.error("获取参训数据失败:",a),j.error("获取参训数据失败")}finally{y.value=!1}},W=()=>{console.log("查询",l.value),k.value.current=1,S()},X=()=>{l.value={userNumber:"",userName:"",unit:void 0,status:void 0},k.value.current=1,S()},F=()=>{console.log("导出数据")},Z=()=>{K.back()},ee=a=>{k.value.current=a.current,k.value.pageSize=a.pageSize,S()},C=async()=>{if(N.value){y.value=!0;try{const a={limit:c.value.pageSize,page:c.value.current,taskId:N.value};l.value.userNumber&&(a.userNumber=l.value.userNumber),l.value.userName&&(a.userName=l.value.userName),l.value.unit&&(a.unit=l.value.unit);const e=await ve(a);e&&e.list&&(D.value=e.list,c.value.total=e.total)}catch(a){console.error("获取任务用户数据失败:",a),j.error("获取任务用户数据失败")}finally{y.value=!1}}},ae=a=>{c.value.current=a.current,c.value.pageSize=a.pageSize,C()},te=()=>{console.log("任务查询",l.value),c.value.current=1,C()},se=()=>{l.value={userNumber:"",userName:"",unit:void 0,status:void 0},c.value.current=1,C()};return ie(()=>{R(),G(),S()}),(a,e)=>{const u=_e,g=be,f=ye,d=ge,w=Ne,I=fe,x=we,V=ke,le=he;return m(),v("div",Se,[o("div",Ce,[o("h2",null,_(O.value),1),t(u,{onClick:Z},{default:n(()=>e[9]||(e[9]=[r("返回")])),_:1,__:[9]})]),o("div",Ie,[t(le,{activeKey:P.value,"onUpdate:activeKey":e[8]||(e[8]=s=>P.value=s),class:"statistics-tabs"},{default:n(()=>[t(V,{key:"participation",tab:"参训整体情况"},{default:n(()=>[o("div",xe,[e[12]||(e[12]=o("div",{class:"filter-title"},"筛选查询",-1)),o("div",Le,[t(I,{gutter:16,align:"middle"},{default:n(()=>[t(d,{span:5},{default:n(()=>[t(f,{label:"用户编号：","label-col":{span:9},"wrapper-col":{span:15}},{default:n(()=>[t(g,{value:l.value.userNumber,"onUpdate:value":e[0]||(e[0]=s=>l.value.userNumber=s),placeholder:"请输入"},null,8,["value"])]),_:1})]),_:1}),t(d,{span:5},{default:n(()=>[t(f,{label:"用户姓名：","label-col":{span:9},"wrapper-col":{span:15}},{default:n(()=>[t(g,{value:l.value.userName,"onUpdate:value":e[1]||(e[1]=s=>l.value.userName=s),placeholder:"请输入"},null,8,["value"])]),_:1})]),_:1}),t(d,{span:5},{default:n(()=>[t(f,{label:"单位：","label-col":{span:6},"wrapper-col":{span:18}},{default:n(()=>[t(w,{value:l.value.unit,"onUpdate:value":e[2]||(e[2]=s=>l.value.unit=s),placeholder:"请选择",options:z.value,"allow-clear":""},null,8,["value","options"])]),_:1})]),_:1}),t(d,{span:5},{default:n(()=>[t(f,{label:"参训状态：","label-col":{span:9},"wrapper-col":{span:15}},{default:n(()=>[t(w,{value:l.value.status,"onUpdate:value":e[3]||(e[3]=s=>l.value.status=s),placeholder:"请选择",options:q,"allow-clear":""},null,8,["value"])]),_:1})]),_:1}),t(d,{span:4},{default:n(()=>[o("div",je,[t(u,{type:"primary",onClick:W},{default:n(()=>e[10]||(e[10]=[r("查询")])),_:1,__:[10]}),t(u,{onClick:X},{default:n(()=>e[11]||(e[11]=[r("重置")])),_:1,__:[11]})])]),_:1})]),_:1})])]),o("div",ze,[o("div",Ue,[o("div",$e,[e[15]||(e[15]=r(" 数据列表 ")),o("span",Pe,[e[13]||(e[13]=r("数据共 ")),o("span",Ae,_(k.value.total),1),e[14]||(e[14]=r(" 条"))])]),t(u,{type:"primary",onClick:F},{default:n(()=>e[16]||(e[16]=[r("导出")])),_:1,__:[16]})]),t(x,{columns:H,"data-source":A.value,pagination:k.value,loading:y.value,"row-key":s=>s.id,scroll:{x:1e3},onChange:ee},{bodyCell:n(({column:s,record:p})=>[s.key==="nickName"?(m(),v("a",De,_(p.nickName),1)):s.key==="joinTime"?(m(),v(L,{key:1},[r(_(Y(p.joinTime)),1)],64)):s.key==="currentTask"?(m(),v("div",Be,[o("span",null,_(p.currentTask)+" / "+_(T.value),1),o("span",{class:U(["status-icon",p.currentTask>=T.value?"completed":"inProgress"])},[p.currentTask>=T.value?(m(),v(L,{key:0},[r("✓")],64)):(m(),v(L,{key:1},[r("⟳")],64))],2)])):E("",!0)]),_:1},8,["data-source","pagination","loading","row-key"])])]),_:1}),t(V,{key:"task",tab:"任务完成情况"},{default:n(()=>[o("div",Fe,[e[19]||(e[19]=o("div",{class:"filter-title"},"筛选查询",-1)),o("div",Ve,[t(I,{gutter:16,align:"middle"},{default:n(()=>[t(d,{span:6},{default:n(()=>[t(f,{label:"用户编号：","label-col":{span:8},"wrapper-col":{span:16}},{default:n(()=>[t(g,{value:l.value.userNumber,"onUpdate:value":e[4]||(e[4]=s=>l.value.userNumber=s),placeholder:"请输入"},null,8,["value"])]),_:1})]),_:1}),t(d,{span:6},{default:n(()=>[t(f,{label:"用户姓名：","label-col":{span:8},"wrapper-col":{span:16}},{default:n(()=>[t(g,{value:l.value.userName,"onUpdate:value":e[5]||(e[5]=s=>l.value.userName=s),placeholder:"请输入"},null,8,["value"])]),_:1})]),_:1}),t(d,{span:6},{default:n(()=>[t(f,{label:"单位：","label-col":{span:6},"wrapper-col":{span:18}},{default:n(()=>[t(w,{value:l.value.unit,"onUpdate:value":e[6]||(e[6]=s=>l.value.unit=s),placeholder:"请选择",options:z.value,"allow-clear":""},null,8,["value","options"])]),_:1})]),_:1}),t(d,{span:6},{default:n(()=>[o("div",Ee,[t(u,{type:"primary",onClick:te},{default:n(()=>e[17]||(e[17]=[r("查询")])),_:1,__:[17]}),t(u,{onClick:se},{default:n(()=>e[18]||(e[18]=[r("重置")])),_:1,__:[18]})])]),_:1})]),_:1})])]),o("div",Ke,[o("div",Oe,[o("div",Re,[t(g,{value:h.value,"onUpdate:value":e[7]||(e[7]=s=>h.value=s),placeholder:"请输入内容","allow-clear":""},{suffix:n(()=>e[20]||(e[20]=[o("span",{class:"search-icon"},"🔍",-1)])),_:1},8,["value"])]),o("div",qe,[(m(!0),v(L,null,de(J.value,s=>(m(),v("div",{key:s.taskId,class:U(["task-level-item",{active:N.value===s.taskId}]),onClick:p=>M(s.taskId)},_(s.name),11,Je))),128))])]),o("div",Me,[o("div",He,[o("div",Qe,[e[23]||(e[23]=r(" 数据列表 ")),o("span",Ge,[e[21]||(e[21]=r("数据共 ")),o("span",Ye,_(c.value.total),1),e[22]||(e[22]=r(" 条"))])]),t(u,{type:"primary",onClick:F},{default:n(()=>e[24]||(e[24]=[r("导出")])),_:1,__:[24]})]),t(x,{columns:Q,"data-source":D.value,pagination:c.value,loading:y.value,"row-key":s=>s.id,scroll:{x:1200},onChange:ae},{bodyCell:n(({column:s,record:p})=>[s.key==="userName"?(m(),v("a",We,_(p.userName),1)):s.key==="experimentStatus"?(m(),v("span",{key:1,class:U(["status-tag",p.statusType])},_(p.experimentStatus),3)):E("",!0)]),_:1},8,["data-source","pagination","loading","row-key"])])])]),_:1})]),_:1},8,["activeKey"])])])}}}),na=Te(Xe,[["__scopeId","data-v-d22606d5"]]);export{na as default};
