const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./antd-Drh1eHWx.js","./vue-PnzzEkKE.js"])))=>i.map(i=>d[i]);
import{k as It,_ as Nt}from"./index-L25N5W2M.js";import{d as jt,ak as Pt,am as Et,f,c as $e,w as he,o as $t,_ as g,a1 as m,$ as r,k as a,a7 as s,ac as x,F as S,ag as z,u as k,a6 as J,G as p,a9 as A,H as Dt,ab as Ht,y as we}from"./vue-PnzzEkKE.js";import{u as Ot,a as Bt,i as Gt,R as De,d as be,g as He,e as Kt,h as zt,s as Jt,f as Wt}from"./RichTextEditor-Dh_IycJl.js";import{e as Yt,f as Zt,a as Qt,b as ke}from"./index-CFRqEQtr.js";import{g as Xt,a as ea}from"./dictionary-Dgbn3Qqw.js";import{H as q,j as ta,t as aa,x as Ce,c as la,a as oa,m as sa,u as na,F as ra,b as ia,R as ua,N as da,d as va,e as ca}from"./useFileTree-Bff1u7gC.js";import{ae as u,Z as pa,Y as fa,K as ma,z as ga,I as ya,$ as _a,a0 as ha,a1 as wa,a2 as ba,a3 as ka,a7 as Ca,a4 as Ta,H as Ua,J as Sa,a5 as xa,D as Ra,a6 as Fa,f as Ma,e as La,T as Aa,s as Va,ac as qa,ab as Ia,ag as Na}from"./antd-Drh1eHWx.js";const ja={class:"edit-jupyter-lab-page"},Pa={class:"page-container"},Ea={class:"steps-section"},$a={key:0},Da={class:"form-section"},Ha={class:"flex items-top gap-16px"},Oa={class:"flex flex-col gap-12px"},Ba={key:0,class:"image-preview"},Ga=["src"],Ka={class:"flex items-top gap-16px"},za={class:"flex flex-col gap-12px"},Ja={key:0,class:"image-preview"},Wa=["src"],Ya={class:"form-section"},Za={key:1},Qa={class:"form-section repository-section"},Xa={class:"repository-top-bar flex items-center gap-16px justify-between"},el={class:"repository-url-group"},tl={class:"repository-main-area"},al={class:"repository-left"},ll={class:"repository-switch-box flex items-center justify-between"},ol={class:"flex items-center gap-12px"},sl={key:1,class:"repository-tips"},nl={class:"repository-right"},rl={key:1,class:"empty-area"},il={key:2,class:"step-content evaluation-step"},ul={class:"evaluation-section"},dl={class:"section-block"},vl={class:"block-content"},cl={class:"file-select-wrapper"},pl={class:"selected-files-list"},fl={style:{display:"flex","align-items":"center",gap:"8px"}},ml={key:0,class:"section-block"},gl={class:"block-header"},yl={class:"header-actions"},_l={class:"block-content"},hl={class:"test-set-label"},wl={class:"tab-footer-buttons"},bl={class:"reference-section"},kl={class:"section-block"},Cl={class:"block-content"},Tl={class:"tab-footer-buttons"},Ul={key:3,class:"step-content environment-step"},Sl={class:"environment-section"},xl={class:"environment-container"},Rl={class:"environment-left"},Fl={class:"search-box"},Ml={class:"environment-list"},Ll=["onClick"],Al={class:"environment-right"},Vl={class:"environment-config-header"},ql={style:{display:"flex","align-items":"center",gap:"8px"}},Il={class:"page-footer"},ue="http://101.200.13.193",Nl=jt({name:"EditJupyterLab",__name:"edit-jupyter-lab",setup(jl){q.registerLanguage("javascript",ta),q.registerLanguage("typescript",aa),q.registerLanguage("xml",Ce),q.registerLanguage("html",Ce),q.registerLanguage("vue",Ce),q.registerLanguage("css",la),q.registerLanguage("json",oa),q.registerLanguage("markdown",sa);const $=Pt(),Oe=Et(),R=f(null),I=f(null),h=f(0),j=f(!1),W=f(),Te=f(),l=f({name:"",tag:"",fieldType:void 0,difficulty:1,environment:void 0,secondType:void 0,classHour:"",topCover:"",cover:"",description:"",showTaskRequire:!1,authType:1,enableCodeRepository:!1,repositoryType:"代码仓库",gitUrl:""}),Y=f(""),Z=f(""),Q=f(!1),X=f(!1),Ue={name:[{required:!0,message:"请输入名称",trigger:"blur"}],tag:[{required:!0,message:"请输入技能标签",trigger:"blur"}],fieldType:[{required:!0,message:"请选择领域类别",trigger:"change"}],difficulty:[{required:!0,message:"请选择难度",trigger:"change"}],environment:[{required:!0,message:"请选择实验环境",trigger:"change"}],secondType:[{required:!0,message:"请选择小类别",trigger:"change"}],classHour:[{required:!0,message:"请输入学时",trigger:"blur"}],topCover:[{required:!0,message:"请上传顶部背景图",trigger:"change"}],cover:[{required:!0,message:"请上传封面图",trigger:"change"}],authType:[{required:!0,message:"请选择培训公开范围",trigger:"change"}]},de=Ot(),Se=Bt(),D=Gt(),U=f([]),ve=f(!1),Be=async()=>{try{ve.value=!0;const t=Xt(3),e=await ea({code:t});e&&e.list&&(U.value=e.list.map(n=>({label:n.name,value:String(n.value)})),console.log("加载环境选项:",{environmentOptions:U.value,currentEnvironment:l.value.environment}),l.value.environment?(T.value=String(l.value.environment),w.value.dockerImage=String(l.value.environment),console.log("使用第一步的环境:",l.value.environment)):!T.value&&U.value.length>0&&(T.value=U.value[0].value,w.value.dockerImage=U.value[0].value,l.value.environment=U.value[0].value,console.log("默认选中第一个环境:",U.value[0])))}catch(t){console.error("加载实验环境选项失败：",t),u.error("加载实验环境选项失败")}finally{ve.value=!1}},Ge=[{label:"切换仓库",value:"切换仓库"},{label:"代码仓库",value:"代码仓库"},{label:"私密代码仓库",value:"私密代码仓库"}],P=f(!1),ce=f(new Set),Ke=[{title:"基本信息"},{title:"代码仓库"},{title:"评测设置"},{title:"实验环境"}],{fileTreeData:ee,expandedKeys:pe,selectedFile:ze,highlightedCode:Je,dynamicFileContents:We,handleSelectFile:Ye,getNodePath:xe,addFileToTree:Re,addFolderToTree:Ze,handleRenameNode:Qe,handleCopyPath:Xe,loadRemoteFileTree:et,loadChildrenData:tt,getNodePathFromMap:fe}=na(),H=f(!1),te=f(!1),ae=f(!1),le=f(!1),O=f("/"),B=f("/"),Fe=f(null),oe=f("/"),Me=f("settings"),c=f({openTestValidate:1,testValidateFiles:"",testValidateSh:"",timeLimitM:"",scoreRule:1,evaluationSetting:1,testSets:[]}),C=f({showAnswer:1,prohibitCopyAnswer:1,referenceAnswer:""}),se=f(!1),ne=f(!1);let me=1;const at=()=>{c.value.testSets.push({id:me++,arg:"",answer:"",select:1})},lt=t=>{if(c.value.testSets.length===1){u.warning("至少保留一个测试集");return}c.value.testSets=c.value.testSets.filter(e=>e.id!==t),u.success("删除成功")},ot=(t,e)=>{t.select=e?1:2},M=f([]),st=t=>{const{onSuccess:e}=t;setTimeout(()=>{e("ok")},0)},nt=async t=>{const{fileList:e}=t,n=e.filter(i=>i.status==="uploading"||i.status==="done"||!i.status);M.value=n;const d=n.filter(i=>i.originFileObj&&!i.url).map(async i=>{try{const v=await be(i.originFileObj);return i.url=v,v}catch(v){return console.error("文件上传失败:",v),u.error(`文件 ${i.name} 上传失败`),null}});if(d.length>0){const v=(await Promise.all(d)).filter(b=>b!==null);if(v.length>0){const b=n.filter(y=>y.url).map(y=>y.url).join(",");c.value.testValidateFiles=b,u.success(`成功上传 ${v.length} 个文件`)}}},rt=t=>{M.value=t.map(n=>({uid:n.uid,name:n.name,status:"done",url:n.path}));const e=t.map(n=>n.path).join(",");c.value.testValidateFiles=e,u.success(`已选择 ${t.length} 个文件`),le.value=!1},T=f(""),re=f(""),it=$e(()=>re.value?U.value.filter(t=>t.label.toLowerCase().includes(re.value.toLowerCase())):U.value),ut=$e(()=>{const t=U.value.find(e=>e.value===T.value);return t?t.label:"未选择"}),w=f({dockerImage:"",secondType:"Css",timeLimitM:""}),dt=t=>{T.value=t,w.value.dockerImage=t,l.value.environment!==t&&(l.value.environment=t)},vt=async()=>{if(!R.value){u.error("缺少项目ID"),$.back();return}try{j.value=!0;const t=await Yt({id:R.value});l.value={name:t.name||"",tag:t.tag||"",fieldType:t.fieldType,difficulty:t.difficulty||1,environment:t.environment,secondType:t.secondType,classHour:t.classHour||"",topCover:t.topCover||"",cover:t.cover||"",description:t.description||"",showTaskRequire:t.showTaskRequire===1,authType:t.authType||1,enableCodeRepository:t.gitUrl?!0:t.enableCodeRepository||!1,repositoryType:t.repositoryType||"代码仓库",gitUrl:t.gitUrl||""},t.topCover&&(Y.value=ue+t.topCover),t.cover&&(Z.value=ue+t.cover),t.gitUrl&&(P.value=!0),t.environment&&(await we(),T.value=String(t.environment),w.value.dockerImage=String(t.environment),console.log("同步环境到第四步:",{environment:t.environment,selectedEnvironment:T.value,environmentOptions:U.value})),await ct()}catch(t){console.error("获取项目详情失败：",t),u.error(t.message||"获取项目详情失败"),$.back()}finally{j.value=!1}},ct=async()=>{if(R.value)try{const t=await Zt({projectId:R.value});let e=[];if(Array.isArray(t)?e=t:t&&typeof t=="object"&&(e=t.list||t.data||t.tasks||[]),e&&e.length>0){const n=e[0];if(n){if(I.value=n.taskId,c.value={openTestValidate:n.openTestValidate||1,testValidateFiles:n.testValidateFiles||"",testValidateSh:n.testValidateSh||"",timeLimitM:n.timeLimitM||"",scoreRule:n.scoreRule||1,evaluationSetting:n.evaluationSetting||1,testSets:[]},n.testContent)try{const d=JSON.parse(n.testContent);c.value.testSets=d.map((i,v)=>({id:v+1,arg:i.arg||"",answer:i.answer||"",select:i.select||1})),me=c.value.testSets.length+1}catch(d){console.error("解析测试集失败:",d)}c.value.testSets.length===0&&(c.value.testSets=[{id:1,arg:"",answer:"",select:1},{id:2,arg:"",answer:"",select:1}],me=3),n.testValidateFiles&&(M.value=n.testValidateFiles.split(",").map((d,i)=>({uid:`${i}`,name:d.split("/").pop()||`文件${i+1}`,status:"done",url:d,response:d}))),C.value={showAnswer:n.showAnswer||1,prohibitCopyAnswer:n.prohibitCopyAnswer||1,referenceAnswer:n.referenceAnswer||""},n.secondType&&(w.value.secondType=n.secondType),n.timeLimitM&&(w.value.timeLimitM=n.timeLimitM),se.value=!0,ne.value=!0}}}catch(t){console.error("获取任务列表失败：",t)}},pt=async t=>{var d;if(!(t.size/1024/1024<12))return u.error("图片大小不能超过 12MB!"),!1;if(!(t.type==="image/jpeg"||t.type==="image/png"))return u.error("只能上传 JPG/PNG 格式的图片!"),!1;try{Q.value=!0;const i=await be(t);Y.value=ue+i,l.value.topCover=i,(d=W.value)==null||d.validateFields(["topCover"]),u.success("顶部背景图上传成功")}catch{u.error("顶部背景图上传失败")}finally{Q.value=!1}return!1},ft=async t=>{var d;if(!(t.size/1024/1024<12))return u.error("图片大小不能超过 12MB!"),!1;if(!(t.type==="image/jpeg"||t.type==="image/png"))return u.error("只能上传 JPG/PNG 格式的图片!"),!1;try{X.value=!0;const i=await be(t);Z.value=ue+i,l.value.cover=i,(d=W.value)==null||d.validateFields(["cover"]),u.success("封面图上传成功")}catch{u.error("封面图上传失败")}finally{X.value=!1}return!1},mt=t=>{(typeof t=="boolean"?t:!!t)?H.value=!0:l.value.enableCodeRepository=!1},ie=async()=>{try{const t=u.loading("正在查询仓库文件...",0),e=await He(l.value.gitUrl,"");et(e),ce.value.clear(),t(),u.success("仓库文件查询成功"),console.log("查询仓库地址：",l.value.gitUrl),console.log("获取到的文件列表：",e)}catch(t){u.error(t.message||"仓库文件查询失败"),console.error("仓库文件查询失败：",t)}},gt=async()=>{if(!l.value.gitUrl||!l.value.gitUrl.trim()){u.error("请先配置仓库地址"),Le();return}l.value.enableCodeRepository=!0,H.value=!1,P.value=!0,await ie()},Le=()=>{l.value.enableCodeRepository=!1,H.value=!1};he(()=>l.value.repositoryType,t=>{t==="切换仓库"&&l.value.enableCodeRepository&&(P.value=!1,u.info("已解锁仓库地址，请重新输入"),we(()=>{l.value.repositoryType="代码仓库"}))}),he(()=>l.value.environment,t=>{console.log("formData.environment 变化:",t,"当前 selectedEnvironment:",T.value),t&&String(t)!==T.value&&(T.value=String(t),w.value.dockerImage=String(t),console.log("已同步到第四步:",T.value))}),he(()=>T.value,t=>{console.log("selectedEnvironment 变化为:",t)});const yt=()=>{var t;l.value.enableCodeRepository&&!P.value&&((t=l.value.gitUrl)!=null&&t.trim())&&(P.value=!0,ie())},_t=async(t,e)=>{const{expanded:n,node:d}=e;if(n&&!d.isLeaf){const i=String(d.key);if(ce.value.has(i)){console.log("文件夹已加载，跳过：",i);return}try{const v=fe(i);console.log("加载文件夹：",v,"节点key:",i);const b=u.loading(`正在加载 ${d.title}...`,0),y=await He(l.value.gitUrl,v);tt(i,y),ce.value.add(i),b(),console.log("文件夹加载成功：",v,y)}catch(v){u.error(v.message||"加载文件夹失败"),console.error("加载文件夹失败：",v)}}},ht=t=>{switch(String(t.key)){case"newFile":Ve();break;case"newFolder":qe();break;case"upload":Ae("/");break}},wt=(t,e)=>{const n=String(t.key),d=fe(e.key)||xe(e.key);switch(n){case"newFile":Ve(d);break;case"newFolder":qe(d);break;case"upload":Ae(d);break;case"rename":Qe(e);break;case"copyPath":Xe(e);break;case"delete":Ut(e);break}},Ae=t=>{var e;oe.value=t,(e=Fe.value)==null||e.click()},bt=async t=>{var d;const e=t.target,n=(d=e.files)==null?void 0:d[0];if(n)try{let i=oe.value==="/"?"":oe.value.replace(/^\//,"");const v=u.loading(`正在上传 ${n.name}...`,0);await Kt(n,l.value.gitUrl,i);const b=new FileReader;b.onload=y=>{var _;const L=(_=y.target)==null?void 0:_.result;Re(n.name,L,oe.value)},b.readAsText(n),v(),u.success(`文件 ${n.name} 上传成功`),console.log("文件上传成功：",{fileName:n.name,path:i})}catch(i){u.error(i.message||"文件上传失败"),console.error("文件上传失败：",i)}finally{e&&(e.value="")}},Ve=(t="/")=>{te.value=!0,O.value=t},kt=async t=>{try{let e=O.value==="/"?"":O.value.replace(/^\//,"");const n=u.loading("正在保存文件...",0);await Jt({fileContent:t.fileContent,fileName:t.fileName,gitUrl:l.value.gitUrl,path:e,commit:t.commitMessage}),Re(t.fileName,t.fileContent,O.value),n(),u.success("文件创建成功"),te.value=!1,console.log("文件保存成功：",{fileName:t.fileName,path:e})}catch(e){u.error(e.message||"文件创建失败"),console.error("文件创建失败：",e)}},qe=(t="/")=>{ae.value=!0,B.value=t},Ct=async t=>{try{let e=B.value==="/"?t.folderName:`${B.value.replace(/^\//,"")}/${t.folderName}`;const n=u.loading("正在创建文件夹...",0);await Wt({commit:t.commitMessage,gitUrl:l.value.gitUrl,path:e}),Ze(t.folderName,B.value),n(),u.success("文件夹创建成功"),ae.value=!1,console.log("文件夹创建成功：",{folderName:t.folderName,path:e})}catch(e){u.error(e.message||"文件夹创建失败"),console.error("文件夹创建失败：",e)}},Tt=t=>{const e=n=>{const d=n.findIndex(i=>i.key===t);if(d!==-1)return n.splice(d,1),!0;for(const i of n)if(i.children&&e(i.children))return!0;return!1};e(ee.value)},Ut=async t=>{const e=t.children!==void 0||t.isLeaf===!1,n=t.title,i=(fe(t.key)||xe(t.key)).split("/");i.pop();const v=i.join("/")||"",{Modal:b}=await It(async()=>{const{Modal:y}=await import("./antd-Drh1eHWx.js").then(L=>L.au);return{Modal:y}},__vite__mapDeps([0,1]),import.meta.url);b.confirm({title:"确认删除",content:`确定要删除${e?"文件夹":"文件"} "${n}" 吗？${e?"文件夹下的所有内容也会被删除。":""}`,okText:"确定",cancelText:"取消",okType:"danger",onOk:async()=>{let y=null;try{y=u.loading("正在删除...",0),await zt({fileName:n,gitUrl:l.value.gitUrl,path:v}),Tt(t.key),y(),u.success("删除成功"),console.log("删除成功：",{fileName:n,path:v})}catch(L){y&&y(),u.error(L.message||"删除失败"),console.error("删除失败：",L)}}})},G=()=>{we(()=>{window.scrollTo({top:0,behavior:"smooth"}),document.documentElement.scrollTop=0,document.body.scrollTop=0;const t=document.querySelector(".page-content");t&&(t.scrollTop=0);const e=document.querySelector(".ant-layout-content");e&&(e.scrollTop=0),document.querySelectorAll("*").forEach(d=>{d.scrollTop>0&&(d.scrollTop=0)})})},St=async()=>{h.value>0?(h.value--,G(),h.value===1&&l.value.gitUrl&&l.value.enableCodeRepository&&ee.value.length===0&&await ie()):$.back()},xt=async()=>{var t,e;if(h.value===0)try{await Promise.all([(t=W.value)==null?void 0:t.validate(),(e=Te.value)==null?void 0:e.validate()]),h.value=1,G(),l.value.gitUrl&&l.value.enableCodeRepository&&ee.value.length===0&&await ie()}catch{u.error("请完善必填信息"),G()}else if(h.value===1){if(l.value.enableCodeRepository&&(!l.value.gitUrl||l.value.gitUrl.trim()==="")){u.error("请输入仓库地址");return}await Ie(!1),h.value=2,G()}else if(h.value===2){try{await Ne()}catch{return}try{await je()}catch{return}h.value=3,G()}else h.value===3&&await Rt()},Ie=async(t=!1)=>{try{j.value=!0;const e={id:R.value,projectType:3,environment:l.value.environment,name:l.value.name,tag:l.value.tag,fieldType:l.value.fieldType,difficulty:l.value.difficulty,classHour:l.value.classHour,topCover:l.value.topCover,cover:l.value.cover,description:l.value.description,showTaskRequire:l.value.showTaskRequire?1:2,authType:l.value.authType,enableCodeRepository:l.value.enableCodeRepository,secondType:l.value.secondType};t&&(e.status=10),l.value.enableCodeRepository&&(e.repositoryType=l.value.repositoryType,e.gitUrl=l.value.gitUrl),await Qt(e),t?(u.success("项目更新成功！"),setTimeout(()=>{$.push("/dashboard/analysis")},500)):u.success("保存成功！")}catch(e){throw console.error("更新失败：",e),u.error(e.message||"项目更新失败，请稍后重试"),e}finally{j.value=!1}},Ne=async()=>{if(!I.value)throw u.error("任务ID不存在，请重新创建任务"),new Error("任务ID不存在");if(c.value.openTestValidate===1){if(!c.value.testValidateFiles||c.value.testValidateFiles.trim()==="")throw u.error("请上传评测文件"),new Error("请上传评测文件");if(!c.value.testValidateSh||c.value.testValidateSh.trim()==="")throw u.error("请输入评测执行命令"),new Error("请输入评测执行命令");if(!c.value.timeLimitM)throw u.error("请输入评测时长限制"),new Error("请输入评测时长限制");if(!c.value.testSets||c.value.testSets.length===0)throw u.error("请至少添加一个测试集"),new Error("请至少添加一个测试集");const n=c.value.testSets.filter(d=>d.select===1);if(n.length===0)throw u.error("请至少选中一个测试集"),new Error("请至少选中一个测试集");for(let d=0;d<n.length;d++){const i=n[d];if(!i.arg||i.arg.trim()==="")throw u.error(`测试集${d+1}的输入内容不能为空`),new Error(`测试集${d+1}的输入内容不能为空`);if(!i.answer||i.answer.trim()==="")throw u.error(`测试集${d+1}的期望输出不能为空`),new Error(`测试集${d+1}的期望输出不能为空`)}}const t=c.value.testSets.map(n=>({arg:n.arg,answer:n.answer,select:n.select})),e={taskId:I.value,projectId:R.value,openTestValidate:c.value.openTestValidate,testValidateFiles:c.value.testValidateFiles,testValidateSh:c.value.testValidateSh,timeLimitM:c.value.timeLimitM,scoreRule:c.value.scoreRule,evaluationSetting:c.value.evaluationSetting,testContent:JSON.stringify(t)};try{await ke(e),se.value=!0}catch(n){throw u.error("评测设置保存失败，请重试"),n}},je=async()=>{if(!I.value)throw u.error("任务ID不存在，请重新创建任务"),new Error("任务ID不存在");if(!C.value.referenceAnswer||C.value.referenceAnswer.trim()==="")throw u.error("请输入参考答案内容"),new Error("请输入参考答案内容");if(!C.value.referenceAnswer.replace(/<[^>]*>/g,"").trim())throw u.error("请输入参考答案内容"),new Error("请输入参考答案内容");const e={taskId:I.value,projectId:R.value,showAnswer:C.value.showAnswer,prohibitCopyAnswer:C.value.prohibitCopyAnswer,referenceAnswer:C.value.referenceAnswer};try{await ke(e),ne.value=!0}catch(n){throw u.error("参考答案保存失败，请重试"),n}},Rt=async()=>{try{if(!R.value||!I.value){u.error("项目ID或任务ID不存在");return}if(!se.value){u.error("请先保存评测设置后再完成更新");return}if(!ne.value){u.error("请先保存参考答案后再完成更新");return}if(!w.value.dockerImage){u.error("请选择实验环境");return}if(!w.value.timeLimitM){u.error("请输入实验环境使用时长");return}await ke({taskId:I.value,projectId:R.value,dockerImage:w.value.dockerImage,secondType:w.value.secondType,timeLimitM:w.value.timeLimitM}),await Ie(!0)}catch(t){console.error("完成更新失败：",t),u.error("完成更新失败，请重试")}};return $t(async()=>{de.load(),Se.load(),D.load();const t=Oe.query.id;t?(R.value=Number(t),await Be(),await vt()):(u.error("缺少项目ID"),$.back())}),(t,e)=>{const n=fa,d=pa,i=ya,v=ga,b=ha,y=wa,L=_a,_=ka,N=ba,ge=Ca,F=Ua,ye=Ta,Pe=Sa,K=ma,Ft=xa,_e=La,Mt=Ma,Lt=Ra,At=qa,Ee=Va,Vt=Aa,qt=Na;return m(),g("div",ja,[e[70]||(e[70]=r("div",{class:"page-header"},[r("h2",null,"编辑JupyterLab环境实训项目")],-1)),a(qt,{spinning:j.value},{default:s(()=>[r("div",Pa,[r("div",Ea,[a(d,{current:h.value,class:"custom-steps"},{default:s(()=>[(m(),g(S,null,z(Ke,(o,V)=>a(n,{key:V,title:o.title},null,8,["title"])),64))]),_:1},8,["current"])]),h.value===0?(m(),g("div",$a,[e[38]||(e[38]=r("div",{class:"section-title"},[r("h3",null,"基本信息")],-1)),r("div",Da,[a(K,{ref_key:"formRef",ref:W,model:l.value,rules:Ue,layout:"horizontal","label-col":{span:2},"wrapper-col":{span:18}},{default:s(()=>[a(v,{label:"名称",name:"name",required:""},{default:s(()=>[a(i,{value:l.value.name,"onUpdate:value":e[0]||(e[0]=o=>l.value.name=o),placeholder:"请输入名称"},null,8,["value"])]),_:1}),a(L,null,{default:s(()=>[a(b,{span:12},{default:s(()=>[a(v,{label:"技能标签",name:"tag",required:"","label-col":{span:4},"wrapper-col":{span:20}},{default:s(()=>[a(i,{value:l.value.tag,"onUpdate:value":e[1]||(e[1]=o=>l.value.tag=o),placeholder:"请输入技能标签"},null,8,["value"])]),_:1})]),_:1}),a(b,{span:12},{default:s(()=>[a(v,{label:"领域类别",name:"fieldType",required:"","label-col":{span:4},"wrapper-col":{span:12}},{default:s(()=>[a(y,{value:l.value.fieldType,"onUpdate:value":e[2]||(e[2]=o=>l.value.fieldType=o),placeholder:"请选择领域类别",options:k(de).options.value,loading:k(de).loading.value},null,8,["value","options","loading"])]),_:1})]),_:1})]),_:1}),a(v,{label:"难度",name:"difficulty",required:""},{default:s(()=>[a(N,{value:l.value.difficulty,"onUpdate:value":e[3]||(e[3]=o=>l.value.difficulty=o),class:"custom-radio"},{default:s(()=>[(m(!0),g(S,null,z(k(Se).data.value,o=>(m(),J(_,{key:o.value,value:Number(o.value)},{default:s(()=>[p(A(o.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),a(L,null,{default:s(()=>[a(b,{span:12},{default:s(()=>[a(v,{label:"实验环境",name:"environment",required:"","label-col":{span:4},"wrapper-col":{span:20}},{default:s(()=>[a(y,{value:l.value.environment,"onUpdate:value":e[4]||(e[4]=o=>l.value.environment=o),placeholder:"请选择实验环境",options:U.value,loading:ve.value},null,8,["value","options","loading"])]),_:1})]),_:1}),a(b,{span:12},{default:s(()=>[a(v,{label:"小类别",name:"secondType",required:"","label-col":{span:4},"wrapper-col":{span:12}},{default:s(()=>[a(y,{value:l.value.secondType,"onUpdate:value":e[5]||(e[5]=o=>l.value.secondType=o),placeholder:"请选择小类别",options:k(D).options.value,loading:k(D).loading.value},null,8,["value","options","loading"])]),_:1})]),_:1})]),_:1}),a(v,{label:"学时",name:"classHour",required:""},{default:s(()=>[a(ge,{min:0,class:"w-full",value:l.value.classHour,"onUpdate:value":e[6]||(e[6]=o=>l.value.classHour=o),placeholder:"请输入学时"},null,8,["value"])]),_:1}),a(v,{label:"顶部背景图",name:"topCover",required:""},{default:s(()=>[r("div",Ha,[r("div",Oa,[a(ye,{"before-upload":pt,"show-upload-list":!1,accept:"image/png,image/jpeg"},{default:s(()=>[a(F,{loading:Q.value},{default:s(()=>[Q.value?(m(),g(S,{key:1},[p("上传中...")],64)):(m(),g(S,{key:0},[p("选择文件")],64))]),_:1},8,["loading"])]),_:1}),Y.value?(m(),g("div",Ba,[r("img",{src:Y.value,alt:"顶部背景图预览",style:{"max-width":"290px","max-height":"218px","border-radius":"4px"}},null,8,Ga)])):x("",!0)]),e[31]||(e[31]=r("div",{class:"upload-hint"}," 说明：支持上传png/jpeg等格式文件，文件大小不能超过12M,建议使用290*218像素。 ",-1))])]),_:1}),a(v,{label:"封面图",name:"cover",required:""},{default:s(()=>[r("div",Ka,[r("div",za,[a(ye,{"before-upload":ft,"show-upload-list":!1,accept:"image/png,image/jpeg"},{default:s(()=>[a(F,{loading:X.value},{default:s(()=>[X.value?(m(),g(S,{key:1},[p("上传中...")],64)):(m(),g(S,{key:0},[p("选择文件")],64))]),_:1},8,["loading"])]),_:1}),Z.value?(m(),g("div",Ja,[r("img",{src:Z.value,alt:"封面图预览",style:{"max-width":"290px","max-height":"218px","border-radius":"4px"}},null,8,Wa)])):x("",!0)]),e[32]||(e[32]=r("div",{class:"upload-hint"}," 说明：支持上传png/jpeg等格式文件，文件大小不能超过12M,建议使用290*218像素。 ",-1))])]),_:1}),a(v,{label:"简介",name:"description"},{default:s(()=>[a(De,{modelValue:l.value.description,"onUpdate:modelValue":e[7]||(e[7]=o=>l.value.description=o)},null,8,["modelValue"])]),_:1}),a(v,{label:"任务要求",name:"showTaskRequire"},{default:s(()=>[a(Pe,{checked:l.value.showTaskRequire,"onUpdate:checked":e[8]||(e[8]=o=>l.value.showTaskRequire=o)},{default:s(()=>e[33]||(e[33]=[p(" 显示任务要求（勾选后，将帮作为任务要求显示在任务项目政策面） ")])),_:1,__:[33]},8,["checked"])]),_:1})]),_:1},8,["model"])]),e[39]||(e[39]=r("div",{class:"section-title"},[r("h3",null,"培训公开范围")],-1)),r("div",Ya,[a(K,{ref_key:"trainingScopeFormRef",ref:Te,model:l.value,rules:Ue,layout:"horizontal","label-col":{span:2},"wrapper-col":{span:18}},{default:s(()=>[a(v,{label:"培训公开范围",name:"authType",required:""},{default:s(()=>[a(N,{value:l.value.authType,"onUpdate:value":e[9]||(e[9]=o=>l.value.authType=o),class:"custom-radio"},{default:s(()=>[a(_,{value:1},{default:s(()=>e[34]||(e[34]=[p("完全公开")])),_:1,__:[34]}),a(_,{value:2},{default:s(()=>e[35]||(e[35]=[p("全院公开")])),_:1,__:[35]}),a(_,{value:3},{default:s(()=>e[36]||(e[36]=[p("本单位公开")])),_:1,__:[36]}),a(_,{value:4},{default:s(()=>e[37]||(e[37]=[p("不公开")])),_:1,__:[37]})]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])])])):x("",!0),h.value===1?(m(),g("div",Za,[r("div",Qa,[r("div",Xa,[a(y,{value:l.value.repositoryType,"onUpdate:value":e[10]||(e[10]=o=>l.value.repositoryType=o),options:Ge,class:"repository-type-select"},null,8,["value"]),r("div",el,[e[40]||(e[40]=r("span",{class:"url-label"},"仓库地址：",-1)),a(i,{value:l.value.gitUrl,"onUpdate:value":e[11]||(e[11]=o=>l.value.gitUrl=o),placeholder:"请输入仓库地址",class:"url-input",disabled:P.value,onBlur:yt},null,8,["value","disabled"])])]),r("div",tl,[r("div",al,[r("div",ll,[r("div",ol,[e[41]||(e[41]=r("span",{class:"switch-label"},"代码仓库",-1)),a(Ft,{checked:l.value.enableCodeRepository,disabled:l.value.enableCodeRepository,onChange:mt},null,8,["checked","disabled"])]),l.value.enableCodeRepository?(m(),J(Lt,{key:0},{overlay:s(()=>[a(Mt,{onClick:ht},{default:s(()=>[a(_e,{key:"newFile"},{default:s(()=>e[42]||(e[42]=[p("新建文件")])),_:1,__:[42]}),a(_e,{key:"newFolder"},{default:s(()=>e[43]||(e[43]=[p("新建文件夹")])),_:1,__:[43]}),a(_e,{key:"upload"},{default:s(()=>e[44]||(e[44]=[p("上传")])),_:1,__:[44]})]),_:1})]),default:s(()=>[a(F,{type:"primary",size:"small"},{default:s(()=>[a(k(Fa)),e[45]||(e[45]=p(" 新建 "))]),_:1,__:[45]})]),_:1})):x("",!0)]),l.value.enableCodeRepository?(m(),J(ra,{key:0,"file-tree-data":k(ee),"expanded-keys":k(pe),"onUpdate:expandedKeys":e[12]||(e[12]=o=>Dt(pe)?pe.value=o:null),onSelect:k(Ye),onMenuClick:wt,onExpand:_t},null,8,["file-tree-data","expanded-keys","onSelect"])):x("",!0),l.value.enableCodeRepository?(m(),g("div",sl,e[46]||(e[46]=[r("div",{class:"tips-title"},"提示：",-1),r("div",{class:"tips-content"}," 此处存放本实训所需的所有代码等相关文件，你可以通过以下： ",-1),r("div",{class:"tips-list"},[p(" 1、"),r("a",{href:"#",class:"tips-link"},"Gitee客户端"),p(" 上传已有文件来开始使用。 ")],-1),r("div",{class:"tips-list"}," 2、直接在平台上创建文件目录以及相关代码文件。 ",-1)]))):x("",!0)]),r("div",nl,[l.value.enableCodeRepository?(m(),J(ia,{key:0,"selected-file":k(ze),"highlighted-code":k(Je),"dynamic-file-contents":k(We)},null,8,["selected-file","highlighted-code","dynamic-file-contents"])):(m(),g("div",rl," 在左侧代码仓库区域点击目录打开文件 "))])])])])):x("",!0),h.value===2?(m(),g("div",il,[a(Vt,{activeKey:Me.value,"onUpdate:activeKey":e[23]||(e[23]=o=>Me.value=o),class:"evaluation-tabs"},{default:s(()=>[a(Ee,{key:"settings",tab:"评测设置"},{default:s(()=>[r("div",ul,[r("div",dl,[e[59]||(e[59]=r("div",{class:"block-header"},"评测文件",-1)),r("div",vl,[a(K,{layout:"horizontal","label-col":{span:3},"wrapper-col":{span:20}},{default:s(()=>[a(v,{label:"是否启用评测功能",required:""},{default:s(()=>[a(N,{value:c.value.openTestValidate,"onUpdate:value":e[13]||(e[13]=o=>c.value.openTestValidate=o),class:"custom-radio"},{default:s(()=>[a(_,{value:1},{default:s(()=>e[47]||(e[47]=[p("是")])),_:1,__:[47]}),a(_,{value:2},{default:s(()=>e[48]||(e[48]=[p("否")])),_:1,__:[48]})]),_:1},8,["value"])]),_:1}),c.value.openTestValidate===1?(m(),g(S,{key:0},[a(v,{label:"评测文件",required:""},{default:s(()=>[l.value.enableCodeRepository?(m(),g(S,{key:1},[r("div",cl,[a(F,{type:"primary",onClick:e[15]||(e[15]=o=>le.value=!0)},{default:s(()=>e[51]||(e[51]=[p("点击选择")])),_:1,__:[51]}),r("div",pl,[(m(!0),g(S,null,z(M.value,o=>(m(),J(At,{key:o.uid,closable:"",onClose:()=>{M.value=M.value.filter(V=>V.uid!==o.uid),c.value.testValidateFiles=M.value.map(V=>V.url).join(",")},style:{margin:"4px"}},{default:s(()=>[p(A(o.name),1)]),_:2},1032,["onClose"]))),128))])]),e[52]||(e[52]=r("div",{class:"upload-hint"}," 说明：从代码仓库中选择文件。（点击评测按钮时调用的文件，用于检验学员任务结果是否正确） ",-1))],64)):(m(),g(S,{key:0},[a(ye,{"file-list":M.value,"onUpdate:fileList":e[14]||(e[14]=o=>M.value=o),"custom-request":st,onChange:nt,"max-count":10},{default:s(()=>[a(F,{type:"primary"},{default:s(()=>e[49]||(e[49]=[p("点击上传")])),_:1,__:[49]})]),_:1},8,["file-list"]),e[50]||(e[50]=r("div",{class:"upload-hint"}," 说明：支持上传多个文件，每个文件大小不能超过500M。 ",-1))],64))]),_:1}),a(v,{label:"评测执行命令",required:""},{default:s(()=>[a(i,{value:c.value.testValidateSh,"onUpdate:value":e[16]||(e[16]=o=>c.value.testValidateSh=o),placeholder:"请输入评测执行命令，例如：python main.py"},null,8,["value"]),e[53]||(e[53]=r("div",{class:"upload-hint"}," （执行评测文件的命令，如：python main.py、node index.js、java Main 等） ",-1))]),_:1,__:[53]}),a(v,{label:"评测时长限制",required:""},{default:s(()=>[r("div",fl,[a(ge,{value:c.value.timeLimitM,"onUpdate:value":e[17]||(e[17]=o=>c.value.timeLimitM=o),min:1,placeholder:"请输入评测时长（分钟）",style:{width:"580px"}},null,8,["value"]),e[54]||(e[54]=r("span",null,"分钟",-1))])]),_:1}),a(v,{label:"系统评分规则"},{default:s(()=>[a(N,{value:c.value.scoreRule,"onUpdate:value":e[18]||(e[18]=o=>c.value.scoreRule=o),class:"custom-radio"},{default:s(()=>[a(_,{value:1},{default:s(()=>e[55]||(e[55]=[p(" 通过全部测试集（仅当所有测试集都正确时，获得项目学时） ")])),_:1,__:[55]}),a(_,{value:2},{default:s(()=>e[56]||(e[56]=[p(" 通过部分测试集（任意一个测试集正确时，获得项目学时） ")])),_:1,__:[56]})]),_:1},8,["value"])]),_:1}),a(v,{label:"评测设置",required:""},{default:s(()=>[a(N,{value:c.value.evaluationSetting,"onUpdate:value":e[19]||(e[19]=o=>c.value.evaluationSetting=o),class:"custom-radio"},{default:s(()=>[a(_,{value:1},{default:s(()=>e[57]||(e[57]=[p(" 通过所有代码块评测（对学员任务文件的所有非空代码块进行评测） ")])),_:1,__:[57]}),a(_,{value:2},{default:s(()=>e[58]||(e[58]=[p(" 通过指定代码块评测（对学员任务文件的指定非空代码块进行评测） ")])),_:1,__:[58]})]),_:1},8,["value"])]),_:1})],64)):x("",!0)]),_:1})])]),c.value.openTestValidate===1?(m(),g("div",ml,[r("div",gl,[e[61]||(e[61]=r("span",null,"测试集",-1)),r("div",yl,[a(F,{onClick:at},{default:s(()=>e[60]||(e[60]=[p("新增测试集")])),_:1,__:[60]})])]),r("div",_l,[(m(!0),g(S,null,z(c.value.testSets,(o,V)=>(m(),g("div",{key:o.id,class:"test-set-item"},[a(Pe,{checked:o.select===1,onChange:E=>ot(o,E.target.checked),class:"test-set-checkbox"},null,8,["checked","onChange"]),r("span",hl,"测试集"+A(V+1),1),a(i,{value:o.arg,"onUpdate:value":E=>o.arg=E,placeholder:"请输入输入内容",class:"test-set-input"},null,8,["value","onUpdate:value"]),a(i,{value:o.answer,"onUpdate:value":E=>o.answer=E,placeholder:"请输入期望输出",class:"test-set-input"},null,8,["value","onUpdate:value"]),a(k(Ia),{class:"delete-test-set-icon",onClick:E=>lt(o.id)},null,8,["onClick"])]))),128))])])):x("",!0),r("div",wl,[a(F,{type:"primary",onClick:Ne},{default:s(()=>[p(A(se.value?"更新":"保存"),1)]),_:1})])])]),_:1}),a(Ee,{key:"reference",tab:"参考答案"},{default:s(()=>[r("div",bl,[r("div",kl,[e[66]||(e[66]=r("div",{class:"block-header"},"参考答案",-1)),r("div",Cl,[a(K,{layout:"horizontal","label-col":{span:3},"wrapper-col":{span:20}},{default:s(()=>[a(v,{label:"是否显示参考答案模块",required:""},{default:s(()=>[a(N,{value:C.value.showAnswer,"onUpdate:value":e[20]||(e[20]=o=>C.value.showAnswer=o),class:"custom-radio"},{default:s(()=>[a(_,{value:1},{default:s(()=>e[62]||(e[62]=[p("是")])),_:1,__:[62]}),a(_,{value:2},{default:s(()=>e[63]||(e[63]=[p("否")])),_:1,__:[63]})]),_:1},8,["value"])]),_:1}),a(v,{label:"是否禁止复制参考答案",required:""},{default:s(()=>[a(N,{value:C.value.prohibitCopyAnswer,"onUpdate:value":e[21]||(e[21]=o=>C.value.prohibitCopyAnswer=o),class:"custom-radio"},{default:s(()=>[a(_,{value:1},{default:s(()=>e[64]||(e[64]=[p("是")])),_:1,__:[64]}),a(_,{value:2},{default:s(()=>e[65]||(e[65]=[p("否")])),_:1,__:[65]})]),_:1},8,["value"])]),_:1}),a(v,{label:"参考答案",required:""},{default:s(()=>[a(De,{modelValue:C.value.referenceAnswer,"onUpdate:modelValue":e[22]||(e[22]=o=>C.value.referenceAnswer=o)},null,8,["modelValue"])]),_:1})]),_:1})])]),r("div",Tl,[a(F,{type:"primary",onClick:je},{default:s(()=>[p(A(ne.value?"更新":"保存"),1)]),_:1})])])]),_:1})]),_:1},8,["activeKey"])])):x("",!0),h.value===3?(m(),g("div",Ul,[r("div",Sl,[e[69]||(e[69]=r("h3",{class:"section-main-title"},"实验环境",-1)),r("div",xl,[r("div",Rl,[r("div",Fl,[a(i,{value:re.value,"onUpdate:value":e[24]||(e[24]=o=>re.value=o),placeholder:"搜索需要的实验环境","allow-clear":""},{suffix:s(()=>e[67]||(e[67]=[r("span",{class:"search-icon"},"🔍",-1)])),_:1},8,["value"])]),r("div",Ml,[(m(!0),g(S,null,z(it.value,o=>(m(),g("div",{key:o.value,class:Ht(["environment-item",{active:T.value===o.value}]),onClick:V=>dt(o.value)},A(o.label),11,Ll))),128))])]),r("div",Al,[r("div",Vl," 实验环境: "+A(ut.value),1),a(K,{model:w.value,layout:"horizontal","label-col":{span:6},"wrapper-col":{span:16}},{default:s(()=>[a(v,{label:"附带环境"},{default:s(()=>[a(y,{value:w.value.secondType,"onUpdate:value":e[25]||(e[25]=o=>w.value.secondType=o),placeholder:"请选择附带环境",options:k(D).options.value,loading:k(D).loading.value},null,8,["value","options","loading"])]),_:1}),a(v,{label:"实验环境使用时长"},{default:s(()=>[r("div",ql,[a(ge,{value:w.value.timeLimitM,"onUpdate:value":e[26]||(e[26]=o=>w.value.timeLimitM=o),min:1,placeholder:"请输入实验环境使用时长",style:{flex:"1"}},null,8,["value"]),e[68]||(e[68]=r("span",null,"分",-1))])]),_:1})]),_:1},8,["model"])])])])])):x("",!0),r("div",Il,[a(F,{onClick:St},{default:s(()=>[p(A(h.value===0?"返回":"上一步"),1)]),_:1}),a(F,{type:"primary",loading:j.value,onClick:xt},{default:s(()=>[p(A(h.value===3?"完成":"下一步"),1)]),_:1},8,["loading"])])])]),_:1},8,["spinning"]),r("input",{ref_key:"fileUploadInput",ref:Fe,type:"file",style:{display:"none"},onChange:bt},null,544),a(ua,{open:H.value,"onUpdate:open":e[27]||(e[27]=o=>H.value=o),onConfirm:gt,onCancel:Le},null,8,["open"]),a(da,{open:te.value,"onUpdate:open":e[28]||(e[28]=o=>te.value=o),"parent-path":O.value,onConfirm:kt},null,8,["open","parent-path"]),a(va,{open:ae.value,"onUpdate:open":e[29]||(e[29]=o=>ae.value=o),"parent-path":B.value,onConfirm:Ct},null,8,["open","parent-path"]),a(ca,{open:le.value,"onUpdate:open":e[30]||(e[30]=o=>le.value=o),title:"选择评测文件","git-url":l.value.gitUrl,onConfirm:rt},null,8,["open","git-url"])])}}}),Gl=Nt(Nl,[["__scopeId","data-v-453fad86"]]);export{Gl as default};
