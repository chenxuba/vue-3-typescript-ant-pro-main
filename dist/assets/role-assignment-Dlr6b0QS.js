import{n as x,_ as J}from"./index-C3OFe7rM.js";import{g as W}from"./role-COQhuVNd.js";import{z as X,I as Y,S as Z,H as ee,K as ae,a6 as le,ab as te,an as oe,ak as se,a1 as ne,M as B,ad as c,aj as re}from"./antd-C8FlOT2N.js";import{d as ue,r as L,f as i,o as ie,_ as h,a1 as _,$ as r,k as a,a7 as o,G as v,a9 as z,u as T,a6 as D,ac as de,F as ce,ag as me,l as pe}from"./vue-PnzzEkKE.js";async function ge(m){return x("/role-assignment/list",m)}async function _e(m){return x("/role-assignment/create",m)}async function ve(m){return x("/role-assignment/batch-delete",{ids:m})}const fe={class:"role-assignment"},ye={class:"content-wrapper"},be={class:"main-panel"},Ne={class:"query-form"},we={class:"table-header"},Ce={class:"table-info"},ke={class:"info-value"},he={class:"table-actions"},ze={class:"table-container"},xe={key:0,class:"user-link"},Ie=ue({name:"RoleAssignment",__name:"role-assignment",setup(m){const n=L({userName:"",roleName:"",pageNum:1,pageSize:10}),N=i(!1),I=i([]),w=i(0),u=i([]),f=i([]),O=[{title:"用户编号",dataIndex:"userCode",key:"userCode"},{title:"用户姓名",dataIndex:"userName",key:"userName"},{title:"单位",dataIndex:"organization",key:"organization",ellipsis:!0},{title:"授予角色",dataIndex:"roles",key:"roles"}],y=i(!1),C=i(!1),S=i([]),l=L({userCode:"",userName:"",organization:"",roleIds:[]}),p=async()=>{N.value=!0;try{const s=await ge(n);s.data&&(I.value=s.data.list,w.value=s.data.total)}catch{c.error("获取角色分配列表失败")}finally{N.value=!1}},V=async()=>{try{const s=await W({pageNum:1,pageSize:1e3});s.data&&(S.value=s.data.list)}catch(s){console.error("获取角色列表失败:",s)}},k=()=>{n.pageNum=1,u.value=[],f.value=[],p()},E=()=>{n.userName="",n.roleName="",n.pageNum=1,n.pageSize=10,u.value=[],f.value=[],p()},F=(s,e)=>{u.value=s,f.value=e},P=()=>{l.userCode="",l.userName="",l.organization="",l.roleIds=[],y.value=!0},K=async()=>{if(!l.userCode||!l.userName||!l.organization||l.roleIds.length===0){c.error("请填写所有必填项");return}C.value=!0;try{await _e({userCode:l.userCode,userName:l.userName,organization:l.organization,roleIds:l.roleIds}),c.success("创建成功"),y.value=!1,p()}catch{c.error("创建失败")}finally{C.value=!1}},M=()=>{if(u.value.length===0){c.warning("请选择要删除的角色分配");return}B.confirm({title:"确认批量删除",icon:pe(re),content:`确定要删除选中的 ${u.value.length} 条角色分配记录吗？`,okText:"确定",cancelText:"取消",onOk:async()=>{try{await ve(u.value),c.success("批量删除成功"),u.value=[],f.value=[],p()}catch{c.error("批量删除失败")}}})},$=s=>{n.pageNum=s.current,n.pageSize=s.pageSize,p()};return ie(()=>{p(),V()}),(s,e)=>{const g=Y,d=X,b=ee,A=Z,R=ae,Q=oe,j=se,G=ne,H=B;return _(),h("div",fe,[r("div",ye,[r("div",be,[e[14]||(e[14]=r("div",{class:"query-header"},[r("h3",null,"筛选查询")],-1)),r("div",Ne,[a(R,{layout:"inline"},{default:o(()=>[a(d,{label:"用户姓名"},{default:o(()=>[a(g,{value:n.userName,"onUpdate:value":e[0]||(e[0]=t=>n.userName=t),placeholder:"请输入","allow-clear":"",style:{width:"200px"},onPressEnter:k},null,8,["value"])]),_:1}),a(d,{label:"角色名称"},{default:o(()=>[a(g,{value:n.roleName,"onUpdate:value":e[1]||(e[1]=t=>n.roleName=t),placeholder:"请输入","allow-clear":"",style:{width:"200px"},onPressEnter:k},null,8,["value"])]),_:1}),a(d,null,{default:o(()=>[a(A,null,{default:o(()=>[a(b,{type:"primary",onClick:k},{default:o(()=>e[7]||(e[7]=[v(" 查询 ")])),_:1,__:[7]}),a(b,{onClick:E},{default:o(()=>e[8]||(e[8]=[v(" 重置 ")])),_:1,__:[8]})]),_:1})]),_:1})]),_:1})]),r("div",we,[r("div",Ce,[e[9]||(e[9]=r("span",{class:"info-label"},"数据列表",-1)),e[10]||(e[10]=r("span",{class:"info-divider"},"数据共",-1)),r("span",ke,z(w.value),1),e[11]||(e[11]=r("span",{class:"info-unit"},"条",-1))]),r("div",he,[a(b,{type:"primary",onClick:P},{icon:o(()=>[a(T(le))]),default:o(()=>[e[12]||(e[12]=v(" 新增分配 "))]),_:1,__:[12]}),a(b,{danger:"",disabled:u.value.length===0,onClick:M},{icon:o(()=>[a(T(te))]),default:o(()=>[e[13]||(e[13]=v(" 批量删除 "))]),_:1,__:[13]},8,["disabled"])])]),r("div",ze,[a(j,{columns:O,"data-source":I.value,loading:N.value,pagination:{current:n.pageNum,pageSize:n.pageSize,total:w.value,showSizeChanger:!0,showQuickJumper:!0,showTotal:t=>`共 ${t} 条`},"row-selection":{selectedRowKeys:u.value,onChange:F},scroll:{x:1e3},"row-key":"id",onChange:$},{bodyCell:o(({column:t,record:q})=>[t.key==="userName"?(_(),h("a",xe,z(q.userName),1)):t.key==="roles"?(_(),D(A,{key:1,wrap:""},{default:o(()=>[(_(!0),h(ce,null,me(q.roles,U=>(_(),D(Q,{key:U,color:"blue"},{default:o(()=>[v(z(U),1)]),_:2},1024))),128))]),_:2},1024)):de("",!0)]),_:1},8,["data-source","loading","pagination","row-selection"])])])]),a(H,{open:y.value,"onUpdate:open":e[6]||(e[6]=t=>y.value=t),title:"新增角色分配",width:600,"confirm-loading":C.value,onOk:K},{default:o(()=>[a(R,{model:l,"label-col":{span:6},"wrapper-col":{span:16},style:{"margin-top":"24px"}},{default:o(()=>[a(d,{label:"用户编号",name:"userCode",rules:[{required:!0,message:"请输入用户编号",trigger:"blur"}]},{default:o(()=>[a(g,{value:l.userCode,"onUpdate:value":e[2]||(e[2]=t=>l.userCode=t),placeholder:"请输入用户编号","allow-clear":""},null,8,["value"])]),_:1}),a(d,{label:"用户姓名",name:"userName",rules:[{required:!0,message:"请输入用户姓名",trigger:"blur"}]},{default:o(()=>[a(g,{value:l.userName,"onUpdate:value":e[3]||(e[3]=t=>l.userName=t),placeholder:"请输入用户姓名","allow-clear":""},null,8,["value"])]),_:1}),a(d,{label:"单位",name:"organization",rules:[{required:!0,message:"请输入单位",trigger:"blur"}]},{default:o(()=>[a(g,{value:l.organization,"onUpdate:value":e[4]||(e[4]=t=>l.organization=t),placeholder:"请输入单位","allow-clear":""},null,8,["value"])]),_:1}),a(d,{label:"授予角色",name:"roleIds",rules:[{required:!0,message:"请选择角色",trigger:"change"}]},{default:o(()=>[a(G,{value:l.roleIds,"onUpdate:value":e[5]||(e[5]=t=>l.roleIds=t),mode:"multiple",placeholder:"请选择角色","allow-clear":"",options:S.value.map(t=>({label:t.roleName,value:t.id}))},null,8,["value","options"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","confirm-loading"])])}}}),Ue=J(Ie,[["__scopeId","data-v-08bb4b48"]]);export{Ue as default};
