const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./antd-BsIzK5uT.js","./vue-C8C4cLDH.js"])))=>i.map(i=>d[i]);
import{k as wl,_ as Ul}from"./index-DLVpMS9m.js";import{d as Il,a9 as ql,am as xl,f as _,c as Rl,w as Pl,o as Fl,_ as g,a1 as v,$ as i,k as l,a7 as a,ad as T,G as c,F,a6 as R,u as n,H as me,aa as P,ah as H,ac as O,B as ot,af as Sl,y as Pe}from"./vue-C8C4cLDH.js";import{R as Fe,u as nt,g as it,a as Ll,d as Nl,s as Ml,c as El}from"./RichTextEditor-Cbgd4Efe.js";import{e as jl,a as $l,u as Vl,f as Al}from"./index-DSGWGCOl.js";import{H as N,j as Bl,t as Dl,x as Se,c as Hl,a as Ol,m as Kl,u as Ql,F as zl,b as Gl,R as Jl,N as Wl,d as Yl}from"./useFileTree-D7h08RYb.js";import{u as Zl,Q as Xl}from"./useTaskLevel-D4sYUAMJ.js";import{ad as f,Z as ea,Y as ta,K as la,B as aa,I as sa,$ as oa,a0 as na,a1 as ia,a2 as ra,a3 as ua,a4 as da,H as pa,J as ca,a5 as va,D as fa,a6 as rt,f as ma,e as ga,ab as ge,T as ya,t as _a,a7 as ka,a8 as ha,a9 as Ta,aa as ut,ac as ba,v as Ca,af as wa}from"./antd-BsIzK5uT.js";const Ua={class:"edit-full-stack-page"},Ia={class:"page-content"},qa={class:"steps-container"},xa={key:0},Ra={class:"form-section"},Pa={class:"flex items-top gap-16px"},Fa={class:"flex flex-col gap-12px"},Sa={key:0,class:"image-preview"},La=["src"],Na={class:"flex items-top gap-16px"},Ma={class:"flex flex-col gap-12px"},Ea={key:0,class:"image-preview"},ja=["src"],$a={class:"form-section"},Va={key:1},Aa={class:"form-section repository-section"},Ba={class:"repository-top-bar flex items-center gap-16px justify-between"},Da={class:"repository-url-group"},Ha={class:"repository-main-area"},Oa={class:"repository-left"},Ka={class:"repository-switch-box flex items-center justify-between"},Qa={class:"flex items-center gap-12px"},za={key:1,class:"repository-tips"},Ga={class:"repository-right"},Ja={key:1,class:"empty-area"},Wa={key:2},Ya={class:"task-level-section"},Za={class:"task-level-header"},Xa={class:"header-buttons"},es={class:"task-level-main"},ts={class:"task-level-list"},ls={class:"list-title"},as={class:"list-items"},ss=["onClick"],os={class:"item-name"},ns={class:"task-level-detail"},is={key:0,class:"detail-content"},rs={key:0,class:"questions-content"},us={key:1,class:"questions-list"},ds=["onDragstart","onDrop"],ps={class:"question-header"},cs={class:"question-number-with-drag"},vs={class:"question-number"},fs={class:"action-icons"},ms={class:"question-title"},gs={key:0,class:"flex"},ys=["innerHTML"],_s={key:1,style:{color:"#bfbfbf"}},ks={class:"question-options"},hs={class:"option-label"},Ts={class:"option-content"},bs={key:0,class:"correct-tag"},Cs={class:"question-explanation"},ws={class:"explanation-content"},Us={key:0},Is={key:1,style:{color:"#bfbfbf"}},qs={class:"evaluation-content"},xs={class:"evaluation-section"},Rs={class:"evaluation-section"},Ps={class:"evaluation-section"},Fs={class:"case-type-row"},Ss={key:0,class:"test-case-buttons"},Ls={key:0,class:"test-cases-list"},Ns={class:"test-case-label"},Ms={key:0,class:"form-footer-buttons"},Es={key:1,class:"empty-detail"},js={key:3,class:"step-content"},$s={class:"content-card"},Vs={class:"environment-header"},As={class:"environment-actions"},Bs={class:"tab-label"},Ds=["onDblclick"],Hs={class:"experiment-image-info"},Os={class:"experiment-interfaces"},Ks={key:0,style:{color:"#999"}},Qs={key:1,style:{color:"#999"}},zs={class:"page-footer"},ye="http://101.200.13.193",Gs=Il({name:"EditFullStack",__name:"edit-full-stack",setup(Js){N.registerLanguage("javascript",Bl),N.registerLanguage("typescript",Dl),N.registerLanguage("xml",Se),N.registerLanguage("html",Se),N.registerLanguage("vue",Se),N.registerLanguage("css",Hl),N.registerLanguage("json",Ol),N.registerLanguage("markdown",Kl);const K=ql(),dt=xl(),S=_(null),U=_(0),A=_(!1),ee=_(),Le=_(),te=_(),r=_({name:"",tag:"",fieldType:void 0,difficulty:1,classHour:"",topCover:"",cover:"",description:"",showTaskRequire:!1,authType:1,enableCodeRepository:!1,repositoryType:"代码仓库",gitUrl:"",environment:void 0}),le=_(""),ae=_(""),se=_(!1),oe=_(!1),B=_(void 0),I=_([]),M=_("1"),Q=_(""),pt={dockerImage:[{required:!0,message:"请选择实验镜像",trigger:"change"}],viewTypes:[{required:!0,type:"array",min:1,message:"请至少选择一个实验界面",trigger:"change"}],secondType:[{required:!0,message:"请选择附带环境",trigger:"change"}],taskId:[{required:!0,message:"请选择任务关卡",trigger:"change"}],codeType:[{required:!0,message:"请选择编程语言",trigger:"change"}],shellBegin:[{required:!0,message:"请输入开启时触发命令",trigger:"blur"}],containerPort:[{required:!0,message:"请输入容器端口",trigger:"blur"}]},Ne=Rl(()=>{var e;const t=I.value.find(u=>u.id===M.value);return(t==null?void 0:t.config)||((e=I.value[0])==null?void 0:e.config)}),Me={name:[{required:!0,message:"请输入名称",trigger:"blur"}],tag:[{required:!0,message:"请输入技能标签",trigger:"blur"}],fieldType:[{required:!0,message:"请选择领域类别",trigger:"change"}],difficulty:[{required:!0,message:"请选择难度",trigger:"change"}],topCover:[{required:!0,message:"请上传顶部背景图",trigger:"change"}],cover:[{required:!0,message:"请上传封面图",trigger:"change"}],authType:[{required:!0,message:"请选择培训公开范围",trigger:"change"}]},ct=[{label:"人工智能",value:1},{label:"大数据",value:2},{label:"云计算",value:3},{label:"Web开发",value:4}],vt=[{label:"切换仓库",value:"切换仓库"},{label:"代码仓库",value:"代码仓库"},{label:"私密代码仓库",value:"私密代码仓库"}],D=_(!1),_e=_(new Set),{fileTreeData:ne,expandedKeys:ke,selectedFile:ft,highlightedCode:mt,dynamicFileContents:gt,handleSelectFile:yt,getNodePath:Ee,addFileToTree:je,addFolderToTree:_t,handleRenameNode:kt,handleCopyPath:ht,loadRemoteFileTree:Tt,loadChildrenData:bt,getNodePathFromMap:he}=Ql(),{taskLevels:L,selectedTaskLevelId:$e,currentTab:ie,taskLevelFormRef:Te,evaluationFormRef:Ct,taskLevelFormData:k,evaluationFormData:w,learningResourceFileList:be,taskLevelFormRules:wt,evaluationFormRules:Ut,isKernelTask:It,isChoiceTask:Ce,isProgrammingTask:Ve,addTaskLevel:we,deleteTaskLevel:qt,selectTaskLevel:Ae,saveTaskLevel:xt,resetTaskLevel:Rt,handleLearningResourceCustomRequest:Ue,handleLearningResourceUpload:Pt,handleUserFilesUpload:Ft,handleTestValidateFilesUpload:St,userFileList:Ie,testValidateFileList:qe,addTestCase:Lt,removeTestCase:Nt,clearAllTestCases:Mt,downloadTemplate:Et,batchUploadTestCases:jt,getCurrentQuestions:re,addQuestion:$t,deleteQuestion:Vt,updateQuestion:At,updateQuestionsOrder:Bt,loadQuestions:Be,saveQuestionsOrder:Dt}=Zl(S),z=_(!1),ue=_(!1),de=_(!1),pe=_(!1),G=_(null),J=_("/"),W=_("/"),De=_(null),ce=_("/"),Ht=()=>({1:"Python3.6",2:"Python3.13",3:"Python3.12/VNC"})[B.value||1]||"Python3.6",He=()=>{I.value.length===0&&(I.value=[{id:"1",name:"实验环境1",isEditing:!1,isSaved:!1,config:{dockerImage:B.value||1,viewTypes:[],secondType:void 0,taskId:void 0,codeType:void 0,shellBegin:void 0,containerPort:void 0,containerPath:void 0}}])},Ot=async()=>{if(S.value)try{const t=await Al({projectId:S.value});let e=[];Array.isArray(t)?e=t:t&&typeof t=="object"&&(e=t.list||t.data||t.tasks||[]),e&&e.length>0&&(L.value=e.map(o=>{let d="programming";o.type===4?d="kernel":o.type===2?d="choice":o.type===1&&(d="programming");const p=o.source?o.source.split(",").map((y,q)=>({uid:`${q}`,name:y.split("/").pop()||`文件${q+1}`,status:"done",url:y,response:y})):[];let h=[];if(o.testContent)try{h=JSON.parse(o.testContent)}catch(y){console.error("解析测试集内容失败:",y)}return{id:String(o.taskId),name:o.name,type:d,source:o.source,require:o.require,referenceAnswer:o.referenceAnswer,difficulty:o.difficulty,tag:o.tag,classHour:o.classHour,jumpUrl:o.jumpUrl,taskId:o.taskId,formData:{name:o.name,source:p,require:o.require,referenceAnswer:o.referenceAnswer,difficulty:o.difficulty,tag:o.tag,classHour:o.classHour,jumpUrl:o.jumpUrl,taskId:o.taskId},evaluationSettings:o.type===1?{timeLimitM:o.timeLimitM,userFiles:o.userFiles?o.userFiles.split(",").map((y,q)=>({uid:`${q}`,name:y.split("/").pop()||`文件${q+1}`,status:"done",url:y,response:y})):[],testValidateFiles:o.testValidateFiles?o.testValidateFiles.split(",").map((y,q)=>({uid:`${q}`,name:y.split("/").pop()||`文件${q+1}`,status:"done",url:y,response:y})):[],testValidateSh:o.testValidateSh,passType:o.passType||1,passTypeRule:o.passTypeRule||"",blankCode:o.blankCode||1,scoreRule:o.scoreRule||1,testValidateType:o.testValidateType||1,testContent:h}:void 0,questions:o.questions||[]}}),L.value.length>0&&Ae(L.value[0].id));let u=[];e&&e.length>0&&e.forEach((o,d)=>{if(o.envIsDel===0||o.envIsDel===void 0||o.envIsDel===null){const p={id:o.id||o.taskId,title:o.title||o.name||`实验环境${d+1}`,dockerImage:o.dockerImage,viewTypes:o.viewTypes,secondType:o.secondType,taskId:o.taskId,codeType:o.codeType,shellBegin:o.shellBegin,containerPort:o.containerPort,containerPath:o.containerPath,envIsDel:o.envIsDel};u.push(p)}}),u.length>0?(I.value=u.map((o,d)=>{let p=[];return o.viewTypes&&(typeof o.viewTypes=="string"?p=o.viewTypes.split(",").map(h=>Number(h.trim())).filter(h=>!isNaN(h)):Array.isArray(o.viewTypes)&&(p=o.viewTypes.map(h=>Number(h)))),{id:String(o.id||Date.now()+d),name:o.title||o.name||`实验环境${d+1}`,isEditing:!1,isSaved:!0,config:{dockerImage:Number(o.dockerImage)||B.value||1,viewTypes:p,secondType:o.secondType?o.secondType:void 0,taskId:o.taskId?String(o.taskId):void 0,codeType:o.codeType?String(o.codeType):void 0,shellBegin:o.shellBegin?String(o.shellBegin):void 0,containerPort:o.containerPort?String(o.containerPort):void 0,containerPath:o.containerPath?String(o.containerPath):void 0}}}),I.value.length>0&&(M.value=I.value[0].id)):He()}catch(t){f.warning(t.message||"获取任务关卡列表失败"),He()}},Kt=async()=>{if(!S.value){f.error("缺少项目ID"),K.back();return}try{A.value=!0;const t=await jl({id:S.value});r.value={name:t.name||"",tag:t.tag||"",fieldType:t.fieldType,difficulty:t.difficulty||1,classHour:t.classHour||"",topCover:t.topCover||"",cover:t.cover||"",description:t.description||"",showTaskRequire:t.showTaskRequire===1,authType:t.authType||1,enableCodeRepository:t.gitUrl?!0:t.enableCodeRepository||!1,repositoryType:t.repositoryType||"代码仓库",gitUrl:t.gitUrl||"",environment:t.environment},t.topCover&&(le.value=ye+t.topCover),t.cover&&(ae.value=ye+t.cover),B.value=t.environment||1,t.gitUrl&&(D.value=!0),await Ot()}catch(t){console.error("获取项目详情失败：",t),f.error(t.message||"获取项目详情失败"),K.back()}finally{A.value=!1}},Qt=async t=>{var o;if(!(t.size/1024/1024<12))return f.error("图片大小不能超过 12MB!"),!1;if(!(t.type==="image/jpeg"||t.type==="image/png"))return f.error("只能上传 JPG/PNG 格式的图片!"),!1;try{se.value=!0;const d=await nt(t);le.value=ye+d,r.value.topCover=d,(o=ee.value)==null||o.validateFields(["topCover"]),f.success("顶部背景图上传成功")}catch{f.error("顶部背景图上传失败")}finally{se.value=!1}return!1},zt=async t=>{var o;if(!(t.size/1024/1024<12))return f.error("图片大小不能超过 12MB!"),!1;if(!(t.type==="image/jpeg"||t.type==="image/png"))return f.error("只能上传 JPG/PNG 格式的图片!"),!1;try{oe.value=!0;const d=await nt(t);ae.value=ye+d,r.value.cover=d,(o=ee.value)==null||o.validateFields(["cover"]),f.success("封面图上传成功")}catch{f.error("封面图上传失败")}finally{oe.value=!1}return!1},Gt=t=>{(typeof t=="boolean"?t:!!t)?z.value=!0:r.value.enableCodeRepository=!1},ve=async()=>{try{const t=f.loading("正在查询仓库文件...",0),e=await it(r.value.gitUrl,"");Tt(e),_e.value.clear(),t(),f.success("仓库文件查询成功"),console.log("查询仓库地址：",r.value.gitUrl),console.log("获取到的文件列表：",e)}catch(t){f.error(t.message||"仓库文件查询失败"),console.error("仓库文件查询失败：",t)}},Jt=async()=>{if(!r.value.gitUrl||!r.value.gitUrl.trim()){f.error("请先配置仓库地址"),Oe();return}r.value.enableCodeRepository=!0,z.value=!1,D.value=!0,await ve()},Oe=()=>{r.value.enableCodeRepository=!1,z.value=!1};Pl(()=>r.value.repositoryType,t=>{t==="切换仓库"&&r.value.enableCodeRepository&&(D.value=!1,f.info("已解锁仓库地址，请重新输入"),Pe(()=>{r.value.repositoryType="代码仓库"}))});const Wt=()=>{var t;r.value.enableCodeRepository&&!D.value&&((t=r.value.gitUrl)!=null&&t.trim())&&(D.value=!0,ve())},Yt=async(t,e)=>{const{expanded:u,node:o}=e;if(u&&!o.isLeaf){const d=String(o.key);if(_e.value.has(d)){console.log("文件夹已加载，跳过：",d);return}try{const p=he(d);console.log("加载文件夹：",p,"节点key:",d);const h=f.loading(`正在加载 ${o.title}...`,0),y=await it(r.value.gitUrl,p);bt(d,y),_e.value.add(d),h(),console.log("文件夹加载成功：",p,y)}catch(p){f.error(p.message||"加载文件夹失败"),console.error("加载文件夹失败：",p)}}},Zt=t=>{switch(String(t.key)){case"newFile":Qe();break;case"newFolder":ze();break;case"upload":Ke("/");break}},Xt=(t,e)=>{const u=String(t.key),o=he(e.key)||Ee(e.key);switch(u){case"newFile":Qe(o);break;case"newFolder":ze(o);break;case"upload":Ke(o);break;case"rename":kt(e);break;case"copyPath":ht(e);break;case"delete":sl(e);break}},Ke=t=>{var e;ce.value=t,(e=De.value)==null||e.click()},el=async t=>{var o;const e=t.target,u=(o=e.files)==null?void 0:o[0];if(u)try{let d=ce.value==="/"?"":ce.value.replace(/^\//,"");const p=f.loading(`正在上传 ${u.name}...`,0);await Ll(u,r.value.gitUrl,d);const h=new FileReader;h.onload=y=>{var b;const q=(b=y.target)==null?void 0:b.result;je(u.name,q,ce.value)},h.readAsText(u),p(),f.success(`文件 ${u.name} 上传成功`),console.log("文件上传成功：",{fileName:u.name,path:d})}catch(d){f.error(d.message||"文件上传失败"),console.error("文件上传失败：",d)}finally{e&&(e.value="")}},Qe=(t="/")=>{ue.value=!0,J.value=t},tl=async t=>{try{let e=J.value==="/"?"":J.value.replace(/^\//,"");const u=f.loading("正在保存文件...",0);await Ml({fileContent:t.fileContent,fileName:t.fileName,gitUrl:r.value.gitUrl,path:e,commit:t.commitMessage}),je(t.fileName,t.fileContent,J.value),u(),f.success("文件创建成功"),ue.value=!1,console.log("文件保存成功：",{fileName:t.fileName,path:e})}catch(e){f.error(e.message||"文件创建失败"),console.error("文件创建失败：",e)}},ze=(t="/")=>{de.value=!0,W.value=t},ll=async t=>{try{let e=W.value==="/"?t.folderName:`${W.value.replace(/^\//,"")}/${t.folderName}`;const u=f.loading("正在创建文件夹...",0);await El({commit:t.commitMessage,gitUrl:r.value.gitUrl,path:e}),_t(t.folderName,W.value),u(),f.success("文件夹创建成功"),de.value=!1,console.log("文件夹创建成功：",{folderName:t.folderName,path:e})}catch(e){f.error(e.message||"文件夹创建失败"),console.error("文件夹创建失败：",e)}},al=t=>{const e=u=>{const o=u.findIndex(d=>d.key===t);if(o!==-1)return u.splice(o,1),!0;for(const d of u)if(d.children&&e(d.children))return!0;return!1};e(ne.value)},sl=async t=>{const e=t.children!==void 0||t.isLeaf===!1,u=t.title,d=(he(t.key)||Ee(t.key)).split("/");d.pop();const p=d.join("/")||"",{Modal:h}=await wl(async()=>{const{Modal:y}=await import("./antd-BsIzK5uT.js").then(q=>q.au);return{Modal:y}},__vite__mapDeps([0,1]),import.meta.url);h.confirm({title:"确认删除",content:`确定要删除${e?"文件夹":"文件"} "${u}" 吗？${e?"文件夹下的所有内容也会被删除。":""}`,okText:"确定",cancelText:"取消",okType:"danger",onOk:async()=>{let y=null;try{y=f.loading("正在删除...",0),await Nl({fileName:u,gitUrl:r.value.gitUrl,path:p}),al(t.key),y(),f.success("删除成功"),console.log("删除成功：",{fileName:u,path:p})}catch(q){y&&y(),f.error(q.message||"删除失败"),console.error("删除失败：",q)}}})},Y=()=>{Pe(()=>{window.scrollTo({top:0,behavior:"smooth"}),document.documentElement.scrollTop=0,document.body.scrollTop=0;const t=document.querySelector(".page-content");t&&(t.scrollTop=0);const e=document.querySelector(".ant-layout-content");e&&(e.scrollTop=0),document.querySelectorAll("*").forEach(o=>{o.scrollTop>0&&(o.scrollTop=0)})})},ol=async()=>{U.value>0?(U.value--,Y(),U.value===1&&r.value.gitUrl&&r.value.enableCodeRepository&&ne.value.length===0&&await ve()):K.back()},nl=async()=>{var t,e;if(U.value===0)try{await Promise.all([(t=ee.value)==null?void 0:t.validate(),(e=Le.value)==null?void 0:e.validate()]),U.value=1,Y(),r.value.gitUrl&&r.value.enableCodeRepository&&ne.value.length===0&&await ve()}catch{f.error("请完善必填信息"),Y()}else if(U.value===1){if(r.value.enableCodeRepository&&(!r.value.gitUrl||r.value.gitUrl.trim()==="")){f.error("请输入仓库地址");return}await Ge(!1),U.value=2,Y()}else if(U.value===2){if(L.value.length===0){f.error("请至少添加一个任务关卡");return}if(L.value.some(o=>!o.taskId)){f.error("请先保存所有任务关卡后再进行下一步");return}U.value=3,Y()}else if(U.value===3){if(I.value.filter(o=>!o.isSaved).length>0){f.error("请先保存所有实验环境配置");return}await Ge(!0)}},Ge=async(t=!1)=>{try{A.value=!0;const e={id:S.value,projectType:1,environment:B.value,name:r.value.name,tag:r.value.tag,fieldType:r.value.fieldType,difficulty:r.value.difficulty,classHour:r.value.classHour,topCover:r.value.topCover,cover:r.value.cover,description:r.value.description,showTaskRequire:r.value.showTaskRequire?1:2,authType:r.value.authType,enableCodeRepository:r.value.enableCodeRepository};r.value.enableCodeRepository&&(e.repositoryType=r.value.repositoryType,e.gitUrl=r.value.gitUrl),await $l(e),t?(f.success("项目更新成功！"),setTimeout(()=>{K.push("/dashboard/analysis")},500)):f.success("保存成功！")}catch(e){throw console.error("更新失败：",e),f.error(e.message||"项目更新失败，请稍后重试"),e}finally{A.value=!1}},xe=async(t,e=0)=>{var u,o;try{if(e!==1){const p=["dockerImage","viewTypes","secondType","taskId"],h=[];t.config.viewTypes.includes(1)?p.push("codeType"):h.push("codeType"),t.config.viewTypes.includes(2)?p.push("shellBegin"):h.push("shellBegin"),t.config.viewTypes.includes(3)?p.push("containerPort"):h.push("containerPort"),h.length>0&&((u=te.value)==null||u.clearValidate(h)),await((o=te.value)==null?void 0:o.validate(p))}if(!S.value){f.error("项目ID不存在，无法保存");return}const d={title:t.name,dockerImage:t.config.dockerImage,viewTypes:t.config.viewTypes.join(","),secondType:t.config.secondType,taskId:t.config.taskId?Number(t.config.taskId):void 0,codeType:t.config.codeType,shellBegin:t.config.shellBegin,containerPort:t.config.containerPort,containerPath:t.config.containerPath,projectId:S.value,envisDel:e};await Vl(d),e!==1?(t.isSaved=!0,f.success("实验环境保存成功！")):f.success("删除成功！")}catch(d){console.error("保存失败：",d),f.error(e===1?"删除失败":"请完善必填信息")}},Re=t=>{const e=Ne.value;if(!e)return;const u=e.viewTypes.indexOf(t);u>-1?(e.viewTypes.splice(u,1),t===1?e.codeType=void 0:t===2?e.shellBegin=void 0:t===3&&(e.containerPort=void 0,e.containerPath=void 0)):e.viewTypes.push(t),Pe(()=>{var o;(o=te.value)==null||o.clearValidate(["viewTypes"])})},Je=(t,e)=>{if(!e)return!1;const u=typeof e=="string"?Number(e):e;return I.value.some(o=>{if(!o.config.taskId)return!1;const d=typeof o.config.taskId=="string"?Number(o.config.taskId):o.config.taskId;return o.id!==t&&d===u})},il=()=>{const t=String(Date.now()),e={id:t,name:`实验环境${I.value.length+1}`,isEditing:!1,isSaved:!1,config:{dockerImage:B.value||1,viewTypes:[],secondType:void 0,taskId:void 0,codeType:void 0,shellBegin:void 0,containerPort:void 0,containerPath:void 0}};I.value.push(e),M.value=t,f.success("添加实验环境成功")},rl=async t=>{if(I.value.length===1){f.warning("至少保留一个实验环境");return}const e=I.value.findIndex(u=>u.id===t);if(e>-1){const u=I.value[e];u.isSaved&&await xe(u,1),I.value.splice(e,1),M.value===t&&(M.value=I.value[0].id),u.isSaved||f.success("删除实验环境成功")}},We=t=>{t.isEditing=!0,Q.value=t.name},Ye=t=>{Q.value.trim()?(t.name=Q.value.trim(),t.isEditing=!1,t.isSaved&&(f.success("重命名成功"),xe(t))):f.warning("名称不能为空")},ul=t=>{var u;t.replace(/<[^>]*>/g,"").trim()&&((u=Te.value)==null||u.clearValidate(["require"]))},dl=t=>{var u;t.replace(/<[^>]*>/g,"").trim()&&((u=Te.value)==null||u.clearValidate(["referenceAnswer"]))},pl=()=>{G.value=null,pe.value=!0},cl=t=>{G.value=t,pe.value=!0},vl=async t=>{G.value?At(t):$t(t),G.value=null,k.value.taskId&&await Be(k.value.taskId)},fl=t=>{try{return JSON.parse(t.selects||"[]").map(u=>{const o=Object.keys(u)[0];return{label:o,content:u[o]}})}catch{return[]}},Ze=(t,e)=>t.answer.includes(e),E=_(null),ml=t=>{E.value=t},gl=t=>{t.preventDefault()},yl=async(t,e)=>{if(t.preventDefault(),E.value!==null&&E.value!==e){const u=[...re.value],[o]=u.splice(E.value,1);u.splice(e,0,o),u.forEach((d,p)=>{d.weight=p+1}),Bt(u);try{await Dt(u),f.success("题目顺序已更新")}catch(d){f.error(d.message||"保存题目排序失败，请重试")}}E.value=null},_l=()=>{E.value=null},kl=async t=>{const e=String(t);if(Ce.value&&e==="questions"){if(!k.value.taskId){f.warning("请先保存创建任务后再添加题目");return}k.value.taskId&&await Be(k.value.taskId)}if(Ve.value&&e==="evaluation"&&!k.value.taskId){f.warning("请先保存创建任务后再配置评测设置");return}ie.value=e},hl=(t,e)=>{t.select=e?1:2};return Fl(()=>{const t=dt.query.id;t?(S.value=Number(t),Kt()):(f.error("缺少项目ID"),K.back())}),(t,e)=>{const u=ta,o=ea,d=sa,p=aa,h=na,y=ia,q=oa,b=ua,j=ra,C=pa,Z=da,Xe=ca,$=la,Tl=va,X=ga,et=ma,tt=fa,lt=ka,fe=_a,at=ha,st=ya,V=ba,bl=wa;return v(),g("div",Ua,[e[108]||(e[108]=i("div",{class:"page-header"},[i("h2",null,"编辑全栈环境实训项目")],-1)),l(bl,{spinning:A.value},{default:a(()=>[i("div",Ia,[i("div",qa,[l(o,{current:U.value,class:"custom-steps"},{default:a(()=>[l(u,{title:"基本信息"}),l(u,{title:"代码仓库"}),l(u,{title:"任务关卡"}),l(u,{title:"实验环境"})]),_:1},8,["current"])]),U.value===0?(v(),g("div",xa,[e[51]||(e[51]=i("div",{class:"section-title"},[i("h3",null,"基本信息")],-1)),i("div",Ra,[l($,{ref_key:"formRef",ref:ee,model:r.value,rules:Me,layout:"horizontal","label-col":{span:2},"wrapper-col":{span:18}},{default:a(()=>[l(p,{label:"名称",name:"name",required:""},{default:a(()=>[l(d,{value:r.value.name,"onUpdate:value":e[0]||(e[0]=s=>r.value.name=s),placeholder:"请输入名称"},null,8,["value"])]),_:1}),l(q,null,{default:a(()=>[l(h,{span:12},{default:a(()=>[l(p,{label:"技能标签",name:"tag",required:"","label-col":{span:4},"wrapper-col":{span:20}},{default:a(()=>[l(d,{value:r.value.tag,"onUpdate:value":e[1]||(e[1]=s=>r.value.tag=s),placeholder:"请输入技能标签"},null,8,["value"])]),_:1})]),_:1}),l(h,{span:12},{default:a(()=>[l(p,{label:"领域类别",name:"fieldType",required:"","label-col":{span:4},"wrapper-col":{span:12}},{default:a(()=>[l(y,{value:r.value.fieldType,"onUpdate:value":e[2]||(e[2]=s=>r.value.fieldType=s),placeholder:"请选择领域类别",options:ct},null,8,["value"])]),_:1})]),_:1})]),_:1}),l(p,{label:"难度",name:"difficulty",required:""},{default:a(()=>[l(j,{value:r.value.difficulty,"onUpdate:value":e[3]||(e[3]=s=>r.value.difficulty=s),class:"custom-radio"},{default:a(()=>[l(b,{value:1},{default:a(()=>e[41]||(e[41]=[c("简单")])),_:1,__:[41]}),l(b,{value:2},{default:a(()=>e[42]||(e[42]=[c("适中")])),_:1,__:[42]}),l(b,{value:3},{default:a(()=>e[43]||(e[43]=[c("困难")])),_:1,__:[43]})]),_:1},8,["value"])]),_:1}),l(p,{label:"学时",name:"classHour"},{default:a(()=>[l(d,{value:r.value.classHour,"onUpdate:value":e[4]||(e[4]=s=>r.value.classHour=s),placeholder:"配置任务后自动计算",disabled:""},null,8,["value"])]),_:1}),l(p,{label:"顶部背景图",name:"topCover",required:""},{default:a(()=>[i("div",Pa,[i("div",Fa,[l(Z,{"before-upload":Qt,"show-upload-list":!1,accept:"image/png,image/jpeg"},{default:a(()=>[l(C,{loading:se.value},{default:a(()=>[se.value?(v(),g(F,{key:1},[c("上传中...")],64)):(v(),g(F,{key:0},[c("选择文件")],64))]),_:1},8,["loading"])]),_:1}),le.value?(v(),g("div",Sa,[i("img",{src:le.value,alt:"顶部背景图预览",style:{"max-width":"290px","max-height":"218px","border-radius":"4px"}},null,8,La)])):T("",!0)]),e[44]||(e[44]=i("div",{class:"upload-hint"}," 说明：支持上传png/jpeg等格式文件，文件大小不能超过12M,建议使用290*218像素。 ",-1))])]),_:1}),l(p,{label:"封面图",name:"cover",required:""},{default:a(()=>[i("div",Na,[i("div",Ma,[l(Z,{"before-upload":zt,"show-upload-list":!1,accept:"image/png,image/jpeg"},{default:a(()=>[l(C,{loading:oe.value},{default:a(()=>[oe.value?(v(),g(F,{key:1},[c("上传中...")],64)):(v(),g(F,{key:0},[c("选择文件")],64))]),_:1},8,["loading"])]),_:1}),ae.value?(v(),g("div",Ea,[i("img",{src:ae.value,alt:"封面图预览",style:{"max-width":"290px","max-height":"218px","border-radius":"4px"}},null,8,ja)])):T("",!0)]),e[45]||(e[45]=i("div",{class:"upload-hint"}," 说明：支持上传png/jpeg等格式文件，文件大小不能超过12M,建议使用290*218像素。 ",-1))])]),_:1}),l(p,{label:"简介",name:"description"},{default:a(()=>[l(Fe,{modelValue:r.value.description,"onUpdate:modelValue":e[5]||(e[5]=s=>r.value.description=s),height:400},null,8,["modelValue"])]),_:1}),l(p,{label:"任务要求",name:"showTaskRequire"},{default:a(()=>[l(Xe,{checked:r.value.showTaskRequire,"onUpdate:checked":e[6]||(e[6]=s=>r.value.showTaskRequire=s)},{default:a(()=>e[46]||(e[46]=[c(" 显示任务要求（勾选后，将帮作为任务要求显示在任务项目政策面） ")])),_:1,__:[46]},8,["checked"])]),_:1})]),_:1},8,["model"])]),e[52]||(e[52]=i("div",{class:"section-title"},[i("h3",null,"培训公开范围")],-1)),i("div",$a,[l($,{ref_key:"trainingScopeFormRef",ref:Le,model:r.value,rules:Me,layout:"horizontal","label-col":{span:2},"wrapper-col":{span:18}},{default:a(()=>[l(p,{label:"培训公开范围",name:"authType",required:""},{default:a(()=>[l(j,{value:r.value.authType,"onUpdate:value":e[7]||(e[7]=s=>r.value.authType=s),class:"custom-radio"},{default:a(()=>[l(b,{value:1},{default:a(()=>e[47]||(e[47]=[c("完全公开")])),_:1,__:[47]}),l(b,{value:2},{default:a(()=>e[48]||(e[48]=[c("全院公开")])),_:1,__:[48]}),l(b,{value:3},{default:a(()=>e[49]||(e[49]=[c("本单位公开")])),_:1,__:[49]}),l(b,{value:4},{default:a(()=>e[50]||(e[50]=[c("不公开")])),_:1,__:[50]})]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])])])):T("",!0),U.value===1?(v(),g("div",Va,[i("div",Aa,[i("div",Ba,[l(y,{value:r.value.repositoryType,"onUpdate:value":e[8]||(e[8]=s=>r.value.repositoryType=s),options:vt,class:"repository-type-select"},null,8,["value"]),i("div",Da,[e[53]||(e[53]=i("span",{class:"url-label"},"仓库地址：",-1)),l(d,{value:r.value.gitUrl,"onUpdate:value":e[9]||(e[9]=s=>r.value.gitUrl=s),placeholder:"请输入仓库地址",class:"url-input",disabled:D.value,onBlur:Wt},null,8,["value","disabled"])])]),i("div",Ha,[i("div",Oa,[i("div",Ka,[i("div",Qa,[e[54]||(e[54]=i("span",{class:"switch-label"},"代码仓库",-1)),l(Tl,{checked:r.value.enableCodeRepository,disabled:r.value.enableCodeRepository,onChange:Gt},null,8,["checked","disabled"])]),r.value.enableCodeRepository?(v(),R(tt,{key:0},{overlay:a(()=>[l(et,{onClick:Zt},{default:a(()=>[l(X,{key:"newFile"},{default:a(()=>e[55]||(e[55]=[c("新建文件")])),_:1,__:[55]}),l(X,{key:"newFolder"},{default:a(()=>e[56]||(e[56]=[c("新建文件夹")])),_:1,__:[56]}),l(X,{key:"upload"},{default:a(()=>e[57]||(e[57]=[c("上传")])),_:1,__:[57]})]),_:1})]),default:a(()=>[l(C,{type:"primary",size:"small"},{default:a(()=>[l(n(rt)),e[58]||(e[58]=c(" 新建 "))]),_:1,__:[58]})]),_:1})):T("",!0)]),r.value.enableCodeRepository?(v(),R(zl,{key:0,"file-tree-data":n(ne),"expanded-keys":n(ke),"onUpdate:expandedKeys":e[10]||(e[10]=s=>me(ke)?ke.value=s:null),onSelect:n(yt),onMenuClick:Xt,onExpand:Yt},null,8,["file-tree-data","expanded-keys","onSelect"])):T("",!0),r.value.enableCodeRepository?(v(),g("div",za,e[59]||(e[59]=[i("div",{class:"tips-title"},"提示：",-1),i("div",{class:"tips-content"}," 此处存放本实训所需的所有代码等相关文件，你可以通过以下： ",-1),i("div",{class:"tips-list"},[c(" 1、"),i("a",{href:"#",class:"tips-link"},"Gitee客户端"),c(" 上传已有文件来开始使用。 ")],-1),i("div",{class:"tips-list"}," 2、直接在平台上创建文件目录以及相关代码文件。 ",-1)]))):T("",!0)]),i("div",Ga,[r.value.enableCodeRepository?(v(),R(Gl,{key:0,"selected-file":n(ft),"highlighted-code":n(mt),"dynamic-file-contents":n(gt)},null,8,["selected-file","highlighted-code","dynamic-file-contents"])):(v(),g("div",Ja," 在左侧代码仓库区域点击目录打开文件 "))])])])])):T("",!0),U.value===2?(v(),g("div",Wa,[i("div",Ya,[i("div",Za,[i("div",Xa,[l(C,{type:"primary",onClick:e[11]||(e[11]=s=>n(we)("kernel"))},{default:a(()=>e[60]||(e[60]=[c("添加内核链接任务")])),_:1,__:[60]}),l(C,{type:"primary",onClick:e[12]||(e[12]=s=>n(we)("choice"))},{default:a(()=>e[61]||(e[61]=[c("添加选择题任务")])),_:1,__:[61]}),l(C,{type:"primary",onClick:e[13]||(e[13]=s=>n(we)("programming"))},{default:a(()=>e[62]||(e[62]=[c("添加编程任务")])),_:1,__:[62]})])]),i("div",es,[i("div",ts,[i("div",ls,"任务关卡 ("+P(n(L).length)+")",1),i("div",as,[(v(!0),g(F,null,H(n(L),s=>(v(),g("div",{key:s.id,class:O(["list-item",{active:n($e)===s.id}]),onClick:m=>n(Ae)(s.id)},[i("span",os,P(s.name),1),l(n(ge),{class:"delete-icon",onClick:ot(m=>n(qt)(s.id),["stop"])},null,8,["onClick"])],10,ss))),128))])]),i("div",ns,[n($e)?(v(),g("div",is,[l(st,{activeKey:n(ie),onChange:kl},Sl({default:a(()=>[l(fe,{key:"task",tab:"关联任务"},{default:a(()=>[l($,{ref_key:"taskLevelFormRef",ref:Te,model:n(k),rules:n(wt),layout:"horizontal","label-col":{span:4},"wrapper-col":{span:18}},{default:a(()=>[l(p,{label:"任务名称",name:"name",required:""},{default:a(()=>[l(d,{value:n(k).name,"onUpdate:value":e[14]||(e[14]=s=>n(k).name=s),placeholder:"请输入任务名称"},null,8,["value"])]),_:1}),l(p,{label:"学习资源",name:"source",required:""},{default:a(()=>[l(Z,{"file-list":n(be),"onUpdate:fileList":e[15]||(e[15]=s=>me(be)?be.value=s:null),"custom-request":n(Ue),onChange:n(Pt),accept:".doc,.docx,.pdf,.ppt,.pptx,.mp4","max-count":10},{default:a(()=>[l(C,{type:"primary"},{default:a(()=>e[64]||(e[64]=[c("点击上传")])),_:1,__:[64]})]),_:1},8,["file-list","custom-request","onChange"]),e[65]||(e[65]=i("div",{class:"upload-hint"}," 说明：支持上传word、pdf、ppt、mp4等格式文件，每个文件大小不能超过500M。 ",-1))]),_:1,__:[65]}),l(p,{label:"任务要求",name:"require",required:""},{default:a(()=>[l(Fe,{modelValue:n(k).require,"onUpdate:modelValue":e[16]||(e[16]=s=>n(k).require=s),placeholder:"请输入任务要求",onChange:ul},null,8,["modelValue"])]),_:1}),l(p,{label:"参考答案",name:"referenceAnswer",required:""},{default:a(()=>[l(Fe,{modelValue:n(k).referenceAnswer,"onUpdate:modelValue":e[17]||(e[17]=s=>n(k).referenceAnswer=s),placeholder:"请输入参考答案",onChange:dl},null,8,["modelValue"])]),_:1}),l(p,{label:"难度系数",name:"difficulty",required:""},{default:a(()=>[l(j,{value:n(k).difficulty,"onUpdate:value":e[18]||(e[18]=s=>n(k).difficulty=s),class:"custom-radio"},{default:a(()=>[l(b,{value:1},{default:a(()=>e[66]||(e[66]=[c("简单")])),_:1,__:[66]}),l(b,{value:2},{default:a(()=>e[67]||(e[67]=[c("适中")])),_:1,__:[67]}),l(b,{value:3},{default:a(()=>e[68]||(e[68]=[c("困难")])),_:1,__:[68]})]),_:1},8,["value"])]),_:1}),l(p,{label:"技能标签",name:"tag",required:""},{default:a(()=>[l(d,{value:n(k).tag,"onUpdate:value":e[19]||(e[19]=s=>n(k).tag=s),placeholder:"请输入技能标签"},null,8,["value"])]),_:1}),n(It)?(v(),R(p,{key:0,label:"内嵌链接",name:"jumpUrl",required:""},{default:a(()=>[l(d,{value:n(k).jumpUrl,"onUpdate:value":e[20]||(e[20]=s=>n(k).jumpUrl=s),placeholder:"请输入内嵌链接"},null,8,["value"])]),_:1})):T("",!0),l(p,{label:"任务学时",name:"classHour",required:""},{default:a(()=>[l(lt,{style:{width:"100%"},min:0,value:n(k).classHour,"onUpdate:value":e[21]||(e[21]=s=>n(k).classHour=s),placeholder:"请输入任务学时"},null,8,["value"])]),_:1})]),_:1},8,["model","rules"])]),_:1}),n(Ce)?(v(),R(fe,{key:"questions",tab:"题目"},{default:a(()=>[n(re).length===0?(v(),g("div",rs,[l(at,{description:"暂无题目，请点击右上方按钮新增题目"})])):(v(),g("div",us,[(v(!0),g(F,null,H(n(re),(s,m)=>(v(),g("div",{key:s.id,class:O(["question-item",{dragging:E.value===m}]),draggable:"true",onDragstart:x=>ml(m),onDragover:gl,onDrop:x=>yl(x,m),onDragend:_l},[i("div",ps,[i("div",cs,[l(n(Ta),{class:"drag-handle"}),i("span",vs,"题目"+P(m+1),1)]),i("div",fs,[l(n(ut),{class:"edit-icon",onClick:x=>cl(s)},null,8,["onClick"]),l(n(ge),{class:"delete-icon",onClick:x=>n(Vt)(s.id)},null,8,["onClick"])])]),i("div",ms,[s.name?(v(),g("div",gs,[c(P(m+1)+"、 ",1),i("div",{innerHTML:s.name},null,8,ys)])):(v(),g("div",_s,"暂无题干"))]),i("div",ks,[(v(!0),g(F,null,H(fl(s),(x,Cl)=>(v(),g("div",{key:Cl,class:O(["option-row",{"is-correct":Ze(s,x.label)}])},[i("span",hs,P(x.label)+".",1),i("span",Ts,P(x.content),1),Ze(s,x.label)?(v(),g("span",bs,"正确答案")):T("",!0)],2))),128))]),i("div",Cs,[e[69]||(e[69]=i("div",{class:"explanation-label"},"答案解析：",-1)),i("div",ws,[s.answerKey?(v(),g("span",Us,P(s.answerKey),1)):(v(),g("span",Is,"暂无答案解析"))])])],42,ds))),128))]))]),_:1})):T("",!0),n(Ve)?(v(),R(fe,{key:"evaluation",tab:"评测设置"},{default:a(()=>[i("div",qs,[i("div",xs,[e[76]||(e[76]=i("div",{class:"section-header"},"评测文件",-1)),l($,{ref_key:"evaluationFormRef",ref:Ct,model:n(w),rules:n(Ut),layout:"horizontal","label-col":{span:4},"wrapper-col":{span:18}},{default:a(()=>[l(p,{label:"评测时长限制",name:"timeLimitM",required:""},{default:a(()=>[l(lt,{value:n(w).timeLimitM,"onUpdate:value":e[22]||(e[22]=s=>n(w).timeLimitM=s),min:0,placeholder:"请输入评测时长限制",style:{width:"200px"}},null,8,["value"]),e[70]||(e[70]=i("span",{style:{"margin-left":"8px"}},"分钟",-1))]),_:1,__:[70]}),l(p,{label:"学员任务文件",name:"userFiles",required:""},{default:a(()=>[l(Z,{"file-list":n(Ie),"onUpdate:fileList":e[23]||(e[23]=s=>me(Ie)?Ie.value=s:null),"custom-request":n(Ue),onChange:n(Ft),accept:".js,.ts,.py,.java,.cpp,.c","max-count":10},{default:a(()=>[l(C,{type:"primary"},{default:a(()=>e[71]||(e[71]=[c("点击上传")])),_:1,__:[71]})]),_:1},8,["file-list","custom-request","onChange"]),e[72]||(e[72]=i("div",{class:"upload-hint"}," 说明：支持上传多个代码文件，每个文件大小不能超过500M。（学员评测基本任务时名称，查看效果页上需要编辑的文件类型） ",-1))]),_:1,__:[72]}),l(p,{label:"评测执行文件",name:"testValidateFiles",required:""},{default:a(()=>[l(Z,{"file-list":n(qe),"onUpdate:fileList":e[24]||(e[24]=s=>me(qe)?qe.value=s:null),"custom-request":n(Ue),onChange:n(St),accept:".js,.ts,.py,.java,.cpp,.c","max-count":10},{default:a(()=>[l(C,{type:"primary"},{default:a(()=>e[73]||(e[73]=[c("点击上传")])),_:1,__:[73]})]),_:1},8,["file-list","custom-request","onChange"]),e[74]||(e[74]=i("div",{class:"upload-hint"},' 说明：支持上传多个代码文件，每个文件大小不能超过500M。（点击评测按钮时调用的文件，用于检验学员任务结果是否正确，可与"学员任务文件"一致） ',-1))]),_:1,__:[74]}),l(p,{label:"评测执行命令",name:"testValidateSh",required:""},{default:a(()=>[l(d,{value:n(w).testValidateSh,"onUpdate:value":e[25]||(e[25]=s=>n(w).testValidateSh=s),placeholder:"请输入评测执行命令，例如：python main.py"},null,8,["value"]),e[75]||(e[75]=i("div",{class:"upload-hint"}," （执行评测文件的命令，如：python main.py、node index.js、java Main 等） ",-1))]),_:1,__:[75]})]),_:1},8,["model","rules"])]),i("div",Rs,[e[83]||(e[83]=i("div",{class:"section-header"},"评测规则",-1)),l($,{layout:"horizontal","label-col":{span:4},"wrapper-col":{span:18}},{default:a(()=>[l(p,{label:"通关判定"},{default:a(()=>[l(j,{value:n(w).passType,"onUpdate:value":e[26]||(e[26]=s=>n(w).passType=s),class:"custom-radio"},{default:a(()=>[l(b,{value:1},{default:a(()=>e[77]||(e[77]=[c("实际输出与期望输出对比")])),_:1,__:[77]}),l(b,{value:2},{default:a(()=>e[78]||(e[78]=[c("实际输出满足规则")])),_:1,__:[78]})]),_:1},8,["value"])]),_:1}),n(w).passType===2?(v(),R(p,{key:0,label:"判定规则"},{default:a(()=>[l(d,{value:n(w).passTypeRule,"onUpdate:value":e[27]||(e[27]=s=>n(w).passTypeRule=s),placeholder:"请输入判定规则"},null,8,["value"]),e[79]||(e[79]=i("div",{class:"upload-hint"}," （请输入实际输出满足的规则描述） ",-1))]),_:1,__:[79]})):T("",!0),l(p,{label:"空格处理"},{default:a(()=>[l(j,{value:n(w).blankCode,"onUpdate:value":e[28]||(e[28]=s=>n(w).blankCode=s),class:"custom-radio"},{default:a(()=>[l(b,{value:1},{default:a(()=>e[80]||(e[80]=[c("不忽略空格")])),_:1,__:[80]}),l(b,{value:2},{default:a(()=>e[81]||(e[81]=[c("忽略首尾空格")])),_:1,__:[81]}),l(b,{value:3},{default:a(()=>e[82]||(e[82]=[c("忽略所有空格(仅通过空格中自动添加所有空格进行对比)")])),_:1,__:[82]})]),_:1},8,["value"])]),_:1})]),_:1})]),i("div",Ps,[e[92]||(e[92]=i("div",{class:"section-header"},"测试集",-1)),l($,{layout:"horizontal","label-col":{span:4},"wrapper-col":{span:18}},{default:a(()=>[l(p,{label:"得分规则"},{default:a(()=>[l(j,{value:n(w).scoreRule,"onUpdate:value":e[29]||(e[29]=s=>n(w).scoreRule=s),class:"custom-radio"},{default:a(()=>[l(b,{value:1},{default:a(()=>e[84]||(e[84]=[c("通过全部测试集（所有测试集都正确，才获取对应积分；否则得0学分）")])),_:1,__:[84]}),l(b,{value:2},{default:a(()=>e[85]||(e[85]=[c("通过部分测试集（选中的测试集全部正确，获取任务学分；否则得0学分）")])),_:1,__:[85]})]),_:1},8,["value"])]),_:1}),l(p,{label:"用例类型"},{default:a(()=>[i("div",Fs,[l(j,{value:n(w).testValidateType,"onUpdate:value":e[30]||(e[30]=s=>n(w).testValidateType=s),class:"custom-radio"},{default:a(()=>[l(b,{value:1},{default:a(()=>e[86]||(e[86]=[c("文本")])),_:1,__:[86]}),l(b,{value:2},{default:a(()=>e[87]||(e[87]=[c("文件")])),_:1,__:[87]})]),_:1},8,["value"]),n(w).testValidateType===1?(v(),g("div",Ss,[l(C,{type:"primary",onClick:n(Lt)},{default:a(()=>e[88]||(e[88]=[c("新增测试集")])),_:1,__:[88]},8,["onClick"]),l(C,{onClick:n(Mt)},{default:a(()=>e[89]||(e[89]=[c("一键删除测试用例")])),_:1,__:[89]},8,["onClick"]),l(C,{onClick:n(Et)},{default:a(()=>e[90]||(e[90]=[c("下载测试用例模板")])),_:1,__:[90]},8,["onClick"]),l(C,{onClick:n(jt)},{default:a(()=>e[91]||(e[91]=[c("批量上传测试用例")])),_:1,__:[91]},8,["onClick"])])):T("",!0)])]),_:1}),n(w).testValidateType===1&&n(w).testContent.length>0?(v(),g("div",Ls,[(v(!0),g(F,null,H(n(w).testContent,(s,m)=>(v(),g("div",{key:s.id,class:"test-case-item"},[l(Xe,{checked:s.select===1,onChange:x=>hl(s,x.target.checked),class:"test-case-checkbox"},null,8,["checked","onChange"]),i("span",Ns,"测试集"+P(m+1),1),l(d,{value:s.arg,"onUpdate:value":x=>s.arg=x,placeholder:"请输入输入内容",class:"test-case-input"},null,8,["value","onUpdate:value"]),l(d,{value:s.answer,"onUpdate:value":x=>s.answer=x,placeholder:"请输入期望输出",class:"test-case-output"},null,8,["value","onUpdate:value"]),l(n(ge),{class:"delete-test-case",onClick:x=>n(Nt)(s.id)},null,8,["onClick"])]))),128))])):T("",!0)]),_:1})])])]),_:1})):T("",!0)]),_:2},[n(Ce)&&n(ie)==="questions"?{name:"tabBarExtraContent",fn:a(()=>[l(C,{type:"primary",onClick:pl},{default:a(()=>[l(n(rt)),e[63]||(e[63]=c(" 新增题目 "))]),_:1,__:[63]})]),key:"0"}:void 0]),1032,["activeKey"]),n(ie)!=="questions"?(v(),g("div",Ms,[n(k).taskId?T("",!0):(v(),R(C,{key:0,onClick:n(Rt)},{default:a(()=>e[93]||(e[93]=[c("重置")])),_:1,__:[93]},8,["onClick"])),l(C,{type:"primary",onClick:n(xt)},{default:a(()=>[c(P(n(k).taskId?"更新":"保存"),1)]),_:1},8,["onClick"])])):T("",!0)])):(v(),g("div",Es,[l(at,{description:"请先添加任务关卡"})]))])])])])):T("",!0),U.value===3?(v(),g("div",js,[i("div",$s,[i("div",Vs,[e[96]||(e[96]=i("h3",{class:"environment-title"},"实验环境",-1)),i("div",As,[l(C,{type:"primary",onClick:il},{default:a(()=>e[94]||(e[94]=[c("添加实验环境")])),_:1,__:[94]}),l(C,null,{default:a(()=>e[95]||(e[95]=[c("设置")])),_:1,__:[95]})])]),l($,{ref_key:"experimentFormRef",ref:te,model:Ne.value,rules:pt,"label-col":{span:4},"wrapper-col":{span:18}},{default:a(()=>[l(st,{activeKey:M.value,"onUpdate:activeKey":e[36]||(e[36]=s=>M.value=s)},{default:a(()=>[(v(!0),g(F,null,H(I.value,s=>(v(),R(fe,{key:s.id},{tab:a(()=>[i("div",Bs,[s.isEditing?(v(),R(d,{key:0,value:Q.value,"onUpdate:value":e[31]||(e[31]=m=>Q.value=m),size:"small",style:{width:"120px"},onPressEnter:m=>Ye(s),onBlur:m=>Ye(s)},null,8,["value","onPressEnter","onBlur"])):(v(),g(F,{key:1},[i("span",{onDblclick:m=>We(s)},P(s.name),41,Ds),l(tt,{trigger:["click"]},{overlay:a(()=>[l(et,null,{default:a(()=>[l(X,{onClick:m=>We(s)},{default:a(()=>[l(n(ut)),e[97]||(e[97]=c(" 重命名 "))]),_:2,__:[97]},1032,["onClick"]),l(X,{onClick:m=>rl(s.id)},{default:a(()=>[l(n(ge)),e[98]||(e[98]=c(" 删除 "))]),_:2,__:[98]},1032,["onClick"])]),_:2},1024)]),default:a(()=>[l(n(Ca),{class:"tab-more-icon",onClick:e[32]||(e[32]=ot(()=>{},["stop"]))})]),_:2},1024)],64))])]),default:a(()=>[l(p,{label:"实验镜像",name:"dockerImage",required:""},{default:a(()=>[i("div",Hs," 系统实验镜像默认为"+P(Ht())+"。 ",1)]),_:1}),l(p,{label:"实验界面",name:"viewTypes",required:""},{default:a(()=>[i("div",Os,[i("div",{class:O(["interface-card",{active:s.config.viewTypes.includes(1)}]),onClick:e[33]||(e[33]=m=>Re(1))},e[99]||(e[99]=[i("div",{class:"card-title"},"代码编辑器",-1),i("div",{class:"card-desc"},"提供代码编辑器，编辑器，调试器等工具",-1)]),2),i("div",{class:O(["interface-card",{active:s.config.viewTypes.includes(2)}]),onClick:e[34]||(e[34]=m=>Re(2))},e[100]||(e[100]=[i("div",{class:"card-title"},"命令行终端",-1),i("div",{class:"card-desc"},"提供命令行窗口",-1)]),2),i("div",{class:O(["interface-card",{active:s.config.viewTypes.includes(3)}]),onClick:e[35]||(e[35]=m=>Re(3))},e[101]||(e[101]=[i("div",{class:"card-title"},"容器内服务",-1),i("div",{class:"card-desc"},"直接预览容器内部Web服务",-1)]),2)])]),_:2},1024),l(p,{label:"附带环境",name:"secondType",required:""},{default:a(()=>[l(y,{value:s.config.secondType,"onUpdate:value":m=>s.config.secondType=m,placeholder:"请选择附带环境",allowClear:""},{default:a(()=>[l(V,{value:1},{default:a(()=>e[102]||(e[102]=[c("环境1")])),_:1,__:[102]}),l(V,{value:2},{default:a(()=>e[103]||(e[103]=[c("环境2")])),_:1,__:[103]})]),_:2},1032,["value","onUpdate:value"])]),_:2},1024),l(p,{label:"任务关卡",name:"taskId",required:""},{default:a(()=>[l(y,{value:s.config.taskId,"onUpdate:value":m=>s.config.taskId=m,placeholder:"请选择任务关卡",allowClear:""},{default:a(()=>[(v(!0),g(F,null,H(n(L),m=>(v(),R(V,{key:m.taskId||m.id,value:m.taskId?String(m.taskId):void 0,disabled:!m.taskId||Je(s.id,m.taskId)},{default:a(()=>[c(P(m.name)+" ",1),m.taskId?Je(s.id,m.taskId)?(v(),g("span",Qs," (已被使用)")):T("",!0):(v(),g("span",Ks," (未保存)"))]),_:2},1032,["value","disabled"]))),128))]),_:2},1032,["value","onUpdate:value"])]),_:2},1024),s.config.viewTypes.includes(1)?(v(),R(p,{key:0,label:"编程语言",name:"codeType",required:""},{default:a(()=>[l(y,{value:s.config.codeType,"onUpdate:value":m=>s.config.codeType=m,placeholder:"请选择编程语言",allowClear:""},{default:a(()=>[l(V,{value:"1"},{default:a(()=>e[104]||(e[104]=[c("Python")])),_:1,__:[104]}),l(V,{value:"2"},{default:a(()=>e[105]||(e[105]=[c("JavaScript")])),_:1,__:[105]}),l(V,{value:"3"},{default:a(()=>e[106]||(e[106]=[c("Java")])),_:1,__:[106]}),l(V,{value:"4"},{default:a(()=>e[107]||(e[107]=[c("C++")])),_:1,__:[107]})]),_:2},1032,["value","onUpdate:value"])]),_:2},1024)):T("",!0),s.config.viewTypes.includes(2)?(v(),R(p,{key:1,label:"开启时触发命令",name:"shellBegin",required:""},{default:a(()=>[l(d,{value:s.config.shellBegin,"onUpdate:value":m=>s.config.shellBegin=m,placeholder:"请输入命令"},null,8,["value","onUpdate:value"])]),_:2},1024)):T("",!0),s.config.viewTypes.includes(3)?(v(),R(p,{key:2,label:"容器端口",name:"containerPort",required:""},{default:a(()=>[l(d,{value:s.config.containerPort,"onUpdate:value":m=>s.config.containerPort=m,placeholder:"请输入容器端口"},null,8,["value","onUpdate:value"])]),_:2},1024)):T("",!0),s.config.viewTypes.includes(3)?(v(),R(p,{key:3,label:"路由"},{default:a(()=>[l(d,{value:s.config.containerPath,"onUpdate:value":m=>s.config.containerPath=m,placeholder:"请输入路由（选填）"},null,8,["value","onUpdate:value"])]),_:2},1024)):T("",!0),l(p,{"wrapper-col":{offset:4,span:18}},{default:a(()=>[l(C,{class:"w-full",type:"primary",onClick:m=>xe(s)},{default:a(()=>[c(P(s.isSaved?"更新":"保存"),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["activeKey"])]),_:1},8,["model"])])])):T("",!0),i("div",zs,[l(C,{onClick:ol},{default:a(()=>[c(P(U.value===0?"返回":"上一步"),1)]),_:1}),l(C,{type:"primary",loading:A.value,onClick:nl},{default:a(()=>[c(P(U.value===3?"完成":"下一步"),1)]),_:1},8,["loading"])])])]),_:1},8,["spinning"]),i("input",{ref_key:"fileUploadInput",ref:De,type:"file",style:{display:"none"},onChange:el},null,544),l(Jl,{open:z.value,"onUpdate:open":e[37]||(e[37]=s=>z.value=s),onConfirm:Jt,onCancel:Oe},null,8,["open"]),l(Wl,{open:ue.value,"onUpdate:open":e[38]||(e[38]=s=>ue.value=s),"parent-path":J.value,onConfirm:tl},null,8,["open","parent-path"]),l(Yl,{open:de.value,"onUpdate:open":e[39]||(e[39]=s=>de.value=s),"parent-path":W.value,onConfirm:ll},null,8,["open","parent-path"]),l(Xl,{open:pe.value,"onUpdate:open":e[40]||(e[40]=s=>pe.value=s),question:G.value,"project-id":S.value??void 0,"task-id":n(k).taskId,"existing-questions":n(re),onConfirm:vl},null,8,["open","question","project-id","task-id","existing-questions"])])}}}),ao=Ul(Gs,[["__scopeId","data-v-5885e37a"]]);export{ao as default};
