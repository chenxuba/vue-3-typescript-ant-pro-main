import{d as R,ab as D,f as C,o as G,a0 as u,a3 as r,a1 as s,k as t,a9 as i,G as v,ac as m,af as Q,F as y,ae as S}from"./vue-CLfcZxUN.js";import{i as q,f as H,j as K}from"./index-Cd0N-3PO.js";import{ad as W,ae as X,Q as Y,U as Z,v as ee,G as ae,$ as te,E as ne,ap as oe,aa as h,a9 as $}from"./antd-Du2BR_SQ.js";import{_ as se}from"./index-BQjyLfUJ.js";const le={class:"raining-project-management"},ie={class:"search-section"},ce={class:"table-section"},ue={class:"table-header"},re={class:"table-tabs"},pe={class:"tabs-left"},de={class:"data-count"},_e={class:"tabs-right"},ve={key:3,class:"public-scope-cell"},me={key:4,class:"action-links"},ge=["onClick"],ye=["onClick"],he=["onClick"],ke=["onClick"],be=["onClick"],fe=R({name:"RainingProjectManagement",__name:"index",setup(Ce){const j=D(),c=C({projectName:"",environment:void 0,organizer:void 0}),w=[{label:"全栈环境",value:"全栈环境"},{label:"JupyterNotebook环境",value:"JupyterNotebook环境"},{label:"JupyterLab环境",value:"JupyterLab环境"},{label:"其他",value:"其他"}],P=[{label:"中国科学院计算机网络信息中心",value:"中国科学院计算机网络信息中心"}],o=C({current:1,pageSize:10,total:0}),I=[{title:"项目名称",dataIndex:"projectName",key:"projectName"},{title:"实验环境",dataIndex:"environment",key:"environment"},{title:"技能标签",dataIndex:"skillTag",key:"skillTag"},{title:"主办单位",dataIndex:"organizer",key:"organizer"},{title:"公开范围",dataIndex:"publicScope",key:"publicScope"},{title:"操作",key:"action",width:280}],k=C([]),T=C(!1),_=async()=>{T.value=!0;try{const n={page:o.value.current,limit:o.value.pageSize,startNum:(o.value.current-1)*o.value.pageSize,name:c.value.projectName||void 0,orgName:c.value.organizer||void 0,orderbyFiled:"createTime:desc"},e=await q(n);k.value=e.list,o.value.total=e.count}catch(n){h.error(n.message||"获取项目列表失败"),k.value=[],o.value.total=0}finally{T.value=!1}},F=n=>{o.value.current=n.current,o.value.pageSize=n.pageSize,_()},J=()=>{c.value={projectName:"",environment:void 0,organizer:void 0},o.value.current=1,_()},U=()=>{o.value.current=1,_()};G(()=>{_()});const B=()=>{j.push("/dashboard/raining-project-management/create")},L=n=>{j.push({path:"/dashboard/raining-project-management/statistics",query:{id:n.key,name:n.projectName}})},N=n=>{const e=n.status===1,p=e?"取消发布":"发布",g=e?0:1;$.confirm({title:`确认${p}`,content:`确定要${p}项目"${n.name}"吗？`,okText:"确认",cancelText:"取消",onOk:async()=>{try{await H({id:n.id,status:g}),h.success(`${p}成功`),_()}catch(d){console.error(`${p}失败：`,d),h.error(d.message||`${p}失败`)}}})},O=n=>{console.log("编辑",n)},V=n=>{$.confirm({title:"确认删除",content:`确定要删除项目"${n.name}"吗？删除后数据将无法恢复！`,okText:"确认删除",okType:"danger",cancelText:"取消",onOk:async()=>{try{await K({id:n.id}),h.success("删除成功"),k.value.length===1&&o.value.current>1&&(o.value.current-=1),_()}catch(e){console.error("删除失败：",e),h.error(e.message||"删除失败")}}})};return(n,e)=>{const p=Z,g=Y,d=X,x=ee,z=ae,A=W,E=te,b=ne,M=oe;return r(),u("div",le,[s("div",ie,[e[5]||(e[5]=s("h3",{class:"section-title"},"筛选查询",-1)),t(E,{model:c.value,layout:"horizontal",class:"search-form"},{default:i(()=>[t(A,{gutter:24},{default:i(()=>[t(d,{span:6},{default:i(()=>[t(g,{label:"项目名称：",name:"projectName"},{default:i(()=>[t(p,{value:c.value.projectName,"onUpdate:value":e[0]||(e[0]=l=>c.value.projectName=l),placeholder:"请输入项目名称"},null,8,["value"])]),_:1})]),_:1}),t(d,{span:6},{default:i(()=>[t(g,{label:"实验环境：",name:"environment"},{default:i(()=>[t(x,{value:c.value.environment,"onUpdate:value":e[1]||(e[1]=l=>c.value.environment=l),placeholder:"请选择实验环境",options:w,"allow-clear":""},null,8,["value"])]),_:1})]),_:1}),t(d,{span:6},{default:i(()=>[t(g,{label:"主办单位：",name:"organizer"},{default:i(()=>[t(x,{value:c.value.organizer,"onUpdate:value":e[2]||(e[2]=l=>c.value.organizer=l),placeholder:"请选择主办单位",options:P,"allow-clear":""},null,8,["value"])]),_:1})]),_:1}),t(d,{span:6,class:"form-actions"},{default:i(()=>[t(z,{type:"primary",onClick:U},{default:i(()=>e[3]||(e[3]=[v("查询")])),_:1,__:[3]}),t(z,{onClick:J},{default:i(()=>e[4]||(e[4]=[v("重置")])),_:1,__:[4]})]),_:1})]),_:1})]),_:1},8,["model"])]),s("div",ce,[s("div",ue,[s("div",re,[s("div",pe,[e[6]||(e[6]=s("span",{class:"tab-item active"},"数据列表",-1)),s("span",de,"数据共 "+m(o.value.total)+" 条",1)]),s("div",_e,[t(z,{type:"primary",onClick:B},{default:i(()=>e[7]||(e[7]=[v("新建项目")])),_:1,__:[7]})])])]),t(M,{columns:I,"data-source":k.value,loading:T.value,pagination:{current:o.value.current,pageSize:o.value.pageSize,total:o.value.total,showSizeChanger:!0,showQuickJumper:!0,showTotal:l=>`共 ${l} 条`},onChange:F,bordered:""},{bodyCell:i(({column:l,record:a})=>[l.key==="projectName"?(r(),u(y,{key:0},[v(m(a.name),1)],64)):l.key==="skillTag"?(r(),u(y,{key:1},[v(m(a.tag),1)],64)):l.key==="organizer"?(r(),u(y,{key:2},[v(m(a.connectUnit||"-"),1)],64)):l.key==="publicScope"?(r(),u("div",ve,[s("div",{class:S(["status-badge",{"status-published":a.status===1,"status-unpublished":a.status!==1}])},m(a.status===1?"已发布":"未发布"),3),s("div",{class:S(["scope-badge",{"scope-full":a.authType===1,"scope-academy":a.authType===2,"scope-unit":a.authType===3,"scope-private":a.authType===4}])},m(a.authType===1?"完全公开":a.authType===2?"全院公开":a.authType===3?"本单位公开":a.authType===4?"不公开":"-"),3)])):l.key==="action"?(r(),u("div",me,[s("a",{onClick:f=>L(a)},"统计",8,ge),a.status===1?(r(),u(y,{key:0},[t(b,{type:"vertical"}),s("a",{onClick:f=>N(a)},"取消发布",8,ye),t(b,{type:"vertical"}),s("a",{onClick:f=>O(a)},"编辑",8,he)],64)):(r(),u(y,{key:1},[t(b,{type:"vertical"}),s("a",{onClick:f=>N(a)},"发布",8,ke)],64)),t(b,{type:"vertical"}),s("a",{class:"danger-link",onClick:f=>V(a)},"删除",8,be)])):Q("",!0)]),_:1},8,["data-source","loading","pagination"])])])}}}),xe=se(fe,[["__scopeId","data-v-d5d76258"]]);export{xe as default};
