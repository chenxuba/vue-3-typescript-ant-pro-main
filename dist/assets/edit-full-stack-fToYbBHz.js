const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./antd-Cme2pY03.js","./vue-PnzzEkKE.js"])))=>i.map(i=>d[i]);
import{m as $l,_ as Vl}from"./index-BGDR-97V.js";import{d as Al,ak as Bl,am as Dl,f as _,c as ye,w as Hl,o as Ol,_ as m,a1 as p,$ as i,k as a,a7 as o,ac as b,u as n,F as P,ag as L,a6 as w,G as f,a9 as C,H as ft,ab as O,B as gt,ae as zl,y as Me}from"./vue-PnzzEkKE.js";import{R as je,u as mt,g as yt,a as Kl,d as Ql,s as Gl,c as Jl}from"./RichTextEditor-BhwfBcCN.js";import{e as Wl,a as Yl,u as Zl,f as Xl}from"./index-B4vHWS7k.js";import{u as ea,a as ta,b as la,c as aa,d as sa}from"./dictionary-C05O3TXU.js";import{u as oa}from"./multi-tab-BmvI8B-a.js";import{H as E,j as na,t as ia,x as $e,c as ra,a as ua,m as da,F as _t}from"./FileSelectModal-BT-YDwEd.js";import{u as ca,a as pa,F as va,b as fa,R as ga,N as ma,c as ya,Q as _a}from"./useTaskLevel-CwlKotqN.js";import{a1 as v,a3 as ha,a2 as ka,K as ba,z as Ta,I as wa,a4 as Ca,a5 as Ua,a6 as xa,a7 as Ia,a8 as Ra,a9 as qa,H as Fa,aa as Pa,D as Sa,ab as ht,f as La,e as Na,af as _e,T as Ea,s as Ma,ac as ja,ad as $a,ae as Va,Z as kt,ag as Aa,J as Ba,ah as Da,ai as Ha,u as Oa,Y as za}from"./antd-Cme2pY03.js";import"./dictionary-Cogn3OR_.js";const Ka={class:"edit-full-stack-page"},Qa={class:"page-content"},Ga={class:"steps-container"},Ja={key:0},Wa={class:"form-section"},Ya={class:"flex items-top gap-16px"},Za={class:"flex flex-col gap-12px"},Xa={key:0,class:"image-preview"},es=["src"],ts={class:"flex items-top gap-16px"},ls={class:"flex flex-col gap-12px"},as={key:0,class:"image-preview"},ss=["src"],os={class:"form-section"},ns={key:1},is={class:"form-section repository-section"},rs={class:"repository-top-bar flex items-center gap-16px justify-between"},us={class:"repository-url-group"},ds={class:"repository-main-area"},cs={class:"repository-left"},ps={class:"repository-switch-box flex items-center justify-between"},vs={class:"flex items-center gap-12px"},fs={key:1,class:"repository-tips"},gs={class:"repository-right"},ms={key:1,class:"empty-area"},ys={key:2},_s={class:"task-level-section"},hs={class:"task-level-header"},ks={class:"header-buttons"},bs={class:"task-level-main"},Ts={class:"task-level-list"},ws={class:"list-title"},Cs={class:"list-items"},Us=["onClick"],xs={class:"item-name"},Is={class:"task-level-detail"},Rs={key:0,class:"detail-content"},qs={key:0,class:"questions-content"},Fs={key:1,class:"questions-list"},Ps=["onDragstart","onDrop"],Ss={class:"question-header"},Ls={class:"question-number-with-drag"},Ns={class:"question-number"},Es={class:"action-icons"},Ms={class:"question-title"},js={key:0,class:"flex"},$s=["innerHTML"],Vs={key:1,style:{color:"#bfbfbf"}},As={class:"question-options"},Bs={class:"option-label"},Ds={class:"option-content"},Hs={key:0,class:"correct-tag"},Os={class:"question-explanation"},zs={class:"explanation-content"},Ks={key:0},Qs={key:1,style:{color:"#bfbfbf"}},Gs={class:"evaluation-content"},Js={class:"evaluation-section"},Ws={class:"file-select-wrapper"},Ys={class:"selected-files-list"},Zs={class:"file-select-wrapper"},Xs={class:"selected-files-list"},eo={class:"evaluation-section"},to={class:"evaluation-section"},lo={class:"case-type-row"},ao={key:0,class:"test-case-buttons"},so={key:0,class:"test-cases-list"},oo={class:"test-case-label"},no={key:0,class:"form-footer-buttons"},io={key:1,class:"empty-detail"},ro={key:3,class:"step-content"},uo={key:0,class:"content-card"},co={class:"environment-header"},po={class:"environment-actions"},vo={class:"tab-label"},fo=["onDblclick"],go={class:"experiment-image-info"},mo={class:"experiment-interfaces"},yo={key:0,style:{color:"#999"}},_o={key:1,style:{color:"#999"}},ho={key:1,class:"content-card no-environment-card"},ko={class:"page-footer"},bt="/dashboard/analysis",bo=Al({name:"EditFullStack",__name:"edit-full-stack",setup(To){E.registerLanguage("javascript",na),E.registerLanguage("typescript",ia),E.registerLanguage("xml",$e),E.registerLanguage("html",$e),E.registerLanguage("vue",$e),E.registerLanguage("css",ra),E.registerLanguage("json",ua),E.registerLanguage("markdown",da);const z=Bl(),Tt=Dl(),wt=oa(),Ct=async()=>{await z.push(bt),wt.closeOther(bt)},S=_(null),I=_(0),A=_(!1),X=_(),Ve=_(),ee=_(),u=_({name:"",tag:"",fieldType:void 0,difficulty:1,classHour:"",topCover:"",cover:"",description:"",showTaskRequire:!1,authType:1,enableCodeRepository:!1,repositoryType:"代码仓库",gitUrl:"",environment:void 0}),te=_(""),le=_(""),ae=_(!1),se=_(!1),oe=window.location.origin,B=_(void 0),R=_([]),M=_("1"),K=_(""),Ut={dockerImage:[{required:!0,message:"请选择实验镜像",trigger:"change"}],viewTypes:[{required:!0,type:"array",min:1,message:"请至少选择一个实验界面",trigger:"change"}],taskId:[{required:!0,message:"请选择任务关卡",trigger:"change"}],codeType:[{required:!0,message:"请选择编程语言",trigger:"change"}],shellBegin:[{required:!0,message:"请输入开启时触发命令",trigger:"blur"}],containerPort:[{required:!0,message:"请输入容器端口",trigger:"blur"}]},Ae=ye(()=>{var e;const t=R.value.find(d=>d.id===M.value);return(t==null?void 0:t.config)||((e=R.value[0])==null?void 0:e.config)}),Be={name:[{required:!0,message:"请输入名称",trigger:"blur"}],tag:[{required:!0,message:"请输入技能标签",trigger:"blur"}],fieldType:[{required:!0,message:"请选择领域类别",trigger:"change"}],difficulty:[{required:!0,message:"请选择难度",trigger:"change"}],topCover:[{required:!0,message:"请上传顶部背景图",trigger:"change"}],cover:[{required:!0,message:"请上传封面图",trigger:"change"}],authType:[{required:!0,message:"请选择培训公开范围",trigger:"change"}]},he=ea(),ke=ta(),xt=la(),be=aa(),De=sa(1),It=[{label:"切换仓库",value:"切换仓库"},{label:"代码仓库",value:"代码仓库"},{label:"私密代码仓库",value:"私密代码仓库"}],D=_(!1),Te=_(new Set),{fileTreeData:ne,expandedKeys:we,selectedFile:Rt,highlightedCode:qt,dynamicFileContents:Ft,handleSelectFile:Pt,getNodePath:He,addFileToTree:Oe,addFolderToTree:St,handleRenameNode:Lt,handleCopyPath:Nt,loadRemoteFileTree:Et,loadChildrenData:Mt,getNodePathFromMap:Ce}=ca(),{taskLevels:N,selectedTaskLevelId:ze,currentTab:H,taskLevelFormRef:Ue,evaluationFormRef:jt,taskLevelFormData:h,evaluationFormData:T,learningResourceFileList:xe,taskLevelFormRules:$t,evaluationFormRules:Vt,isKernelTask:At,isChoiceTask:Ie,isProgrammingTask:Ke,addTaskLevel:Re,deleteTaskLevel:Bt,selectTaskLevel:ie,saveTaskLevel:Dt,resetTaskLevel:Ht,handleLearningResourceCustomRequest:Ot,handleLearningResourceUpload:zt,handleUserFilesSelect:Kt,handleTestValidateFilesSelect:Qt,userFileList:re,testValidateFileList:ue,addTestCase:Gt,removeTestCase:Jt,clearAllTestCases:Wt,getCurrentQuestions:de,addQuestion:Yt,deleteQuestion:Zt,updateQuestion:Xt,updateQuestionsOrder:el,loadQuestions:Qe,saveQuestionsOrder:tl}=pa(S),Ge=ye(()=>[...N.value].sort((t,e)=>{const d=t.weight??0,s=e.weight??0;return d-s})),Je=ye(()=>Ge.value.filter(t=>t.type==="programming")),We=ye(()=>Je.value.length>0),Q=_(!1),ce=_(!1),pe=_(!1),ve=_(!1),qe=_(!1),Fe=_(!1),G=_(null),J=_("/"),W=_("/"),Ye=_(null),fe=_("/"),ll=()=>{const t=De.data.value.find(e=>e.value===String(B.value||1));return(t==null?void 0:t.name)||"--"},Ze=()=>{R.value.length===0&&(R.value=[{id:"1",name:"实验环境1",isEditing:!1,isSaved:!1,config:{dockerImage:B.value||1,viewTypes:[],secondType:"1",taskId:void 0,codeType:void 0,shellBegin:"bash",containerPort:void 0,containerPath:void 0}}])},al=async()=>{if(S.value)try{const t=await Xl({projectId:S.value,orderbyFiled:"weight:asc"});let e=[];Array.isArray(t)?e=t:t&&typeof t=="object"&&(e=t.list||t.data||t.tasks||[]),e&&e.length>0&&(N.value=e.map(s=>{let c="programming";s.type===4?c="kernel":s.type===2?c="choice":s.type===1&&(c="programming");const r=s.source?s.source.split(",").map((y,q)=>({uid:`${q}`,name:y.split("/").pop()||`文件${q+1}`,status:"done",url:y,response:y})):[];let k=[];if(s.testContent)try{k=JSON.parse(s.testContent)}catch(y){console.error("解析测试集内容失败:",y)}return{id:String(s.taskId),name:s.name,type:c,source:s.source,require:s.require,referenceAnswer:s.referenceAnswer,difficulty:s.difficulty,tag:s.tag,classHour:s.classHour,jumpUrl:s.jumpUrl,taskId:s.taskId,formData:{name:s.name,source:r,require:s.require,referenceAnswer:s.referenceAnswer,difficulty:s.difficulty,tag:s.tag,classHour:s.classHour,jumpUrl:s.jumpUrl,taskId:s.taskId},evaluationSettings:s.type===1?{timeLimitM:s.timeLimitM,userFiles:s.userFiles?s.userFiles.split(",").map((y,q)=>({uid:`${q}`,name:y.split("/").pop()||`文件${q+1}`,status:"done",url:y,response:y})):[],testValidateFiles:s.testValidateFiles?s.testValidateFiles.split(",").map((y,q)=>({uid:`${q}`,name:y.split("/").pop()||`文件${q+1}`,status:"done",url:y,response:y})):[],testValidateSh:s.testValidateSh,passType:s.passType||1,passTypeRule:s.passTypeRule||"",blankCode:s.blankCode||1,scoreRule:s.scoreRule||1,testValidateType:s.testValidateType||1,testContent:k}:void 0,questions:s.questions||[]}}),N.value.length>0&&ie(N.value[0].id));let d=[];e&&e.length>0&&e.forEach((s,c)=>{if(s.type===1&&(s.envIsDel===0||s.envIsDel===void 0||s.envIsDel===null)){const r={id:s.id||s.taskId,title:s.title||s.name||`实验环境${c+1}`,dockerImage:s.dockerImage,viewTypes:s.viewTypes,secondType:s.secondType,taskId:s.taskId,codeType:s.codeType,shellBegin:s.shellBegin,containerPort:s.containerPort,containerPath:s.containerPath,envIsDel:s.envIsDel};d.push(r)}}),d.length>0?(R.value=d.map((s,c)=>{let r=[];return s.viewTypes&&(typeof s.viewTypes=="string"?r=s.viewTypes.split(",").map(k=>Number(k.trim())).filter(k=>!isNaN(k)):Array.isArray(s.viewTypes)&&(r=s.viewTypes.map(k=>Number(k)))),{id:String(s.id||Date.now()+c),name:s.title||s.name||`实验环境${c+1}`,isEditing:!1,isSaved:!0,config:{dockerImage:Number(s.dockerImage)||B.value||1,viewTypes:r,secondType:s.secondType?s.secondType:void 0,taskId:s.taskId?String(s.taskId):void 0,codeType:s.codeType?String(s.codeType):void 0,shellBegin:s.shellBegin?String(s.shellBegin):void 0,containerPort:s.containerPort?String(s.containerPort):void 0,containerPath:s.containerPath?String(s.containerPath):void 0}}}),R.value.length>0&&(M.value=R.value[0].id)):Ze()}catch(t){v.warning(t.message||"获取任务关卡列表失败"),Ze()}},sl=async()=>{if(!S.value){v.error("缺少项目ID"),z.back();return}try{A.value=!0;const t=await Wl({id:S.value});u.value={name:t.name||"",tag:t.tag||"",fieldType:t.fieldType?t.fieldType:void 0,difficulty:t.difficulty||1,classHour:t.classHour||"",topCover:t.topCover||"",cover:t.cover||"",description:t.description||"",showTaskRequire:t.showTaskRequire===1,authType:t.authType||1,enableCodeRepository:t.gitUrl?!0:t.enableCodeRepository||!1,repositoryType:t.repositoryType||"代码仓库",gitUrl:t.gitUrl||"",environment:t.environment},t.topCover&&(te.value=oe+t.topCover),t.cover&&(le.value=oe+t.cover),B.value=t.environment||1,t.gitUrl&&(D.value=!0),await al()}catch(t){console.error("获取项目详情失败：",t),v.error(t.message||"获取项目详情失败"),z.back()}finally{A.value=!1}},ol=async t=>{var s;if(!(t.size/1024/1024<12))return v.error("图片大小不能超过 12MB!"),!1;if(!(t.type==="image/jpeg"||t.type==="image/png"))return v.error("只能上传 JPG/PNG 格式的图片!"),!1;try{ae.value=!0;const c=await mt(t);te.value=oe+c,u.value.topCover=c,(s=X.value)==null||s.validateFields(["topCover"]),v.success("顶部背景图上传成功")}catch{v.error("顶部背景图上传失败")}finally{ae.value=!1}return!1},nl=async t=>{var s;if(!(t.size/1024/1024<12))return v.error("图片大小不能超过 12MB!"),!1;if(!(t.type==="image/jpeg"||t.type==="image/png"))return v.error("只能上传 JPG/PNG 格式的图片!"),!1;try{se.value=!0;const c=await mt(t);le.value=oe+c,u.value.cover=c,(s=X.value)==null||s.validateFields(["cover"]),v.success("封面图上传成功")}catch{v.error("封面图上传失败")}finally{se.value=!1}return!1},il=t=>{(typeof t=="boolean"?t:!!t)?Q.value=!0:u.value.enableCodeRepository=!1},ge=async()=>{try{const t=v.loading("正在查询仓库文件...",0),e=await yt(u.value.gitUrl,"");Et(e),Te.value.clear(),t(),v.success("仓库文件查询成功"),console.log("查询仓库地址：",u.value.gitUrl),console.log("获取到的文件列表：",e)}catch(t){v.error(t.message||"仓库文件查询失败"),console.error("仓库文件查询失败：",t)}},rl=async()=>{if(!u.value.gitUrl||!u.value.gitUrl.trim()){v.error("请先配置仓库地址"),Xe();return}u.value.enableCodeRepository=!0,Q.value=!1,D.value=!0,await ge()},Xe=()=>{u.value.enableCodeRepository=!1,Q.value=!1};Hl(()=>u.value.repositoryType,t=>{t==="切换仓库"&&u.value.enableCodeRepository&&(D.value=!1,v.info("已解锁仓库地址，请重新输入"),Me(()=>{u.value.repositoryType="代码仓库"}))});const ul=()=>{var t;u.value.enableCodeRepository&&!D.value&&((t=u.value.gitUrl)!=null&&t.trim())&&(D.value=!0,ge())},dl=async(t,e)=>{const{expanded:d,node:s}=e;if(d&&!s.isLeaf){const c=String(s.key);if(Te.value.has(c)){console.log("文件夹已加载，跳过：",c);return}try{const r=Ce(c);console.log("加载文件夹：",r,"节点key:",c);const k=v.loading(`正在加载 ${s.title}...`,0),y=await yt(u.value.gitUrl,r);Mt(c,y),Te.value.add(c),k(),console.log("文件夹加载成功：",r,y)}catch(r){v.error(r.message||"加载文件夹失败"),console.error("加载文件夹失败：",r)}}},cl=t=>{switch(String(t.key)){case"newFile":tt();break;case"newFolder":lt();break;case"upload":et("/");break}},pl=(t,e)=>{const d=String(t.key),s=Ce(e.key)||He(e.key);switch(d){case"newFile":tt(s);break;case"newFolder":lt(s);break;case"upload":et(s);break;case"rename":Lt(e);break;case"copyPath":Nt(e);break;case"delete":yl(e);break}},et=t=>{var e;fe.value=t,(e=Ye.value)==null||e.click()},vl=async t=>{var s;const e=t.target,d=(s=e.files)==null?void 0:s[0];if(d)try{let c=fe.value==="/"?"":fe.value.replace(/^\//,"");const r=v.loading(`正在上传 ${d.name}...`,0);await Kl(d,u.value.gitUrl,c);const k=new FileReader;k.onload=y=>{var U;const q=(U=y.target)==null?void 0:U.result;Oe(d.name,q,fe.value)},k.readAsText(d),r(),v.success(`文件 ${d.name} 上传成功`),console.log("文件上传成功：",{fileName:d.name,path:c})}catch(c){v.error(c.message||"文件上传失败"),console.error("文件上传失败：",c)}finally{e&&(e.value="")}},tt=(t="/")=>{ce.value=!0,J.value=t},fl=async t=>{try{let e=J.value==="/"?"":J.value.replace(/^\//,"");const d=v.loading("正在保存文件...",0);await Gl({fileContent:t.fileContent,fileName:t.fileName,gitUrl:u.value.gitUrl,path:e,commit:t.commitMessage}),Oe(t.fileName,t.fileContent,J.value),d(),v.success("文件创建成功"),ce.value=!1,console.log("文件保存成功：",{fileName:t.fileName,path:e})}catch(e){v.error(e.message||"文件创建失败"),console.error("文件创建失败：",e)}},lt=(t="/")=>{pe.value=!0,W.value=t},gl=async t=>{try{let e=W.value==="/"?t.folderName:`${W.value.replace(/^\//,"")}/${t.folderName}`;const d=v.loading("正在创建文件夹...",0);await Jl({commit:t.commitMessage,gitUrl:u.value.gitUrl,path:e}),St(t.folderName,W.value),d(),v.success("文件夹创建成功"),pe.value=!1,console.log("文件夹创建成功：",{folderName:t.folderName,path:e})}catch(e){v.error(e.message||"文件夹创建失败"),console.error("文件夹创建失败：",e)}},ml=t=>{const e=d=>{const s=d.findIndex(c=>c.key===t);if(s!==-1)return d.splice(s,1),!0;for(const c of d)if(c.children&&e(c.children))return!0;return!1};e(ne.value)},yl=async t=>{const e=t.children!==void 0||t.isLeaf===!1,d=t.title,c=(Ce(t.key)||He(t.key)).split("/");c.pop();const r=c.join("/")||"",{Modal:k}=await $l(async()=>{const{Modal:y}=await import("./antd-Cme2pY03.js").then(q=>q.ax);return{Modal:y}},__vite__mapDeps([0,1]),import.meta.url);k.confirm({title:"确认删除",content:`确定要删除${e?"文件夹":"文件"} "${d}" 吗？${e?"文件夹下的所有内容也会被删除。":""}`,okText:"确定",cancelText:"取消",okType:"danger",onOk:async()=>{let y=null;try{y=v.loading("正在删除...",0),await Ql({fileName:d,gitUrl:u.value.gitUrl,path:r}),ml(t.key),y(),v.success("删除成功"),console.log("删除成功：",{fileName:d,path:r})}catch(q){y&&y(),v.error(q.message||"删除失败"),console.error("删除失败：",q)}}})},Y=()=>{Me(()=>{window.scrollTo({top:0,behavior:"smooth"}),document.documentElement.scrollTop=0,document.body.scrollTop=0;const t=document.querySelector(".page-content");t&&(t.scrollTop=0);const e=document.querySelector(".ant-layout-content");e&&(e.scrollTop=0),document.querySelectorAll("*").forEach(s=>{s.scrollTop>0&&(s.scrollTop=0)})})},_l=async()=>{I.value>0?(I.value--,Y(),I.value===1&&u.value.gitUrl&&u.value.enableCodeRepository&&ne.value.length===0&&await ge()):z.back()},hl=async()=>{var t,e;if(I.value===0)try{await Promise.all([(t=X.value)==null?void 0:t.validate(),(e=Ve.value)==null?void 0:e.validate()]),I.value=1,Y(),u.value.gitUrl&&u.value.enableCodeRepository&&ne.value.length===0&&await ge()}catch{v.error("请完善必填信息"),Y()}else if(I.value===1){if(u.value.enableCodeRepository&&(!u.value.gitUrl||u.value.gitUrl.trim()==="")){v.error("请输入仓库地址");return}await at(!1),I.value=2,Y()}else if(I.value===2){if(N.value.length===0){v.error("请至少添加一个任务关卡");return}if(N.value.some(r=>!r.taskId)){v.error("请先保存所有任务关卡后再进行下一步");return}const s=N.value.find(r=>r.type==="choice"&&r.taskId&&(!r.questions||r.questions.length===0));if(s){v.warning("请至少新增一条题目"),ie(s.id),H.value="questions";return}const c=N.value.find(r=>r.type!=="programming"||!r.taskId||!r.evaluationSettings?!1:r.evaluationSettings.testValidateType===1?!r.evaluationSettings.testContent||r.evaluationSettings.testContent.length===0:!1);if(c){v.warning("用例类型为文本时，必须至少创建一条测试集"),ie(c.id),H.value="evaluation";return}I.value=3,Y()}else if(I.value===3){if(We.value&&R.value.filter(s=>!s.isSaved).length>0){v.error("请先保存实验环境配置");return}await at(!0)}},at=async(t=!1)=>{try{A.value=!0;const e={id:S.value,projectType:1,environment:B.value,name:u.value.name,tag:u.value.tag,fieldType:u.value.fieldType,difficulty:u.value.difficulty,classHour:u.value.classHour,topCover:u.value.topCover,cover:u.value.cover,description:u.value.description,showTaskRequire:u.value.showTaskRequire?1:2,authType:u.value.authType,enableCodeRepository:u.value.enableCodeRepository};t&&u.value.authType!==2&&(e.status=10),u.value.enableCodeRepository&&(e.repositoryType=u.value.repositoryType,e.gitUrl=u.value.gitUrl),await Yl(e),t?(v.success("项目更新成功！"),setTimeout(()=>{Ct()},500)):v.success("保存成功！")}catch(e){throw console.error("更新失败：",e),v.error(e.message||"项目更新失败，请稍后重试"),e}finally{A.value=!1}},Pe=async(t,e=0)=>{var d,s;try{if(e!==1){const r=["dockerImage","viewTypes","taskId"],k=[];t.config.viewTypes.includes(1)?r.push("codeType"):k.push("codeType"),t.config.viewTypes.includes(2)?r.push("shellBegin"):k.push("shellBegin"),t.config.viewTypes.includes(3)?r.push("containerPort"):k.push("containerPort"),k.length>0&&((d=ee.value)==null||d.clearValidate(k)),await((s=ee.value)==null?void 0:s.validate(r))}if(!S.value){v.error("项目ID不存在，无法保存");return}const c={title:t.name,dockerImage:t.config.dockerImage,viewTypes:t.config.viewTypes.join(","),secondType:t.config.secondType,taskId:t.config.taskId?Number(t.config.taskId):void 0,codeType:t.config.codeType,shellBegin:t.config.shellBegin,containerPort:t.config.containerPort,containerPath:t.config.containerPath,projectId:S.value,envisDel:e};await Zl(c),e!==1?(t.isSaved=!0,v.success("实验环境保存成功！")):v.success("删除成功！")}catch(c){throw console.error("保存失败：",c),v.error(e===1?"删除失败":"请完善必填信息"),c}},Se=t=>{const e=Ae.value;if(!e)return;const d=e.viewTypes.indexOf(t);d>-1?(e.viewTypes.splice(d,1),t===1?e.codeType=void 0:t===2?e.shellBegin=void 0:t===3&&(e.containerPort=void 0,e.containerPath=void 0)):e.viewTypes.push(t),Me(()=>{var s;(s=ee.value)==null||s.clearValidate(["viewTypes"])})},st=(t,e)=>{if(!e)return!1;const d=typeof e=="string"?Number(e):e;return R.value.some(s=>{if(!s.config.taskId)return!1;const c=typeof s.config.taskId=="string"?Number(s.config.taskId):s.config.taskId;return s.id!==t&&c===d})},kl=()=>{const t=String(Date.now()),e={id:t,name:`实验环境${R.value.length+1}`,isEditing:!1,isSaved:!1,config:{dockerImage:B.value||1,viewTypes:[],secondType:"1",taskId:void 0,codeType:void 0,shellBegin:"bash",containerPort:void 0,containerPath:void 0}};R.value.push(e),M.value=t,v.success("添加实验环境成功")},bl=async t=>{if(R.value.length===1){v.warning("至少保留一个实验环境");return}const e=R.value.findIndex(d=>d.id===t);if(e>-1){const d=R.value[e];d.isSaved&&await Pe(d,1),R.value.splice(e,1),M.value===t&&(M.value=R.value[0].id),d.isSaved||v.success("删除实验环境成功")}},ot=t=>{t.isEditing=!0,K.value=t.name},nt=t=>{K.value.trim()?(t.name=K.value.trim(),t.isEditing=!1,t.isSaved&&(v.success("重命名成功"),Pe(t))):v.warning("名称不能为空")},Tl=t=>{var d;t.replace(/<[^>]*>/g,"").trim()&&((d=Ue.value)==null||d.clearValidate(["require"]))},wl=t=>{var d;t.replace(/<[^>]*>/g,"").trim()&&((d=Ue.value)==null||d.clearValidate(["referenceAnswer"]))},Cl=()=>{G.value=null,ve.value=!0},Ul=t=>{G.value=t,ve.value=!0},xl=async t=>{G.value?Xt(t):Yt(t),G.value=null,h.value.taskId&&await Qe(h.value.taskId)},Il=t=>{try{return JSON.parse(t.selects||"[]").map(d=>{const s=Object.keys(d)[0];return{label:s,content:d[s]}})}catch{return[]}},it=(t,e)=>t.answer.includes(e),j=_(null),Rl=t=>{j.value=t},ql=t=>{t.preventDefault()},Fl=async(t,e)=>{if(t.preventDefault(),j.value!==null&&j.value!==e){const d=[...de.value],[s]=d.splice(j.value,1);d.splice(e,0,s),d.forEach((c,r)=>{c.weight=r+1}),el(d);try{await tl(d),v.success("题目顺序已更新")}catch(c){v.error(c.message||"保存题目排序失败，请重试")}}j.value=null},Pl=()=>{j.value=null},Sl=async t=>{const e=String(t);if(Ie.value&&e==="questions"){if(!h.value.taskId){v.warning("请先保存创建任务后再添加题目");return}h.value.taskId&&await Qe(h.value.taskId)}if(Ke.value&&e==="evaluation"&&!h.value.taskId){v.warning("请先保存创建任务后再配置评测设置");return}H.value=e},Ll=(t,e)=>{t.select=e?1:2};return Ol(()=>{he.load(),ke.load(),xt.load(),be.load(),De.load();const t=Tt.query.id;t?(S.value=Number(t),sl()):(v.error("缺少项目ID"),z.back())}),(t,e)=>{const d=ka,s=ha,c=wa,r=Ta,k=Ua,y=xa,q=Ca,U=Ra,$=Ia,x=Fa,Le=qa,V=ba,Nl=Pa,Z=Na,rt=La,ut=Sa,Ne=ja,me=Ma,dt=$a,ct=Aa,El=Ba,pt=Da,vt=Ea,Ee=Ha,Ml=za;return p(),m("div",Ka,[e[100]||(e[100]=i("div",{class:"page-header"},[i("h2",null,"编辑全栈环境实训项目")],-1)),a(Ml,{spinning:A.value},{default:o(()=>[i("div",Qa,[i("div",Ga,[a(s,{current:I.value,class:"custom-steps"},{default:o(()=>[a(d,{title:"基本信息"}),a(d,{title:"代码仓库"}),a(d,{title:"任务关卡"}),a(d,{title:"实验环境"})]),_:1},8,["current"])]),I.value===0?(p(),m("div",Ja,[e[50]||(e[50]=i("div",{class:"section-title"},[i("h3",null,"基本信息")],-1)),i("div",Wa,[a(V,{ref_key:"formRef",ref:X,model:u.value,rules:Be,layout:"horizontal","label-col":{span:2},"wrapper-col":{span:18}},{default:o(()=>[a(r,{label:"名称",name:"name",required:""},{default:o(()=>[a(c,{value:u.value.name,"onUpdate:value":e[0]||(e[0]=l=>u.value.name=l),placeholder:"请输入名称"},null,8,["value"])]),_:1}),a(q,null,{default:o(()=>[a(k,{span:12},{default:o(()=>[a(r,{label:"技能标签",name:"tag",required:"","label-col":{span:4},"wrapper-col":{span:20}},{default:o(()=>[a(c,{value:u.value.tag,"onUpdate:value":e[1]||(e[1]=l=>u.value.tag=l),placeholder:"请输入技能标签"},null,8,["value"]),e[43]||(e[43]=i("div",{style:{"font-size":"12px",color:"#999","margin-top":"4px"}}," 请使用英文状态下的逗号分隔技能标签，比如html,css,js ",-1))]),_:1,__:[43]})]),_:1}),a(k,{span:12},{default:o(()=>[a(r,{label:"领域类别",name:"fieldType",required:"","label-col":{span:4},"wrapper-col":{span:12}},{default:o(()=>[a(y,{value:u.value.fieldType,"onUpdate:value":e[2]||(e[2]=l=>u.value.fieldType=l),placeholder:"请选择领域类别",options:n(he).options.value,loading:n(he).loading.value},null,8,["value","options","loading"])]),_:1})]),_:1})]),_:1}),a(r,{label:"难度",name:"difficulty",required:""},{default:o(()=>[a($,{value:u.value.difficulty,"onUpdate:value":e[3]||(e[3]=l=>u.value.difficulty=l),class:"custom-radio"},{default:o(()=>[(p(!0),m(P,null,L(n(ke).data.value,l=>(p(),w(U,{key:l.value,value:Number(l.value)},{default:o(()=>[f(C(l.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),a(r,{label:"学时",name:"classHour"},{default:o(()=>[a(c,{value:u.value.classHour,"onUpdate:value":e[4]||(e[4]=l=>u.value.classHour=l),placeholder:"配置任务后自动计算",disabled:""},null,8,["value"])]),_:1}),a(r,{label:"顶部背景图",name:"topCover",required:""},{default:o(()=>[i("div",Ya,[i("div",Za,[a(Le,{"before-upload":ol,"show-upload-list":!1,accept:"image/png,image/jpeg"},{default:o(()=>[a(x,{loading:ae.value},{default:o(()=>[ae.value?(p(),m(P,{key:1},[f("上传中...")],64)):(p(),m(P,{key:0},[f("选择文件")],64))]),_:1},8,["loading"])]),_:1}),te.value?(p(),m("div",Xa,[i("img",{src:te.value,alt:"顶部背景图预览",style:{"max-width":"290px","max-height":"218px","border-radius":"4px"}},null,8,es)])):b("",!0)]),e[44]||(e[44]=i("div",{class:"upload-hint"}," 说明：支持上传png/jpeg等格式文件，文件大小不能超过12M,建议使用290*218像素。 ",-1))])]),_:1}),a(r,{label:"封面图",name:"cover",required:""},{default:o(()=>[i("div",ts,[i("div",ls,[a(Le,{"before-upload":nl,"show-upload-list":!1,accept:"image/png,image/jpeg"},{default:o(()=>[a(x,{loading:se.value},{default:o(()=>[se.value?(p(),m(P,{key:1},[f("上传中...")],64)):(p(),m(P,{key:0},[f("选择文件")],64))]),_:1},8,["loading"])]),_:1}),le.value?(p(),m("div",as,[i("img",{src:le.value,alt:"封面图预览",style:{"max-width":"290px","max-height":"218px","border-radius":"4px"}},null,8,ss)])):b("",!0)]),e[45]||(e[45]=i("div",{class:"upload-hint"}," 说明：支持上传png/jpeg等格式文件，文件大小不能超过12M,建议使用290*218像素。 ",-1))])]),_:1}),a(r,{label:"简介",name:"description"},{default:o(()=>[a(je,{modelValue:u.value.description,"onUpdate:modelValue":e[5]||(e[5]=l=>u.value.description=l),height:400},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),e[51]||(e[51]=i("div",{class:"section-title"},[i("h3",null,"培训公开范围")],-1)),i("div",os,[a(V,{ref_key:"trainingScopeFormRef",ref:Ve,model:u.value,rules:Be,layout:"horizontal","label-col":{span:2},"wrapper-col":{span:18}},{default:o(()=>[a(r,{label:"培训公开范围",name:"authType",required:""},{default:o(()=>[a($,{value:u.value.authType,"onUpdate:value":e[6]||(e[6]=l=>u.value.authType=l),class:"custom-radio"},{default:o(()=>[a(U,{value:1},{default:o(()=>e[46]||(e[46]=[f("完全公开")])),_:1,__:[46]}),a(U,{value:2},{default:o(()=>e[47]||(e[47]=[f("全院公开")])),_:1,__:[47]}),a(U,{value:3},{default:o(()=>e[48]||(e[48]=[f("本单位公开")])),_:1,__:[48]}),a(U,{value:4},{default:o(()=>e[49]||(e[49]=[f("不公开")])),_:1,__:[49]})]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])])])):b("",!0),I.value===1?(p(),m("div",ns,[i("div",is,[i("div",rs,[a(y,{value:u.value.repositoryType,"onUpdate:value":e[7]||(e[7]=l=>u.value.repositoryType=l),options:It,class:"repository-type-select"},null,8,["value"]),i("div",us,[e[52]||(e[52]=i("span",{class:"url-label"},"仓库地址：",-1)),a(c,{value:u.value.gitUrl,"onUpdate:value":e[8]||(e[8]=l=>u.value.gitUrl=l),placeholder:"请输入仓库地址",class:"url-input",disabled:D.value,onBlur:ul},null,8,["value","disabled"])])]),i("div",ds,[i("div",cs,[i("div",ps,[i("div",vs,[e[53]||(e[53]=i("span",{class:"switch-label"},"代码仓库",-1)),a(Nl,{checked:u.value.enableCodeRepository,disabled:u.value.enableCodeRepository,onChange:il},null,8,["checked","disabled"])]),u.value.enableCodeRepository?(p(),w(ut,{key:0},{overlay:o(()=>[a(rt,{onClick:cl},{default:o(()=>[a(Z,{key:"newFile"},{default:o(()=>e[54]||(e[54]=[f("新建文件")])),_:1,__:[54]}),a(Z,{key:"newFolder"},{default:o(()=>e[55]||(e[55]=[f("新建文件夹")])),_:1,__:[55]}),a(Z,{key:"upload"},{default:o(()=>e[56]||(e[56]=[f("上传")])),_:1,__:[56]})]),_:1})]),default:o(()=>[a(x,{type:"primary",size:"small"},{default:o(()=>[a(n(ht)),e[57]||(e[57]=f(" 新建 "))]),_:1,__:[57]})]),_:1})):b("",!0)]),u.value.enableCodeRepository?(p(),w(va,{key:0,"file-tree-data":n(ne),"expanded-keys":n(we),"onUpdate:expandedKeys":e[9]||(e[9]=l=>ft(we)?we.value=l:null),onSelect:n(Pt),onMenuClick:pl,onExpand:dl},null,8,["file-tree-data","expanded-keys","onSelect"])):b("",!0),u.value.enableCodeRepository?(p(),m("div",fs,e[58]||(e[58]=[i("div",{class:"tips-title"},"提示：",-1),i("div",{class:"tips-content"}," 此处存放本实训所需的所有代码等相关文件，你可以通过以下： ",-1),i("div",{class:"tips-list"},[f(" 1、"),i("a",{href:"#",class:"tips-link"},"Gitee客户端"),f(" 上传已有文件来开始使用。 ")],-1),i("div",{class:"tips-list"}," 2、直接在平台上创建文件目录以及相关代码文件。 ",-1)]))):b("",!0)]),i("div",gs,[u.value.enableCodeRepository?(p(),w(fa,{key:0,"selected-file":n(Rt),"highlighted-code":n(qt),"dynamic-file-contents":n(Ft)},null,8,["selected-file","highlighted-code","dynamic-file-contents"])):(p(),m("div",ms," 在左侧代码仓库区域点击目录打开文件 "))])])])])):b("",!0),I.value===2?(p(),m("div",ys,[i("div",_s,[i("div",hs,[i("div",ks,[a(x,{type:"primary",onClick:e[10]||(e[10]=l=>n(Re)("kernel"))},{default:o(()=>e[59]||(e[59]=[f("添加内嵌链接任务")])),_:1,__:[59]}),a(x,{type:"primary",onClick:e[11]||(e[11]=l=>n(Re)("choice"))},{default:o(()=>e[60]||(e[60]=[f("添加选择题任务")])),_:1,__:[60]}),u.value.enableCodeRepository?(p(),w(x,{key:0,type:"primary",onClick:e[12]||(e[12]=l=>n(Re)("programming"))},{default:o(()=>e[61]||(e[61]=[f("添加编程任务")])),_:1,__:[61]})):b("",!0)])]),i("div",bs,[i("div",Ts,[i("div",ws,"任务关卡 ("+C(n(N).length)+")",1),i("div",Cs,[(p(!0),m(P,null,L(Ge.value,l=>(p(),m("div",{key:l.id,class:O(["list-item",{active:n(ze)===l.id}]),onClick:g=>n(ie)(l.id)},[i("span",xs,C(l.name),1),a(n(_e),{class:"delete-icon",onClick:gt(g=>n(Bt)(l.id),["stop"])},null,8,["onClick"])],10,Us))),128))])]),i("div",Is,[n(ze)?(p(),m("div",Rs,[a(vt,{activeKey:n(H),onChange:Sl},zl({default:o(()=>[a(me,{key:"task",tab:"关联任务"},{default:o(()=>[a(V,{ref_key:"taskLevelFormRef",ref:Ue,model:n(h),rules:n($t),layout:"horizontal","label-col":{span:4},"wrapper-col":{span:18}},{default:o(()=>[a(r,{label:"任务名称",name:"name",required:""},{default:o(()=>[a(c,{value:n(h).name,"onUpdate:value":e[13]||(e[13]=l=>n(h).name=l),placeholder:"请输入任务名称"},null,8,["value"])]),_:1}),a(r,{label:"学习资源",name:"source"},{default:o(()=>[a(Le,{"file-list":n(xe),"onUpdate:fileList":e[14]||(e[14]=l=>ft(xe)?xe.value=l:null),"custom-request":n(Ot),onChange:n(zt),accept:".doc,.docx,.pdf,.ppt,.pptx,.mp4","max-count":10},{default:o(()=>[a(x,{type:"primary"},{default:o(()=>e[63]||(e[63]=[f("点击上传")])),_:1,__:[63]})]),_:1},8,["file-list","custom-request","onChange"]),e[64]||(e[64]=i("div",{class:"upload-hint"}," 说明：支持上传word、pdf、ppt、mp4等格式文件，每个文件大小不能超过300M。 ",-1))]),_:1,__:[64]}),a(r,{label:"任务要求",name:"require",required:""},{default:o(()=>[a(je,{modelValue:n(h).require,"onUpdate:modelValue":e[15]||(e[15]=l=>n(h).require=l),placeholder:"请输入任务要求",onChange:Tl},null,8,["modelValue"])]),_:1}),a(r,{label:"参考答案",name:"referenceAnswer",required:""},{default:o(()=>[a(je,{modelValue:n(h).referenceAnswer,"onUpdate:modelValue":e[16]||(e[16]=l=>n(h).referenceAnswer=l),placeholder:"请输入参考答案",onChange:wl},null,8,["modelValue"])]),_:1}),a(r,{label:"难度系数",name:"difficulty",required:""},{default:o(()=>[a($,{value:n(h).difficulty,"onUpdate:value":e[17]||(e[17]=l=>n(h).difficulty=l),class:"custom-radio"},{default:o(()=>[(p(!0),m(P,null,L(n(ke).data.value,l=>(p(),w(U,{key:l.value,value:Number(l.value)},{default:o(()=>[f(C(l.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),a(r,{label:"技能标签",name:"tag",required:""},{default:o(()=>[a(c,{value:n(h).tag,"onUpdate:value":e[18]||(e[18]=l=>n(h).tag=l),placeholder:"请输入技能标签"},null,8,["value"]),e[65]||(e[65]=i("div",{style:{"font-size":"12px",color:"#999","margin-top":"4px"}}," 请使用英文状态下的逗号分隔技能标签，比如html,css,js ",-1))]),_:1,__:[65]}),n(At)?(p(),w(r,{key:0,label:"内嵌链接",name:"jumpUrl",required:""},{default:o(()=>[a(c,{value:n(h).jumpUrl,"onUpdate:value":e[19]||(e[19]=l=>n(h).jumpUrl=l),placeholder:"请输入内嵌链接"},null,8,["value"])]),_:1})):b("",!0),a(r,{label:"任务学时",name:"classHour",required:""},{default:o(()=>[a(Ne,{style:{width:"100%"},min:0,value:n(h).classHour,"onUpdate:value":e[20]||(e[20]=l=>n(h).classHour=l),placeholder:"请输入任务学时"},null,8,["value"])]),_:1}),a(r,{label:"排序权重",name:"weight"},{default:o(()=>[a(Ne,{style:{width:"100%"},min:0,value:n(h).weight,"onUpdate:value":e[21]||(e[21]=l=>n(h).weight=l),placeholder:"请输入排序权重，数值越小越靠前"},null,8,["value"]),e[66]||(e[66]=i("div",{style:{color:"#999","font-size":"12px","margin-top":"4px"}}," 权重用于任务关卡排序，数值越小越靠前，默认按从小到大排序 ",-1))]),_:1,__:[66]})]),_:1},8,["model","rules"])]),_:1}),n(Ie)?(p(),w(me,{key:"questions",tab:"题目"},{default:o(()=>[n(de).length===0?(p(),m("div",qs,[a(dt,{description:"暂无题目，请点击右上方按钮新增题目"})])):(p(),m("div",Fs,[(p(!0),m(P,null,L(n(de),(l,g)=>(p(),m("div",{key:l.id,class:O(["question-item",{dragging:j.value===g}]),draggable:"true",onDragstart:F=>Rl(g),onDragover:ql,onDrop:F=>Fl(F,g),onDragend:Pl},[i("div",Ss,[i("div",Ls,[a(n(Va),{class:"drag-handle"}),i("span",Ns,"题目"+C(g+1),1)]),i("div",Es,[a(n(kt),{class:"edit-icon",onClick:F=>Ul(l)},null,8,["onClick"]),a(n(_e),{class:"delete-icon",onClick:F=>n(Zt)(l.id)},null,8,["onClick"])])]),i("div",Ms,[l.name?(p(),m("div",js,[f(C(g+1)+"、 ",1),i("div",{innerHTML:l.name},null,8,$s)])):(p(),m("div",Vs,"暂无题干"))]),i("div",As,[(p(!0),m(P,null,L(Il(l),(F,jl)=>(p(),m("div",{key:jl,class:O(["option-row",{"is-correct":it(l,F.label)}])},[i("span",Bs,C(F.label)+".",1),i("span",Ds,C(F.content),1),it(l,F.label)?(p(),m("span",Hs,"正确答案")):b("",!0)],2))),128))]),i("div",Os,[e[67]||(e[67]=i("div",{class:"explanation-label"},"答案解析：",-1)),i("div",zs,[l.answerKey?(p(),m("span",Ks,C(l.answerKey),1)):(p(),m("span",Qs,"暂无答案解析"))])])],42,Ps))),128))]))]),_:1})):b("",!0),n(Ke)?(p(),w(me,{key:"evaluation",tab:"评测设置"},{default:o(()=>[i("div",Gs,[i("div",Js,[e[74]||(e[74]=i("div",{class:"section-header"},"评测文件",-1)),a(V,{ref_key:"evaluationFormRef",ref:jt,model:n(T),rules:n(Vt),layout:"horizontal","label-col":{span:4},"wrapper-col":{span:18}},{default:o(()=>[a(r,{label:"评测时长限制",name:"timeLimitM",required:""},{default:o(()=>[a(Ne,{value:n(T).timeLimitM,"onUpdate:value":e[22]||(e[22]=l=>n(T).timeLimitM=l),min:0,placeholder:"请输入评测时长限制",style:{width:"200px"}},null,8,["value"]),e[68]||(e[68]=i("span",{style:{"margin-left":"8px"}},"分钟",-1))]),_:1,__:[68]}),a(r,{label:"学员任务文件",name:"userFiles",required:""},{default:o(()=>[i("div",Ws,[a(x,{type:"primary",onClick:e[23]||(e[23]=l=>qe.value=!0)},{default:o(()=>e[69]||(e[69]=[f("点击选择")])),_:1,__:[69]}),i("div",Ys,[(p(!0),m(P,null,L(n(re),l=>(p(),w(ct,{key:l.uid,closable:"",onClose:()=>{re.value=n(re).filter(g=>g.uid!==l.uid),n(T).userFiles=[...n(re)]},style:{margin:"4px"}},{default:o(()=>[f(C(l.name),1)]),_:2},1032,["onClose"]))),128))])]),e[70]||(e[70]=i("div",{class:"upload-hint"}," 说明：从代码仓库中选择文件。（学员评测基本任务时名称，查看效果页上需要编辑的文件类型） ",-1))]),_:1,__:[70]}),a(r,{label:"评测执行文件",name:"testValidateFiles",required:""},{default:o(()=>[i("div",Zs,[a(x,{type:"primary",onClick:e[24]||(e[24]=l=>Fe.value=!0)},{default:o(()=>e[71]||(e[71]=[f("点击选择")])),_:1,__:[71]}),i("div",Xs,[(p(!0),m(P,null,L(n(ue),l=>(p(),w(ct,{key:l.uid,closable:"",onClose:()=>{ue.value=n(ue).filter(g=>g.uid!==l.uid),n(T).testValidateFiles=[...n(ue)]},style:{margin:"4px"}},{default:o(()=>[f(C(l.name),1)]),_:2},1032,["onClose"]))),128))])]),e[72]||(e[72]=i("div",{class:"upload-hint"},' 说明：从代码仓库中选择文件。（点击评测按钮时调用的文件，用于检验学员任务结果是否正确，可与"学员任务文件"一致） ',-1))]),_:1,__:[72]}),a(r,{label:"评测执行命令",name:"testValidateSh",required:""},{default:o(()=>[a(c,{value:n(T).testValidateSh,"onUpdate:value":e[25]||(e[25]=l=>n(T).testValidateSh=l),placeholder:"请输入评测执行命令，例如：python main.py"},null,8,["value"]),e[73]||(e[73]=i("div",{class:"upload-hint"}," （执行评测文件的命令，如：python main.py、node index.js、java Main 等） ",-1))]),_:1,__:[73]})]),_:1},8,["model","rules"])]),i("div",eo,[e[81]||(e[81]=i("div",{class:"section-header"},"评测规则",-1)),a(V,{layout:"horizontal","label-col":{span:4},"wrapper-col":{span:18}},{default:o(()=>[a(r,{label:"通关判定"},{default:o(()=>[a($,{value:n(T).passType,"onUpdate:value":e[26]||(e[26]=l=>n(T).passType=l),class:"custom-radio"},{default:o(()=>[a(U,{value:1},{default:o(()=>e[75]||(e[75]=[f("实际输出与期望输出对比")])),_:1,__:[75]}),a(U,{value:2},{default:o(()=>e[76]||(e[76]=[f("实际输出满足规则")])),_:1,__:[76]})]),_:1},8,["value"])]),_:1}),n(T).passType===2?(p(),w(r,{key:0,label:"判定规则"},{default:o(()=>[a(c,{value:n(T).passTypeRule,"onUpdate:value":e[27]||(e[27]=l=>n(T).passTypeRule=l),placeholder:"请输入判定规则"},null,8,["value"]),e[77]||(e[77]=i("div",{class:"upload-hint"}," （请输入实际输出满足的规则描述） ",-1))]),_:1,__:[77]})):b("",!0),a(r,{label:"空格处理"},{default:o(()=>[a($,{value:n(T).blankCode,"onUpdate:value":e[28]||(e[28]=l=>n(T).blankCode=l),class:"custom-radio"},{default:o(()=>[a(U,{value:1},{default:o(()=>e[78]||(e[78]=[f("不忽略空格")])),_:1,__:[78]}),a(U,{value:2},{default:o(()=>e[79]||(e[79]=[f("忽略首尾空格")])),_:1,__:[79]}),a(U,{value:3},{default:o(()=>e[80]||(e[80]=[f("忽略所有空格(仅通过空格中自动添加所有空格进行对比)")])),_:1,__:[80]})]),_:1},8,["value"])]),_:1})]),_:1})]),i("div",to,[e[88]||(e[88]=i("div",{class:"section-header"},"测试集",-1)),a(V,{layout:"horizontal","label-col":{span:4},"wrapper-col":{span:18}},{default:o(()=>[a(r,{label:"得分规则"},{default:o(()=>[a($,{value:n(T).scoreRule,"onUpdate:value":e[29]||(e[29]=l=>n(T).scoreRule=l),class:"custom-radio"},{default:o(()=>[a(U,{value:1},{default:o(()=>e[82]||(e[82]=[f("通过全部测试集（所有测试集都正确，才获取对应积分；否则得0学分）")])),_:1,__:[82]}),a(U,{value:2},{default:o(()=>e[83]||(e[83]=[f("通过部分测试集（选中的测试集全部正确，获取任务学分；否则得0学分）")])),_:1,__:[83]})]),_:1},8,["value"])]),_:1}),a(r,{label:"用例类型"},{default:o(()=>[i("div",lo,[a($,{value:n(T).testValidateType,"onUpdate:value":e[30]||(e[30]=l=>n(T).testValidateType=l),class:"custom-radio"},{default:o(()=>[a(U,{value:1},{default:o(()=>e[84]||(e[84]=[f("文本")])),_:1,__:[84]}),a(U,{value:2},{default:o(()=>e[85]||(e[85]=[f("文件")])),_:1,__:[85]})]),_:1},8,["value"]),n(T).testValidateType===1?(p(),m("div",ao,[a(x,{type:"primary",onClick:n(Gt)},{default:o(()=>e[86]||(e[86]=[f("新增测试集")])),_:1,__:[86]},8,["onClick"]),a(x,{onClick:n(Wt)},{default:o(()=>e[87]||(e[87]=[f("一键删除测试用例")])),_:1,__:[87]},8,["onClick"])])):b("",!0)])]),_:1}),n(T).testValidateType===1&&n(T).testContent.length>0?(p(),m("div",so,[(p(!0),m(P,null,L(n(T).testContent,(l,g)=>(p(),m("div",{key:l.id,class:"test-case-item"},[a(El,{checked:l.select===1,onChange:F=>Ll(l,F.target.checked),class:"test-case-checkbox"},null,8,["checked","onChange"]),i("span",oo,"测试集"+C(g+1),1),a(pt,{value:l.arg,"onUpdate:value":F=>l.arg=F,placeholder:"请输入输入内容",class:"test-case-input","auto-size":{minRows:3}},null,8,["value","onUpdate:value"]),a(pt,{value:l.answer,"onUpdate:value":F=>l.answer=F,placeholder:"请输入期望输出",class:"test-case-output","auto-size":{minRows:3}},null,8,["value","onUpdate:value"]),a(n(_e),{class:"delete-test-case",onClick:F=>n(Jt)(l.id)},null,8,["onClick"])]))),128))])):b("",!0)]),_:1})])])]),_:1})):b("",!0)]),_:2},[n(Ie)&&n(H)==="questions"?{name:"tabBarExtraContent",fn:o(()=>[a(x,{type:"primary",onClick:Cl},{default:o(()=>[a(n(ht)),e[62]||(e[62]=f(" 新增题目 "))]),_:1,__:[62]})]),key:"0"}:void 0]),1032,["activeKey"]),n(H)!=="questions"?(p(),m("div",no,[n(h).taskId?b("",!0):(p(),w(x,{key:0,onClick:n(Ht)},{default:o(()=>e[89]||(e[89]=[f("重置")])),_:1,__:[89]},8,["onClick"])),a(x,{type:"primary",onClick:n(Dt)},{default:o(()=>[f(C(n(h).taskId?"更新":"保存"),1)]),_:1},8,["onClick"])])):b("",!0)])):(p(),m("div",io,[a(dt,{description:"请先添加任务关卡"})]))])])])])):b("",!0),I.value===3?(p(),m("div",ro,[We.value?(p(),m("div",uo,[i("div",co,[e[91]||(e[91]=i("h3",{class:"environment-title"},"实验环境",-1)),i("div",po,[a(x,{type:"primary",onClick:kl},{default:o(()=>e[90]||(e[90]=[f("添加实验环境")])),_:1,__:[90]})])]),a(V,{ref_key:"experimentFormRef",ref:ee,model:Ae.value,rules:Ut,"label-col":{span:4},"wrapper-col":{span:18}},{default:o(()=>[a(vt,{activeKey:M.value,"onUpdate:activeKey":e[36]||(e[36]=l=>M.value=l)},{default:o(()=>[(p(!0),m(P,null,L(R.value,l=>(p(),w(me,{key:l.id},{tab:o(()=>[i("div",vo,[l.isEditing?(p(),w(c,{key:0,value:K.value,"onUpdate:value":e[31]||(e[31]=g=>K.value=g),size:"small",style:{width:"120px"},onPressEnter:g=>nt(l),onBlur:g=>nt(l)},null,8,["value","onPressEnter","onBlur"])):(p(),m(P,{key:1},[i("span",{onDblclick:g=>ot(l)},C(l.name),41,fo),a(ut,{trigger:["click"]},{overlay:o(()=>[a(rt,null,{default:o(()=>[a(Z,{onClick:g=>ot(l)},{default:o(()=>[a(n(kt)),e[92]||(e[92]=f(" 重命名 "))]),_:2,__:[92]},1032,["onClick"]),a(Z,{onClick:g=>bl(l.id)},{default:o(()=>[a(n(_e)),e[93]||(e[93]=f(" 删除 "))]),_:2,__:[93]},1032,["onClick"])]),_:2},1024)]),default:o(()=>[a(n(Oa),{class:"tab-more-icon",onClick:e[32]||(e[32]=gt(()=>{},["stop"]))})]),_:2},1024)],64))])]),default:o(()=>[a(r,{label:"实验镜像",name:"dockerImage",required:""},{default:o(()=>[i("div",go," 系统实验镜像默认为"+C(ll())+"。 ",1)]),_:1}),a(r,{label:"实验界面",name:"viewTypes",required:""},{default:o(()=>[i("div",mo,[i("div",{class:O(["interface-card",{active:l.config.viewTypes.includes(1)}]),onClick:e[33]||(e[33]=g=>Se(1))},e[94]||(e[94]=[i("div",{class:"card-title"},"代码编辑器",-1),i("div",{class:"card-desc"},"提供代码编辑器，编辑器，调试器等工具",-1)]),2),i("div",{class:O(["interface-card",{active:l.config.viewTypes.includes(2)}]),onClick:e[34]||(e[34]=g=>Se(2))},e[95]||(e[95]=[i("div",{class:"card-title"},"命令行终端",-1),i("div",{class:"card-desc"},"提供命令行窗口",-1)]),2),i("div",{class:O(["interface-card",{active:l.config.viewTypes.includes(3)}]),onClick:e[35]||(e[35]=g=>Se(3))},e[96]||(e[96]=[i("div",{class:"card-title"},"容器内服务",-1),i("div",{class:"card-desc"},"直接预览容器内部Web服务",-1)]),2)])]),_:2},1024),a(r,{label:"任务关卡",name:"taskId",required:""},{default:o(()=>[a(y,{value:l.config.taskId,"onUpdate:value":g=>l.config.taskId=g,placeholder:"请选择任务关卡",allowClear:""},{default:o(()=>[(p(!0),m(P,null,L(Je.value,g=>(p(),w(Ee,{key:g.taskId||g.id,value:g.taskId?String(g.taskId):void 0,disabled:!g.taskId||st(l.id,g.taskId)},{default:o(()=>[f(C(g.name)+" ",1),g.taskId?st(l.id,g.taskId)?(p(),m("span",_o," (已被使用)")):b("",!0):(p(),m("span",yo," (未保存)"))]),_:2},1032,["value","disabled"]))),128))]),_:2},1032,["value","onUpdate:value"])]),_:2},1024),l.config.viewTypes.includes(1)?(p(),w(r,{key:0,label:"编程语言",name:"codeType",required:""},{default:o(()=>[a(y,{value:l.config.codeType?Number(l.config.codeType):void 0,onChange:g=>l.config.codeType=String(g),placeholder:"请选择编程语言",options:n(be).options.value,loading:n(be).loading.value,allowClear:""},null,8,["value","onChange","options","loading"])]),_:2},1024)):b("",!0),l.config.viewTypes.includes(2)?(p(),w(r,{key:1,label:"开启时触发命令",name:"shellBegin",required:""},{default:o(()=>[a(y,{value:l.config.shellBegin,"onUpdate:value":g=>l.config.shellBegin=g,placeholder:"请选择终端类型"},{default:o(()=>[a(Ee,{value:"bash"},{default:o(()=>e[97]||(e[97]=[f("bash")])),_:1,__:[97]}),a(Ee,{value:"sh"},{default:o(()=>e[98]||(e[98]=[f("sh")])),_:1,__:[98]})]),_:2},1032,["value","onUpdate:value"])]),_:2},1024)):b("",!0),l.config.viewTypes.includes(3)?(p(),w(r,{key:2,label:"容器端口",name:"containerPort",required:""},{default:o(()=>[a(c,{value:l.config.containerPort,"onUpdate:value":g=>l.config.containerPort=g,placeholder:"请输入容器端口"},null,8,["value","onUpdate:value"])]),_:2},1024)):b("",!0),l.config.viewTypes.includes(3)?(p(),w(r,{key:3,label:"路由"},{default:o(()=>[a(c,{value:l.config.containerPath,"onUpdate:value":g=>l.config.containerPath=g,placeholder:"请输入路由（选填）"},null,8,["value","onUpdate:value"])]),_:2},1024)):b("",!0),a(r,{"wrapper-col":{offset:4,span:18}},{default:o(()=>[a(x,{class:"w-full",type:"primary",onClick:g=>Pe(l)},{default:o(()=>[f(C(l.isSaved?"更新":"保存"),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["activeKey"])]),_:1},8,["model"])])):(p(),m("div",ho,e[99]||(e[99]=[i("div",{class:"no-env-content"},[i("div",{class:"no-env-badge"},"实验环境配置"),i("h3",null,"当前无编程任务，无需配置实验环境"),i("p",{class:"no-env-desc"}," 当你添加并保存编程任务后，可在此一步选择对应关卡并配置实验镜像、界面与端口。 "),i("p",{class:"no-env-hint"},"点击完成创建即可完成整个项目配置。")],-1)])))])):b("",!0),i("div",ko,[a(x,{onClick:_l},{default:o(()=>[f(C(I.value===0?"返回":"上一步"),1)]),_:1}),a(x,{type:"primary",loading:A.value,onClick:hl},{default:o(()=>[f(C(I.value===3?"完成":"下一步"),1)]),_:1},8,["loading"])])])]),_:1},8,["spinning"]),i("input",{ref_key:"fileUploadInput",ref:Ye,type:"file",style:{display:"none"},onChange:vl},null,544),a(ga,{open:Q.value,"onUpdate:open":e[37]||(e[37]=l=>Q.value=l),onConfirm:rl,onCancel:Xe},null,8,["open"]),a(ma,{open:ce.value,"onUpdate:open":e[38]||(e[38]=l=>ce.value=l),"parent-path":J.value,onConfirm:fl},null,8,["open","parent-path"]),a(ya,{open:pe.value,"onUpdate:open":e[39]||(e[39]=l=>pe.value=l),"parent-path":W.value,onConfirm:gl},null,8,["open","parent-path"]),a(_a,{open:ve.value,"onUpdate:open":e[40]||(e[40]=l=>ve.value=l),question:G.value,"project-id":S.value??void 0,"task-id":n(h).taskId,"existing-questions":n(de),onConfirm:xl},null,8,["open","question","project-id","task-id","existing-questions"]),a(_t,{open:qe.value,"onUpdate:open":e[41]||(e[41]=l=>qe.value=l),title:"选择学员任务文件","git-url":u.value.gitUrl,onConfirm:n(Kt)},null,8,["open","git-url","onConfirm"]),a(_t,{open:Fe.value,"onUpdate:open":e[42]||(e[42]=l=>Fe.value=l),title:"选择评测执行文件","git-url":u.value.gitUrl,onConfirm:n(Qt)},null,8,["open","git-url","onConfirm"])])}}}),Lo=Vl(bo,[["__scopeId","data-v-b9077601"]]);export{Lo as default};
