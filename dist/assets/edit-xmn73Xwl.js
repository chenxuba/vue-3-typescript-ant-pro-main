import{d as L,ak as K,am as W,f as d,w as Y,c as N,o as $,_ as b,a1 as k,$ as c,k as o,a7 as r,G as p,ac as H,F as q,a9 as E,u as I}from"./vue-PnzzEkKE.js";import{R as Q}from"./RichTextEditor-DE0ySZe4.js";import{g as X,a as Z}from"./dictionary-BtudliZb.js";import{e as ee,a as te}from"./index-BzdcU38b.js";import{a as ae,e as oe}from"./dictionary-B3T7Y7Sv.js";import{a1 as s,a7 as ne,a8 as re,K as se,z as le,I as ie,a6 as ue,ac as de,H as ce,Y as pe}from"./antd-Cme2pY03.js";import{_ as ve}from"./index-CRN7Cu29.js";const me={class:"edit-project-page"},fe={class:"page-content"},_e={class:"project-type-section"},ge={class:"project-type-desc"},ye={class:"project-form-section"},be={class:"form-title"},ke={key:0},Te={class:"page-footer"},je=L({name:"EditRainingProject",__name:"edit",setup(he){const g=K(),P=W(),v=d(),D=d(),j=d(!1),h=d(!1),w=d(!1),l=d(1),u=d(null),a=d({name:"",description:"",difficulty:void 0,environment:void 0,secondType:void 0,classHour:0,showTaskRequire:!0}),M={name:[{required:!0,message:"请输入名称",trigger:"blur"}],description:[{required:!0,validator:(t,e)=>{if(!e)return Promise.reject("请输入简介");const n=/<img\s+[^>]*src\s*=\s*["'][^"']+["'][^>]*>/i.test(e),m=e.replace(/<[^>]*>/g,"").trim();return!n&&!m?Promise.reject("请输入简介"):Promise.resolve()},trigger:"blur"}],difficulty:[{required:!0,message:"请选择难度",trigger:"change"}],environment:[{required:!0,message:"请选择实验环境",trigger:"change"}]},R=ae(),U=oe(),T=d({1:[],2:[],3:[]}),V=()=>(T.value[l.value]||[]).map(n=>({label:n.name,value:n.value})),C=async t=>{if(!(T.value[t].length>0))try{h.value=!0;const e=X(t);if(!e)return;const n=await Z({code:e});n&&n.list&&(T.value[t]=n.list)}catch{s.error("加载实验环境选项失败")}finally{h.value=!1}},B=async()=>{if(!v.value){s.error("缺少项目ID"),g.back();return}try{j.value=!0;const t=await ee({id:v.value});u.value=t,t.projectType&&(l.value=t.projectType,await C(t.projectType)),a.value={name:t.name||"",description:t.description||"",difficulty:t.difficulty||void 0,environment:t.environment||void 0,secondType:t.secondType||void 0,classHour:t.classHour?Number(t.classHour):0,showTaskRequire:t.showTaskRequire===1}}catch(t){s.error(t.message||"获取项目详情失败"),g.back()}finally{j.value=!1}},F=()=>{g.back()},J=async()=>{var m;try{await((m=D.value)==null?void 0:m.validate())}catch{return}if(!a.value.name){s.error("请输入名称");return}const t=a.value.description||"",e=/<img\s+[^>]*src\s*=\s*["'][^"']+["'][^>]*>/i.test(t),n=t.replace(/<[^>]*>/g,"").trim();if(!e&&!n){s.error("请输入简介");return}if(!a.value.difficulty){s.error("请选择难度");return}if(!a.value.environment){s.error("请选择实验环境");return}if(!v.value||!u.value){s.error("项目信息缺失");return}try{w.value=!0;const f={id:v.value,name:a.value.name,tag:u.value.tag||"",fieldType:a.value.secondType,difficulty:a.value.difficulty,classHour:a.value.classHour,topCover:u.value.topCover||"",cover:u.value.cover||"",description:a.value.description,showTaskRequire:a.value.showTaskRequire?1:2,authType:u.value.authType||1,enableCodeRepository:u.value.enableCodeRepository||!1,repositoryType:u.value.repositoryType||"",gitUrl:u.value.gitUrl||"",environment:a.value.environment};await te(f),s.success("保存成功");const y={1:"/dashboard/raining-project-management/edit-full-stack",2:"/dashboard/raining-project-management/edit-jupyter-notebook",3:"/dashboard/raining-project-management/edit-jupyter-lab"}[l.value];y?g.push({path:y,query:{id:v.value}}):s.error("未知的项目类型")}catch(f){s.error(f.message||"保存失败")}finally{w.value=!1}};Y(l,t=>{a.value.environment=void 0,a.value.secondType=void 0,a.value.showTaskRequire=!0,C(t)});const S=N(()=>({1:"全栈环境",2:"JupyterNotebook环境",3:"JupyterLab环境"})[l.value]||""),z=N(()=>{if(!a.value.environment)return"";const e=(T.value[l.value]||[]).find(n=>n.value===a.value.environment);return(e==null?void 0:e.name)||""});return $(()=>{R.load(),U.load();const t=P.query.id;t?(v.value=Number(t),B()):(s.error("缺少项目ID"),g.back())}),(t,e)=>{const n=re,m=ne,f=ie,_=le,y=ue,A=de,O=se,x=ce,G=pe;return k(),b("div",me,[e[12]||(e[12]=c("div",{class:"page-header"},[c("h2",null,"编辑实训项目")],-1)),o(G,{spinning:j.value},{default:r(()=>[c("div",fe,[c("div",_e,[o(m,{value:l.value,"onUpdate:value":e[0]||(e[0]=i=>l.value=i),class:"custom-radio",disabled:""},{default:r(()=>[o(n,{value:1},{default:r(()=>e[6]||(e[6]=[p("全栈环境实训项目")])),_:1,__:[6]}),o(n,{value:2},{default:r(()=>e[7]||(e[7]=[p("JupyterNotebook环境实训项目")])),_:1,__:[7]}),o(n,{value:3},{default:r(()=>e[8]||(e[8]=[p("JupyterLab环境实训项目")])),_:1,__:[8]})]),_:1},8,["value"])]),c("div",ge,[l.value===1?(k(),b(q,{key:0},[p(" 多功能新型实战项目模式，支持图形化桌面、Web IDE、命令行、提供仿真拟真等种实验场景，适用于各类复杂工程项目研发。 ")],64)):l.value===2?(k(),b(q,{key:1},[p(" 多功能实时交互实验模式，支持实时代码、数学方程、可视化和MarkDown等。 适用于数据清理、数值模拟、统计建模、机器学习等系列实验。 ")],64)):l.value===3?(k(),b(q,{key:2},[p(" 多功能实时交互实验模式，支持实时代码、数学方程、可视化和MarkDown等。 适用于数据清理、数值模拟、统计建模、机器学习等系列实验。 ")],64)):H("",!0)]),c("div",ye,[c("div",be,[p(E(S.value)+"实训项目 ",1),a.value.environment?(k(),b("span",ke," 实验环境: "+E(z.value),1)):H("",!0)]),o(O,{ref_key:"formRef",ref:D,model:a.value,rules:M,layout:"horizontal","label-col":{span:3},"wrapper-col":{span:18}},{default:r(()=>[o(_,{label:"名称",name:"name",required:""},{default:r(()=>[o(f,{value:a.value.name,"onUpdate:value":e[1]||(e[1]=i=>a.value.name=i),placeholder:"请输入名称"},null,8,["value"])]),_:1}),o(_,{label:"简介",name:"description",required:""},{default:r(()=>[o(Q,{modelValue:a.value.description,"onUpdate:modelValue":e[2]||(e[2]=i=>a.value.description=i),placeholder:"请输入简介内容",height:200},null,8,["modelValue"])]),_:1}),o(_,{label:"难度",name:"difficulty",required:""},{default:r(()=>[o(y,{value:a.value.difficulty,"onUpdate:value":e[3]||(e[3]=i=>a.value.difficulty=i),placeholder:"请选择难度",options:I(R).options.value,loading:I(R).loading.value},null,8,["value","options","loading"])]),_:1}),o(_,{label:"实验环境",name:"environment",required:""},{default:r(()=>[o(y,{value:a.value.environment,"onUpdate:value":e[4]||(e[4]=i=>a.value.environment=i),placeholder:"请选择实验环境",options:V(),loading:h.value},null,8,["value","options","loading"])]),_:1}),o(_,{label:"学时",name:"classHour"},{default:r(()=>[o(A,{min:0,class:"w-full",value:a.value.classHour,"onUpdate:value":e[5]||(e[5]=i=>a.value.classHour=i),disabled:"",placeholder:"配置任务后自动计算"},null,8,["value"]),e[9]||(e[9]=c("div",{style:{"font-size":"12px",color:"#999","margin-top":"4px"}}," 此学时为关卡总计学时，无需填写，系统自动计算。 ",-1))]),_:1,__:[9]})]),_:1},8,["model"])]),c("div",Te,[o(x,{onClick:F},{default:r(()=>e[10]||(e[10]=[p("返回")])),_:1,__:[10]}),o(x,{type:"primary",loading:w.value,onClick:J},{default:r(()=>e[11]||(e[11]=[p("下一步")])),_:1,__:[11]},8,["loading"])])])]),_:1},8,["spinning"])])}}}),Ee=ve(je,[["__scopeId","data-v-db372ef7"]]);export{Ee as default};
