import{g as P}from"./organization-z6d53rTq.js";import{aq as G,ar as J,U as R,as as q,ak as A,at as F,t as $,an as j,au as H,av as Q,aa as N}from"./antd-Du2BR_SQ.js";import{d as W,f as v,w as X,o as Y,a0 as f,a3 as m,a1 as l,k as i,u as E,a9 as u,af as Z,ac as _,G as g}from"./vue-CLfcZxUN.js";import{_ as ee}from"./index-BNgW0Kx4.js";const te={class:"organization-management"},ae={class:"content-wrapper"},se={class:"left-panel"},ne={class:"panel-header"},le={class:"header-title"},oe={class:"title-icon"},ie={class:"search-box"},re={key:0,class:"loading-container"},ce={key:1,class:"empty-search"},de={key:2,class:"tree-container"},ue={key:0,class:"search-result-tip"},pe={class:"ml-6px"},_e={class:"tree-node-title"},he={class:"node-name"},ve={class:"panel-footer"},fe={class:"stats-info"},me={class:"stat-item"},ge={class:"stat-value"},ye={class:"right-panel"},Ce={key:0,class:"detail-content"},Ie={key:1,class:"empty-content"},be=W({name:"OrganizationManagement",__name:"organization-management",setup(xe){const c=v([]),b=v([]),p=v(null),C=v([]),x=v([]),I=v(""),M=v(!1),O=t=>{const e=[],n=a=>{a.forEach(s=>{s.id&&e.push(s.id),s.children&&s.children.length>0&&n(s.children)})};return n(t),e},k=t=>JSON.parse(JSON.stringify(t)),L=(t,e)=>{if(!e)return k(t);const n=[];return t.forEach(a=>{var o,y;const s={...a},d=(o=a.name)==null?void 0:o.toLowerCase().includes(e.toLowerCase()),h=(y=a.code)==null?void 0:y.toLowerCase().includes(e.toLowerCase());if(a.children&&a.children.length>0){const r=L(a.children,e);r.length>0?(s.children=r,n.push(s)):(d||h)&&(delete s.children,n.push(s))}else(d||h)&&n.push(s)}),n},V=(t,e)=>{if(!e)return[];const n=[],a=(s,d=[])=>{let h=!1;return s.forEach(o=>{var T,z;const y=(T=o.name)==null?void 0:T.toLowerCase().includes(e.toLowerCase()),r=(z=o.code)==null?void 0:z.toLowerCase().includes(e.toLowerCase()),S=[...d,o.id];let D=!1;o.children&&o.children.length>0&&(D=a(o.children,S)),(y||r||D)&&(n.push(...S),h=!0)}),h};return a(t),[...new Set(n)]},K=t=>({id:t.orgID,name:t.orgName,code:t.orgCode,parentId:t.parentOrgID||null,parentName:t.parentOrgName,isActive:t.status===1,order:t.sortID,isIndependentTraining:t.isOrg===1,isVirtual:t.isVirOrg===1}),w=t=>{const e=new Map,n=[];return t.forEach(a=>{e.set(a.id,{...a,children:[]})}),t.forEach(a=>{const s=e.get(a.id);if(s)if(a.parentId&&e.has(a.parentId)){const d=e.get(a.parentId);d&&(d.children||(d.children=[]),d.children.push(s))}else n.push(s)}),n};X(I,t=>{if(!t||t.trim()==="")c.value=k(b.value),C.value=O(c.value);else{const e=t.trim();c.value=L(b.value,e),C.value=V(b.value,e)}});const U=async()=>{try{M.value=!0;const t=await P({limit:1e4,page:1,startNum:0,orderbyFiled:"orgCode:asc"});if(t&&t.data&&t.data.list){const e=t.data.list.map(K),n=w(e);b.value=k(n),c.value=k(n),C.value=O(c.value),c.value.length>0&&(x.value=[c.value[0].id],p.value=c.value[0]),N.success(`成功加载 ${e.length} 个组织`)}else N.warning("未获取到组织数据")}catch(t){console.error("获取组织列表失败:",t),N.error("获取组织列表失败，请稍后重试")}finally{M.value=!1}},B=(t,e)=>{t.length>0&&(x.value=t,p.value=e.node)};return Y(()=>{U()}),(t,e)=>{const n=R,a=q,s=A,d=$,h=j,o=H,y=Q;return m(),f("div",te,[l("div",ae,[l("div",se,[l("div",ne,[l("div",le,[l("div",oe,[i(E(G))]),e[3]||(e[3]=l("span",{class:"title-text"}," 组织架构 ",-1))])]),l("div",ie,[i(n,{value:I.value,"onUpdate:value":e[0]||(e[0]=r=>I.value=r),placeholder:"搜索组织名称...","allow-clear":"",class:"modern-search",disabled:M.value},{prefix:u(()=>[i(E(J))]),_:1},8,["value","disabled"])]),M.value?(m(),f("div",re,[i(a,{size:"large",tip:"加载中..."})])):I.value&&c.value.length===0?(m(),f("div",ce,[i(s,{description:"未找到匹配的组织",image:E(A).PRESENTED_IMAGE_SIMPLE},null,8,["image"])])):(m(),f("div",de,[I.value?(m(),f("div",ue,[i(E(F)),l("span",pe,"搜索到 "+_(O(c.value).length)+" 个匹配结果",1)])):Z("",!0),i(h,{"expanded-keys":C.value,"onUpdate:expandedKeys":e[1]||(e[1]=r=>C.value=r),"selected-keys":x.value,"onUpdate:selectedKeys":e[2]||(e[2]=r=>x.value=r),"tree-data":c.value,"field-names":{title:"name",key:"id",children:"children"},"show-line":"",onSelect:B},{title:u(({name:r})=>[i(d,{title:r,placement:"topLeft"},{default:u(()=>[l("div",_e,[l("span",he,_(r),1)])]),_:2},1032,["title"])]),_:1},8,["expanded-keys","selected-keys","tree-data"])])),l("div",ve,[l("div",fe,[l("div",me,[e[4]||(e[4]=l("span",{class:"stat-label"},"总数",-1)),l("span",ge,_(O(c.value).length),1)])])])]),l("div",ye,[e[5]||(e[5]=l("div",{class:"detail-header"},[l("h3",null,"基本信息")],-1)),p.value?(m(),f("div",Ce,[i(y,{bordered:"",column:1},{default:u(()=>[i(o,{label:"单位名称"},{default:u(()=>[g(_(p.value.name),1)]),_:1}),i(o,{label:"单位编号"},{default:u(()=>[g(_(p.value.code),1)]),_:1}),i(o,{label:"上级单位名称"},{default:u(()=>[g(_(p.value.parentName||"-"),1)]),_:1}),i(o,{label:"是否有效"},{default:u(()=>[g(_(p.value.isActive?"是":"否"),1)]),_:1}),i(o,{label:"序号"},{default:u(()=>[g(_(p.value.order||"-"),1)]),_:1}),i(o,{label:"是否独立组织培训机构"},{default:u(()=>[g(_(p.value.isIndependentTraining?"是":"否"),1)]),_:1}),i(o,{label:"是否虚拟组织机构"},{default:u(()=>[g(_(p.value.isVirtual?"是":"否"),1)]),_:1})]),_:1})])):(m(),f("div",Ie,[i(s,{description:"请在左侧选择组织"})]))])])])}}}),Ne=ee(be,[["__scopeId","data-v-87a5322d"]]);export{Ne as default};
