import{g as Z}from"./personnel-Dmpes5vC.js";import{g as ee}from"./organization-Cgbh5m4g.js";import{ap as te,an as ae,I as se,ag as ne,a8 as V,aq as oe,af as le,aj as ie,z as re,S as ce,H as de,K as ue,ac as pe,al as _e,ae as f}from"./antd-Drh1eHWx.js";import{d as he,f as _,r as me,w as ge,o as ve,_ as m,a1 as p,$ as s,k as i,u as T,a7 as c,ac as B,a9 as g,G as M,a6 as $}from"./vue-PnzzEkKE.js";import{_ as fe}from"./index-L25N5W2M.js";const ye={class:"personnel-management"},ke={class:"content-wrapper"},Ne={class:"left-panel"},Ie={class:"panel-header"},xe={class:"header-title"},Ce={class:"title-icon"},be={class:"search-box"},we={key:0,class:"loading-container"},Se={key:1,class:"empty-search"},Ee={key:2,class:"tree-container"},De={key:0,class:"search-result-tip"},Oe={class:"ml-6px"},ze={class:"tree-node-title"},Le={class:"node-name"},Te={class:"panel-footer"},Me={class:"stats-info"},Ae={class:"stat-item"},Pe={class:"stat-value"},Ue={class:"right-panel"},Fe={class:"query-form"},Ke={class:"table-header"},Ve={class:"table-info"},Be={class:"info-value"},$e={class:"table-container"},qe={key:0,class:"user-link"},Je={key:1},Re={key:2},Ge={key:3},Qe=he({name:"PersonnelManagement",__name:"personnel-management",setup(je){const h=_([]),b=_([]),q=_(null),I=_([]),A=_([]),x=_(""),w=_(!1),n=me({userID:"",operatorName:"",orgName:"",page:1,pageSize:10,orderbyFiled:"createTime:desc"}),P=_(!1),F=_([]),U=_(0),J=[{title:"用户编号",dataIndex:"operatorID",key:"operatorID",width:160},{title:"用户昵称",dataIndex:"operatorName",key:"operatorName",width:140},{title:"单位",dataIndex:"orgName",key:"orgName",width:200,ellipsis:!0},{title:"是否管理人",dataIndex:"isAdmin",key:"isAdmin",width:120},{title:"手机号",dataIndex:"mobileNO",key:"mobileNO",width:140},{title:"邮箱",dataIndex:"oEmail",key:"oEmail",width:200,ellipsis:!0},{title:"状态",dataIndex:"status",key:"status",width:100},{title:"操作",key:"action",width:150,fixed:"right"}],S=t=>{const e=[],o=l=>{l.forEach(r=>{r.id&&e.push(r.id),r.children&&r.children.length>0&&o(r.children)})};return o(t),e},E=t=>JSON.parse(JSON.stringify(t)),K=(t,e)=>{if(!e)return E(t);const o=[];return t.forEach(l=>{var d,v;const r={...l},u=(d=l.name)==null?void 0:d.toLowerCase().includes(e.toLowerCase()),y=(v=l.code)==null?void 0:v.toLowerCase().includes(e.toLowerCase());if(l.children&&l.children.length>0){const k=K(l.children,e);k.length>0?(r.children=k,o.push(r)):(u||y)&&(delete r.children,o.push(r))}else(u||y)&&o.push(r)}),o},R=(t,e)=>{if(!e)return[];const o=[],l=(r,u=[])=>{let y=!1;return r.forEach(d=>{var L,a;const v=(L=d.name)==null?void 0:L.toLowerCase().includes(e.toLowerCase()),k=(a=d.code)==null?void 0:a.toLowerCase().includes(e.toLowerCase()),O=[...u,d.id];let z=!1;d.children&&d.children.length>0&&(z=l(d.children,O)),(v||k||z)&&(o.push(...O),y=!0)}),y};return l(t),[...new Set(o)]};ge(x,t=>{if(!t||t.trim()==="")h.value=E(b.value),I.value=S(h.value);else{const e=t.trim();h.value=K(b.value,e),I.value=R(b.value,e)}});const G=t=>({id:t.orgID,name:t.orgName,code:t.orgCode,parentId:t.parentOrgID||null,parentName:t.parentOrgName,isActive:t.status===1,order:t.sortID,isIndependentTraining:t.isOrg===1,isVirtual:t.isVirOrg===1}),Q=t=>{const e=new Map,o=[];return t.forEach(l=>{e.set(l.id,{...l,children:[]})}),t.forEach(l=>{const r=e.get(l.id);if(r)if(l.parentId&&e.has(l.parentId)){const u=e.get(l.parentId);u&&(u.children||(u.children=[]),u.children.push(r))}else o.push(r)}),o},j=async()=>{try{w.value=!0;const t=await ee({limit:1e4,page:1,startNum:0,orderbyFiled:"orgCode:asc"});if(t&&t.data&&t.data.list){const e=t.data.list.map(G),o=Q(e);b.value=E(o),h.value=E(o),I.value=S(h.value),f.success(`成功加载 ${e.length} 个组织`)}else f.warning("未获取到组织数据")}catch(t){console.error("获取组织列表失败:",t),f.error("获取组织列表失败，请稍后重试")}finally{w.value=!1}},H=(t,e)=>{t.length>0&&(A.value=t,q.value=e.node,n.orgName=e.node.name||"",C())},D=async()=>{P.value=!0;try{const t={limit:n.pageSize,page:n.page,startNum:(n.page-1)*n.pageSize,orderbyFiled:n.orderbyFiled},e=await Z(t);console.log(e),e.result===1&&e.data?(F.value=e.data.list,U.value=e.data.total,f.success(`成功加载 ${e.data.list.length} 条用户数据`)):f.error(e.msg||"获取用户列表失败")}catch(t){console.error("获取全量用户列表失败:",t),f.error("获取用户列表失败，请稍后重试")}finally{P.value=!1}},C=()=>{n.page=1,D()},W=()=>{n.userID="",n.operatorName="",n.orgName="",n.page=1,n.pageSize=10,D()},X=async t=>{try{const e=t.status===1?0:1;t.status=e,f.success(e===1?"启用成功":"禁用成功")}catch{f.error("操作失败")}},Y=t=>{n.page=t.current,n.pageSize=t.pageSize,D()};return ve(()=>{j(),D()}),(t,e)=>{const o=se,l=ne,r=V,u=le,y=ie,d=re,v=de,k=ce,O=ue,z=pe,L=_e;return p(),m("div",ye,[s("div",ke,[s("div",Ne,[s("div",Ie,[s("div",xe,[s("div",Ce,[i(T(te))]),e[6]||(e[6]=s("span",{class:"title-text"}," 组织架构 ",-1))])]),s("div",be,[i(o,{value:x.value,"onUpdate:value":e[0]||(e[0]=a=>x.value=a),placeholder:"搜索组织名称...","allow-clear":"",class:"modern-search",disabled:w.value},{prefix:c(()=>[i(T(ae))]),_:1},8,["value","disabled"])]),w.value?(p(),m("div",we,[i(l,{size:"large",tip:"加载中..."})])):x.value&&h.value.length===0?(p(),m("div",Se,[i(r,{description:"未找到匹配的组织",image:T(V).PRESENTED_IMAGE_SIMPLE},null,8,["image"])])):(p(),m("div",Ee,[x.value?(p(),m("div",De,[i(T(oe)),s("span",Oe,"搜索到 "+g(S(h.value).length)+" 个匹配结果",1)])):B("",!0),i(y,{"expanded-keys":I.value,"onUpdate:expandedKeys":e[1]||(e[1]=a=>I.value=a),"selected-keys":A.value,"onUpdate:selectedKeys":e[2]||(e[2]=a=>A.value=a),"tree-data":h.value,"field-names":{title:"name",key:"id",children:"children"},"show-line":"",onSelect:H},{title:c(({name:a})=>[i(u,{title:a,placement:"topLeft"},{default:c(()=>[s("div",ze,[s("span",Le,g(a),1)])]),_:2},1032,["title"])]),_:1},8,["expanded-keys","selected-keys","tree-data"])])),s("div",Te,[s("div",Me,[s("div",Ae,[e[7]||(e[7]=s("span",{class:"stat-label"},"总数",-1)),s("span",Pe,g(S(h.value).length),1)])])])]),s("div",Ue,[e[13]||(e[13]=s("div",{class:"query-header"},[s("h3",null,"筛选查询")],-1)),s("div",Fe,[i(O,{layout:"inline"},{default:c(()=>[i(d,{label:"用户ID"},{default:c(()=>[i(o,{value:n.userID,"onUpdate:value":e[3]||(e[3]=a=>n.userID=a),placeholder:"请输入","allow-clear":"",style:{width:"180px"},onPressEnter:C},null,8,["value"])]),_:1}),i(d,{label:"姓名"},{default:c(()=>[i(o,{value:n.operatorName,"onUpdate:value":e[4]||(e[4]=a=>n.operatorName=a),placeholder:"请输入","allow-clear":"",style:{width:"180px"},onPressEnter:C},null,8,["value"])]),_:1}),i(d,{label:"组织名称"},{default:c(()=>[i(o,{value:n.orgName,"onUpdate:value":e[5]||(e[5]=a=>n.orgName=a),placeholder:"请输入","allow-clear":"",style:{width:"200px"},onPressEnter:C},null,8,["value"])]),_:1}),i(d,null,{default:c(()=>[i(k,null,{default:c(()=>[i(v,{type:"primary",onClick:C},{default:c(()=>e[8]||(e[8]=[M(" 查询 ")])),_:1,__:[8]}),i(v,{onClick:W},{default:c(()=>e[9]||(e[9]=[M(" 重置 ")])),_:1,__:[9]})]),_:1})]),_:1})]),_:1})]),s("div",Ke,[s("div",Ve,[e[10]||(e[10]=s("span",{class:"info-label"},"数据列表",-1)),e[11]||(e[11]=s("span",{class:"info-divider"},"数据共",-1)),s("span",Be,g(U.value),1),e[12]||(e[12]=s("span",{class:"info-unit"},"条",-1))])]),s("div",$e,[i(L,{columns:J,"data-source":F.value,loading:P.value,pagination:{current:n.page,pageSize:n.pageSize,total:U.value,showSizeChanger:!0,showQuickJumper:!0,showTotal:a=>`共 ${a} 条`},scroll:{x:1400},"row-key":"operatorID",onChange:Y},{bodyCell:c(({column:a,record:N})=>[a.key==="operatorName"?(p(),m("a",qe,g(N.operatorName),1)):a.key==="isAdmin"?(p(),m("span",Je,"-")):a.key==="mobileNO"?(p(),m("span",Re,g(N.mobileNO||"-"),1)):a.key==="oEmail"?(p(),m("span",Ge,g(N.oEmail||"-"),1)):a.key==="status"?(p(),$(z,{key:4,color:N.status===1?"green":"red"},{default:c(()=>[M(g(N.status===1?"启用":"禁用"),1)]),_:2},1032,["color"])):a.key==="action"?(p(),$(k,{key:5},{default:c(()=>[i(v,{type:"link",size:"small",onClick:He=>X(N)},{default:c(()=>[M(g(N.status===1?"禁用":"启用"),1)]),_:2},1032,["onClick"])]),_:2},1024)):B("",!0)]),_:1},8,["data-source","loading","pagination"])])])])])}}}),tt=fe(Qe,[["__scopeId","data-v-f0373834"]]);export{tt as default};
