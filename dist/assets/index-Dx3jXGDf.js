import{d as Z,ak as ee,f as g,c as L,o as te,_,a1 as m,$ as n,k as o,a7 as c,G as f,a9 as h,a6 as ae,ac as ne,F as k,ab as M}from"./vue-PnzzEkKE.js";import{n as oe,a as se,o as ie}from"./index-CCqIRe_t.js";import{a as le}from"./dictionary-DuOUJmgT.js";import{g as ce}from"./organization-ITXqn1XC.js";import{a4 as re,a5 as ue,z as pe,I as ve,a6 as me,H as _e,K as de,aj as ge,x as he,an as ke,a1 as C,M as D}from"./antd-Cme2pY03.js";import{_ as ye}from"./index-Ce1Nr6w0.js";const fe={class:"raining-project-management"},Ce={class:"search-section"},be={class:"table-section"},ze={class:"table-header"},Te={class:"table-tabs"},Ne={class:"tabs-left"},je={class:"data-count"},$e={class:"tabs-right"},Se={key:4,class:"public-scope-cell"},we={key:5,class:"action-links"},xe=["onClick"],Ie=["onClick"],Oe=["onClick"],Pe=["onClick"],Ae=["onClick"],Ee=["onClick"],Le=["onClick"],Me=["onClick"],De=["onClick"],Fe=["onClick"],Be=["onClick"],qe=["onClick"],Re=Z({name:"RainingProjectManagement",__name:"index",setup(Ue){const N=ee(),b=g([]),j=g([]),z=g(!1),F=async()=>{try{const t=["project#environment_1","project#environment_2","project#environment_3"],e=await Promise.all(t.map(s=>le({code:s}))),r=[];e.forEach(s=>{s&&s.list&&r.push(...s.list)});const p=new Map;r.forEach(s=>{p.has(s.value)||p.set(s.value,s)}),b.value=Array.from(p.values())}catch(t){console.error("获取环境字典失败：",t),b.value=[]}},A=async(t="")=>{z.value=!0;try{const e=await ce({limit:50,page:1,startNum:0,orderbyFiled:"orgCode:asc",orgName:t||void 0});e&&e.data&&e.data.list&&(j.value=e.data.list)}catch(e){console.error("获取组织列表失败：",e),j.value=[]}finally{z.value=!1}};let $=null;const B=t=>{$&&clearTimeout($),$=setTimeout(()=>{A(t)},300)},q=t=>{if(!t&&t!==0)return"-";const e=String(t),r=b.value.find(p=>p.value===e);return r?r.name:"-"},u=g({projectName:"",environment:void 0,organizer:void 0}),R=L(()=>b.value.map(t=>({label:t.name,value:t.value}))),U=L(()=>{const t=new Map;return j.value.forEach(e=>{e.orgName&&!t.has(e.orgName)&&t.set(e.orgName,e.orgName)}),Array.from(t.values()).sort().map(e=>({label:e,value:e}))}),i=g({current:1,pageSize:10,total:0}),G=[{title:"项目名称",dataIndex:"projectName",key:"projectName"},{title:"实验环境",dataIndex:"environment",key:"environment"},{title:"技能标签",dataIndex:"skillTag",key:"skillTag",ellipsis:!0},{title:"主办单位",dataIndex:"organizer",key:"organizer"},{title:"公开范围",dataIndex:"publicScope",key:"publicScope"},{title:"操作",key:"action",width:280}],T=g([]),S=g(!1),y=async()=>{S.value=!0;try{const t={page:i.value.current,limit:i.value.pageSize,startNum:(i.value.current-1)*i.value.pageSize,name:u.value.projectName||void 0,orgName:u.value.organizer||void 0,environment:u.value.environment||void 0,orderbyFiled:"createTime:desc"},e=await oe(t);T.value=e.list,i.value.total=e.count}catch(t){C.error(t.message||"获取项目列表失败"),T.value=[],i.value.total=0}finally{S.value=!1}},V=t=>{i.value.current=t.current,i.value.pageSize=t.pageSize,y()},H=()=>{u.value={projectName:"",environment:void 0,organizer:void 0},i.value.current=1,y()},J=()=>{i.value.current=1,y()};te(()=>{F(),A(),y()});const K=()=>{N.push("/dashboard/raining-project-management/create")},w=t=>{N.push({path:"/dashboard/raining-project-management/statistics",query:{id:t.id,name:t.name}})},x=t=>{const e=t.status===10,r=e?"取消发布":"发布",p=e?2:10;D.confirm({title:`确认${r}`,content:`确定要${r}项目"${t.name}"吗？`,okText:"确认",cancelText:"取消",onOk:async()=>{try{await se({id:t.id,status:p}),C.success(`${r}成功`),y()}catch(s){console.error(`${r}失败：`,s),C.error(s.message||`${r}失败`)}}})},I=t=>{N.push({path:"/dashboard/raining-project-management/edit",query:{id:t.id}})},O=t=>{D.confirm({title:"确认删除",content:`确定要删除项目"${t.name}"吗？删除后数据将无法恢复！`,okText:"确认删除",okType:"danger",cancelText:"取消",onOk:async()=>{try{await ie({id:t.id}),C.success("删除成功"),T.value.length===1&&i.value.current>1&&(i.value.current-=1),y()}catch(e){console.error("删除失败：",e),C.error(e.message||"删除失败")}}})};return(t,e)=>{const r=ve,p=pe,s=ue,E=me,P=_e,Q=re,W=de,X=ge,d=he,Y=ke;return m(),_("div",fe,[n("div",Ce,[e[5]||(e[5]=n("h3",{class:"section-title"},"筛选查询",-1)),o(W,{model:u.value,layout:"horizontal",class:"search-form"},{default:c(()=>[o(Q,{gutter:24},{default:c(()=>[o(s,{span:6},{default:c(()=>[o(p,{label:"项目名称：",name:"projectName"},{default:c(()=>[o(r,{value:u.value.projectName,"onUpdate:value":e[0]||(e[0]=l=>u.value.projectName=l),placeholder:"请输入项目名称"},null,8,["value"])]),_:1})]),_:1}),o(s,{span:6},{default:c(()=>[o(p,{label:"实验环境：",name:"environment"},{default:c(()=>[o(E,{value:u.value.environment,"onUpdate:value":e[1]||(e[1]=l=>u.value.environment=l),placeholder:"请选择实验环境",options:R.value,"allow-clear":""},null,8,["value","options"])]),_:1})]),_:1}),o(s,{span:6},{default:c(()=>[o(p,{label:"主办单位：",name:"organizer"},{default:c(()=>[o(E,{value:u.value.organizer,"onUpdate:value":e[2]||(e[2]=l=>u.value.organizer=l),placeholder:"请输入主办单位名称搜索",options:U.value,"allow-clear":"","show-search":"","filter-option":!1,loading:z.value,"not-found-content":z.value?"加载中...":"暂无数据",onSearch:B},null,8,["value","options","loading","not-found-content"])]),_:1})]),_:1}),o(s,{span:6,class:"form-actions"},{default:c(()=>[o(P,{type:"primary",onClick:J},{default:c(()=>e[3]||(e[3]=[f("查询")])),_:1,__:[3]}),o(P,{onClick:H},{default:c(()=>e[4]||(e[4]=[f("重置")])),_:1,__:[4]})]),_:1})]),_:1})]),_:1},8,["model"])]),n("div",be,[n("div",ze,[n("div",Te,[n("div",Ne,[e[6]||(e[6]=n("span",{class:"tab-item active"},"数据列表",-1)),n("span",je,"数据共 "+h(i.value.total)+" 条",1)]),n("div",$e,[o(P,{type:"primary",onClick:K},{default:c(()=>e[7]||(e[7]=[f("新建项目")])),_:1,__:[7]})])])]),o(Y,{columns:G,"data-source":T.value,loading:S.value,"row-key":l=>l.id,pagination:{current:i.value.current,pageSize:i.value.pageSize,total:i.value.total,showSizeChanger:!0,showQuickJumper:!0,showTotal:l=>`共 ${l} 条`},onChange:V,bordered:""},{bodyCell:c(({column:l,record:a})=>[l.key==="projectName"?(m(),_(k,{key:0},[f(h(a.name),1)],64)):l.key==="environment"?(m(),_(k,{key:1},[f(h(q(a.environment)),1)],64)):l.key==="skillTag"?(m(),ae(X,{key:2,title:a.tag,placement:"topLeft"},{default:c(()=>[n("span",null,h(a.tag),1)]),_:2},1032,["title"])):l.key==="organizer"?(m(),_(k,{key:3},[f(h(a.orgName||"-"),1)],64)):l.key==="publicScope"?(m(),_("div",Se,[n("div",{class:M(["status-badge",{"status-published":a.status===10,"status-unpublished":a.status!==10}])},h(a.status===10?"已发布":a.status===2?"已取消发布":(a.status===1,"已中断")),3),n("div",{class:M(["scope-badge",{"scope-full":a.authType===1,"scope-academy":a.authType===2,"scope-unit":a.authType===3,"scope-private":a.authType===4}])},h(a.authType===1?"完全公开":a.authType===2?"全院公开":a.authType===3?"本单位公开":a.authType===4?"不公开":"-"),3)])):l.key==="action"?(m(),_("div",we,[a.status===1?(m(),_(k,{key:0},[n("a",{onClick:v=>I(a)},"编辑",8,xe),o(d,{type:"vertical"}),n("a",{class:"danger-link",onClick:v=>O(a)},"删除",8,Ie)],64)):a.status===10?(m(),_(k,{key:1},[n("a",{onClick:v=>w(a)},"统计",8,Oe),o(d,{type:"vertical"}),n("a",{onClick:v=>x(a)},"取消发布",8,Pe)],64)):a.status===2?(m(),_(k,{key:2},[n("a",{onClick:v=>w(a)},"统计",8,Ae),o(d,{type:"vertical"}),n("a",{onClick:v=>x(a)},"发布",8,Ee),o(d,{type:"vertical"}),n("a",{onClick:v=>I(a)},"编辑",8,Le),o(d,{type:"vertical"}),n("a",{class:"danger-link",onClick:v=>O(a)},"删除",8,Me)],64)):(m(),_(k,{key:3},[n("a",{onClick:v=>w(a)},"统计",8,De),o(d,{type:"vertical"}),n("a",{onClick:v=>x(a)},"发布",8,Fe),o(d,{type:"vertical"}),n("a",{onClick:v=>I(a)},"编辑",8,Be),o(d,{type:"vertical"}),n("a",{class:"danger-link",onClick:v=>O(a)},"删除",8,qe)],64))])):ne("",!0)]),_:1},8,["data-source","loading","row-key","pagination"])])])}}}),We=ye(Re,[["__scopeId","data-v-1047d681"]]);export{We as default};
