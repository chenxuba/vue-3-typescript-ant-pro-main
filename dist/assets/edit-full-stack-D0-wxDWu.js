const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./antd-Cme2pY03.js","./vue-PnzzEkKE.js"])))=>i.map(i=>d[i]);
import{m as El,_ as Ml}from"./index-BIFaRxaG.js";import{d as $l,ak as jl,am as Vl,f as h,c as ct,w as Bl,o as Al,_ as m,a1 as p,$ as i,k as a,a7 as s,ac as T,u as n,F,ag as N,a6 as b,G as f,a9 as I,H as pt,ab as O,B as vt,ae as Dl,y as Le}from"./vue-PnzzEkKE.js";import{R as Ee,u as ft,g as gt,a as Hl,d as Ol,s as zl,c as Kl}from"./RichTextEditor-Cz6mCNpY.js";import{e as Ql,a as Gl,u as mt,f as Jl}from"./index-C2nOwYy5.js";import{u as Wl,a as Yl,b as Zl,c as Xl}from"./dictionary-BYhlHAuH.js";import{H as E,j as ea,t as ta,x as Me,c as la,a as aa,m as oa,F as yt}from"./FileSelectModal-Cfes7IOp.js";import{u as sa,a as na,F as ia,b as ra,R as ua,N as da,c as ca,Q as pa}from"./useTaskLevel-Ca6wWhuO.js";import{a1 as v,a3 as va,a2 as fa,K as ga,z as ma,I as ya,a4 as _a,a5 as ha,a6 as ka,a7 as Ta,a8 as wa,a9 as ba,H as Ca,J as Ua,aa as Ia,D as xa,ab as _t,f as Ra,e as Pa,af as me,T as qa,s as Fa,ac as Sa,ad as Na,ae as La,Z as ht,ag as Ea,ah as Ma,ai as $a,u as ja,Y as Va}from"./antd-Cme2pY03.js";import"./dictionary-D9nyuFW2.js";const Ba={class:"edit-full-stack-page"},Aa={class:"page-content"},Da={class:"steps-container"},Ha={key:0},Oa={class:"form-section"},za={class:"flex items-top gap-16px"},Ka={class:"flex flex-col gap-12px"},Qa={key:0,class:"image-preview"},Ga=["src"],Ja={class:"flex items-top gap-16px"},Wa={class:"flex flex-col gap-12px"},Ya={key:0,class:"image-preview"},Za=["src"],Xa={class:"form-section"},eo={key:1},to={class:"form-section repository-section"},lo={class:"repository-top-bar flex items-center gap-16px justify-between"},ao={class:"repository-url-group"},oo={class:"repository-main-area"},so={class:"repository-left"},no={class:"repository-switch-box flex items-center justify-between"},io={class:"flex items-center gap-12px"},ro={key:1,class:"repository-tips"},uo={class:"repository-right"},co={key:1,class:"empty-area"},po={key:2},vo={class:"task-level-section"},fo={class:"task-level-header"},go={class:"header-buttons"},mo={class:"task-level-main"},yo={class:"task-level-list"},_o={class:"list-title"},ho={class:"list-items"},ko=["onClick"],To={class:"item-name"},wo={class:"task-level-detail"},bo={key:0,class:"detail-content"},Co={key:0,class:"questions-content"},Uo={key:1,class:"questions-list"},Io=["onDragstart","onDrop"],xo={class:"question-header"},Ro={class:"question-number-with-drag"},Po={class:"question-number"},qo={class:"action-icons"},Fo={class:"question-title"},So={key:0,class:"flex"},No=["innerHTML"],Lo={key:1,style:{color:"#bfbfbf"}},Eo={class:"question-options"},Mo={class:"option-label"},$o={class:"option-content"},jo={key:0,class:"correct-tag"},Vo={class:"question-explanation"},Bo={class:"explanation-content"},Ao={key:0},Do={key:1,style:{color:"#bfbfbf"}},Ho={class:"evaluation-content"},Oo={class:"evaluation-section"},zo={class:"file-select-wrapper"},Ko={class:"selected-files-list"},Qo={class:"file-select-wrapper"},Go={class:"selected-files-list"},Jo={class:"evaluation-section"},Wo={class:"evaluation-section"},Yo={class:"case-type-row"},Zo={key:0,class:"test-case-buttons"},Xo={key:0,class:"test-cases-list"},es={class:"test-case-label"},ts={key:0,class:"form-footer-buttons"},ls={key:1,class:"empty-detail"},as={key:3,class:"step-content"},os={class:"content-card"},ss={class:"environment-header"},ns={class:"environment-actions"},is={class:"tab-label"},rs=["onDblclick"],us={class:"experiment-image-info"},ds={class:"experiment-interfaces"},cs={key:0,style:{color:"#999"}},ps={key:1,style:{color:"#999"}},vs={class:"page-footer"},fs=$l({name:"EditFullStack",__name:"edit-full-stack",setup(gs){E.registerLanguage("javascript",ea),E.registerLanguage("typescript",ta),E.registerLanguage("xml",Me),E.registerLanguage("html",Me),E.registerLanguage("vue",Me),E.registerLanguage("css",la),E.registerLanguage("json",aa),E.registerLanguage("markdown",oa);const z=jl(),kt=Vl(),S=h(null),R=h(0),B=h(!1),X=h(),$e=h(),A=h(),d=h({name:"",tag:"",fieldType:void 0,difficulty:1,classHour:"",topCover:"",cover:"",description:"",showTaskRequire:!1,authType:1,enableCodeRepository:!1,repositoryType:"代码仓库",gitUrl:"",environment:void 0}),ee=h(""),te=h(""),le=h(!1),ae=h(!1),oe=window.location.origin,D=h(void 0),C=h([]),L=h("1"),K=h(""),Tt={dockerImage:[{required:!0,message:"请选择实验镜像",trigger:"change"}],viewTypes:[{required:!0,type:"array",min:1,message:"请至少选择一个实验界面",trigger:"change"}],secondType:[{required:!0,message:"请选择附带环境",trigger:"change"}],taskId:[{required:!0,message:"请选择任务关卡",trigger:"change"}],codeType:[{required:!0,message:"请选择编程语言",trigger:"change"}],shellBegin:[{required:!0,message:"请输入开启时触发命令",trigger:"blur"}],containerPort:[{required:!0,message:"请输入容器端口",trigger:"blur"}]},je=ct(()=>{var e;const t=C.value.find(u=>u.id===L.value);return(t==null?void 0:t.config)||((e=C.value[0])==null?void 0:e.config)}),Ve={name:[{required:!0,message:"请输入名称",trigger:"blur"}],tag:[{required:!0,message:"请输入技能标签",trigger:"blur"}],fieldType:[{required:!0,message:"请选择领域类别",trigger:"change"}],difficulty:[{required:!0,message:"请选择难度",trigger:"change"}],topCover:[{required:!0,message:"请上传顶部背景图",trigger:"change"}],cover:[{required:!0,message:"请上传封面图",trigger:"change"}],authType:[{required:!0,message:"请选择培训公开范围",trigger:"change"}]},ye=Wl(),_e=Yl(),he=Zl(),ke=Xl(),wt=[{label:"切换仓库",value:"切换仓库"},{label:"代码仓库",value:"代码仓库"},{label:"私密代码仓库",value:"私密代码仓库"}],H=h(!1),Te=h(new Set),{fileTreeData:se,expandedKeys:we,selectedFile:bt,highlightedCode:Ct,dynamicFileContents:Ut,handleSelectFile:It,getNodePath:Be,addFileToTree:Ae,addFolderToTree:xt,handleRenameNode:Rt,handleCopyPath:Pt,loadRemoteFileTree:qt,loadChildrenData:Ft,getNodePathFromMap:be}=sa(),{taskLevels:M,selectedTaskLevelId:De,currentTab:ne,taskLevelFormRef:Ce,evaluationFormRef:St,taskLevelFormData:k,evaluationFormData:w,learningResourceFileList:Ue,taskLevelFormRules:Nt,evaluationFormRules:Lt,isKernelTask:Et,isChoiceTask:Ie,isProgrammingTask:He,addTaskLevel:xe,deleteTaskLevel:Mt,selectTaskLevel:Oe,saveTaskLevel:$t,saveAllTaskLevels:jt,resetTaskLevel:Vt,handleLearningResourceCustomRequest:Bt,handleLearningResourceUpload:At,handleUserFilesSelect:Dt,handleTestValidateFilesSelect:Ht,userFileList:ie,testValidateFileList:re,addTestCase:Ot,removeTestCase:zt,clearAllTestCases:Kt,getCurrentQuestions:ue,addQuestion:Qt,deleteQuestion:Gt,updateQuestion:Jt,updateQuestionsOrder:Wt,loadQuestions:ze,saveQuestionsOrder:Yt}=na(S),Ke=ct(()=>[...M.value].sort((t,e)=>{const u=t.weight??0,o=e.weight??0;return u-o})),Q=h(!1),de=h(!1),ce=h(!1),pe=h(!1),Re=h(!1),Pe=h(!1),G=h(null),J=h("/"),W=h("/"),Qe=h(null),ve=h("/"),Zt=()=>({1:"Python3.6",2:"Python3.13",3:"Python3.12/VNC"})[D.value||1]||"Python3.6",Ge=()=>{C.value.length===0&&(C.value=[{id:"1",name:"实验环境1",isEditing:!1,isSaved:!1,config:{dockerImage:D.value||1,viewTypes:[],secondType:void 0,taskId:void 0,codeType:void 0,shellBegin:void 0,containerPort:void 0,containerPath:void 0}}])},Xt=async()=>{if(S.value)try{const t=await Jl({projectId:S.value,orderbyFiled:"weight:asc"});let e=[];Array.isArray(t)?e=t:t&&typeof t=="object"&&(e=t.list||t.data||t.tasks||[]),e&&e.length>0&&(M.value=e.map(o=>{let c="programming";o.type===4?c="kernel":o.type===2?c="choice":o.type===1&&(c="programming");const r=o.source?o.source.split(",").map((_,P)=>({uid:`${P}`,name:_.split("/").pop()||`文件${P+1}`,status:"done",url:_,response:_})):[];let y=[];if(o.testContent)try{y=JSON.parse(o.testContent)}catch(_){console.error("解析测试集内容失败:",_)}return{id:String(o.taskId),name:o.name,type:c,source:o.source,require:o.require,referenceAnswer:o.referenceAnswer,difficulty:o.difficulty,tag:o.tag,classHour:o.classHour,jumpUrl:o.jumpUrl,taskId:o.taskId,formData:{name:o.name,source:r,require:o.require,referenceAnswer:o.referenceAnswer,difficulty:o.difficulty,tag:o.tag,classHour:o.classHour,jumpUrl:o.jumpUrl,taskId:o.taskId},evaluationSettings:o.type===1?{timeLimitM:o.timeLimitM,userFiles:o.userFiles?o.userFiles.split(",").map((_,P)=>({uid:`${P}`,name:_.split("/").pop()||`文件${P+1}`,status:"done",url:_,response:_})):[],testValidateFiles:o.testValidateFiles?o.testValidateFiles.split(",").map((_,P)=>({uid:`${P}`,name:_.split("/").pop()||`文件${P+1}`,status:"done",url:_,response:_})):[],testValidateSh:o.testValidateSh,passType:o.passType||1,passTypeRule:o.passTypeRule||"",blankCode:o.blankCode||1,scoreRule:o.scoreRule||1,testValidateType:o.testValidateType||1,testContent:y}:void 0,questions:o.questions||[]}}),M.value.length>0&&Oe(M.value[0].id));let u=[];e&&e.length>0&&e.forEach((o,c)=>{if(o.envIsDel===0||o.envIsDel===void 0||o.envIsDel===null){const r={id:o.id||o.taskId,title:o.title||o.name||`实验环境${c+1}`,dockerImage:o.dockerImage,viewTypes:o.viewTypes,secondType:o.secondType,taskId:o.taskId,codeType:o.codeType,shellBegin:o.shellBegin,containerPort:o.containerPort,containerPath:o.containerPath,envIsDel:o.envIsDel};u.push(r)}}),u.length>0?(C.value=u.map((o,c)=>{let r=[];return o.viewTypes&&(typeof o.viewTypes=="string"?r=o.viewTypes.split(",").map(y=>Number(y.trim())).filter(y=>!isNaN(y)):Array.isArray(o.viewTypes)&&(r=o.viewTypes.map(y=>Number(y)))),{id:String(o.id||Date.now()+c),name:o.title||o.name||`实验环境${c+1}`,isEditing:!1,isSaved:!0,config:{dockerImage:Number(o.dockerImage)||D.value||1,viewTypes:r,secondType:o.secondType?o.secondType:void 0,taskId:o.taskId?String(o.taskId):void 0,codeType:o.codeType?String(o.codeType):void 0,shellBegin:o.shellBegin?String(o.shellBegin):void 0,containerPort:o.containerPort?String(o.containerPort):void 0,containerPath:o.containerPath?String(o.containerPath):void 0}}}),C.value.length>0&&(L.value=C.value[0].id)):Ge()}catch(t){v.warning(t.message||"获取任务关卡列表失败"),Ge()}},el=async()=>{if(!S.value){v.error("缺少项目ID"),z.back();return}try{B.value=!0;const t=await Ql({id:S.value});d.value={name:t.name||"",tag:t.tag||"",fieldType:t.fieldType?t.fieldType:void 0,difficulty:t.difficulty||1,classHour:t.classHour||"",topCover:t.topCover||"",cover:t.cover||"",description:t.description||"",showTaskRequire:t.showTaskRequire===1,authType:t.authType||1,enableCodeRepository:t.gitUrl?!0:t.enableCodeRepository||!1,repositoryType:t.repositoryType||"代码仓库",gitUrl:t.gitUrl||"",environment:t.environment},t.topCover&&(ee.value=oe+t.topCover),t.cover&&(te.value=oe+t.cover),D.value=t.environment||1,t.gitUrl&&(H.value=!0),await Xt()}catch(t){console.error("获取项目详情失败：",t),v.error(t.message||"获取项目详情失败"),z.back()}finally{B.value=!1}},tl=async t=>{var o;if(!(t.size/1024/1024<12))return v.error("图片大小不能超过 12MB!"),!1;if(!(t.type==="image/jpeg"||t.type==="image/png"))return v.error("只能上传 JPG/PNG 格式的图片!"),!1;try{le.value=!0;const c=await ft(t);ee.value=oe+c,d.value.topCover=c,(o=X.value)==null||o.validateFields(["topCover"]),v.success("顶部背景图上传成功")}catch{v.error("顶部背景图上传失败")}finally{le.value=!1}return!1},ll=async t=>{var o;if(!(t.size/1024/1024<12))return v.error("图片大小不能超过 12MB!"),!1;if(!(t.type==="image/jpeg"||t.type==="image/png"))return v.error("只能上传 JPG/PNG 格式的图片!"),!1;try{ae.value=!0;const c=await ft(t);te.value=oe+c,d.value.cover=c,(o=X.value)==null||o.validateFields(["cover"]),v.success("封面图上传成功")}catch{v.error("封面图上传失败")}finally{ae.value=!1}return!1},al=t=>{(typeof t=="boolean"?t:!!t)?Q.value=!0:d.value.enableCodeRepository=!1},fe=async()=>{try{const t=v.loading("正在查询仓库文件...",0),e=await gt(d.value.gitUrl,"");qt(e),Te.value.clear(),t(),v.success("仓库文件查询成功"),console.log("查询仓库地址：",d.value.gitUrl),console.log("获取到的文件列表：",e)}catch(t){v.error(t.message||"仓库文件查询失败"),console.error("仓库文件查询失败：",t)}},ol=async()=>{if(!d.value.gitUrl||!d.value.gitUrl.trim()){v.error("请先配置仓库地址"),Je();return}d.value.enableCodeRepository=!0,Q.value=!1,H.value=!0,await fe()},Je=()=>{d.value.enableCodeRepository=!1,Q.value=!1};Bl(()=>d.value.repositoryType,t=>{t==="切换仓库"&&d.value.enableCodeRepository&&(H.value=!1,v.info("已解锁仓库地址，请重新输入"),Le(()=>{d.value.repositoryType="代码仓库"}))});const sl=()=>{var t;d.value.enableCodeRepository&&!H.value&&((t=d.value.gitUrl)!=null&&t.trim())&&(H.value=!0,fe())},nl=async(t,e)=>{const{expanded:u,node:o}=e;if(u&&!o.isLeaf){const c=String(o.key);if(Te.value.has(c)){console.log("文件夹已加载，跳过：",c);return}try{const r=be(c);console.log("加载文件夹：",r,"节点key:",c);const y=v.loading(`正在加载 ${o.title}...`,0),_=await gt(d.value.gitUrl,r);Ft(c,_),Te.value.add(c),y(),console.log("文件夹加载成功：",r,_)}catch(r){v.error(r.message||"加载文件夹失败"),console.error("加载文件夹失败：",r)}}},il=t=>{switch(String(t.key)){case"newFile":Ye();break;case"newFolder":Ze();break;case"upload":We("/");break}},rl=(t,e)=>{const u=String(t.key),o=be(e.key)||Be(e.key);switch(u){case"newFile":Ye(o);break;case"newFolder":Ze(o);break;case"upload":We(o);break;case"rename":Rt(e);break;case"copyPath":Pt(e);break;case"delete":vl(e);break}},We=t=>{var e;ve.value=t,(e=Qe.value)==null||e.click()},ul=async t=>{var o;const e=t.target,u=(o=e.files)==null?void 0:o[0];if(u)try{let c=ve.value==="/"?"":ve.value.replace(/^\//,"");const r=v.loading(`正在上传 ${u.name}...`,0);await Hl(u,d.value.gitUrl,c);const y=new FileReader;y.onload=_=>{var x;const P=(x=_.target)==null?void 0:x.result;Ae(u.name,P,ve.value)},y.readAsText(u),r(),v.success(`文件 ${u.name} 上传成功`),console.log("文件上传成功：",{fileName:u.name,path:c})}catch(c){v.error(c.message||"文件上传失败"),console.error("文件上传失败：",c)}finally{e&&(e.value="")}},Ye=(t="/")=>{de.value=!0,J.value=t},dl=async t=>{try{let e=J.value==="/"?"":J.value.replace(/^\//,"");const u=v.loading("正在保存文件...",0);await zl({fileContent:t.fileContent,fileName:t.fileName,gitUrl:d.value.gitUrl,path:e,commit:t.commitMessage}),Ae(t.fileName,t.fileContent,J.value),u(),v.success("文件创建成功"),de.value=!1,console.log("文件保存成功：",{fileName:t.fileName,path:e})}catch(e){v.error(e.message||"文件创建失败"),console.error("文件创建失败：",e)}},Ze=(t="/")=>{ce.value=!0,W.value=t},cl=async t=>{try{let e=W.value==="/"?t.folderName:`${W.value.replace(/^\//,"")}/${t.folderName}`;const u=v.loading("正在创建文件夹...",0);await Kl({commit:t.commitMessage,gitUrl:d.value.gitUrl,path:e}),xt(t.folderName,W.value),u(),v.success("文件夹创建成功"),ce.value=!1,console.log("文件夹创建成功：",{folderName:t.folderName,path:e})}catch(e){v.error(e.message||"文件夹创建失败"),console.error("文件夹创建失败：",e)}},pl=t=>{const e=u=>{const o=u.findIndex(c=>c.key===t);if(o!==-1)return u.splice(o,1),!0;for(const c of u)if(c.children&&e(c.children))return!0;return!1};e(se.value)},vl=async t=>{const e=t.children!==void 0||t.isLeaf===!1,u=t.title,c=(be(t.key)||Be(t.key)).split("/");c.pop();const r=c.join("/")||"",{Modal:y}=await El(async()=>{const{Modal:_}=await import("./antd-Cme2pY03.js").then(P=>P.ax);return{Modal:_}},__vite__mapDeps([0,1]),import.meta.url);y.confirm({title:"确认删除",content:`确定要删除${e?"文件夹":"文件"} "${u}" 吗？${e?"文件夹下的所有内容也会被删除。":""}`,okText:"确定",cancelText:"取消",okType:"danger",onOk:async()=>{let _=null;try{_=v.loading("正在删除...",0),await Ol({fileName:u,gitUrl:d.value.gitUrl,path:r}),pl(t.key),_(),v.success("删除成功"),console.log("删除成功：",{fileName:u,path:r})}catch(P){_&&_(),v.error(P.message||"删除失败"),console.error("删除失败：",P)}}})},Y=()=>{Le(()=>{window.scrollTo({top:0,behavior:"smooth"}),document.documentElement.scrollTop=0,document.body.scrollTop=0;const t=document.querySelector(".page-content");t&&(t.scrollTop=0);const e=document.querySelector(".ant-layout-content");e&&(e.scrollTop=0),document.querySelectorAll("*").forEach(o=>{o.scrollTop>0&&(o.scrollTop=0)})})},fl=async()=>{R.value>0?(R.value--,Y(),R.value===1&&d.value.gitUrl&&d.value.enableCodeRepository&&se.value.length===0&&await fe()):z.back()},gl=async()=>{var t,e;if(R.value===0)try{await Promise.all([(t=X.value)==null?void 0:t.validate(),(e=$e.value)==null?void 0:e.validate()]),R.value=1,Y(),d.value.gitUrl&&d.value.enableCodeRepository&&se.value.length===0&&await fe()}catch{v.error("请完善必填信息"),Y()}else if(R.value===1){if(d.value.enableCodeRepository&&(!d.value.gitUrl||d.value.gitUrl.trim()==="")){v.error("请输入仓库地址");return}await Xe(!1),R.value=2,Y()}else if(R.value===2){if(M.value.length===0){v.error("请至少添加一个任务关卡");return}if(M.value.some(o=>!o.taskId)){v.error("请先保存所有任务关卡后再进行下一步");return}try{await jt()}catch(o){console.error("批量保存任务关卡失败:",o);return}R.value=3,Y()}else if(R.value===3){if(C.value.filter(o=>!o.isSaved).length>0){v.error("请先保存所有实验环境配置");return}try{await ml()}catch(o){console.error("批量保存实验环境失败:",o);return}await Xe(!0)}},Xe=async(t=!1)=>{try{B.value=!0;const e={id:S.value,projectType:1,environment:D.value,name:d.value.name,tag:d.value.tag,fieldType:d.value.fieldType,difficulty:d.value.difficulty,classHour:d.value.classHour,topCover:d.value.topCover,cover:d.value.cover,description:d.value.description,showTaskRequire:d.value.showTaskRequire?1:2,authType:d.value.authType,enableCodeRepository:d.value.enableCodeRepository};t&&(e.status=10),d.value.enableCodeRepository&&(e.repositoryType=d.value.repositoryType,e.gitUrl=d.value.gitUrl),await Gl(e),t?(v.success("项目更新成功！"),setTimeout(()=>{z.push("/dashboard/analysis")},500)):v.success("保存成功！")}catch(e){throw console.error("更新失败：",e),v.error(e.message||"项目更新失败，请稍后重试"),e}finally{B.value=!1}},qe=async(t,e=0)=>{var u,o;try{if(e!==1){const r=["dockerImage","viewTypes","secondType","taskId"],y=[];t.config.viewTypes.includes(1)?r.push("codeType"):y.push("codeType"),t.config.viewTypes.includes(2)?r.push("shellBegin"):y.push("shellBegin"),t.config.viewTypes.includes(3)?r.push("containerPort"):y.push("containerPort"),y.length>0&&((u=A.value)==null||u.clearValidate(y)),await((o=A.value)==null?void 0:o.validate(r))}if(!S.value){v.error("项目ID不存在，无法保存");return}const c={title:t.name,dockerImage:t.config.dockerImage,viewTypes:t.config.viewTypes.join(","),secondType:t.config.secondType,taskId:t.config.taskId?Number(t.config.taskId):void 0,codeType:t.config.codeType,shellBegin:t.config.shellBegin,containerPort:t.config.containerPort,containerPath:t.config.containerPath,projectId:S.value,envisDel:e};await mt(c),e!==1?(t.isSaved=!0,v.success("实验环境保存成功！")):v.success("删除成功！")}catch(c){throw console.error("保存失败：",c),v.error(e===1?"删除失败":"请完善必填信息"),c}},ml=async()=>{var o,c;const t=C.value.find(r=>r.id===L.value);if(t){const r=["dockerImage","viewTypes","secondType","taskId"],y=[];t.config.viewTypes.includes(1)?r.push("codeType"):y.push("codeType"),t.config.viewTypes.includes(2)?r.push("shellBegin"):y.push("shellBegin"),t.config.viewTypes.includes(3)?r.push("containerPort"):y.push("containerPort"),y.length>0&&((o=A.value)==null||o.clearValidate(y));try{await((c=A.value)==null?void 0:c.validate(r)),console.log("当前实验环境表单验证通过")}catch{throw v.error("请完善当前实验环境的必填信息"),new Error("当前实验环境表单验证失败")}}const e=C.value.filter(r=>r.isSaved);if(e.length===0){console.log("没有需要更新的实验环境");return}console.log(`开始批量更新 ${e.length} 个实验环境`);const u=[];for(const r of e)try{if(!S.value)throw new Error("项目ID不存在，无法保存");const y={title:r.name,dockerImage:r.config.dockerImage,viewTypes:r.config.viewTypes.join(","),secondType:r.config.secondType,taskId:r.config.taskId?Number(r.config.taskId):void 0,codeType:r.config.codeType,shellBegin:r.config.shellBegin,containerPort:r.config.containerPort,containerPath:r.config.containerPath,projectId:S.value,envisDel:0};await mt(y),console.log(`实验环境 "${r.name}" 更新成功`)}catch(y){const _=`实验环境 "${r.name}" 更新失败: ${y.message||"未知错误"}`;console.error(_,y),u.push(_)}if(u.length===0)v.success(`成功更新 ${e.length} 个实验环境`);else throw u.length<e.length?(v.warning(`部分实验环境更新失败：${u.join("; ")}`),new Error("部分实验环境更新失败")):(v.error("所有实验环境更新失败"),new Error("所有实验环境更新失败"))},Fe=t=>{const e=je.value;if(!e)return;const u=e.viewTypes.indexOf(t);u>-1?(e.viewTypes.splice(u,1),t===1?e.codeType=void 0:t===2?e.shellBegin=void 0:t===3&&(e.containerPort=void 0,e.containerPath=void 0)):e.viewTypes.push(t),Le(()=>{var o;(o=A.value)==null||o.clearValidate(["viewTypes"])})},et=(t,e)=>{if(!e)return!1;const u=typeof e=="string"?Number(e):e;return C.value.some(o=>{if(!o.config.taskId)return!1;const c=typeof o.config.taskId=="string"?Number(o.config.taskId):o.config.taskId;return o.id!==t&&c===u})},yl=()=>{const t=String(Date.now()),e={id:t,name:`实验环境${C.value.length+1}`,isEditing:!1,isSaved:!1,config:{dockerImage:D.value||1,viewTypes:[],secondType:void 0,taskId:void 0,codeType:void 0,shellBegin:void 0,containerPort:void 0,containerPath:void 0}};C.value.push(e),L.value=t,v.success("添加实验环境成功")},_l=async t=>{if(C.value.length===1){v.warning("至少保留一个实验环境");return}const e=C.value.findIndex(u=>u.id===t);if(e>-1){const u=C.value[e];u.isSaved&&await qe(u,1),C.value.splice(e,1),L.value===t&&(L.value=C.value[0].id),u.isSaved||v.success("删除实验环境成功")}},tt=t=>{t.isEditing=!0,K.value=t.name},lt=t=>{K.value.trim()?(t.name=K.value.trim(),t.isEditing=!1,t.isSaved&&(v.success("重命名成功"),qe(t))):v.warning("名称不能为空")},hl=t=>{var u;t.replace(/<[^>]*>/g,"").trim()&&((u=Ce.value)==null||u.clearValidate(["require"]))},kl=t=>{var u;t.replace(/<[^>]*>/g,"").trim()&&((u=Ce.value)==null||u.clearValidate(["referenceAnswer"]))},Tl=()=>{G.value=null,pe.value=!0},wl=t=>{G.value=t,pe.value=!0},bl=async t=>{G.value?Jt(t):Qt(t),G.value=null,k.value.taskId&&await ze(k.value.taskId)},Cl=t=>{try{return JSON.parse(t.selects||"[]").map(u=>{const o=Object.keys(u)[0];return{label:o,content:u[o]}})}catch{return[]}},at=(t,e)=>t.answer.includes(e),$=h(null),Ul=t=>{$.value=t},Il=t=>{t.preventDefault()},xl=async(t,e)=>{if(t.preventDefault(),$.value!==null&&$.value!==e){const u=[...ue.value],[o]=u.splice($.value,1);u.splice(e,0,o),u.forEach((c,r)=>{c.weight=r+1}),Wt(u);try{await Yt(u),v.success("题目顺序已更新")}catch(c){v.error(c.message||"保存题目排序失败，请重试")}}$.value=null},Rl=()=>{$.value=null},Pl=async t=>{const e=String(t);if(Ie.value&&e==="questions"){if(!k.value.taskId){v.warning("请先保存创建任务后再添加题目");return}k.value.taskId&&await ze(k.value.taskId)}if(He.value&&e==="evaluation"&&!k.value.taskId){v.warning("请先保存创建任务后再配置评测设置");return}ne.value=e},ql=(t,e)=>{t.select=e?1:2};return Al(()=>{ye.load(),_e.load(),he.load(),ke.load();const t=kt.query.id;t?(S.value=Number(t),el()):(v.error("缺少项目ID"),z.back())}),(t,e)=>{const u=fa,o=va,c=ya,r=ma,y=ha,_=ka,P=_a,x=wa,j=Ta,U=Ca,Se=ba,ot=Ua,V=ga,Fl=Ia,Z=Pa,st=Ra,nt=xa,Ne=Sa,ge=Fa,it=Na,rt=Ea,ut=Ma,dt=qa,Sl=$a,Nl=Va;return p(),m("div",Ba,[e[98]||(e[98]=i("div",{class:"page-header"},[i("h2",null,"编辑全栈环境实训项目")],-1)),a(Nl,{spinning:B.value},{default:s(()=>[i("div",Aa,[i("div",Da,[a(o,{current:R.value,class:"custom-steps"},{default:s(()=>[a(u,{title:"基本信息"}),a(u,{title:"代码仓库"}),a(u,{title:"任务关卡"}),a(u,{title:"实验环境"})]),_:1},8,["current"])]),R.value===0?(p(),m("div",Ha,[e[51]||(e[51]=i("div",{class:"section-title"},[i("h3",null,"基本信息")],-1)),i("div",Oa,[a(V,{ref_key:"formRef",ref:X,model:d.value,rules:Ve,layout:"horizontal","label-col":{span:2},"wrapper-col":{span:18}},{default:s(()=>[a(r,{label:"名称",name:"name",required:""},{default:s(()=>[a(c,{value:d.value.name,"onUpdate:value":e[0]||(e[0]=l=>d.value.name=l),placeholder:"请输入名称"},null,8,["value"])]),_:1}),a(P,null,{default:s(()=>[a(y,{span:12},{default:s(()=>[a(r,{label:"技能标签",name:"tag",required:"","label-col":{span:4},"wrapper-col":{span:20}},{default:s(()=>[a(c,{value:d.value.tag,"onUpdate:value":e[1]||(e[1]=l=>d.value.tag=l),placeholder:"请输入技能标签"},null,8,["value"])]),_:1})]),_:1}),a(y,{span:12},{default:s(()=>[a(r,{label:"领域类别",name:"fieldType",required:"","label-col":{span:4},"wrapper-col":{span:12}},{default:s(()=>[a(_,{value:d.value.fieldType,"onUpdate:value":e[2]||(e[2]=l=>d.value.fieldType=l),placeholder:"请选择领域类别",options:n(ye).options.value,loading:n(ye).loading.value},null,8,["value","options","loading"])]),_:1})]),_:1})]),_:1}),a(r,{label:"难度",name:"difficulty",required:""},{default:s(()=>[a(j,{value:d.value.difficulty,"onUpdate:value":e[3]||(e[3]=l=>d.value.difficulty=l),class:"custom-radio"},{default:s(()=>[(p(!0),m(F,null,N(n(_e).data.value,l=>(p(),b(x,{key:l.value,value:Number(l.value)},{default:s(()=>[f(I(l.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),a(r,{label:"学时",name:"classHour"},{default:s(()=>[a(c,{value:d.value.classHour,"onUpdate:value":e[4]||(e[4]=l=>d.value.classHour=l),placeholder:"配置任务后自动计算",disabled:""},null,8,["value"])]),_:1}),a(r,{label:"顶部背景图",name:"topCover",required:""},{default:s(()=>[i("div",za,[i("div",Ka,[a(Se,{"before-upload":tl,"show-upload-list":!1,accept:"image/png,image/jpeg"},{default:s(()=>[a(U,{loading:le.value},{default:s(()=>[le.value?(p(),m(F,{key:1},[f("上传中...")],64)):(p(),m(F,{key:0},[f("选择文件")],64))]),_:1},8,["loading"])]),_:1}),ee.value?(p(),m("div",Qa,[i("img",{src:ee.value,alt:"顶部背景图预览",style:{"max-width":"290px","max-height":"218px","border-radius":"4px"}},null,8,Ga)])):T("",!0)]),e[44]||(e[44]=i("div",{class:"upload-hint"}," 说明：支持上传png/jpeg等格式文件，文件大小不能超过12M,建议使用290*218像素。 ",-1))])]),_:1}),a(r,{label:"封面图",name:"cover",required:""},{default:s(()=>[i("div",Ja,[i("div",Wa,[a(Se,{"before-upload":ll,"show-upload-list":!1,accept:"image/png,image/jpeg"},{default:s(()=>[a(U,{loading:ae.value},{default:s(()=>[ae.value?(p(),m(F,{key:1},[f("上传中...")],64)):(p(),m(F,{key:0},[f("选择文件")],64))]),_:1},8,["loading"])]),_:1}),te.value?(p(),m("div",Ya,[i("img",{src:te.value,alt:"封面图预览",style:{"max-width":"290px","max-height":"218px","border-radius":"4px"}},null,8,Za)])):T("",!0)]),e[45]||(e[45]=i("div",{class:"upload-hint"}," 说明：支持上传png/jpeg等格式文件，文件大小不能超过12M,建议使用290*218像素。 ",-1))])]),_:1}),a(r,{label:"简介",name:"description"},{default:s(()=>[a(Ee,{modelValue:d.value.description,"onUpdate:modelValue":e[5]||(e[5]=l=>d.value.description=l),height:400},null,8,["modelValue"])]),_:1}),a(r,{label:"任务要求",name:"showTaskRequire"},{default:s(()=>[a(ot,{checked:d.value.showTaskRequire,"onUpdate:checked":e[6]||(e[6]=l=>d.value.showTaskRequire=l)},{default:s(()=>e[46]||(e[46]=[f(" 显示任务要求（勾选后，将帮作为任务要求显示在任务项目政策面） ")])),_:1,__:[46]},8,["checked"])]),_:1})]),_:1},8,["model"])]),e[52]||(e[52]=i("div",{class:"section-title"},[i("h3",null,"培训公开范围")],-1)),i("div",Xa,[a(V,{ref_key:"trainingScopeFormRef",ref:$e,model:d.value,rules:Ve,layout:"horizontal","label-col":{span:2},"wrapper-col":{span:18}},{default:s(()=>[a(r,{label:"培训公开范围",name:"authType",required:""},{default:s(()=>[a(j,{value:d.value.authType,"onUpdate:value":e[7]||(e[7]=l=>d.value.authType=l),class:"custom-radio"},{default:s(()=>[a(x,{value:1},{default:s(()=>e[47]||(e[47]=[f("完全公开")])),_:1,__:[47]}),a(x,{value:2},{default:s(()=>e[48]||(e[48]=[f("全院公开")])),_:1,__:[48]}),a(x,{value:3},{default:s(()=>e[49]||(e[49]=[f("本单位公开")])),_:1,__:[49]}),a(x,{value:4},{default:s(()=>e[50]||(e[50]=[f("不公开")])),_:1,__:[50]})]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])])])):T("",!0),R.value===1?(p(),m("div",eo,[i("div",to,[i("div",lo,[a(_,{value:d.value.repositoryType,"onUpdate:value":e[8]||(e[8]=l=>d.value.repositoryType=l),options:wt,class:"repository-type-select"},null,8,["value"]),i("div",ao,[e[53]||(e[53]=i("span",{class:"url-label"},"仓库地址：",-1)),a(c,{value:d.value.gitUrl,"onUpdate:value":e[9]||(e[9]=l=>d.value.gitUrl=l),placeholder:"请输入仓库地址",class:"url-input",disabled:H.value,onBlur:sl},null,8,["value","disabled"])])]),i("div",oo,[i("div",so,[i("div",no,[i("div",io,[e[54]||(e[54]=i("span",{class:"switch-label"},"代码仓库",-1)),a(Fl,{checked:d.value.enableCodeRepository,disabled:d.value.enableCodeRepository,onChange:al},null,8,["checked","disabled"])]),d.value.enableCodeRepository?(p(),b(nt,{key:0},{overlay:s(()=>[a(st,{onClick:il},{default:s(()=>[a(Z,{key:"newFile"},{default:s(()=>e[55]||(e[55]=[f("新建文件")])),_:1,__:[55]}),a(Z,{key:"newFolder"},{default:s(()=>e[56]||(e[56]=[f("新建文件夹")])),_:1,__:[56]}),a(Z,{key:"upload"},{default:s(()=>e[57]||(e[57]=[f("上传")])),_:1,__:[57]})]),_:1})]),default:s(()=>[a(U,{type:"primary",size:"small"},{default:s(()=>[a(n(_t)),e[58]||(e[58]=f(" 新建 "))]),_:1,__:[58]})]),_:1})):T("",!0)]),d.value.enableCodeRepository?(p(),b(ia,{key:0,"file-tree-data":n(se),"expanded-keys":n(we),"onUpdate:expandedKeys":e[10]||(e[10]=l=>pt(we)?we.value=l:null),onSelect:n(It),onMenuClick:rl,onExpand:nl},null,8,["file-tree-data","expanded-keys","onSelect"])):T("",!0),d.value.enableCodeRepository?(p(),m("div",ro,e[59]||(e[59]=[i("div",{class:"tips-title"},"提示：",-1),i("div",{class:"tips-content"}," 此处存放本实训所需的所有代码等相关文件，你可以通过以下： ",-1),i("div",{class:"tips-list"},[f(" 1、"),i("a",{href:"#",class:"tips-link"},"Gitee客户端"),f(" 上传已有文件来开始使用。 ")],-1),i("div",{class:"tips-list"}," 2、直接在平台上创建文件目录以及相关代码文件。 ",-1)]))):T("",!0)]),i("div",uo,[d.value.enableCodeRepository?(p(),b(ra,{key:0,"selected-file":n(bt),"highlighted-code":n(Ct),"dynamic-file-contents":n(Ut)},null,8,["selected-file","highlighted-code","dynamic-file-contents"])):(p(),m("div",co," 在左侧代码仓库区域点击目录打开文件 "))])])])])):T("",!0),R.value===2?(p(),m("div",po,[i("div",vo,[i("div",fo,[i("div",go,[a(U,{type:"primary",onClick:e[11]||(e[11]=l=>n(xe)("kernel"))},{default:s(()=>e[60]||(e[60]=[f("添加内核链接任务")])),_:1,__:[60]}),a(U,{type:"primary",onClick:e[12]||(e[12]=l=>n(xe)("choice"))},{default:s(()=>e[61]||(e[61]=[f("添加选择题任务")])),_:1,__:[61]}),d.value.enableCodeRepository?(p(),b(U,{key:0,type:"primary",onClick:e[13]||(e[13]=l=>n(xe)("programming"))},{default:s(()=>e[62]||(e[62]=[f("添加编程任务")])),_:1,__:[62]})):T("",!0)])]),i("div",mo,[i("div",yo,[i("div",_o,"任务关卡 ("+I(n(M).length)+")",1),i("div",ho,[(p(!0),m(F,null,N(Ke.value,l=>(p(),m("div",{key:l.id,class:O(["list-item",{active:n(De)===l.id}]),onClick:g=>n(Oe)(l.id)},[i("span",To,I(l.name),1),a(n(me),{class:"delete-icon",onClick:vt(g=>n(Mt)(l.id),["stop"])},null,8,["onClick"])],10,ko))),128))])]),i("div",wo,[n(De)?(p(),m("div",bo,[a(dt,{activeKey:n(ne),onChange:Pl},Dl({default:s(()=>[a(ge,{key:"task",tab:"关联任务"},{default:s(()=>[a(V,{ref_key:"taskLevelFormRef",ref:Ce,model:n(k),rules:n(Nt),layout:"horizontal","label-col":{span:4},"wrapper-col":{span:18}},{default:s(()=>[a(r,{label:"任务名称",name:"name",required:""},{default:s(()=>[a(c,{value:n(k).name,"onUpdate:value":e[14]||(e[14]=l=>n(k).name=l),placeholder:"请输入任务名称"},null,8,["value"])]),_:1}),a(r,{label:"学习资源",name:"source",required:""},{default:s(()=>[a(Se,{"file-list":n(Ue),"onUpdate:fileList":e[15]||(e[15]=l=>pt(Ue)?Ue.value=l:null),"custom-request":n(Bt),onChange:n(At),accept:".doc,.docx,.pdf,.ppt,.pptx,.mp4","max-count":10},{default:s(()=>[a(U,{type:"primary"},{default:s(()=>e[64]||(e[64]=[f("点击上传")])),_:1,__:[64]})]),_:1},8,["file-list","custom-request","onChange"]),e[65]||(e[65]=i("div",{class:"upload-hint"}," 说明：支持上传word、pdf、ppt、mp4等格式文件，每个文件大小不能超过300M。 ",-1))]),_:1,__:[65]}),a(r,{label:"任务要求",name:"require",required:""},{default:s(()=>[a(Ee,{modelValue:n(k).require,"onUpdate:modelValue":e[16]||(e[16]=l=>n(k).require=l),placeholder:"请输入任务要求",onChange:hl},null,8,["modelValue"])]),_:1}),a(r,{label:"参考答案",name:"referenceAnswer",required:""},{default:s(()=>[a(Ee,{modelValue:n(k).referenceAnswer,"onUpdate:modelValue":e[17]||(e[17]=l=>n(k).referenceAnswer=l),placeholder:"请输入参考答案",onChange:kl},null,8,["modelValue"])]),_:1}),a(r,{label:"难度系数",name:"difficulty",required:""},{default:s(()=>[a(j,{value:n(k).difficulty,"onUpdate:value":e[18]||(e[18]=l=>n(k).difficulty=l),class:"custom-radio"},{default:s(()=>[(p(!0),m(F,null,N(n(_e).data.value,l=>(p(),b(x,{key:l.value,value:Number(l.value)},{default:s(()=>[f(I(l.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),a(r,{label:"技能标签",name:"tag",required:""},{default:s(()=>[a(c,{value:n(k).tag,"onUpdate:value":e[19]||(e[19]=l=>n(k).tag=l),placeholder:"请输入技能标签"},null,8,["value"])]),_:1}),n(Et)?(p(),b(r,{key:0,label:"内嵌链接",name:"jumpUrl",required:""},{default:s(()=>[a(c,{value:n(k).jumpUrl,"onUpdate:value":e[20]||(e[20]=l=>n(k).jumpUrl=l),placeholder:"请输入内嵌链接"},null,8,["value"])]),_:1})):T("",!0),a(r,{label:"任务学时",name:"classHour",required:""},{default:s(()=>[a(Ne,{style:{width:"100%"},min:0,value:n(k).classHour,"onUpdate:value":e[21]||(e[21]=l=>n(k).classHour=l),placeholder:"请输入任务学时"},null,8,["value"])]),_:1}),a(r,{label:"排序权重",name:"weight"},{default:s(()=>[a(Ne,{style:{width:"100%"},min:0,value:n(k).weight,"onUpdate:value":e[22]||(e[22]=l=>n(k).weight=l),placeholder:"请输入排序权重，数值越小越靠前"},null,8,["value"]),e[66]||(e[66]=i("div",{style:{color:"#999","font-size":"12px","margin-top":"4px"}}," 权重用于任务关卡排序，数值越小越靠前，默认按从小到大排序 ",-1))]),_:1,__:[66]})]),_:1},8,["model","rules"])]),_:1}),n(Ie)?(p(),b(ge,{key:"questions",tab:"题目"},{default:s(()=>[n(ue).length===0?(p(),m("div",Co,[a(it,{description:"暂无题目，请点击右上方按钮新增题目"})])):(p(),m("div",Uo,[(p(!0),m(F,null,N(n(ue),(l,g)=>(p(),m("div",{key:l.id,class:O(["question-item",{dragging:$.value===g}]),draggable:"true",onDragstart:q=>Ul(g),onDragover:Il,onDrop:q=>xl(q,g),onDragend:Rl},[i("div",xo,[i("div",Ro,[a(n(La),{class:"drag-handle"}),i("span",Po,"题目"+I(g+1),1)]),i("div",qo,[a(n(ht),{class:"edit-icon",onClick:q=>wl(l)},null,8,["onClick"]),a(n(me),{class:"delete-icon",onClick:q=>n(Gt)(l.id)},null,8,["onClick"])])]),i("div",Fo,[l.name?(p(),m("div",So,[f(I(g+1)+"、 ",1),i("div",{innerHTML:l.name},null,8,No)])):(p(),m("div",Lo,"暂无题干"))]),i("div",Eo,[(p(!0),m(F,null,N(Cl(l),(q,Ll)=>(p(),m("div",{key:Ll,class:O(["option-row",{"is-correct":at(l,q.label)}])},[i("span",Mo,I(q.label)+".",1),i("span",$o,I(q.content),1),at(l,q.label)?(p(),m("span",jo,"正确答案")):T("",!0)],2))),128))]),i("div",Vo,[e[67]||(e[67]=i("div",{class:"explanation-label"},"答案解析：",-1)),i("div",Bo,[l.answerKey?(p(),m("span",Ao,I(l.answerKey),1)):(p(),m("span",Do,"暂无答案解析"))])])],42,Io))),128))]))]),_:1})):T("",!0),n(He)?(p(),b(ge,{key:"evaluation",tab:"评测设置"},{default:s(()=>[i("div",Ho,[i("div",Oo,[e[74]||(e[74]=i("div",{class:"section-header"},"评测文件",-1)),a(V,{ref_key:"evaluationFormRef",ref:St,model:n(w),rules:n(Lt),layout:"horizontal","label-col":{span:4},"wrapper-col":{span:18}},{default:s(()=>[a(r,{label:"评测时长限制",name:"timeLimitM",required:""},{default:s(()=>[a(Ne,{value:n(w).timeLimitM,"onUpdate:value":e[23]||(e[23]=l=>n(w).timeLimitM=l),min:0,placeholder:"请输入评测时长限制",style:{width:"200px"}},null,8,["value"]),e[68]||(e[68]=i("span",{style:{"margin-left":"8px"}},"分钟",-1))]),_:1,__:[68]}),a(r,{label:"学员任务文件",name:"userFiles",required:""},{default:s(()=>[i("div",zo,[a(U,{type:"primary",onClick:e[24]||(e[24]=l=>Re.value=!0)},{default:s(()=>e[69]||(e[69]=[f("点击选择")])),_:1,__:[69]}),i("div",Ko,[(p(!0),m(F,null,N(n(ie),l=>(p(),b(rt,{key:l.uid,closable:"",onClose:()=>{ie.value=n(ie).filter(g=>g.uid!==l.uid),n(w).userFiles=[...n(ie)]},style:{margin:"4px"}},{default:s(()=>[f(I(l.name),1)]),_:2},1032,["onClose"]))),128))])]),e[70]||(e[70]=i("div",{class:"upload-hint"}," 说明：从代码仓库中选择文件。（学员评测基本任务时名称，查看效果页上需要编辑的文件类型） ",-1))]),_:1,__:[70]}),a(r,{label:"评测执行文件",name:"testValidateFiles",required:""},{default:s(()=>[i("div",Qo,[a(U,{type:"primary",onClick:e[25]||(e[25]=l=>Pe.value=!0)},{default:s(()=>e[71]||(e[71]=[f("点击选择")])),_:1,__:[71]}),i("div",Go,[(p(!0),m(F,null,N(n(re),l=>(p(),b(rt,{key:l.uid,closable:"",onClose:()=>{re.value=n(re).filter(g=>g.uid!==l.uid),n(w).testValidateFiles=[...n(re)]},style:{margin:"4px"}},{default:s(()=>[f(I(l.name),1)]),_:2},1032,["onClose"]))),128))])]),e[72]||(e[72]=i("div",{class:"upload-hint"},' 说明：从代码仓库中选择文件。（点击评测按钮时调用的文件，用于检验学员任务结果是否正确，可与"学员任务文件"一致） ',-1))]),_:1,__:[72]}),a(r,{label:"评测执行命令",name:"testValidateSh",required:""},{default:s(()=>[a(c,{value:n(w).testValidateSh,"onUpdate:value":e[26]||(e[26]=l=>n(w).testValidateSh=l),placeholder:"请输入评测执行命令，例如：python main.py"},null,8,["value"]),e[73]||(e[73]=i("div",{class:"upload-hint"}," （执行评测文件的命令，如：python main.py、node index.js、java Main 等） ",-1))]),_:1,__:[73]})]),_:1},8,["model","rules"])]),i("div",Jo,[e[81]||(e[81]=i("div",{class:"section-header"},"评测规则",-1)),a(V,{layout:"horizontal","label-col":{span:4},"wrapper-col":{span:18}},{default:s(()=>[a(r,{label:"通关判定"},{default:s(()=>[a(j,{value:n(w).passType,"onUpdate:value":e[27]||(e[27]=l=>n(w).passType=l),class:"custom-radio"},{default:s(()=>[a(x,{value:1},{default:s(()=>e[75]||(e[75]=[f("实际输出与期望输出对比")])),_:1,__:[75]}),a(x,{value:2},{default:s(()=>e[76]||(e[76]=[f("实际输出满足规则")])),_:1,__:[76]})]),_:1},8,["value"])]),_:1}),n(w).passType===2?(p(),b(r,{key:0,label:"判定规则"},{default:s(()=>[a(c,{value:n(w).passTypeRule,"onUpdate:value":e[28]||(e[28]=l=>n(w).passTypeRule=l),placeholder:"请输入判定规则"},null,8,["value"]),e[77]||(e[77]=i("div",{class:"upload-hint"}," （请输入实际输出满足的规则描述） ",-1))]),_:1,__:[77]})):T("",!0),a(r,{label:"空格处理"},{default:s(()=>[a(j,{value:n(w).blankCode,"onUpdate:value":e[29]||(e[29]=l=>n(w).blankCode=l),class:"custom-radio"},{default:s(()=>[a(x,{value:1},{default:s(()=>e[78]||(e[78]=[f("不忽略空格")])),_:1,__:[78]}),a(x,{value:2},{default:s(()=>e[79]||(e[79]=[f("忽略首尾空格")])),_:1,__:[79]}),a(x,{value:3},{default:s(()=>e[80]||(e[80]=[f("忽略所有空格(仅通过空格中自动添加所有空格进行对比)")])),_:1,__:[80]})]),_:1},8,["value"])]),_:1})]),_:1})]),i("div",Wo,[e[88]||(e[88]=i("div",{class:"section-header"},"测试集",-1)),a(V,{layout:"horizontal","label-col":{span:4},"wrapper-col":{span:18}},{default:s(()=>[a(r,{label:"得分规则"},{default:s(()=>[a(j,{value:n(w).scoreRule,"onUpdate:value":e[30]||(e[30]=l=>n(w).scoreRule=l),class:"custom-radio"},{default:s(()=>[a(x,{value:1},{default:s(()=>e[82]||(e[82]=[f("通过全部测试集（所有测试集都正确，才获取对应积分；否则得0学分）")])),_:1,__:[82]}),a(x,{value:2},{default:s(()=>e[83]||(e[83]=[f("通过部分测试集（选中的测试集全部正确，获取任务学分；否则得0学分）")])),_:1,__:[83]})]),_:1},8,["value"])]),_:1}),a(r,{label:"用例类型"},{default:s(()=>[i("div",Yo,[a(j,{value:n(w).testValidateType,"onUpdate:value":e[31]||(e[31]=l=>n(w).testValidateType=l),class:"custom-radio"},{default:s(()=>[a(x,{value:1},{default:s(()=>e[84]||(e[84]=[f("文本")])),_:1,__:[84]}),a(x,{value:2},{default:s(()=>e[85]||(e[85]=[f("文件")])),_:1,__:[85]})]),_:1},8,["value"]),n(w).testValidateType===1?(p(),m("div",Zo,[a(U,{type:"primary",onClick:n(Ot)},{default:s(()=>e[86]||(e[86]=[f("新增测试集")])),_:1,__:[86]},8,["onClick"]),a(U,{onClick:n(Kt)},{default:s(()=>e[87]||(e[87]=[f("一键删除测试用例")])),_:1,__:[87]},8,["onClick"])])):T("",!0)])]),_:1}),n(w).testValidateType===1&&n(w).testContent.length>0?(p(),m("div",Xo,[(p(!0),m(F,null,N(n(w).testContent,(l,g)=>(p(),m("div",{key:l.id,class:"test-case-item"},[a(ot,{checked:l.select===1,onChange:q=>ql(l,q.target.checked),class:"test-case-checkbox"},null,8,["checked","onChange"]),i("span",es,"测试集"+I(g+1),1),a(ut,{value:l.arg,"onUpdate:value":q=>l.arg=q,placeholder:"请输入输入内容",class:"test-case-input","auto-size":{minRows:3}},null,8,["value","onUpdate:value"]),a(ut,{value:l.answer,"onUpdate:value":q=>l.answer=q,placeholder:"请输入期望输出",class:"test-case-output","auto-size":{minRows:3}},null,8,["value","onUpdate:value"]),a(n(me),{class:"delete-test-case",onClick:q=>n(zt)(l.id)},null,8,["onClick"])]))),128))])):T("",!0)]),_:1})])])]),_:1})):T("",!0)]),_:2},[n(Ie)&&n(ne)==="questions"?{name:"tabBarExtraContent",fn:s(()=>[a(U,{type:"primary",onClick:Tl},{default:s(()=>[a(n(_t)),e[63]||(e[63]=f(" 新增题目 "))]),_:1,__:[63]})]),key:"0"}:void 0]),1032,["activeKey"]),n(ne)!=="questions"?(p(),m("div",ts,[n(k).taskId?T("",!0):(p(),b(U,{key:0,onClick:n(Vt)},{default:s(()=>e[89]||(e[89]=[f("重置")])),_:1,__:[89]},8,["onClick"])),a(U,{type:"primary",onClick:n($t)},{default:s(()=>[f(I(n(k).taskId?"更新":"保存"),1)]),_:1},8,["onClick"])])):T("",!0)])):(p(),m("div",ls,[a(it,{description:"请先添加任务关卡"})]))])])])])):T("",!0),R.value===3?(p(),m("div",as,[i("div",os,[i("div",ss,[e[92]||(e[92]=i("h3",{class:"environment-title"},"实验环境",-1)),i("div",ns,[a(U,{type:"primary",onClick:yl},{default:s(()=>e[90]||(e[90]=[f("添加实验环境")])),_:1,__:[90]}),a(U,null,{default:s(()=>e[91]||(e[91]=[f("设置")])),_:1,__:[91]})])]),a(V,{ref_key:"experimentFormRef",ref:A,model:je.value,rules:Tt,"label-col":{span:4},"wrapper-col":{span:18}},{default:s(()=>[a(dt,{activeKey:L.value,"onUpdate:activeKey":e[37]||(e[37]=l=>L.value=l)},{default:s(()=>[(p(!0),m(F,null,N(C.value,l=>(p(),b(ge,{key:l.id},{tab:s(()=>[i("div",is,[l.isEditing?(p(),b(c,{key:0,value:K.value,"onUpdate:value":e[32]||(e[32]=g=>K.value=g),size:"small",style:{width:"120px"},onPressEnter:g=>lt(l),onBlur:g=>lt(l)},null,8,["value","onPressEnter","onBlur"])):(p(),m(F,{key:1},[i("span",{onDblclick:g=>tt(l)},I(l.name),41,rs),a(nt,{trigger:["click"]},{overlay:s(()=>[a(st,null,{default:s(()=>[a(Z,{onClick:g=>tt(l)},{default:s(()=>[a(n(ht)),e[93]||(e[93]=f(" 重命名 "))]),_:2,__:[93]},1032,["onClick"]),a(Z,{onClick:g=>_l(l.id)},{default:s(()=>[a(n(me)),e[94]||(e[94]=f(" 删除 "))]),_:2,__:[94]},1032,["onClick"])]),_:2},1024)]),default:s(()=>[a(n(ja),{class:"tab-more-icon",onClick:e[33]||(e[33]=vt(()=>{},["stop"]))})]),_:2},1024)],64))])]),default:s(()=>[a(r,{label:"实验镜像",name:"dockerImage",required:""},{default:s(()=>[i("div",us," 系统实验镜像默认为"+I(Zt())+"。 ",1)]),_:1}),a(r,{label:"实验界面",name:"viewTypes",required:""},{default:s(()=>[i("div",ds,[i("div",{class:O(["interface-card",{active:l.config.viewTypes.includes(1)}]),onClick:e[34]||(e[34]=g=>Fe(1))},e[95]||(e[95]=[i("div",{class:"card-title"},"代码编辑器",-1),i("div",{class:"card-desc"},"提供代码编辑器，编辑器，调试器等工具",-1)]),2),i("div",{class:O(["interface-card",{active:l.config.viewTypes.includes(2)}]),onClick:e[35]||(e[35]=g=>Fe(2))},e[96]||(e[96]=[i("div",{class:"card-title"},"命令行终端",-1),i("div",{class:"card-desc"},"提供命令行窗口",-1)]),2),i("div",{class:O(["interface-card",{active:l.config.viewTypes.includes(3)}]),onClick:e[36]||(e[36]=g=>Fe(3))},e[97]||(e[97]=[i("div",{class:"card-title"},"容器内服务",-1),i("div",{class:"card-desc"},"直接预览容器内部Web服务",-1)]),2)])]),_:2},1024),a(r,{label:"附带环境",name:"secondType",required:""},{default:s(()=>[a(_,{value:l.config.secondType,"onUpdate:value":g=>l.config.secondType=g,placeholder:"请选择附带环境",options:n(he).options.value,loading:n(he).loading.value,allowClear:""},null,8,["value","onUpdate:value","options","loading"])]),_:2},1024),a(r,{label:"任务关卡",name:"taskId",required:""},{default:s(()=>[a(_,{value:l.config.taskId,"onUpdate:value":g=>l.config.taskId=g,placeholder:"请选择任务关卡",allowClear:""},{default:s(()=>[(p(!0),m(F,null,N(Ke.value,g=>(p(),b(Sl,{key:g.taskId||g.id,value:g.taskId?String(g.taskId):void 0,disabled:!g.taskId||et(l.id,g.taskId)},{default:s(()=>[f(I(g.name)+" ",1),g.taskId?et(l.id,g.taskId)?(p(),m("span",ps," (已被使用)")):T("",!0):(p(),m("span",cs," (未保存)"))]),_:2},1032,["value","disabled"]))),128))]),_:2},1032,["value","onUpdate:value"])]),_:2},1024),l.config.viewTypes.includes(1)?(p(),b(r,{key:0,label:"编程语言",name:"codeType",required:""},{default:s(()=>[a(_,{value:l.config.codeType,"onUpdate:value":g=>l.config.codeType=g,placeholder:"请选择编程语言",options:n(ke).options.value,loading:n(ke).loading.value,allowClear:""},null,8,["value","onUpdate:value","options","loading"])]),_:2},1024)):T("",!0),l.config.viewTypes.includes(2)?(p(),b(r,{key:1,label:"开启时触发命令",name:"shellBegin",required:""},{default:s(()=>[a(c,{value:l.config.shellBegin,"onUpdate:value":g=>l.config.shellBegin=g,placeholder:"请输入命令"},null,8,["value","onUpdate:value"])]),_:2},1024)):T("",!0),l.config.viewTypes.includes(3)?(p(),b(r,{key:2,label:"容器端口",name:"containerPort",required:""},{default:s(()=>[a(c,{value:l.config.containerPort,"onUpdate:value":g=>l.config.containerPort=g,placeholder:"请输入容器端口"},null,8,["value","onUpdate:value"])]),_:2},1024)):T("",!0),l.config.viewTypes.includes(3)?(p(),b(r,{key:3,label:"路由"},{default:s(()=>[a(c,{value:l.config.containerPath,"onUpdate:value":g=>l.config.containerPath=g,placeholder:"请输入路由（选填）"},null,8,["value","onUpdate:value"])]),_:2},1024)):T("",!0),a(r,{"wrapper-col":{offset:4,span:18}},{default:s(()=>[a(U,{class:"w-full",type:"primary",onClick:g=>qe(l)},{default:s(()=>[f(I(l.isSaved?"更新":"保存"),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["activeKey"])]),_:1},8,["model"])])])):T("",!0),i("div",vs,[a(U,{onClick:fl},{default:s(()=>[f(I(R.value===0?"返回":"上一步"),1)]),_:1}),a(U,{type:"primary",loading:B.value,onClick:gl},{default:s(()=>[f(I(R.value===3?"完成":"下一步"),1)]),_:1},8,["loading"])])])]),_:1},8,["spinning"]),i("input",{ref_key:"fileUploadInput",ref:Qe,type:"file",style:{display:"none"},onChange:ul},null,544),a(ua,{open:Q.value,"onUpdate:open":e[38]||(e[38]=l=>Q.value=l),onConfirm:ol,onCancel:Je},null,8,["open"]),a(da,{open:de.value,"onUpdate:open":e[39]||(e[39]=l=>de.value=l),"parent-path":J.value,onConfirm:dl},null,8,["open","parent-path"]),a(ca,{open:ce.value,"onUpdate:open":e[40]||(e[40]=l=>ce.value=l),"parent-path":W.value,onConfirm:cl},null,8,["open","parent-path"]),a(pa,{open:pe.value,"onUpdate:open":e[41]||(e[41]=l=>pe.value=l),question:G.value,"project-id":S.value??void 0,"task-id":n(k).taskId,"existing-questions":n(ue),onConfirm:bl},null,8,["open","question","project-id","task-id","existing-questions"]),a(yt,{open:Re.value,"onUpdate:open":e[42]||(e[42]=l=>Re.value=l),title:"选择学员任务文件","git-url":d.value.gitUrl,onConfirm:n(Dt)},null,8,["open","git-url","onConfirm"]),a(yt,{open:Pe.value,"onUpdate:open":e[43]||(e[43]=l=>Pe.value=l),title:"选择评测执行文件","git-url":d.value.gitUrl,onConfirm:n(Ht)},null,8,["open","git-url","onConfirm"])])}}}),Us=Ml(fs,[["__scopeId","data-v-eb3578b3"]]);export{Us as default};
