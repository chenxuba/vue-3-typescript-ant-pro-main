import{d as ue,ak as de,am as ce,f as d,c as pe,o as ve,_,a1 as c,$ as o,k as s,a9 as p,a7 as l,G as r,ac as q,F as b,ab as A,a6 as R,u as H,ag as me}from"./vue-PnzzEkKE.js";import{f as _e,p as ke,q as fe}from"./index-BNK75F8N.js";import{g as ge}from"./organization-Du0TnQbo.js";import{H as ye,s as be,a4 as Ne,a5 as he,z as we,I as Se,a6 as Te,an as Ce,ao as Ie,ap as xe,T as Le,a1 as j}from"./antd-Cme2pY03.js";import{_ as je}from"./index-DmgcJQeo.js";const ze={class:"project-statistics-page"},$e={class:"page-header"},Pe={class:"page-content"},Ue={class:"filter-section"},De={class:"filter-form"},Ae={class:"filter-actions"},Ee={class:"table-section"},Fe={class:"table-header"},Be={class:"table-info"},Me={class:"total-info"},Oe={class:"total-number"},Ke={key:0,class:"user-link"},Ve={key:2,class:"status-cell"},qe={class:"filter-section"},Re={class:"filter-form"},He={class:"filter-actions"},Je={class:"task-completion-container"},Qe={class:"task-level-sidebar"},Ge={class:"task-level-search"},Ye={class:"task-level-list"},We=["onClick"],Xe={class:"task-table-area"},Ze={class:"table-header"},et={class:"table-info"},tt={class:"total-info"},at={class:"total-number"},st={key:1,class:"user-link"},lt=ue({name:"ProjectStatistics",__name:"statistics",setup(nt){const J=de(),E=ce(),Q=d(E.query.name||"实训项目管理详情"),N=d("participation"),n=d({userNumber:"",userName:"",unit:void 0,status:void 0}),z=d([]),G=async()=>{try{const t=await ge({limit:1e4,page:1,startNum:0,orderbyFiled:"orgCode:asc"});t&&t.data&&t.data.list&&(z.value=t.data.list.map(e=>({label:e.orgName,value:e.orgName})))}catch(t){console.error("获取组织列表失败:",t),j.error("获取组织列表失败")}},Y=[{label:"已完成",value:"1"},{label:"进行中",value:"2"},{label:"未开始",value:"3"}],S=d([]),h=d(null),C=d(""),W=pe(()=>C.value?S.value.filter(t=>t.name.toLowerCase().includes(C.value.toLowerCase())):S.value),X=t=>{h.value=t,k.value.current=1,T()},Z=[{title:"用户编号",dataIndex:"userId",key:"userId",width:150},{title:"用户姓名",dataIndex:"nickName",key:"nickName",width:150},{title:"单位",dataIndex:"orgName",key:"orgName",width:300},{title:"参训时间",dataIndex:"joinTime",key:"joinTime",width:200},{title:"参训状态",dataIndex:"currentTask",key:"currentTask",width:150,align:"center"}],ee=[{title:"用户编号",dataIndex:"userNumber",key:"userNumber",width:150},{title:"用户姓名",dataIndex:"userName",key:"userName",width:150},{title:"单位",dataIndex:"unit",key:"unit",width:250},{title:"任务开始时间",dataIndex:"taskStartTime",key:"taskStartTime",width:180},{title:"任务结束时间",dataIndex:"taskEndTime",key:"taskEndTime",width:180},{title:"累计时间",dataIndex:"totalTime",key:"totalTime",width:120},{title:"实验状态",dataIndex:"experimentStatus",key:"experimentStatus",width:120}],F=d([]),B=d([]),f=d({current:1,pageSize:20,total:0,showSizeChanger:!0,showQuickJumper:!0,showTotal:t=>`数据共 ${t} 条`}),k=d({current:1,pageSize:20,total:0,showSizeChanger:!0,showQuickJumper:!0,showTotal:t=>`数据共 ${t} 条`}),$=d(!1),P=d(!1),U=d(Number(E.query.id)||0),I=d(0),te=async()=>{try{const t={projectId:U.value},e=await _e(t);e&&Array.isArray(e)&&(I.value=e.length,S.value=e.map(i=>({taskId:i.taskId,name:i.name})),S.value.length>0&&(h.value=S.value[0].taskId))}catch(t){console.error("获取项目任务列表失败:",t),j.error("获取项目任务列表失败")}},D=t=>{if(!t)return"-";const e=t<1e10?t*1e3:t,i=new Date(e),g=i.getFullYear(),v=String(i.getMonth()+1).padStart(2,"0"),m=String(i.getDate()).padStart(2,"0"),y=String(i.getHours()).padStart(2,"0"),w=String(i.getMinutes()).padStart(2,"0"),L=String(i.getSeconds()).padStart(2,"0");return`${g}-${v}-${m} ${y}:${w}:${L}`},x=async()=>{$.value=!0;try{const t={limit:f.value.pageSize,page:f.value.current,projectId:U.value};n.value.userNumber&&(t.userId=n.value.userNumber),n.value.userName&&(t.nickName=n.value.userName),n.value.unit&&(t.orgName=n.value.unit),n.value.status&&(t.status=n.value.status);const e=await ke(t);e&&e.list&&(F.value=e.list,f.value.total=e.count)}catch(t){console.error("获取参训数据失败:",t),j.error("获取参训数据失败")}finally{$.value=!1}},ae=(t,e)=>{if(!t||!e)return"-";const i=t<1e10?t*1e3:t,g=e<1e10?e*1e3:e,v=Math.floor((g-i)/1e3);if(v<0)return"-";const m=Math.floor(v/3600),y=Math.floor(v%3600/60),w=v%60;return`${String(m).padStart(2,"0")}:${String(y).padStart(2,"0")}:${String(w).padStart(2,"0")}`},se=t=>t===10?"已完成":t>0&&t<10?"进行中":"未开始",le=t=>t===10?"completed":t>0&&t<10?"inProgress":"notStarted",T=async()=>{if(h.value){P.value=!0;try{const t={limit:k.value.pageSize,page:k.value.current,projectId:U.value,taskId:h.value,orderbyFiled:"id:desc"};n.value.userNumber&&(t.userId=n.value.userNumber),n.value.userName&&(t.nickName=n.value.userName),n.value.unit&&(t.orgName=n.value.unit);const e=await fe(t);e&&e.list&&(B.value=e.list,k.value.total=e.count)}catch(t){console.error("获取任务完成情况失败:",t),j.error("获取任务完成情况失败")}finally{P.value=!1}}},M=()=>{console.log("查询",n.value),N.value==="participation"?(f.value.current=1,x()):N.value==="task"&&(k.value.current=1,T())},O=()=>{n.value={userNumber:"",userName:"",unit:void 0,status:void 0},N.value==="participation"?(f.value.current=1,x()):N.value==="task"&&(k.value.current=1,T())},K=()=>{console.log("导出数据")},ne=()=>{J.back()},oe=t=>{f.value.current=t.current,f.value.pageSize=t.pageSize,x()},ie=t=>{k.value.current=t.current,k.value.pageSize=t.pageSize,T()};return ve(async()=>{G(),await te(),x(),h.value&&T()}),(t,e)=>{const i=ye,g=Se,v=we,m=he,y=Te,w=Ne,L=Ce,V=be,re=Le;return c(),_("div",ze,[o("div",$e,[o("h2",null,p(Q.value),1),s(i,{onClick:ne},{default:l(()=>e[9]||(e[9]=[r("返回")])),_:1,__:[9]})]),o("div",Pe,[s(re,{activeKey:N.value,"onUpdate:activeKey":e[8]||(e[8]=a=>N.value=a),class:"statistics-tabs"},{default:l(()=>[s(V,{key:"participation",tab:"参训整体情况"},{default:l(()=>[o("div",Ue,[e[12]||(e[12]=o("div",{class:"filter-title"},"筛选查询",-1)),o("div",De,[s(w,{gutter:16,align:"middle"},{default:l(()=>[s(m,{span:5},{default:l(()=>[s(v,{label:"用户编号：","label-col":{span:9},"wrapper-col":{span:15}},{default:l(()=>[s(g,{value:n.value.userNumber,"onUpdate:value":e[0]||(e[0]=a=>n.value.userNumber=a),placeholder:"请输入"},null,8,["value"])]),_:1})]),_:1}),s(m,{span:5},{default:l(()=>[s(v,{label:"用户姓名：","label-col":{span:9},"wrapper-col":{span:15}},{default:l(()=>[s(g,{value:n.value.userName,"onUpdate:value":e[1]||(e[1]=a=>n.value.userName=a),placeholder:"请输入"},null,8,["value"])]),_:1})]),_:1}),s(m,{span:5},{default:l(()=>[s(v,{label:"单位：","label-col":{span:6},"wrapper-col":{span:18}},{default:l(()=>[s(y,{value:n.value.unit,"onUpdate:value":e[2]||(e[2]=a=>n.value.unit=a),placeholder:"请选择",options:z.value,"allow-clear":""},null,8,["value","options"])]),_:1})]),_:1}),s(m,{span:5},{default:l(()=>[s(v,{label:"参训状态：","label-col":{span:9},"wrapper-col":{span:15}},{default:l(()=>[s(y,{value:n.value.status,"onUpdate:value":e[3]||(e[3]=a=>n.value.status=a),placeholder:"请选择",options:Y,"allow-clear":""},null,8,["value"])]),_:1})]),_:1}),s(m,{span:4},{default:l(()=>[o("div",Ae,[s(i,{type:"primary",onClick:M},{default:l(()=>e[10]||(e[10]=[r("查询")])),_:1,__:[10]}),s(i,{onClick:O},{default:l(()=>e[11]||(e[11]=[r("重置")])),_:1,__:[11]})])]),_:1})]),_:1})])]),o("div",Ee,[o("div",Fe,[o("div",Be,[e[15]||(e[15]=r(" 数据列表 ")),o("span",Me,[e[13]||(e[13]=r("数据共 ")),o("span",Oe,p(f.value.total),1),e[14]||(e[14]=r(" 条"))])]),s(i,{type:"primary",onClick:K},{default:l(()=>e[16]||(e[16]=[r("导出")])),_:1,__:[16]})]),s(L,{columns:Z,"data-source":F.value,pagination:f.value,loading:$.value,"row-key":a=>a.id,scroll:{x:1e3},onChange:oe},{bodyCell:l(({column:a,record:u})=>[a.key==="nickName"?(c(),_("a",Ke,p(u.nickName),1)):a.key==="joinTime"?(c(),_(b,{key:1},[r(p(D(u.joinTime)),1)],64)):a.key==="currentTask"?(c(),_("div",Ve,[o("span",null,p(u.currentTask)+" / "+p(I.value),1),o("span",{class:A(["status-icon",u.currentTask>=I.value?"completed":"inProgress"])},[u.currentTask>=I.value?(c(),R(H(Ie),{key:0})):(c(),R(H(xe),{key:1}))],2)])):q("",!0)]),_:1},8,["data-source","pagination","loading","row-key"])])]),_:1}),s(V,{key:"task",tab:"任务完成情况"},{default:l(()=>[o("div",qe,[e[19]||(e[19]=o("div",{class:"filter-title"},"筛选查询",-1)),o("div",Re,[s(w,{gutter:16,align:"middle"},{default:l(()=>[s(m,{span:6},{default:l(()=>[s(v,{label:"用户编号：","label-col":{span:8},"wrapper-col":{span:16}},{default:l(()=>[s(g,{value:n.value.userNumber,"onUpdate:value":e[4]||(e[4]=a=>n.value.userNumber=a),placeholder:"请输入"},null,8,["value"])]),_:1})]),_:1}),s(m,{span:6},{default:l(()=>[s(v,{label:"用户姓名：","label-col":{span:8},"wrapper-col":{span:16}},{default:l(()=>[s(g,{value:n.value.userName,"onUpdate:value":e[5]||(e[5]=a=>n.value.userName=a),placeholder:"请输入"},null,8,["value"])]),_:1})]),_:1}),s(m,{span:6},{default:l(()=>[s(v,{label:"单位：","label-col":{span:6},"wrapper-col":{span:18}},{default:l(()=>[s(y,{value:n.value.unit,"onUpdate:value":e[6]||(e[6]=a=>n.value.unit=a),placeholder:"请选择",options:z.value,"allow-clear":""},null,8,["value","options"])]),_:1})]),_:1}),s(m,{span:6},{default:l(()=>[o("div",He,[s(i,{type:"primary",onClick:M},{default:l(()=>e[17]||(e[17]=[r("查询")])),_:1,__:[17]}),s(i,{onClick:O},{default:l(()=>e[18]||(e[18]=[r("重置")])),_:1,__:[18]})])]),_:1})]),_:1})])]),o("div",Je,[o("div",Qe,[o("div",Ge,[s(g,{value:C.value,"onUpdate:value":e[7]||(e[7]=a=>C.value=a),placeholder:"请输入内容","allow-clear":""},{suffix:l(()=>e[20]||(e[20]=[o("span",{class:"search-icon"},"🔍",-1)])),_:1},8,["value"])]),o("div",Ye,[(c(!0),_(b,null,me(W.value,a=>(c(),_("div",{key:a.taskId,class:A(["task-level-item",{active:h.value===a.taskId}]),onClick:u=>X(a.taskId)},p(a.name),11,We))),128))])]),o("div",Xe,[o("div",Ze,[o("div",et,[e[23]||(e[23]=r(" 数据列表 ")),o("span",tt,[e[21]||(e[21]=r("数据共 ")),o("span",at,p(k.value.total),1),e[22]||(e[22]=r(" 条"))])]),s(i,{type:"primary",onClick:K},{default:l(()=>e[24]||(e[24]=[r("导出")])),_:1,__:[24]})]),s(L,{columns:ee,"data-source":B.value,pagination:k.value,loading:P.value,"row-key":a=>a.id,scroll:{x:1200},onChange:ie},{bodyCell:l(({column:a,record:u})=>[a.key==="userNumber"?(c(),_(b,{key:0},[r(p(u.userId),1)],64)):a.key==="userName"?(c(),_("a",st,p(u.nickName),1)):a.key==="unit"?(c(),_(b,{key:2},[r(p(u.orgName||"-"),1)],64)):a.key==="taskStartTime"?(c(),_(b,{key:3},[r(p(D(u.beginTime)),1)],64)):a.key==="taskEndTime"?(c(),_(b,{key:4},[r(p(D(u.endTime)),1)],64)):a.key==="totalTime"?(c(),_(b,{key:5},[r(p(ae(u.beginTime,u.endTime)),1)],64)):a.key==="experimentStatus"?(c(),_("span",{key:6,class:A(["status-tag",le(u.status)])},p(se(u.status)),3)):q("",!0)]),_:1},8,["data-source","pagination","loading","row-key"])])])]),_:1})]),_:1},8,["activeKey"])])])}}}),ct=je(lt,[["__scopeId","data-v-07f6b21b"]]);export{ct as default};
