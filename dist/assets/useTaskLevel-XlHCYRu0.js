import{d as J,_ as P,a1 as U,$,a6 as B,a7 as k,k as C,a9 as G,B as Fe,u as z,F as te,G as O,f as L,y as Te,w as se,n as xe,ag as ce,an as $e,ac as ie,ab as Ie,c as Y,l as ae}from"./vue-PnzzEkKE.js";import{ad as Ae,ak as Se,D as qe,u as Le,f as Ve,e as Me,c as Re,H as Z,K as le,z as oe,I as re,M as H,al as Ue,am as Ne,ab as De,ah as Ke,a1 as p}from"./antd-Cme2pY03.js";import{_ as W}from"./index-DuoXNLgb.js";import{R as Ee,u as Pe}from"./RichTextEditor-CT7zsvWx.js";import{h as de,i as Oe,j as Qe,k as je,l as Be,m as He,b as ue,d as ze}from"./index-BiGxzIPP.js";const Ge={class:"file-tree-container"},Je={class:"tree-content"},We={class:"tree-node-title-wrapper"},Xe={class:"tree-node-title"},Ye={key:0,class:"folder-icon"},Ze={key:1,class:"file-icon"},et=["title"],tt=J({__name:"FileTreeComponent",props:{fileTreeData:{},expandedKeys:{}},emits:["update:expandedKeys","select","menu-click","expand"],setup(h,{emit:v}){const l=v,A=y=>{l("update:expandedKeys",y)},c=(y,r)=>{l("select",y,r)},s=(y,r)=>{l("menu-click",y,r)},g=(y,r)=>{l("expand",y,r)};return(y,r)=>{const _=Ae,w=Me,D=Re,K=Ve,Q=qe,q=Se;return U(),P("div",Ge,[r[10]||(r[10]=$("div",{class:"tree-header"},[$("span",{class:"tree-title"},"æ–‡ä»¶ç›®å½•")],-1)),$("div",Je,[!y.fileTreeData||y.fileTreeData.length===0?(U(),B(_,{key:0,description:"æš‚æ— æ–‡ä»¶",class:"empty-tree"},{image:k(()=>r[1]||(r[1]=[$("div",{class:"empty-icon"},"ğŸ“‚",-1)])),_:1})):(U(),B(q,{key:1,"expanded-keys":y.expandedKeys,"onUpdate:expandedKeys":A,"tree-data":y.fileTreeData,"show-icon":!1,"show-line":!0,onSelect:c,onExpand:g},{title:k(({title:T,isLeaf:V,children:E,key:j})=>[$("span",We,[$("span",Xe,[E!==void 0||V===!1?(U(),P("span",Ye,"ğŸ“")):(U(),P("span",Ze,"ğŸ“„")),$("span",{class:"tree-node-text",title:T},G(T),9,et)]),C(Q,{trigger:["click"],placement:"bottomRight"},{overlay:k(()=>[C(K,{onClick:n=>s(n,{key:j,title:T,isLeaf:V,children:E})},{default:k(()=>[E!==void 0||V===!1?(U(),P(te,{key:0},[C(w,{key:"newFile"},{default:k(()=>r[2]||(r[2]=[$("span",null,"æ–°å»ºæ–‡ä»¶",-1)])),_:1,__:[2]}),C(w,{key:"newFolder"},{default:k(()=>r[3]||(r[3]=[$("span",null,"æ–°å»ºæ–‡ä»¶å¤¹",-1)])),_:1,__:[3]}),C(w,{key:"upload"},{default:k(()=>r[4]||(r[4]=[$("span",null,"ä¸Šä¼ ",-1)])),_:1,__:[4]}),C(D),C(w,{key:"copyPath"},{default:k(()=>r[5]||(r[5]=[$("span",null,"å¤åˆ¶è·¯å¾„",-1)])),_:1,__:[5]}),C(w,{key:"delete",danger:""},{default:k(()=>r[6]||(r[6]=[$("span",null,"åˆ é™¤",-1)])),_:1,__:[6]})],64)):(U(),P(te,{key:1},[C(w,{key:"rename"},{default:k(()=>r[7]||(r[7]=[$("span",null,"é‡å‘½å",-1)])),_:1,__:[7]}),C(w,{key:"copyPath"},{default:k(()=>r[8]||(r[8]=[$("span",null,"å¤åˆ¶è·¯å¾„",-1)])),_:1,__:[8]}),C(w,{key:"delete",danger:""},{default:k(()=>r[9]||(r[9]=[$("span",null,"åˆ é™¤",-1)])),_:1,__:[9]})],64))]),_:2},1032,["onClick"])]),default:k(()=>[$("span",{class:"tree-node-more",onClick:r[0]||(r[0]=Fe(()=>{},["stop"]))},[C(z(Le))])]),_:2},1024)])]),_:1},8,["expanded-keys","tree-data"]))])])}}}),Lt=W(tt,[["__scopeId","data-v-5b6e9659"]]),st={class:"file-preview-area"},nt={key:0,class:"file-preview"},at={class:"file-header"},lt={class:"file-name"},ot={class:"file-content"},rt={class:"download-container"},it={key:1,class:"empty-preview"},ut=J({__name:"FilePreview",props:{selectedFile:{},highlightedCode:{},dynamicFileContents:{}},setup(h){const v=h,l=()=>{var s;const c=v.selectedFile;if(c){if(c.fileUrl){const g=`${window.location.origin}${c.fileUrl}`,y=document.createElement("a");y.href=g,y.download=c.title,y.target="_blank",document.body.appendChild(y),y.click(),document.body.removeChild(y),console.log("ä¸‹è½½æ–‡ä»¶:",g)}else if(c.content||v.dynamicFileContents&&v.dynamicFileContents[c.key]){const g=c.content||((s=v.dynamicFileContents)==null?void 0:s[c.key])||"",y=new Blob([g],{type:"text/plain;charset=utf-8"}),r=URL.createObjectURL(y),_=document.createElement("a");_.href=r,_.download=c.title,document.body.appendChild(_),_.click(),document.body.removeChild(_),URL.revokeObjectURL(r),console.log("ä¸‹è½½æœ¬åœ°æ–‡ä»¶:",c.title)}}},A=()=>{const c=v.selectedFile;return c?!!(c.fileUrl||c.content||v.dynamicFileContents&&v.dynamicFileContents[c.key]):!1};return(c,s)=>{const g=Z;return U(),P("div",st,[c.selectedFile?(U(),P("div",nt,[$("div",at,[s[0]||(s[0]=$("span",{class:"file-icon"},"ğŸ“„",-1)),$("span",lt,G(c.selectedFile.title),1)]),$("div",ot,[$("div",rt,[C(g,{type:"primary",size:"large",disabled:!A(),onClick:l},{default:k(()=>s[1]||(s[1]=[O(" ç‚¹å‡»ä¸‹è½½ ")])),_:1,__:[1]},8,["disabled"])])])])):(U(),P("div",it," åœ¨å·¦ä¾§ä»£ç ä»“åº“åŒºåŸŸç‚¹å‡»ç›®å½•æ‰“å¼€æ–‡ä»¶ "))])}}}),Vt=W(ut,[["__scopeId","data-v-f9714d92"]]);function ct(){const h=L([1]);return{codeLineNumbers:h,updateLineNumbers:c=>{const s=c.split(`
`).length;h.value=Array.from({length:Math.max(s,1)},(g,y)=>y+1)},syncScroll:c=>{var y;const s=c.target,g=(y=s.parentElement)==null?void 0:y.querySelector(".code-editor-line-numbers");g&&(g.scrollTop=s.scrollTop)},handleKeydown:(c,s,g)=>{if(c.key==="Tab"){c.preventDefault();const y=c.target,r=y.selectionStart,_=y.selectionEnd,w=s,D=w.substring(0,r)+"  "+w.substring(_);g(D),Te(()=>{y.selectionStart=y.selectionEnd=r+2})}}}}const dt={class:"min-w-100px max-w-150px"},pt={class:"code-editor-wrapper"},mt={class:"code-editor-line-numbers"},ft={class:"modal-footer"},vt=J({__name:"NewFileModal",props:{open:{type:Boolean},parentPath:{}},emits:["update:open","confirm"],setup(h,{emit:v}){const l=h,A=v,c=L(),s=L({fileName:"",commitMessage:"",fileContent:""}),g={fileName:[{required:!0,message:"è¯·è¾“å…¥æ–‡ä»¶åç§°",trigger:"blur"}],commitMessage:[{required:!0,message:"è¯·è¾“å…¥æäº¤ä¿¡æ¯",trigger:"blur"}],fileContent:[{required:!0,message:"è¯·è¾“å…¥æ–‡ä»¶å†…å®¹",trigger:"blur"}]},{codeLineNumbers:y,updateLineNumbers:r,syncScroll:_,handleKeydown:w}=ct();se(()=>s.value.fileContent,q=>{r(q)});const D=()=>{var q;A("update:open",!1),(q=c.value)==null||q.resetFields()},K=async()=>{var q,T;try{await((q=c.value)==null?void 0:q.validate()),A("confirm",{...s.value}),(T=c.value)==null||T.resetFields()}catch(V){console.error("è¡¨å•éªŒè¯å¤±è´¥ï¼š",V)}},Q=q=>{w(q,s.value.fileContent,T=>{s.value.fileContent=T})};return se(()=>l.open,q=>{var T;q&&(s.value={fileName:"",commitMessage:"",fileContent:""},y.value=[1],(T=c.value)==null||T.clearValidate())}),(q,T)=>{const V=re,E=oe,j=le,n=Z,t=H;return U(),B(t,{open:q.open,title:"æ–°å»ºæ–‡ä»¶",footer:null,width:"880px",centered:"","onUpdate:open":T[4]||(T[4]=i=>q.$emit("update:open",i))},{default:k(()=>[C(j,{ref_key:"formRef",ref:c,model:s.value,rules:g,layout:"vertical"},{default:k(()=>[C(E,{label:"æ–‡ä»¶åç§°æˆ–æ–‡ä»¶è·¯å¾„ï¼š",name:"fileName",required:""},{default:k(()=>[C(V,{value:s.value.fileName,"onUpdate:value":T[0]||(T[0]=i=>s.value.fileName=i),placeholder:"è¯·è¾“å…¥æ–‡ä»¶åç§°"},{addonBefore:k(()=>[$("div",dt,G(q.parentPath),1)]),_:1},8,["value"])]),_:1}),C(E,{label:"æäº¤ä¿¡æ¯ï¼š",name:"commitMessage",required:""},{default:k(()=>[C(V,{value:s.value.commitMessage,"onUpdate:value":T[1]||(T[1]=i=>s.value.commitMessage=i),placeholder:"è¯·è¾“å…¥æœ¬æ¬¡æäº¤çš„ä¸»è¦ä¿¡æ¯ï¼Œåˆç†çš„æä¿¡æ¯æœ‰åˆ©äºä»£å†å²è®°å½•çš„æŸ¥ç†"},null,8,["value"])]),_:1}),C(E,{label:"æ–‡ä»¶å†…å®¹ï¼š",name:"fileContent",required:""},{default:k(()=>[$("div",pt,[$("div",mt,[(U(!0),P(te,null,ce(z(y),i=>(U(),P("div",{key:i,class:"line-number"},G(i),1))),128))]),xe($("textarea",{"onUpdate:modelValue":T[2]||(T[2]=i=>s.value.fileContent=i),class:"code-editor-textarea",placeholder:"è¯·è¾“å…¥æ–‡ä»¶å†…å®¹",onScroll:T[3]||(T[3]=(...i)=>z(_)&&z(_)(...i)),onKeydown:Q,spellcheck:"false"},null,544),[[$e,s.value.fileContent]])])]),_:1})]),_:1},8,["model"]),$("div",ft,[C(n,{onClick:D},{default:k(()=>T[5]||(T[5]=[O("å–æ¶ˆ")])),_:1,__:[5]}),C(n,{type:"primary",onClick:K},{default:k(()=>T[6]||(T[6]=[O("ç¡®å®š")])),_:1,__:[6]})])]),_:1},8,["open"])}}}),Mt=W(vt,[["__scopeId","data-v-8bf29398"]]),gt={class:"min-w-100px max-w-150px"},yt={class:"modal-footer"},ht=J({__name:"NewFolderModal",props:{open:{type:Boolean},parentPath:{}},emits:["update:open","confirm"],setup(h,{emit:v}){const l=h,A=v,c=L(),s=L({folderName:"",commitMessage:""}),g={folderName:[{required:!0,message:"è¯·è¾“å…¥æ–‡ä»¶å¤¹åç§°",trigger:"blur"}],commitMessage:[{required:!0,message:"è¯·è¾“å…¥æäº¤ä¿¡æ¯",trigger:"blur"}]},y=()=>{var _;A("update:open",!1),(_=c.value)==null||_.resetFields()},r=async()=>{var _,w;try{await((_=c.value)==null?void 0:_.validate()),A("confirm",{...s.value}),(w=c.value)==null||w.resetFields()}catch(D){console.error("è¡¨å•éªŒè¯å¤±è´¥ï¼š",D)}};return se(()=>l.open,_=>{var w;_&&(s.value={folderName:"",commitMessage:""},(w=c.value)==null||w.clearValidate())}),(_,w)=>{const D=re,K=oe,Q=le,q=Z,T=H;return U(),B(T,{open:_.open,title:"æ–°å»ºæ–‡ä»¶å¤¹",footer:null,width:"600px",centered:"","onUpdate:open":w[2]||(w[2]=V=>_.$emit("update:open",V))},{default:k(()=>[C(Q,{ref_key:"formRef",ref:c,model:s.value,rules:g,layout:"vertical"},{default:k(()=>[C(K,{label:"æ–‡ä»¶å¤¹åç§°ï¼š",name:"folderName",required:""},{default:k(()=>[C(D,{value:s.value.folderName,"onUpdate:value":w[0]||(w[0]=V=>s.value.folderName=V),placeholder:"è¯·è¾“å…¥æ–‡ä»¶å¤¹åç§°"},{addonBefore:k(()=>[$("div",gt,G(_.parentPath),1)]),_:1},8,["value"])]),_:1}),C(K,{label:"æäº¤ä¿¡æ¯ï¼š",name:"commitMessage",required:""},{default:k(()=>[C(D,{value:s.value.commitMessage,"onUpdate:value":w[1]||(w[1]=V=>s.value.commitMessage=V),placeholder:"è¯·è¾“å…¥æœ¬æ¬¡æäº¤çš„ä¸»è¦ä¿¡æ¯ï¼Œåˆç†çš„æä¿¡æ¯æœ‰åˆ©äºä»£å†å²è®°å½•çš„æŸ¥ç†"},null,8,["value"])]),_:1})]),_:1},8,["model"]),$("div",yt,[C(q,{onClick:y},{default:k(()=>w[3]||(w[3]=[O("å–æ¶ˆ")])),_:1,__:[3]}),C(q,{type:"primary",onClick:r},{default:k(()=>w[4]||(w[4]=[O("ç¡®å®š")])),_:1,__:[4]})])]),_:1},8,["open"])}}}),Rt=W(ht,[["__scopeId","data-v-81b8c3fd"]]),_t={class:"repository-modal-content"},wt={class:"modal-icon"},kt={class:"modal-footer"},Ct=J({__name:"RepositoryModal",props:{open:{type:Boolean}},emits:["update:open","confirm","cancel"],setup(h,{emit:v}){const l=v,A=()=>{l("confirm")},c=()=>{l("cancel")};return(s,g)=>{const y=Z,r=H;return U(),B(r,{open:s.open,title:"å¼€å¯ä»£ç åº“",footer:null,width:"480px",centered:"","onUpdate:open":g[0]||(g[0]=_=>s.$emit("update:open",_))},{default:k(()=>[$("div",_t,[$("div",wt,[C(z(Ue),{style:{color:"#faad14","font-size":"24px"}})]),g[1]||(g[1]=$("div",{class:"modal-text"}," æ–°å»ºå®è·µé¢˜å…³å¡æ—¶ï¼Œéœ€è¦ä½¿ç”¨ä»£ç ä»“åº“ï¼›å¦‚æœåªæœ‰é€‰æ‹©å…³å¡ï¼Œåˆ™ä¸éœ€è¦ä»£ç ä»“åº“ã€‚ä»£ç ä»“åº“å¯ç”¨åï¼Œå°†æ— æ³•å…³é—­ã€‚ ",-1))]),$("div",kt,[C(y,{onClick:c},{default:k(()=>g[2]||(g[2]=[O("ä¸å¼€å¯")])),_:1,__:[2]}),C(y,{type:"primary",onClick:A},{default:k(()=>g[3]||(g[3]=[O("å¼€å¯")])),_:1,__:[3]})])]),_:1},8,["open"])}}}),Ut=W(Ct,[["__scopeId","data-v-a8bbff12"]]),bt={class:"ai-buttons-bar"},Ft={class:"options-list"},Tt=["onClick"],xt=J({__name:"QuestionModal",props:{open:{type:Boolean},question:{},projectId:{},taskId:{},existingQuestions:{}},emits:["update:open","confirm"],setup(h,{emit:v}){const l=h,A=v,c=L(),s=L({id:"",name:"",options:[{id:"1",label:"A",content:"",isCorrect:!1},{id:"2",label:"B",content:"",isCorrect:!1},{id:"3",label:"C",content:"",isCorrect:!1},{id:"4",label:"D",content:"",isCorrect:!1}],answerKey:""}),y={name:[{required:!0,message:"è¯·è¾“å…¥é¢˜å¹²"},{validator:(n,t)=>!t||!t.replace(/<[^>]*>/g,"").trim()?Promise.reject("è¯·è¾“å…¥å†…å®¹"):Promise.resolve()}],answerKey:[{required:!0,message:"è¯·è¾“å…¥ç­”æ¡ˆè§£æ",trigger:"blur"}]},r=n=>{let t=[];try{t=JSON.parse(n.selects||"[]").map((f,I)=>{const x=Object.keys(f)[0];return{id:(I+1).toString(),label:x,content:f[x],isCorrect:n.answer.includes(x)}})}catch{t=[{id:"1",label:"A",content:"",isCorrect:!1},{id:"2",label:"B",content:"",isCorrect:!1},{id:"3",label:"C",content:"",isCorrect:!1},{id:"4",label:"D",content:"",isCorrect:!1}]}return{id:n.id,name:n.name,options:t,answerKey:n.answerKey}};se(()=>l.open,n=>{n&&(l.question?s.value=r(l.question):s.value={id:Date.now().toString(),name:"",options:[{id:"1",label:"A",content:"",isCorrect:!1},{id:"2",label:"B",content:"",isCorrect:!1},{id:"3",label:"C",content:"",isCorrect:!1},{id:"4",label:"D",content:"",isCorrect:!1}],answerKey:""})});const _=()=>{var n;A("update:open",!1),(n=c.value)==null||n.resetFields()},w=n=>{var I,x;const t=n.options.filter(m=>m.content.trim()).map(m=>({[m.label]:m.content})),i=n.options.filter(m=>m.isCorrect).map(m=>m.label).join(",");let f=1;return l.question&&l.question.weight?f=l.question.weight:l.existingQuestions&&l.existingQuestions.length>0&&(f=Math.max(...l.existingQuestions.map(S=>S.weight||0))+1),{id:n.id,name:n.name,answer:i,answerKey:n.answerKey,selects:JSON.stringify(t),projectId:l.projectId||((I=l.question)==null?void 0:I.projectId),taskId:l.taskId||((x=l.question)==null?void 0:x.taskId),weight:f}},D=async()=>{var n,t,i,f;try{if(await((n=c.value)==null?void 0:n.validate()),!s.value.options.some(b=>b.content.trim())){p.error("è¯·è‡³å°‘å¡«å†™ä¸€ä¸ªé€‰é¡¹");return}if(!s.value.options.some(b=>b.isCorrect)){p.error("è¯·è‡³å°‘è®¾ç½®ä¸€ä¸ªæ­£ç¡®ç­”æ¡ˆ");return}if(!l.projectId){p.error("é¡¹ç›®IDä¸å­˜åœ¨");return}if(!l.taskId){p.error("ä»»åŠ¡å…³å¡IDä¸å­˜åœ¨ï¼Œè¯·å…ˆä¿å­˜ä»»åŠ¡å…³å¡");return}const m=w(s.value),S=l.question&&l.question.id;console.log("=== é¢˜ç›®å‚æ•° ==="),console.log("æ“ä½œæ¨¡å¼:",S?"ç¼–è¾‘":"æ–°å¢"),console.log("é¢˜ç›®ID (id):",m.id),console.log("é¢˜ç›®æ•°æ®:",m),console.log("é¡¹ç›®ID (projectId):",m.projectId),console.log("ä»»åŠ¡ID (taskId):",m.taskId),console.log("æ’åºæƒé‡ (weight):",m.weight),console.log("å·²æœ‰é¢˜ç›®æ•°é‡:",((t=l.existingQuestions)==null?void 0:t.length)||0),console.log("==================");try{if(S){console.log("ç¼–è¾‘æ¨¡å¼ï¼šè°ƒç”¨æ›´æ–°æ¥å£");const b=await de({id:parseInt(m.id),name:m.name,answer:m.answer,answerKey:m.answerKey,selects:m.selects,projectId:m.projectId,taskId:m.taskId,weight:m.weight});console.log("é¢˜ç›®æ›´æ–°æˆåŠŸï¼Œè¿”å›æ•°æ®:",b),p.success("é¢˜ç›®æ›´æ–°æˆåŠŸ"),A("confirm",m),A("update:open",!1),(i=c.value)==null||i.resetFields()}else{const b=await Oe({name:m.name,answer:m.answer,answerKey:m.answerKey,selects:m.selects,projectId:m.projectId,taskId:m.taskId,weight:m.weight});console.log("é¢˜ç›®åˆ›å»ºæˆåŠŸï¼Œè¿”å›æ•°æ®:",b),p.success("é¢˜ç›®åˆ›å»ºæˆåŠŸ"),m.id=b.id.toString(),A("confirm",m),A("update:open",!1),(f=c.value)==null||f.resetFields()}}catch(b){console.error(S?"é¢˜ç›®æ›´æ–°å¤±è´¥:":"é¢˜ç›®åˆ›å»ºå¤±è´¥:",b),p.error(b.message||(S?"é¢˜ç›®æ›´æ–°å¤±è´¥ï¼Œè¯·é‡è¯•":"é¢˜ç›®åˆ›å»ºå¤±è´¥ï¼Œè¯·é‡è¯•"))}}catch{p.error("è¯·å®Œå–„å¿…å¡«ä¿¡æ¯")}},K=n=>{s.value.options.forEach(i=>{i.isCorrect=!1});const t=s.value.options.find(i=>i.id===n);t&&(t.isCorrect=!0)},Q=n=>{if(s.value.options.length<=2){p.warning("è‡³å°‘ä¿ç•™2ä¸ªé€‰é¡¹");return}const t=s.value.options.findIndex(i=>i.id===n);t!==-1&&(s.value.options.splice(t,1),s.value.options.forEach((i,f)=>{i.label=String.fromCharCode(65+f)}))},q=()=>{if(s.value.options.length>=10){p.warning("æœ€å¤šæ·»åŠ 10ä¸ªé€‰é¡¹");return}const n=String.fromCharCode(65+s.value.options.length);s.value.options.push({id:Date.now().toString(),label:n,content:"",isCorrect:!1})},T=L(!1),V=L(!1),E=async()=>{if(!s.value.name){p.warning("è¯·å…ˆè¾“å…¥é¢˜å¹²å†…å®¹");return}if(!s.value.name.replace(/<[^>]*>/g,"").trim()){p.warning("è¯·å…ˆè¾“å…¥é¢˜å¹²å†…å®¹");return}try{V.value=!0,p.loading("AIæ­£åœ¨æ¶¦è‰²é¢˜å¹²ï¼Œè¯·ç¨å€™...",0);const t=await Qe(s.value.name);p.destroy(),s.value.name=t,p.success("AIæ¶¦è‰²æˆåŠŸ")}catch(t){p.destroy(),console.error("AIæ¶¦è‰²å¤±è´¥:",t),p.error(t.message||"AIæ¶¦è‰²å¤±è´¥ï¼Œè¯·é‡è¯•")}finally{V.value=!1}},j=async()=>{if(!s.value.name){p.warning("è¯·å…ˆè¾“å…¥é¢˜å¹²å†…å®¹");return}if(!s.value.name.replace(/<[^>]*>/g,"").trim()){p.warning("è¯·å…ˆè¾“å…¥é¢˜å¹²å†…å®¹");return}try{T.value=!0,p.loading("AIæ­£åœ¨ç”Ÿæˆé¢˜ç›®ï¼Œè¯·ç¨å€™...",0);const t=await je(s.value.name);if(p.destroy(),console.log("=== AIå‡ºé¢˜è¿”å›æ•°æ® ==="),console.log("è¿”å›ç»“æœ:",t),t.title&&(s.value.name=t.title),t.options&&Array.isArray(t.options)&&t.options.length>0){const i=t.options.map((f,I)=>{const x=String.fromCharCode(65+I);return{id:(I+1).toString(),label:x,content:f,isCorrect:!1}});s.value.options=i}if(t.answer){const i=t.answer.split(",").map(f=>f.trim());s.value.options.forEach(f=>{f.isCorrect=i.includes(f.label)})}t.analysis&&(s.value.answerKey=t.analysis),p.success("AIå‡ºé¢˜æˆåŠŸ")}catch(t){p.destroy(),console.error("AIå‡ºé¢˜å¤±è´¥:",t),p.error(t.message||"AIå‡ºé¢˜å¤±è´¥ï¼Œè¯·é‡è¯•")}finally{T.value=!1}};return(n,t)=>{const i=Z,f=oe,I=re,x=Ke,m=le,S=H;return U(),B(S,{open:n.open,title:n.question?"ç¼–è¾‘é¢˜ç›®":"æ·»åŠ é¢˜ç›®",width:"900px","mask-closable":!1,onCancel:_},{footer:k(()=>[C(i,{onClick:_},{default:k(()=>t[5]||(t[5]=[O("å–æ¶ˆ")])),_:1,__:[5]}),C(i,{type:"primary",onClick:D},{default:k(()=>t[6]||(t[6]=[O("ä¿å­˜")])),_:1,__:[6]})]),default:k(()=>[C(m,{ref_key:"formRef",ref:c,model:s.value,rules:y,layout:"vertical"},{default:k(()=>[C(f,{label:"é¢˜å¹²",name:"name",required:""},{default:k(()=>[$("div",bt,[C(i,{type:"primary",onClick:j,loading:T.value,size:"small"},{default:k(()=>t[2]||(t[2]=[O(" AIå‡ºé¢˜ ")])),_:1,__:[2]},8,["loading"]),C(i,{type:"primary",onClick:E,loading:V.value,size:"small"},{default:k(()=>t[3]||(t[3]=[O(" AIæ¶¦è‰² ")])),_:1,__:[3]},8,["loading"])]),C(Ee,{modelValue:s.value.name,"onUpdate:modelValue":t[0]||(t[0]=b=>s.value.name=b),placeholder:"è¯·æ‚¨è¾“å…¥é¢˜å¹²",height:150,"show-ai-embellish":!1},null,8,["modelValue"])]),_:1}),C(f,{required:""},{label:k(()=>t[4]||(t[4]=[$("span",null,[O("ç­”æ¡ˆé€‰é¡¹ "),$("span",{class:"options-hint ml-12px"},"ç‚¹å‡»å­—æ¯è®¾ç½®æ­£ç¡®ç­”æ¡ˆï¼ˆå•é€‰ï¼‰")],-1)])),default:k(()=>[$("div",Ft,[(U(!0),P(te,null,ce(s.value.options,b=>(U(),P("div",{key:b.id,class:"option-item"},[$("div",{class:Ie(["option-label",{"is-correct":b.isCorrect}]),onClick:N=>K(b.id)},G(b.label),11,Tt),C(I,{value:b.content,"onUpdate:value":N=>b.content=N,placeholder:"è¯·è¾“å…¥é€‰é¡¹å†…å®¹",class:"option-input"},null,8,["value","onUpdate:value"]),s.value.options.length>2?(U(),B(z(Ne),{key:0,class:"remove-icon",onClick:N=>Q(b.id)},null,8,["onClick"])):ie("",!0),b.id===s.value.options[s.value.options.length-1].id&&s.value.options.length<10?(U(),B(z(De),{key:1,class:"add-icon",onClick:q})):ie("",!0)]))),128))])]),_:1}),C(f,{label:"ç­”æ¡ˆè§£æ",name:"answerKey",required:""},{default:k(()=>[C(x,{value:s.value.answerKey,"onUpdate:value":t[1]||(t[1]=b=>s.value.answerKey=b),placeholder:"è¯·è¾“å…¥ç­”æ¡ˆè§£æ",rows:1},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title"])}}}),Nt=W(xt,[["__scopeId","data-v-403b19b6"]]);function Dt(){const h=L([]),v=L([]),l=L(null),A=L({}),c=L({}),s=n=>A.value[n]?A.value[n]:`// æ–‡ä»¶å†…å®¹åŠ è½½ä¸­...
// è¯·ä»Gitä»“åº“åŠ è½½æ–‡ä»¶`,g=n=>{var f;const t=(f=n.split(".").pop())==null?void 0:f.toLowerCase();return{vue:"vue",js:"javascript",ts:"typescript",html:"html",css:"css",json:"json",md:"markdown"}[t||""]||"javascript"},y=(n,t)=>{var m;if(n.length===0||!t.node)return;const i=t.node;if(!i.isLeaf)return;const f=n[0],I=i.title,x=((m=i.dataRef)==null?void 0:m.fileUrl)||i.fileUrl;l.value={key:f,title:I,content:"",fileUrl:x||null},console.log("é€‰ä¸­æ–‡ä»¶:",{key:f,title:I,fileUrl:x})},r=Y(()=>""),_=n=>{const t=(i,f,I="")=>{for(const x of i){const m=I+"/"+x.title;if(x.key===f)return m;if(x.children){const S=t(x.children,f,m);if(S)return S}}return null};return t(h.value,n)||"/"},w=(n,t,i)=>{const f=`0-new-file-${Date.now()}`,I={title:n,key:f,isLeaf:!0};A.value[f]=t;const x=i==="/"?n:`${i.replace(/^\//,"")}/${n}`;if(c.value[f]=x,i==="/")h.value.push(I);else{const m=(S,b)=>{for(const N of S){const ee=c.value[N.key]||_(N.key);if(ee===b||ee===b.replace(/^\//,""))return N.children||(N.children=[]),N.children.push(I),v.value.includes(N.key)||v.value.push(N.key),!0;if(N.children&&m(N.children,b))return!0}return!1};m(h.value,i)}},D=(n,t)=>{const i=`0-new-folder-${Date.now()}`,f={title:n,key:i,isLeaf:!1,children:[]},I=t==="/"?n:`${t.replace(/^\//,"")}/${n}`;if(c.value[i]=I,t==="/")h.value.push(f);else{const x=(m,S)=>{for(const b of m){const N=c.value[b.key]||_(b.key);if(N===S||N===S.replace(/^\//,""))return b.children||(b.children=[]),b.children.push(f),v.value.includes(b.key)||v.value.push(b.key),!0;if(b.children&&x(b.children,S))return!0}return!1};x(h.value,t)}v.value.push(i)},K=n=>{H.confirm({title:"é‡å‘½å",content:ae("div",[ae("p",`å½“å‰åç§°ï¼š${n.title}`),ae("input",{id:"rename-input",placeholder:"è¯·è¾“å…¥æ–°åç§°",style:"width: 100%; padding: 4px 11px; border: 1px solid #d9d9d9; border-radius: 2px;"})]),onOk:()=>{const t=document.getElementById("rename-input"),i=t==null?void 0:t.value.trim();if(!i)return p.error("è¯·è¾“å…¥æ–°åç§°"),Promise.reject();const f=I=>{for(const x of I){if(x.key===n.key)return x.title=i,p.success("é‡å‘½åæˆåŠŸ"),!0;if(x.children&&f(x.children))return!0}return!1};f(h.value),l.value&&l.value.key===n.key&&(l.value.title=i)}})},Q=n=>{const t=_(n.key);navigator.clipboard.writeText(t).then(()=>{p.success(`è·¯å¾„å·²å¤åˆ¶åˆ°å‰ªè´´æ¿: ${t}`)}).catch(()=>{p.error("å¤åˆ¶å¤±è´¥")})},q=n=>{const t=n.children!==void 0||n.isLeaf===!1;H.confirm({title:"ç¡®è®¤åˆ é™¤",content:`ç¡®å®šè¦åˆ é™¤${t?"æ–‡ä»¶å¤¹":"æ–‡ä»¶"} "${n.title}" å—ï¼Ÿ${t?"æ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰å†…å®¹ä¹Ÿä¼šè¢«åˆ é™¤ã€‚":""}`,okText:"ç¡®å®š",cancelText:"å–æ¶ˆ",okType:"danger",onOk:()=>{const i=f=>{var x;const I=f.findIndex(m=>m.key===n.key);if(I!==-1)return f.splice(I,1),p.success("åˆ é™¤æˆåŠŸ"),((x=l.value)==null?void 0:x.key)===n.key&&(l.value=null),A.value[n.key]&&delete A.value[n.key],!0;for(const m of f)if(m.children&&i(m.children))return!0;return!1};i(h.value)}})},T=(n,t="0",i="")=>!n||!Array.isArray(n)?(console.warn("convertApiDataToTreeNodes: apiData is not an array",n),[]):n.map((f,I)=>{const x=`${t}-${I}`,m=i?`${i}/${f.fileName}`:f.fileName,S={title:f.fileName||"untitled",key:x,fileUrl:f.fileUrl||null};return c.value[x]=m,f.fileType==="dir"?(S.isLeaf=!1,S.children=[]):S.isLeaf=!0,S});return{fileTreeData:h,expandedKeys:v,selectedFile:l,dynamicFileContents:A,highlightedCode:r,getFileContent:s,getLanguageByFilename:g,handleSelectFile:y,getNodePath:_,addFileToTree:w,addFolderToTree:D,handleRenameNode:K,handleCopyPath:Q,handleDeleteNode:q,loadRemoteFileTree:n=>{try{console.log("åŠ è½½è¿œç¨‹æ–‡ä»¶æ ‘ï¼ŒåŸå§‹æ•°æ®:",n),c.value={},A.value={};const t=T(n,"0","");console.log("è½¬æ¢åçš„æ ‘èŠ‚ç‚¹:",t),h.value=t,v.value=[],l.value=null}catch(t){console.error("åŠ è½½æ–‡ä»¶æ ‘å¤±è´¥:",t),h.value=[]}},loadChildrenData:(n,t)=>{try{console.log("åŠ è½½å­æ–‡ä»¶å¤¹æ•°æ®:",{nodeKey:n,apiData:t});const i=c.value[n]||"",f=T(t,n,i);console.log("è½¬æ¢åçš„å­èŠ‚ç‚¹:",f);const I=m=>{for(const S of m){if(S.key===n)return S.children=f,!0;if(S.children&&I(S.children))return!0}return!1};I(h.value)||console.warn("æœªæ‰¾åˆ°å¯¹åº”çš„èŠ‚ç‚¹è¿›è¡Œæ›´æ–°:",n)}catch(i){console.error("åŠ è½½å­æ–‡ä»¶å¤¹å¤±è´¥:",i)}},getNodePathFromMap:n=>c.value[n]||""}}function Kt(h){const v=L([]),l=L(""),A=L("task"),c=L(),s=L(),g=L({name:"",source:"",require:"",referenceAnswer:"",difficulty:2,tag:"",classHour:"",jumpUrl:"",type:1,projectId:(h==null?void 0:h.value)||void 0,weight:0}),y=L([]),r=L({timeLimitM:0,userFiles:[],testValidateFiles:[],testValidateSh:"",passType:1,passTypeRule:"",blankCode:1,scoreRule:1,testValidateType:1,testContent:[]}),_=L([]),w=L([]),D=(o,e)=>!e||!e.replace(/<[^>]*>/g,"").trim()?Promise.reject("è¯·è¾“å…¥å†…å®¹"):Promise.resolve(),K={name:[{required:!0,message:"è¯·è¾“å…¥ä»»åŠ¡åç§°",trigger:"blur"}],source:[{required:!0,message:"è¯·ä¸Šä¼ å­¦ä¹ èµ„æº",trigger:"change"}],require:[{required:!0,message:""},{validator:D}],referenceAnswer:[{required:!0,message:""},{validator:D}],difficulty:[{required:!0,message:"è¯·é€‰æ‹©éš¾åº¦ç³»æ•°",trigger:"change"}],tag:[{required:!0,message:"è¯·è¾“å…¥æŠ€èƒ½æ ‡ç­¾",trigger:"blur"}],classHour:[{required:!0,message:"è¯·è¾“å…¥ä»»åŠ¡å­¦æ—¶",trigger:"blur"}],jumpUrl:[{required:!0,message:"è¯·è¾“å…¥å†…åµŒé“¾æ¥",trigger:"blur"}]},Q={timeLimitM:[{required:!0,message:"è¯·è¾“å…¥è¯„æµ‹æ—¶é•¿é™åˆ¶",trigger:"blur"}],userFiles:[{required:!0,message:"è¯·ä¸Šä¼ å­¦å‘˜ä»»åŠ¡æ–‡ä»¶",trigger:"change",type:"array",min:1}],testValidateFiles:[{required:!0,message:"è¯·ä¸Šä¼ è¯„æµ‹æ‰§è¡Œæ–‡ä»¶",trigger:"change",type:"array",min:1}],testValidateSh:[{required:!0,message:"è¯·è¾“å…¥è¯„æµ‹æ‰§è¡Œå‘½ä»¤",trigger:"blur"}]},q=Y(()=>{if(!l.value)return!1;const o=v.value.find(e=>e.id===l.value);return(o==null?void 0:o.type)==="kernel"}),T=Y(()=>{if(!l.value)return!1;const o=v.value.find(e=>e.id===l.value);return(o==null?void 0:o.type)==="choice"}),V=Y(()=>{if(!l.value)return!1;const o=v.value.find(e=>e.id===l.value);return(o==null?void 0:o.type)==="programming"}),E=o=>{if(v.value.some(F=>!F.taskId)){p.warning("è¯·å…ˆä¿å­˜å½“å‰æœªä¿å­˜çš„ä»»åŠ¡å…³å¡ï¼Œå†æ·»åŠ æ–°å…³å¡");return}if(l.value){const F=v.value.find(R=>R.id===l.value);if(F&&F.taskId){if(F.type==="choice"&&(!F.questions||F.questions.length===0)){p.warning("è¯·è‡³å°‘æ–°å¢ä¸€æ¡é¢˜ç›®"),A.value="questions";return}if(F.type==="programming"&&(!F.evaluationSettings||!F.evaluationSettings.testContent||F.evaluationSettings.testContent.length===0)){p.warning("è¯·å…ˆé…ç½®è¯„æµ‹è®¾ç½®åå†æ·»åŠ æ–°å…³å¡"),A.value="evaluation";return}}}const a={programming:"ç¼–ç¨‹å®è®­ä»»åŠ¡å…³å¡",choice:"é€‰æ‹©é¢˜å®è®­ä»»åŠ¡å…³å¡",kernel:"å†…æ ¸é“¾æ¥å®è®­ä»»åŠ¡å…³å¡"},u=v.value.reduce((F,R)=>Math.max(F,R.weight||0),0),d={id:Date.now().toString(),name:`ç¬¬${v.value.length+1}å…³ï¼š${a[o]}`,type:o,source:"",require:"",referenceAnswer:"",difficulty:2,tag:"",classHour:"",weight:u+1};v.value.push(d),l.value=d.id,A.value="task",t(d.id),p.success("ä»»åŠ¡å…³å¡æ·»åŠ æˆåŠŸ")},j=o=>{var a;const e=v.value.findIndex(u=>u.id===o);e!==-1&&(v.value.splice(e,1),v.value.forEach((u,d)=>{const F=u.name.match(/^ç¬¬\d+å…³ï¼š(.+)$/);if(F)u.name=`ç¬¬${d+1}å…³ï¼š${F[1]}`;else{const R=u.name.indexOf("ï¼š");if(R!==-1){const X=u.name.substring(R+1);u.name=`ç¬¬${d+1}å…³ï¼š${X}`}else u.name=`ç¬¬${d+1}å…³ï¼š${u.name}`}}),l.value===o&&(l.value=((a=v.value[0])==null?void 0:a.id)||""),l.value&&t(l.value),p.success("ä»»åŠ¡å…³å¡åˆ é™¤æˆåŠŸ"))},n=async o=>{l.value&&l.value!==o&&i(l.value),l.value=o,A.value="task",t(o);const e=v.value.find(a=>a.id===o);e&&e.type==="choice"&&e.taskId&&await ne(e.taskId)},t=o=>{const e=v.value.find(a=>a.id===o);if(e){if(e.source){const u=e.source.split(",").filter(d=>d.trim());y.value=u.map((d,F)=>{const R=d.trim();return{uid:`${Date.now()}-${F}`,name:R.substring(R.lastIndexOf("/")+1),status:"done",url:R}})}else y.value=[];const a={programming:1,choice:2,kernel:4};g.value={name:e.name,source:e.source||"",require:e.require,referenceAnswer:e.referenceAnswer,difficulty:e.difficulty,tag:e.tag,classHour:e.classHour,jumpUrl:e.jumpUrl||"",type:a[e.type]||3,projectId:(h==null?void 0:h.value)||void 0,taskId:e.taskId,weight:e.weight||0},e.evaluationSettings?(r.value={...e.evaluationSettings},e.evaluationSettings.userFiles&&Array.isArray(e.evaluationSettings.userFiles)?_.value=e.evaluationSettings.userFiles:_.value=[],e.evaluationSettings.testValidateFiles&&Array.isArray(e.evaluationSettings.testValidateFiles)?w.value=e.evaluationSettings.testValidateFiles:w.value=[]):(r.value={timeLimitM:0,userFiles:[],testValidateFiles:[],testValidateSh:"",passType:1,passTypeRule:"",blankCode:1,scoreRule:1,testValidateType:1,testContent:[]},_.value=[],w.value=[])}},i=o=>{const e=v.value.find(a=>a.id===o);if(e){const a=e.questions;e.source=g.value.source,e.require=g.value.require,e.referenceAnswer=g.value.referenceAnswer,e.difficulty=g.value.difficulty,e.tag=g.value.tag,e.classHour=g.value.classHour,e.jumpUrl=g.value.jumpUrl,e.weight=g.value.weight||0,g.value.taskId&&(e.taskId=g.value.taskId),e.questions=a,e.evaluationSettings={...r.value}}},f=async o=>{const{file:e,onSuccess:a,onError:u}=o;try{const d=await Pe(e);a({url:d},e)}catch(d){u(d)}},I=o=>{var d;const{file:e,fileList:a}=o;e.status==="done"?p.success(`${e.name} æ–‡ä»¶ä¸Šä¼ æˆåŠŸ`):e.status==="error"&&p.error(`${e.name} æ–‡ä»¶ä¸Šä¼ å¤±è´¥`),y.value=a.map(F=>{var R;return{uid:F.uid,name:F.name,status:F.status,url:((R=F.response)==null?void 0:R.url)||F.url||""}});const u=y.value.filter(F=>F.url).map(F=>F.url).join(",");g.value.source=u,(d=c.value)==null||d.validateFields(["source"])},x=async()=>{var o,e,a;try{if(q.value||T.value)await((o=c.value)==null?void 0:o.validate());else if(V.value){if(await Promise.all([(e=c.value)==null?void 0:e.validate(),(a=s.value)==null?void 0:a.validate()]),g.value.taskId&&r.value.testValidateType===1&&r.value.testContent.length===0)throw p.error("ç”¨ä¾‹ç±»å‹ä¸ºæ–‡æœ¬æ—¶ï¼Œå¿…é¡»è‡³å°‘åˆ›å»ºä¸€æ¡æµ‹è¯•é›†"),new Error("ç”¨ä¾‹ç±»å‹ä¸ºæ–‡æœ¬æ—¶ï¼Œå¿…é¡»è‡³å°‘åˆ›å»ºä¸€æ¡æµ‹è¯•é›†");if(g.value.taskId&&r.value.testValidateType===1&&r.value.testContent.length>0&&r.value.testContent.find(R=>!R.arg.trim()||!R.answer.trim()))throw p.error("æµ‹è¯•é›†çš„è¾“å…¥å†…å®¹å’ŒæœŸæœ›è¾“å‡ºä¸èƒ½ä¸ºç©º"),new Error("æµ‹è¯•é›†çš„è¾“å…¥å†…å®¹å’ŒæœŸæœ›è¾“å‡ºä¸èƒ½ä¸ºç©º")}let u={...g.value};if(V.value){const F=r.value.testContent.map(M=>({arg:M.arg,answer:M.answer,select:M.select})),R=r.value.userFiles.filter(M=>M.url).map(M=>M.url).join(","),X=r.value.testValidateFiles.filter(M=>M.url).map(M=>M.url).join(",");u={...u,timeLimitM:r.value.timeLimitM,userFiles:R,testValidateFiles:X,passType:r.value.passType,passTypeRule:r.value.passTypeRule,blankCode:r.value.blankCode,scoreRule:r.value.scoreRule,testValidateSh:r.value.testValidateSh,testValidateType:r.value.testValidateType,testContent:JSON.stringify(F)}}console.log("å‡†å¤‡æäº¤çš„æ•°æ®:",u);let d;g.value.taskId?(d=await ue({...u,taskId:g.value.taskId}),console.log("ä»»åŠ¡å…³å¡æ›´æ–°æˆåŠŸï¼Œè¿”å›æ•°æ®:",d),p.success("æ›´æ–°æˆåŠŸ")):(d=await ze(u),console.log("ä»»åŠ¡å…³å¡åˆ›å»ºæˆåŠŸï¼Œè¿”å›æ•°æ®:",d),d.taskId&&(g.value.taskId=d.taskId,console.log("å·²ä¿å­˜ taskId:",d.taskId)),p.success("ä¿å­˜æˆåŠŸ")),l.value&&i(l.value)}catch(u){throw console.error("ä¿å­˜ä»»åŠ¡å…³å¡å¤±è´¥:",u),p.error("è¯·å®Œå–„å¿…å¡«ä¿¡æ¯"),u}},m=async()=>{l.value&&(i(l.value),console.log("å·²åŒæ­¥å½“å‰é€‰ä¸­å…³å¡çš„è¡¨å•æ•°æ®åˆ°æœ¬åœ°çŠ¶æ€"));const o=v.value.filter(a=>a.taskId);if(o.length===0){console.log("æ²¡æœ‰éœ€è¦æ›´æ–°çš„ä»»åŠ¡å…³å¡");return}console.log(`å¼€å§‹æ‰¹é‡æ›´æ–° ${o.length} ä¸ªä»»åŠ¡å…³å¡`);const e=[];for(const a of o)try{let u={taskId:a.taskId,name:a.name,source:a.source,require:a.require,referenceAnswer:a.referenceAnswer,difficulty:a.difficulty,tag:a.tag,classHour:a.classHour,jumpUrl:a.jumpUrl,projectId:(h==null?void 0:h.value)||void 0,weight:a.weight||0};if(a.type==="kernel")u.type=4;else if(a.type==="choice")u.type=2;else if(a.type==="programming"&&(u.type=1,a.evaluationSettings)){const d=a.evaluationSettings,F=d.testContent.map(M=>({arg:M.arg,answer:M.answer,select:M.select})),R=d.userFiles.filter(M=>M.url).map(M=>M.url).join(","),X=d.testValidateFiles.filter(M=>M.url).map(M=>M.url).join(",");u={...u,timeLimitM:d.timeLimitM,userFiles:R,testValidateFiles:X,passType:d.passType,passTypeRule:d.passTypeRule,blankCode:d.blankCode,scoreRule:d.scoreRule,testValidateSh:d.testValidateSh,testValidateType:d.testValidateType,testContent:JSON.stringify(F)}}await ue(u),console.log(`ä»»åŠ¡å…³å¡ "${a.name}" æ›´æ–°æˆåŠŸ`)}catch(u){const d=`ä»»åŠ¡å…³å¡ "${a.name}" æ›´æ–°å¤±è´¥: ${u.message||"æœªçŸ¥é”™è¯¯"}`;console.error(d,u),e.push(d)}if(e.length===0)p.success(`æˆåŠŸæ›´æ–° ${o.length} ä¸ªä»»åŠ¡å…³å¡`);else throw e.length<o.length?(p.warning(`éƒ¨åˆ†ä»»åŠ¡å…³å¡æ›´æ–°å¤±è´¥ï¼š${e.join("; ")}`),new Error("éƒ¨åˆ†ä»»åŠ¡å…³å¡æ›´æ–°å¤±è´¥")):(p.error("æ‰€æœ‰ä»»åŠ¡å…³å¡æ›´æ–°å¤±è´¥"),new Error("æ‰€æœ‰ä»»åŠ¡å…³å¡æ›´æ–°å¤±è´¥"))},S=()=>{H.confirm({title:"ç¡®è®¤é‡ç½®",content:"ç¡®å®šè¦é‡ç½®è¡¨å•å—ï¼Ÿæ‰€æœ‰æœªä¿å­˜çš„æ•°æ®å°†ä¼šä¸¢å¤±ã€‚",okText:"ç¡®å®š",cancelText:"å–æ¶ˆ",onOk:()=>{var e,a;let o=1;if(l.value){const u=v.value.find(d=>d.id===l.value);u&&(o={programming:1,choice:2,kernel:4}[u.type]||1)}g.value={name:"",source:"",require:"",referenceAnswer:"",difficulty:2,tag:"",classHour:"",jumpUrl:"",type:o,projectId:(h==null?void 0:h.value)||void 0,weight:0},r.value={timeLimitM:0,userFiles:[],testValidateFiles:[],testValidateSh:"",passType:1,passTypeRule:"",blankCode:1,scoreRule:1,testValidateType:1,testContent:[]},y.value=[],_.value=[],w.value=[],(e=c.value)==null||e.clearValidate(),(a=s.value)==null||a.clearValidate(),p.success("å·²é‡ç½®")}})},b=o=>{var u;const{file:e,fileList:a}=o;e.status==="done"?p.success(`${e.name} æ–‡ä»¶ä¸Šä¼ æˆåŠŸ`):e.status==="error"&&p.error(`${e.name} æ–‡ä»¶ä¸Šä¼ å¤±è´¥`),_.value=a.map(d=>{var F;return{uid:d.uid,name:d.name,status:d.status,url:((F=d.response)==null?void 0:F.url)||d.url||""}}),r.value.userFiles=[..._.value],(u=s.value)==null||u.validateFields(["userFiles"])},N=o=>{var u;const{file:e,fileList:a}=o;e.status==="done"?p.success(`${e.name} æ–‡ä»¶ä¸Šä¼ æˆåŠŸ`):e.status==="error"&&p.error(`${e.name} æ–‡ä»¶ä¸Šä¼ å¤±è´¥`),w.value=a.map(d=>{var F;return{uid:d.uid,name:d.name,status:d.status,url:((F=d.response)==null?void 0:F.url)||d.url||""}}),r.value.testValidateFiles=[...w.value],(u=s.value)==null||u.validateFields(["testValidateFiles"])},ee=o=>{var a;const e=o.map((u,d)=>({uid:`${Date.now()}-${d}`,name:u.name,status:"done",url:u.path}));_.value=e,r.value.userFiles=[..._.value],(a=s.value)==null||a.validateFields(["userFiles"]),p.success(`å·²é€‰æ‹© ${o.length} ä¸ªæ–‡ä»¶`)},pe=o=>{var a;const e=o.map((u,d)=>({uid:`${Date.now()}-${d}`,name:u.name,status:"done",url:u.path}));w.value=e,r.value.testValidateFiles=[...w.value],(a=s.value)==null||a.validateFields(["testValidateFiles"]),p.success(`å·²é€‰æ‹© ${o.length} ä¸ªæ–‡ä»¶`)},me=()=>{r.value.testContent.push({id:Date.now().toString(),arg:"",answer:"",select:1})},fe=o=>{const e=r.value.testContent.findIndex(a=>a.id===o);e!==-1&&(r.value.testContent.splice(e,1),p.success("åˆ é™¤æˆåŠŸ"))},ve=()=>{r.value.testContent=[],p.success("å·²æ¸…ç©ºæ‰€æœ‰æµ‹è¯•ç”¨ä¾‹")},ge=()=>{p.info("ä¸‹è½½åŠŸèƒ½å¼€å‘ä¸­...")},ye=()=>{p.info("æ‰¹é‡ä¸Šä¼ åŠŸèƒ½å¼€å‘ä¸­...")},he=Y(()=>{if(!l.value)return[];const o=v.value.find(e=>e.id===l.value);return(o==null?void 0:o.questions)||[]}),_e=o=>{if(!l.value)return;const e=v.value.find(a=>a.id===l.value);e&&(e.questions||(e.questions=[]),e.questions.push(o),p.success("é¢˜ç›®æ·»åŠ æˆåŠŸ"))},we=async o=>{l.value&&H.confirm({title:"ç¡®è®¤åˆ é™¤",content:"ç¡®å®šè¦åˆ é™¤è¿™é“é¢˜ç›®å—ï¼Ÿåˆ é™¤åæ— æ³•æ¢å¤ã€‚",okText:"ç¡®å®š",cancelText:"å–æ¶ˆ",async onOk(){try{console.log("å¼€å§‹åˆ é™¤é¢˜ç›®ï¼ŒID:",o),await He({id:parseInt(o)}),console.log("é¢˜ç›®åˆ é™¤æˆåŠŸ"),p.success("é¢˜ç›®åˆ é™¤æˆåŠŸ");const e=v.value.find(a=>a.id===l.value);if(e&&e.questions){const a=e.questions.findIndex(u=>u.id===o);a!==-1&&e.questions.splice(a,1)}e&&e.taskId&&await ne(e.taskId)}catch(e){console.error("é¢˜ç›®åˆ é™¤å¤±è´¥:",e),p.error(e.message||"é¢˜ç›®åˆ é™¤å¤±è´¥ï¼Œè¯·é‡è¯•")}}})},ke=o=>{if(!l.value)return;const e=v.value.find(a=>a.id===l.value);if(e&&e.questions){const a=e.questions.findIndex(u=>u.id===o.id);a!==-1&&(e.questions[a]=o,p.success("é¢˜ç›®æ›´æ–°æˆåŠŸ"))}},Ce=o=>{if(!l.value)return;const e=v.value.find(a=>a.id===l.value);e&&(e.questions=o)},be=async o=>{if(!(h!=null&&h.value))throw new Error("é¡¹ç›®IDä¸å­˜åœ¨");try{console.log("æ‰¹é‡æ›´æ–°é¢˜ç›®æ’åºï¼Œå…±",o.length,"ä¸ªé¢˜ç›®");const e=o.map(a=>de({id:parseInt(a.id),name:a.name,answer:a.answer,answerKey:a.answerKey,selects:a.selects,projectId:a.projectId||h.value,taskId:a.taskId,weight:a.weight}));await Promise.all(e),console.log("é¢˜ç›®æ’åºä¿å­˜æˆåŠŸ")}catch(e){throw console.error("ä¿å­˜é¢˜ç›®æ’åºå¤±è´¥:",e),e}},ne=async o=>{if(!(h!=null&&h.value)){console.error("é¡¹ç›®IDä¸å­˜åœ¨");return}try{console.log("å¼€å§‹åŠ è½½é¢˜ç›®åˆ—è¡¨ï¼Œå‚æ•°:",{projectId:h.value,taskId:o});const e=await Be({projectId:h.value,taskId:o});console.log("é¢˜ç›®åˆ—è¡¨åŠ è½½æˆåŠŸ:",e);const a=e.map(u=>({id:u.id.toString(),name:u.name,answer:u.answer,answerKey:u.answerKey,selects:u.selects,projectId:u.projectId,taskId:u.taskId,weight:u.weight})).sort((u,d)=>(u.weight||0)-(d.weight||0));if(l.value){const u=v.value.find(d=>d.id===l.value);u&&(u.questions=a,console.log("é¢˜ç›®åˆ—è¡¨å·²æ›´æ–°åˆ°ä»»åŠ¡å…³å¡:",u.name,"é¢˜ç›®æ•°é‡:",a.length))}}catch(e){console.error("åŠ è½½é¢˜ç›®åˆ—è¡¨å¤±è´¥:",e),p.error(e.message||"åŠ è½½é¢˜ç›®åˆ—è¡¨å¤±è´¥")}};return{taskLevels:v,selectedTaskLevelId:l,currentTab:A,taskLevelFormRef:c,evaluationFormRef:s,taskLevelFormData:g,evaluationFormData:r,learningResourceFileList:y,taskLevelFormRules:K,evaluationFormRules:Q,isKernelTask:q,isChoiceTask:T,isProgrammingTask:V,addTaskLevel:E,deleteTaskLevel:j,selectTaskLevel:n,saveTaskLevel:x,saveAllTaskLevels:m,resetTaskLevel:S,handleLearningResourceCustomRequest:f,handleLearningResourceUpload:I,handleUserFilesUpload:b,handleTestValidateFilesUpload:N,handleUserFilesSelect:ee,handleTestValidateFilesSelect:pe,userFileList:_,testValidateFileList:w,addTestCase:me,removeTestCase:fe,clearAllTestCases:ve,downloadTemplate:ge,batchUploadTestCases:ye,getCurrentQuestions:he,addQuestion:_e,deleteQuestion:we,updateQuestion:ke,updateQuestionsOrder:Ce,loadQuestions:ne,saveQuestionsOrder:be}}export{Lt as F,Mt as N,Nt as Q,Ut as R,Kt as a,Vt as b,Rt as c,Dt as u};
