import{d as El,ak as Ml,f as y,o as jl,c as re,w as $l,_ as m,a1 as d,$ as n,k as a,ac as k,a7 as o,u as s,F as q,ag as S,a6 as h,G as v,a9 as x,H as pt,a2 as Vl,ae as Bl,ab as A,B as vt,y as Pe}from"./vue-PnzzEkKE.js";import{R as Se,u as ft,a as Al,s as Hl,c as zl,g as gt,d as Dl}from"./RichTextEditor-9Ebw_-A3.js";import{u as Ol,a as mt,c as Kl}from"./index-DCt2nNtB.js";import{u as Ql,a as Gl,b as Jl,c as Wl,d as Zl}from"./dictionary-DK3LBgyS.js";import{u as Xl}from"./multi-tab-CGTp1UN-.js";import{H as L,j as Yl,t as ea,x as Le,c as ta,a as la,m as aa,F as yt}from"./FileSelectModal-C2V8Qaoc.js";import{u as oa,a as sa,F as na,b as ia,R as ra,N as ua,c as da,Q as ca}from"./useTaskLevel-L1ZppZ-I.js";import{a2 as pa,a3 as va,z as fa,I as ga,a4 as ma,a5 as ya,a6 as _a,a7 as ka,a8 as ha,a9 as ba,H as Ca,K as Ta,aa as wa,ab as xa,ac as _t,f as Ua,e as Ra,s as qa,ad as Fa,ae as Ia,af as Pa,Z as kt,ag as ue,ah as Sa,J as La,ai as Na,T as Ea,aj as Ma,D as ja,u as $a,a1 as p,M as Va}from"./antd-D1-4Msx4.js";import{_ as Ba}from"./index-BQVwlz7A.js";import"./dictionary-BgSOUAJL.js";const Aa={class:"config-full-stack-page"},Ha={class:"page-content"},za={class:"steps-container"},Da={key:0},Oa={class:"form-section"},Ka={class:"flex items-top gap-16px"},Qa={class:"flex flex-col gap-12px"},Ga={key:0,class:"image-preview"},Ja=["src"],Wa={class:"flex items-top gap-16px"},Za={class:"flex flex-col gap-12px"},Xa={key:0,class:"image-preview"},Ya=["src"],eo={style:{display:"flex","flex-direction":"column",gap:"8px"}},to={class:"form-section"},lo={key:1},ao={class:"form-section repository-section"},oo={class:"repository-notice",style:{"margin-bottom":"16px",padding:"12px","background-color":"#f0f7ff",border:"1px solid #91caff","border-radius":"4px",color:"#0958d9"}},so={class:"repository-top-bar flex items-center gap-16px justify-between"},no={class:"repository-url-group"},io={class:"repository-main-area"},ro={class:"repository-left"},uo={class:"repository-switch-box flex items-center justify-between"},co={class:"flex items-center gap-12px"},po={key:1,class:"repository-tips"},vo={class:"repository-right"},fo={key:1,class:"empty-area"},go={key:2},mo={class:"task-level-section"},yo={class:"task-level-header"},_o={class:"header-buttons"},ko={class:"task-level-main"},ho={class:"task-level-list"},bo={class:"list-title"},Co={class:"list-items"},To=["onClick"],wo={class:"item-name"},xo={class:"task-level-detail"},Uo={key:0,class:"detail-content"},Ro={key:0,class:"questions-content"},qo={key:1,class:"questions-list"},Fo=["onDragstart","onDrop"],Io={class:"question-header"},Po={class:"question-number-with-drag"},So={class:"question-number"},Lo={class:"action-icons"},No={class:"question-title"},Eo={key:0,class:"flex"},Mo=["innerHTML"],jo={key:1,style:{color:"#bfbfbf"}},$o={class:"question-options"},Vo={class:"option-label"},Bo={class:"option-content"},Ao={key:0,class:"correct-tag"},Ho={class:"question-explanation"},zo={class:"explanation-content"},Do={key:0},Oo={key:1,style:{color:"#bfbfbf"}},Ko={class:"evaluation-content"},Qo={class:"evaluation-section"},Go={class:"file-select-wrapper"},Jo={class:"selected-files-list"},Wo={class:"file-select-wrapper"},Zo={class:"selected-files-list"},Xo={class:"evaluation-section"},Yo={class:"evaluation-section"},es={class:"case-type-row"},ts={key:0,class:"test-case-buttons"},ls={key:0,class:"test-cases-list"},as={class:"test-case-label"},os={key:0,class:"form-footer-buttons"},ss={key:1,class:"empty-detail"},ns={key:3,class:"step-content"},is={key:0,class:"content-card"},rs={class:"environment-header"},us={class:"environment-actions"},ds={class:"tab-label"},cs=["onDblclick"],ps={class:"experiment-image-info"},vs={class:"experiment-interfaces"},fs={key:0,style:{color:"#999"}},gs={key:1,style:{color:"#999"}},ms={key:1,class:"content-card no-environment-card"},ys={class:"page-footer"},ht="/dashboard/analysis",_s=El({name:"ConfigFullStack",__name:"config-full-stack",setup(ks){L.registerLanguage("javascript",Yl),L.registerLanguage("typescript",ea),L.registerLanguage("xml",Le),L.registerLanguage("html",Le),L.registerLanguage("vue",Le),L.registerLanguage("css",ta),L.registerLanguage("json",la),L.registerLanguage("markdown",aa);const Ne=Ml(),bt=Xl(),Ct=async()=>{await Ne.push(ht),bt.closeOther(ht)},R=y(0),P=y(null),W=y(),Ee=y(),Z=y(),i=y({name:"",tag:"",fieldType:void 0,difficulty:1,classHour:"",topCover:"",cover:"",description:"",showTaskRequire:!0,authType:1,enableCodeRepository:!1,repositoryType:"代码仓库",gitUrl:"",environment:void 0}),de=y(""),ce=y(""),X=y(!1),Y=y(!1),Me=window.location.origin,N=y(void 0),Tt=()=>{const t=$e.data.value.find(e=>e.value===String(N.value||1));return(t==null?void 0:t.name)||"--"};jl(()=>{var e;pe.load(),ve.load(),wt.load(),fe.load(),$e.load();const t=history.state;console.log("接收到的路由数据:",t),t&&t.name?(i.value.name=t.name||"",i.value.description=t.description||"",i.value.difficulty=t.difficulty||1,i.value.classHour=t.classHour||"",i.value.showTaskRequire=t.showTaskRequire||!0,N.value=t.environment||1,console.log("已自动填充表单数据:",{name:i.value.name,description:i.value.description,descriptionLength:((e=i.value.description)==null?void 0:e.length)||0,difficulty:i.value.difficulty,classHour:i.value.classHour,showTaskRequire:i.value.showTaskRequire,environment:N.value})):(console.log("未接收到路由数据"),N.value=1),Ut()});const je={name:[{required:!0,message:"请输入名称",trigger:"blur"}],tag:[{required:!0,message:"请输入技能标签",trigger:"blur"}],fieldType:[{required:!0,message:"请选择领域类别",trigger:"change"}],difficulty:[{required:!0,message:"请选择难度",trigger:"change"}],topCover:[{required:!0,message:"请上传顶部背景图",trigger:"change"}],cover:[{required:!0,message:"请上传封面图",trigger:"change"}],authType:[{required:!0,message:"请选择培训公开范围",trigger:"change"}]},pe=Ql(),ve=Gl(),wt=Jl(),fe=Wl(),$e=Zl(1),xt=[{label:"切换仓库",value:"切换仓库"},{label:"代码仓库",value:"代码仓库"},{label:"私密代码仓库",value:"私密代码仓库"}],H=y(!1),ge=y(new Set),F=y([]),Ut=()=>{F.value.length===0&&(F.value=[{id:"1",name:"实验环境1",isEditing:!1,isSaved:!1,config:{dockerImage:N.value||1,viewTypes:[],secondType:"1",taskId:void 0,codeType:void 0,shellBegin:"bash",containerPort:void 0,containerPath:void 0}}])},$=y("1"),z=y(""),Rt={dockerImage:[{required:!0,message:"请选择实验镜像",trigger:"change"}],viewTypes:[{required:!0,type:"array",min:1,message:"请至少选择一个实验界面",trigger:"change"}],taskId:[{required:!0,message:"请选择任务关卡",trigger:"change"}],codeType:[{required:!0,message:"请选择编程语言",trigger:"change"}],shellBegin:[{required:!0,message:"请输入开启时触发命令",trigger:"blur"}],containerPort:[{required:!0,message:"请输入容器端口",trigger:"blur"}]},Ve=re(()=>{var e;const t=F.value.find(u=>u.id===$.value);return(t==null?void 0:t.config)||((e=F.value[0])==null?void 0:e.config)}),{fileTreeData:Be,expandedKeys:me,selectedFile:qt,highlightedCode:Ft,dynamicFileContents:It,handleSelectFile:Pt,getNodePath:Ae,addFileToTree:He,addFolderToTree:St,handleRenameNode:Lt,handleCopyPath:Nt,loadRemoteFileTree:Et,loadChildrenData:Mt,getNodePathFromMap:ye}=oa(),{taskLevels:V,selectedTaskLevelId:ze,currentTab:B,taskLevelFormRef:_e,evaluationFormRef:jt,taskLevelFormData:_,evaluationFormData:b,learningResourceFileList:ke,taskLevelFormRules:$t,evaluationFormRules:Vt,isKernelTask:Bt,isChoiceTask:he,isProgrammingTask:De,addTaskLevel:be,deleteTaskLevel:At,selectTaskLevel:Ce,saveTaskLevel:Ht,resetTaskLevel:zt,handleLearningResourceCustomRequest:Dt,handleLearningResourceUpload:Ot,handleUserFilesSelect:Kt,handleTestValidateFilesSelect:Qt,userFileList:ee,testValidateFileList:te,addTestCase:Gt,removeTestCase:Jt,clearAllTestCases:Wt,getCurrentQuestions:le,addQuestion:Zt,deleteQuestion:Xt,updateQuestion:Yt,updateQuestionsOrder:el,loadQuestions:Oe,saveQuestionsOrder:tl}=sa(P),Ke=re(()=>[...V.value].sort((t,e)=>{const u=t.weight??0,f=e.weight??0;return u-f})),Qe=re(()=>Ke.value.filter(t=>t.type==="programming")),Ge=re(()=>Qe.value.length>0),D=y(!1),ae=y(!1),oe=y(!1),se=y(!1),Te=y(!1),we=y(!1),O=y(null),K=y("/"),Q=y("/"),Je=y(null),ne=y("/"),ll=async t=>{var f;if(!(t.size/1024/1024<12))return p.error("图片大小不能超过 12MB!"),!1;if(!(t.type==="image/jpeg"||t.type==="image/png"))return p.error("只能上传 JPG/PNG 格式的图片!"),!1;try{X.value=!0;const c=await ft(t);de.value=Me+c,i.value.topCover=c,(f=W.value)==null||f.validateFields(["topCover"]),p.success("顶部背景图上传成功")}catch{p.error("顶部背景图上传失败")}finally{X.value=!1}return!1},al=async t=>{var f;if(!(t.size/1024/1024<12))return p.error("图片大小不能超过 12MB!"),!1;if(!(t.type==="image/jpeg"||t.type==="image/png"))return p.error("只能上传 JPG/PNG 格式的图片!"),!1;try{Y.value=!0;const c=await ft(t);ce.value=Me+c,i.value.cover=c,(f=W.value)==null||f.validateFields(["cover"]),p.success("封面图上传成功")}catch{p.error("封面图上传失败")}finally{Y.value=!1}return!1},ol=t=>{(typeof t=="boolean"?t:!!t)?D.value=!0:i.value.enableCodeRepository=!1},We=async()=>{try{const t=p.loading("正在查询仓库文件...",0),e=await gt(i.value.gitUrl,"");Et(e),ge.value.clear(),t(),p.success("仓库文件查询成功"),console.log("查询仓库地址：",i.value.gitUrl),console.log("获取到的文件列表：",e)}catch(t){p.error(t.message||"仓库文件查询失败"),console.error("仓库文件查询失败：",t)}},sl=async(t,e)=>{const{expanded:u,node:f}=e;if(u&&!f.isLeaf){const c=String(f.key);if(ge.value.has(c)){console.log("文件夹已加载，跳过：",c);return}try{const r=ye(c);console.log("加载文件夹：",r,"节点key:",c);const C=p.loading(`正在加载 ${f.title}...`,0),I=await gt(i.value.gitUrl,r);Mt(c,I),ge.value.add(c),C(),console.log("文件夹加载成功：",r,I)}catch(r){p.error(r.message||"加载文件夹失败"),console.error("加载文件夹失败：",r)}}},nl=async()=>{if(!i.value.gitUrl||!i.value.gitUrl.trim()){p.error("请先配置仓库地址"),Ze();return}i.value.enableCodeRepository=!0,D.value=!1,H.value=!0,await We()},Ze=()=>{i.value.enableCodeRepository=!1,D.value=!1};$l(()=>i.value.repositoryType,t=>{t==="切换仓库"&&i.value.enableCodeRepository&&(H.value=!1,p.info("已解锁仓库地址，请重新输入"),Pe(()=>{i.value.repositoryType="代码仓库"}))});const il=()=>{var t;i.value.enableCodeRepository&&!H.value&&((t=i.value.gitUrl)!=null&&t.trim())&&(H.value=!0,We())},rl=t=>{switch(String(t.key)){case"newFile":Ye();break;case"newFolder":et();break;case"upload":Xe("/");break}},ul=(t,e)=>{const u=String(t.key),f=ye(e.key)||Ae(e.key);switch(u){case"newFile":Ye(f);break;case"newFolder":et(f);break;case"upload":Xe(f);break;case"rename":Lt(e);break;case"copyPath":Nt(e);break;case"delete":cl(e);break}},dl=t=>{const e=u=>{const f=u.findIndex(c=>c.key===t);if(f!==-1)return u.splice(f,1),!0;for(const c of u)if(c.children&&e(c.children))return!0;return!1};e(Be.value)},cl=async t=>{const e=t.children!==void 0||t.isLeaf===!1,u=t.title,c=(ye(t.key)||Ae(t.key)).split("/");c.pop();const r=c.join("/")||"";Va.confirm({title:"确认删除",content:`确定要删除${e?"文件夹":"文件"} "${u}" 吗？${e?"文件夹下的所有内容也会被删除。":""}`,okText:"确定",cancelText:"取消",okType:"danger",onOk:async()=>{let C=null;try{C=p.loading("正在删除...",0),await Dl({fileName:u,gitUrl:i.value.gitUrl,path:r}),dl(t.key),C(),p.success("删除成功"),console.log("删除成功：",{fileName:u,path:r})}catch(I){C&&C(),p.error(I.message||"删除失败"),console.error("删除失败：",I)}}})},Xe=t=>{var e;ne.value=t,(e=Je.value)==null||e.click()},pl=async t=>{var f;const e=t.target,u=(f=e.files)==null?void 0:f[0];if(u)try{let c=ne.value==="/"?"":ne.value.replace(/^\//,"");const r=p.loading(`正在上传 ${u.name}...`,0);await Al(u,i.value.gitUrl,c);const C=new FileReader;C.onload=I=>{var w;const Re=(w=I.target)==null?void 0:w.result;He(u.name,Re,ne.value)},C.readAsText(u),r(),p.success(`文件 ${u.name} 上传成功`),console.log("文件上传成功：",{fileName:u.name,path:c})}catch(c){p.error(c.message||"文件上传失败"),console.error("文件上传失败：",c)}finally{e&&(e.value="")}},Ye=(t="/")=>{ae.value=!0,K.value=t},vl=async t=>{try{let e=K.value==="/"?"":K.value.replace(/^\//,"");const u=p.loading("正在保存文件...",0);await Hl({fileContent:t.fileContent,fileName:t.fileName,gitUrl:i.value.gitUrl,path:e,commit:t.commitMessage}),He(t.fileName,t.fileContent,K.value),u(),p.success("文件创建成功"),ae.value=!1,console.log("文件保存成功：",{fileName:t.fileName,path:e})}catch(e){p.error(e.message||"文件创建失败"),console.error("文件创建失败：",e)}},et=(t="/")=>{oe.value=!0,Q.value=t},fl=async t=>{try{let e=Q.value==="/"?t.folderName:`${Q.value.replace(/^\//,"")}/${t.folderName}`;const u=p.loading("正在创建文件夹...",0);await zl({commit:t.commitMessage,gitUrl:i.value.gitUrl,path:e}),St(t.folderName,Q.value),u(),p.success("文件夹创建成功"),oe.value=!1,console.log("文件夹创建成功：",{folderName:t.folderName,path:e})}catch(e){p.error(e.message||"文件夹创建失败"),console.error("文件夹创建失败：",e)}},G=()=>{Pe(()=>{window.scrollTo({top:0,behavior:"smooth"}),document.documentElement.scrollTop=0,document.body.scrollTop=0;const t=document.querySelector(".page-content");t&&(t.scrollTop=0);const e=document.querySelector(".ant-layout-content");e&&(e.scrollTop=0),document.querySelectorAll("*").forEach(f=>{f.scrollTop>0&&(f.scrollTop=0)})})},tt=()=>{R.value>0?(R.value--,G()):Ne.back()},gl=async()=>{var t,e;if(R.value===0)try{await Promise.all([(t=W.value)==null?void 0:t.validate(),(e=Ee.value)==null?void 0:e.validate()]),console.log("表单数据：",i.value),R.value=1,G()}catch{p.error("请完善必填信息"),G()}else if(R.value===1){if(i.value.enableCodeRepository&&(!i.value.gitUrl||i.value.gitUrl.trim()==="")){p.error("请输入仓库地址");return}await ml()}else if(R.value===2){if(V.value.length===0){p.error("请至少添加一个任务关卡");return}const u=V.value.filter(r=>!r.taskId);if(u.length>0){const r=u.map(C=>C.formName||C.name).join("、");p.error(`请先保存以下任务关卡后再进行下一步：${r}`);return}const f=V.value.find(r=>r.type==="choice"&&r.taskId&&(!r.questions||r.questions.length===0));if(f){p.warning("请至少新增一条题目"),Ce(f.id),B.value="questions";return}const c=V.value.find(r=>r.type!=="programming"||!r.taskId||!r.evaluationSettings?!1:r.evaluationSettings.testValidateType===1?!r.evaluationSettings.testContent||r.evaluationSettings.testContent.length===0:!1);if(c){p.warning("用例类型为文本时，必须至少创建一条测试集"),Ce(c.id),B.value="evaluation";return}R.value=3,G()}},ml=async()=>{try{const t={projectType:1,environment:N.value,name:i.value.name,tag:i.value.tag,fieldType:i.value.fieldType,difficulty:i.value.difficulty,classHour:i.value.classHour,topCover:i.value.topCover,cover:i.value.cover,description:i.value.description,showTaskRequire:i.value.showTaskRequire?1:2,authType:i.value.authType,enableCodeRepository:i.value.enableCodeRepository};i.value.enableCodeRepository&&(t.repositoryType=i.value.repositoryType,t.gitUrl=i.value.gitUrl),console.log("提交项目数据：",t);let e;P.value?(t.id=P.value,e=await mt(t),p.success("项目更新成功！"),console.log("更新成功：",e)):(e=await Kl(t),e&&e.id&&(P.value=e.id,console.log("项目ID已保存：",P.value)),p.success("项目创建成功！"),console.log("创建成功：",e)),R.value=2,G()}catch(t){console.error("操作失败：",t),p.error(P.value?"项目更新失败，请稍后重试":"项目创建失败，请稍后重试")}},xe=async(t,e=0)=>{var u,f;try{if(e!==1){const r=["dockerImage","viewTypes","secondType","taskId"],C=[];t.config.viewTypes.includes(1)?r.push("codeType"):C.push("codeType"),t.config.viewTypes.includes(2)?r.push("shellBegin"):C.push("shellBegin"),t.config.viewTypes.includes(3)?r.push("containerPort"):C.push("containerPort"),C.length>0&&((u=Z.value)==null||u.clearValidate(C)),await((f=Z.value)==null?void 0:f.validate(r))}if(!P.value){p.error("项目ID不存在，无法保存");return}const c={title:t.name,dockerImage:t.config.dockerImage,viewTypes:t.config.viewTypes.join(","),secondType:t.config.secondType,taskId:t.config.taskId?Number(t.config.taskId):void 0,codeType:t.config.codeType,shellBegin:t.config.shellBegin,containerPort:t.config.containerPort,containerPath:t.config.containerPath,projectId:P.value,envisDel:e};console.log("保存实验环境数据：",c),await Ol(c),e!==1?(t.isSaved=!0,p.success("实验环境保存成功！")):p.success("删除成功！")}catch(c){console.error("保存失败：",c),p.error(e===1?"删除失败":"请完善必填信息")}},yl=async()=>{if(Ge.value&&F.value.filter(e=>!e.isSaved).length>0){p.error("请先保存实验环境配置");return}if(!P.value){p.error("项目ID不存在，请先创建项目");return}try{i.value.authType!==2&&await mt({id:P.value,status:10}),p.success("项目创建成功！"),setTimeout(()=>{Ct()},500)}catch(t){console.error("项目发布失败：",t),p.error(t.message||"项目发布失败")}},_l=t=>{var u;t.replace(/<[^>]*>/g,"").trim()&&((u=_e.value)==null||u.clearValidate(["require"]))},kl=t=>{var u;t.replace(/<[^>]*>/g,"").trim()&&((u=_e.value)==null||u.clearValidate(["referenceAnswer"]))},hl=()=>{O.value=null,se.value=!0},bl=t=>{O.value=t,se.value=!0},Cl=async t=>{O.value?Yt(t):Zt(t),O.value=null,_.value.taskId&&await Oe(_.value.taskId)},Tl=t=>{try{return JSON.parse(t.selects||"[]").map(u=>{const f=Object.keys(u)[0];return{label:f,content:u[f]}})}catch{return[]}},lt=(t,e)=>t.answer.includes(e),E=y(null),wl=t=>{E.value=t},xl=t=>{t.preventDefault()},Ul=async(t,e)=>{if(t.preventDefault(),E.value!==null&&E.value!==e){const u=[...le.value],[f]=u.splice(E.value,1);u.splice(e,0,f),u.forEach((c,r)=>{c.weight=r+1}),el(u);try{console.log("开始保存题目排序..."),await tl(u),p.success("题目顺序已更新")}catch(c){console.error("保存题目排序失败:",c),p.error(c.message||"保存题目排序失败，请重试")}}E.value=null},Rl=()=>{E.value=null},Ue=t=>{const e=Ve.value;if(!e)return;const u=e.viewTypes.indexOf(t);u>-1?(e.viewTypes.splice(u,1),t===1?e.codeType=void 0:t===2?e.shellBegin=void 0:t===3&&(e.containerPort=void 0,e.containerPath=void 0)):e.viewTypes.push(t),Pe(()=>{var f;(f=Z.value)==null||f.clearValidate(["viewTypes"])})},at=(t,e)=>{if(!e)return!1;const u=typeof e=="string"?Number(e):e;return F.value.some(f=>{if(!f.config.taskId)return!1;const c=typeof f.config.taskId=="string"?Number(f.config.taskId):f.config.taskId;return f.id!==t&&c===u})},ql=()=>{const t=String(Date.now()),e={id:t,name:`实验环境${F.value.length+1}`,isEditing:!1,isSaved:!1,config:{dockerImage:N.value||1,viewTypes:[],secondType:void 0,taskId:void 0,codeType:void 0,shellBegin:void 0,containerPort:void 0,containerPath:void 0}};F.value.push(e),$.value=t,p.success("添加实验环境成功")},Fl=async t=>{if(F.value.length===1){p.warning("至少保留一个实验环境");return}const e=F.value.findIndex(u=>u.id===t);if(e>-1){const u=F.value[e];u.isSaved&&await xe(u,1),F.value.splice(e,1),$.value===t&&($.value=F.value[0].id),u.isSaved||p.success("删除实验环境成功")}},ot=t=>{t.isEditing=!0,z.value=t.name},st=t=>{z.value.trim()?(t.name=z.value.trim(),t.isEditing=!1,t.isSaved&&(p.success("重命名成功"),xe(t))):p.warning("名称不能为空")},Il=async t=>{const e=String(t);if(he.value&&e==="questions"){if(!_.value.taskId){p.warning("请先保存创建任务后再添加题目");return}_.value.taskId&&await Oe(_.value.taskId)}if(De.value&&e==="evaluation"&&!_.value.taskId){p.warning("请先保存创建任务后再配置评测设置");return}B.value=e},Pl=(t,e)=>{t.select=e?1:2};return(t,e)=>{const u=pa,f=va,c=ga,r=fa,C=ya,I=_a,Re=ma,w=ha,M=ka,T=Ca,qe=ba,j=Ta,Sl=xa,J=Ra,nt=Ua,it=ja,Fe=Fa,ie=qa,rt=Ia,ut=Sa,Ll=La,dt=Na,ct=Ea,Ie=Ma;return d(),m("div",Aa,[e[106]||(e[106]=n("div",{class:"page-header"},[n("h2",null,"全栈环境实训项目配置")],-1)),n("div",Ha,[n("div",za,[a(f,{current:R.value,class:"custom-steps"},{default:o(()=>[a(u,{title:"基本信息"}),a(u,{title:"代码仓库"}),a(u,{title:"任务关卡"}),a(u,{title:"实验环境"})]),_:1},8,["current"])]),R.value===0?(d(),m("div",Da,[e[51]||(e[51]=n("div",{class:"section-title"},[n("h3",null,"基本信息")],-1)),n("div",Oa,[a(j,{ref_key:"formRef",ref:W,model:i.value,rules:je,layout:"horizontal","label-col":{span:2},"wrapper-col":{span:18}},{default:o(()=>[a(r,{label:"名称",name:"name",required:""},{default:o(()=>[a(c,{value:i.value.name,"onUpdate:value":e[0]||(e[0]=l=>i.value.name=l),placeholder:"请输入名称"},null,8,["value"])]),_:1}),a(Re,null,{default:o(()=>[a(C,{span:12},{default:o(()=>[a(r,{label:"技能标签",name:"tag",required:"","label-col":{span:4},"wrapper-col":{span:20}},{default:o(()=>[a(c,{value:i.value.tag,"onUpdate:value":e[1]||(e[1]=l=>i.value.tag=l),placeholder:"请输入技能标签"},null,8,["value"]),e[43]||(e[43]=n("div",{style:{"font-size":"12px",color:"#999","margin-top":"4px"}}," 请使用英文状态下的逗号分隔技能标签，比如html,css,js ",-1))]),_:1,__:[43]})]),_:1}),a(C,{span:12},{default:o(()=>[a(r,{label:"领域类别",name:"fieldType",required:"","label-col":{span:4},"wrapper-col":{span:12}},{default:o(()=>[a(I,{value:i.value.fieldType,"onUpdate:value":e[2]||(e[2]=l=>i.value.fieldType=l),placeholder:"请选择领域类别",options:s(pe).options.value,loading:s(pe).loading.value},null,8,["value","options","loading"])]),_:1})]),_:1})]),_:1}),a(r,{label:"难度",name:"difficulty",required:""},{default:o(()=>[a(M,{value:i.value.difficulty,"onUpdate:value":e[3]||(e[3]=l=>i.value.difficulty=l),class:"custom-radio"},{default:o(()=>[(d(!0),m(q,null,S(s(ve).data.value,l=>(d(),h(w,{key:l.value,value:Number(l.value)},{default:o(()=>[v(x(l.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),a(r,{label:"学时",name:"classHour"},{default:o(()=>[a(c,{value:i.value.classHour,"onUpdate:value":e[4]||(e[4]=l=>i.value.classHour=l),placeholder:"配置任务后自动计算",disabled:""},null,8,["value"]),e[44]||(e[44]=n("div",{style:{"font-size":"12px",color:"#999","margin-top":"4px"}}," 此学时为关卡总计学时，无需填写，系统自动计算。 ",-1))]),_:1,__:[44]}),a(r,{label:"顶部背景图",name:"topCover",required:""},{default:o(()=>[n("div",Ka,[n("div",Qa,[a(qe,{"before-upload":ll,"show-upload-list":!1,accept:"image/png,image/jpeg"},{default:o(()=>[a(T,{loading:X.value},{default:o(()=>[X.value?(d(),m(q,{key:1},[v("上传中...")],64)):(d(),m(q,{key:0},[v("选择文件")],64))]),_:1},8,["loading"])]),_:1}),de.value?(d(),m("div",Ga,[n("img",{src:de.value,alt:"顶部背景图预览",style:{"max-width":"290px","max-height":"218px","border-radius":"4px"}},null,8,Ja)])):k("",!0)]),e[45]||(e[45]=n("div",{class:"upload-hint"}," 说明：支持上传png/jpeg等格式文件，文件大小不能超过12M,建议使用290*218像素。 ",-1))])]),_:1}),a(r,{label:"封面图",name:"cover",required:""},{default:o(()=>[n("div",Wa,[n("div",Za,[a(qe,{"before-upload":al,"show-upload-list":!1,accept:"image/png,image/jpeg"},{default:o(()=>[a(T,{loading:Y.value},{default:o(()=>[Y.value?(d(),m(q,{key:1},[v("上传中...")],64)):(d(),m(q,{key:0},[v("选择文件")],64))]),_:1},8,["loading"])]),_:1}),ce.value?(d(),m("div",Xa,[n("img",{src:ce.value,alt:"封面图预览",style:{"max-width":"290px","max-height":"218px","border-radius":"4px"}},null,8,Ya)])):k("",!0)]),e[46]||(e[46]=n("div",{class:"upload-hint"}," 说明：支持上传png/jpeg等格式文件，文件大小不能超过12M,建议使用290*218像素。 ",-1))])]),_:1}),a(r,{label:"简介",name:"description"},{default:o(()=>[n("div",eo,[a(Se,{modelValue:i.value.description,"onUpdate:modelValue":e[5]||(e[5]=l=>i.value.description=l)},null,8,["modelValue"])])]),_:1})]),_:1},8,["model"])]),e[52]||(e[52]=n("div",{class:"section-title"},[n("h3",null,"培训公开范围")],-1)),n("div",to,[a(j,{ref_key:"trainingScopeFormRef",ref:Ee,model:i.value,rules:je,layout:"horizontal","label-col":{span:2},"wrapper-col":{span:18}},{default:o(()=>[a(r,{label:"培训公开范围",name:"authType",required:""},{default:o(()=>[a(M,{value:i.value.authType,"onUpdate:value":e[6]||(e[6]=l=>i.value.authType=l),class:"custom-radio"},{default:o(()=>[a(w,{value:1},{default:o(()=>e[47]||(e[47]=[v("完全公开")])),_:1,__:[47]}),a(w,{value:2},{default:o(()=>e[48]||(e[48]=[v("全院公开")])),_:1,__:[48]}),a(w,{value:3},{default:o(()=>e[49]||(e[49]=[v("本单位公开")])),_:1,__:[49]}),a(w,{value:4},{default:o(()=>e[50]||(e[50]=[v("不公开")])),_:1,__:[50]})]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])])])):k("",!0),R.value===1?(d(),m("div",lo,[n("div",ao,[n("div",oo,[a(s(wa),{style:{"margin-right":"8px"}}),e[53]||(e[53]=n("span",null,"内嵌链接任务跳过此步骤",-1))]),n("div",so,[a(I,{value:i.value.repositoryType,"onUpdate:value":e[7]||(e[7]=l=>i.value.repositoryType=l),options:xt,class:"repository-type-select"},null,8,["value"]),n("div",no,[e[54]||(e[54]=n("span",{class:"url-label"},"仓库地址：",-1)),a(c,{value:i.value.gitUrl,"onUpdate:value":e[8]||(e[8]=l=>i.value.gitUrl=l),placeholder:"请输入仓库地址",class:"url-input",disabled:H.value,onBlur:il},null,8,["value","disabled"])])]),n("div",io,[n("div",ro,[n("div",uo,[n("div",co,[e[55]||(e[55]=n("span",{class:"switch-label"},"代码仓库",-1)),a(Sl,{checked:i.value.enableCodeRepository,disabled:i.value.enableCodeRepository,onChange:ol},null,8,["checked","disabled"])]),i.value.enableCodeRepository?(d(),h(it,{key:0},{overlay:o(()=>[a(nt,{onClick:rl},{default:o(()=>[a(J,{key:"newFile"},{default:o(()=>e[56]||(e[56]=[v("新建文件")])),_:1,__:[56]}),a(J,{key:"newFolder"},{default:o(()=>e[57]||(e[57]=[v("新建文件夹")])),_:1,__:[57]}),a(J,{key:"upload"},{default:o(()=>e[58]||(e[58]=[v("上传")])),_:1,__:[58]})]),_:1})]),default:o(()=>[a(T,{type:"primary",size:"small"},{default:o(()=>[a(s(_t)),e[59]||(e[59]=v(" 新建 "))]),_:1,__:[59]})]),_:1})):k("",!0)]),i.value.enableCodeRepository?(d(),h(na,{key:0,"file-tree-data":s(Be),"expanded-keys":s(me),"onUpdate:expandedKeys":e[9]||(e[9]=l=>pt(me)?me.value=l:null),onSelect:s(Pt),onMenuClick:ul,onExpand:sl},null,8,["file-tree-data","expanded-keys","onSelect"])):k("",!0),i.value.enableCodeRepository?(d(),m("div",po,e[60]||(e[60]=[Vl('<div class="tips-title" data-v-e9ac1c95>提示：</div><div class="tips-content" data-v-e9ac1c95> 此处存放本实训所需的所有代码等相关文件，你可以通过以下： </div><div class="tips-list" data-v-e9ac1c95> 1、<a href="#" class="tips-link" data-v-e9ac1c95>Gitee客户端</a> 上传已有文件来开始使用。 </div><div class="tips-list" data-v-e9ac1c95> 2、直接在平台上创建文件目录以及相关代码文件。 </div>',4)]))):k("",!0)]),n("div",vo,[i.value.enableCodeRepository?(d(),h(ia,{key:0,"selected-file":s(qt),"highlighted-code":s(Ft),"dynamic-file-contents":s(It)},null,8,["selected-file","highlighted-code","dynamic-file-contents"])):(d(),m("div",fo," 在左侧代码仓库区域点击目录打开文件 "))])])])])):k("",!0),R.value===2?(d(),m("div",go,[n("div",mo,[n("div",yo,[n("div",_o,[a(T,{type:"primary",onClick:e[10]||(e[10]=l=>s(be)("kernel"))},{default:o(()=>e[61]||(e[61]=[v("添加内嵌链接任务")])),_:1,__:[61]}),a(T,{type:"primary",onClick:e[11]||(e[11]=l=>s(be)("choice"))},{default:o(()=>e[62]||(e[62]=[v("添加选择题任务")])),_:1,__:[62]}),i.value.enableCodeRepository?(d(),h(T,{key:0,type:"primary",onClick:e[12]||(e[12]=l=>s(be)("programming"))},{default:o(()=>e[63]||(e[63]=[v("添加编程任务")])),_:1,__:[63]})):k("",!0)])]),n("div",ko,[n("div",ho,[n("div",bo,"任务关卡 ("+x(s(V).length)+")",1),n("div",Co,[(d(!0),m(q,null,S(Ke.value,l=>(d(),m("div",{key:l.id,class:A(["list-item",{active:s(ze)===l.id}]),onClick:g=>s(Ce)(l.id)},[n("span",wo,x(l.name),1),a(s(ue),{class:"delete-icon",onClick:vt(g=>s(At)(l.id),["stop"])},null,8,["onClick"])],10,To))),128))])]),n("div",xo,[s(ze)?(d(),m("div",Uo,[a(ct,{activeKey:s(B),onChange:Il},Bl({default:o(()=>[a(ie,{key:"task",tab:"关联任务"},{default:o(()=>[a(j,{ref_key:"taskLevelFormRef",ref:_e,model:s(_),rules:s($t),layout:"horizontal","label-col":{span:4},"wrapper-col":{span:18}},{default:o(()=>[a(r,{label:"任务名称",name:"name",required:""},{default:o(()=>[a(c,{value:s(_).name,"onUpdate:value":e[13]||(e[13]=l=>s(_).name=l),placeholder:"请输入任务名称"},null,8,["value"])]),_:1}),a(r,{label:"学习资源",name:"source"},{default:o(()=>[a(qe,{"file-list":s(ke),"onUpdate:fileList":e[14]||(e[14]=l=>pt(ke)?ke.value=l:null),"custom-request":s(Dt),onChange:s(Ot),accept:".doc,.docx,.pdf,.ppt,.pptx,.mp4","max-count":10},{default:o(()=>[a(T,{type:"primary"},{default:o(()=>e[65]||(e[65]=[v("点击上传")])),_:1,__:[65]})]),_:1},8,["file-list","custom-request","onChange"]),e[66]||(e[66]=n("div",{class:"upload-hint"}," 说明：支持上传word、pdf、ppt、mp4等格式文件，每个文件大小不能超过300M。 ",-1))]),_:1,__:[66]}),a(r,{label:"任务要求",name:"require",required:""},{default:o(()=>[a(Se,{modelValue:s(_).require,"onUpdate:modelValue":e[15]||(e[15]=l=>s(_).require=l),placeholder:"请输入任务要求",onChange:_l},null,8,["modelValue"])]),_:1}),a(r,{label:"参考答案",name:"referenceAnswer",required:""},{default:o(()=>[a(Se,{modelValue:s(_).referenceAnswer,"onUpdate:modelValue":e[16]||(e[16]=l=>s(_).referenceAnswer=l),placeholder:"请输入参考答案",onChange:kl},null,8,["modelValue"])]),_:1}),a(r,{label:"难度系数",name:"difficulty",required:""},{default:o(()=>[a(M,{value:s(_).difficulty,"onUpdate:value":e[17]||(e[17]=l=>s(_).difficulty=l),class:"custom-radio"},{default:o(()=>[(d(!0),m(q,null,S(s(ve).data.value,l=>(d(),h(w,{key:l.value,value:Number(l.value)},{default:o(()=>[v(x(l.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),a(r,{label:"技能标签",name:"tag",required:""},{default:o(()=>[a(c,{value:s(_).tag,"onUpdate:value":e[18]||(e[18]=l=>s(_).tag=l),placeholder:"请输入技能标签"},null,8,["value"]),e[67]||(e[67]=n("div",{style:{"font-size":"12px",color:"#999","margin-top":"4px"}}," 请使用英文状态下的逗号分隔技能标签，比如html,css,js ",-1))]),_:1,__:[67]}),s(Bt)?(d(),h(r,{key:0,label:"内嵌链接",name:"jumpUrl",required:""},{default:o(()=>[a(c,{value:s(_).jumpUrl,"onUpdate:value":e[19]||(e[19]=l=>s(_).jumpUrl=l),placeholder:"请输入内嵌链接"},null,8,["value"])]),_:1})):k("",!0),a(r,{label:"任务学时",name:"classHour",required:""},{default:o(()=>[a(Fe,{style:{width:"100%"},min:0,value:s(_).classHour,"onUpdate:value":e[20]||(e[20]=l=>s(_).classHour=l),placeholder:"请输入任务学时"},null,8,["value"])]),_:1}),a(r,{label:"排序权重",name:"weight"},{default:o(()=>[a(Fe,{style:{width:"100%"},min:0,value:s(_).weight,"onUpdate:value":e[21]||(e[21]=l=>s(_).weight=l),placeholder:"请输入排序权重，数值越小越靠前"},null,8,["value"]),e[68]||(e[68]=n("div",{style:{color:"#999","font-size":"12px","margin-top":"4px"}}," 权重用于任务关卡排序，数值越小越靠前，默认按从小到大排序 ",-1))]),_:1,__:[68]})]),_:1},8,["model","rules"])]),_:1}),s(he)?(d(),h(ie,{key:"questions",tab:"题目"},{default:o(()=>[s(le).length===0?(d(),m("div",Ro,[a(rt,{description:"暂无题目，请点击右上方按钮新增题目"})])):(d(),m("div",qo,[(d(!0),m(q,null,S(s(le),(l,g)=>(d(),m("div",{key:l.id,class:A(["question-item",{dragging:E.value===g}]),draggable:"true",onDragstart:U=>wl(g),onDragover:xl,onDrop:U=>Ul(U,g),onDragend:Rl},[n("div",Io,[n("div",Po,[a(s(Pa),{class:"drag-handle"}),n("span",So,"题目"+x(g+1),1)]),n("div",Lo,[a(s(kt),{class:"edit-icon",onClick:U=>bl(l)},null,8,["onClick"]),a(s(ue),{class:"delete-icon",onClick:U=>s(Xt)(l.id)},null,8,["onClick"])])]),n("div",No,[l.name?(d(),m("div",Eo,[v(x(g+1)+"、 ",1),n("div",{innerHTML:l.name},null,8,Mo)])):(d(),m("div",jo,"暂无题干"))]),n("div",$o,[(d(!0),m(q,null,S(Tl(l),(U,Nl)=>(d(),m("div",{key:Nl,class:A(["option-row",{"is-correct":lt(l,U.label)}])},[n("span",Vo,x(U.label)+".",1),n("span",Bo,x(U.content),1),lt(l,U.label)?(d(),m("span",Ao,"正确答案")):k("",!0)],2))),128))]),n("div",Ho,[e[69]||(e[69]=n("div",{class:"explanation-label"},"答案解析：",-1)),n("div",zo,[l.answerKey?(d(),m("span",Do,x(l.answerKey),1)):(d(),m("span",Oo,"暂无答案解析"))])])],42,Fo))),128))]))]),_:1})):k("",!0),s(De)?(d(),h(ie,{key:"evaluation",tab:"评测设置"},{default:o(()=>[n("div",Ko,[n("div",Qo,[e[76]||(e[76]=n("div",{class:"section-header"},"评测文件",-1)),a(j,{ref_key:"evaluationFormRef",ref:jt,model:s(b),rules:s(Vt),layout:"horizontal","label-col":{span:4},"wrapper-col":{span:18}},{default:o(()=>[a(r,{label:"评测时长限制",name:"timeLimitM",required:""},{default:o(()=>[a(Fe,{value:s(b).timeLimitM,"onUpdate:value":e[22]||(e[22]=l=>s(b).timeLimitM=l),min:0,placeholder:"请输入评测时长限制",style:{width:"200px"}},null,8,["value"]),e[70]||(e[70]=n("span",{style:{"margin-left":"8px"}},"分钟",-1))]),_:1,__:[70]}),a(r,{label:"学员任务文件",name:"userFiles",required:""},{default:o(()=>[n("div",Go,[a(T,{type:"primary",onClick:e[23]||(e[23]=l=>Te.value=!0)},{default:o(()=>e[71]||(e[71]=[v("点击选择")])),_:1,__:[71]}),n("div",Jo,[(d(!0),m(q,null,S(s(ee),l=>(d(),h(ut,{key:l.uid,closable:"",onClose:()=>{ee.value=s(ee).filter(g=>g.uid!==l.uid),s(b).userFiles=[...s(ee)]},style:{margin:"4px"}},{default:o(()=>[v(x(l.name),1)]),_:2},1032,["onClose"]))),128))])]),e[72]||(e[72]=n("div",{class:"upload-hint"}," 说明：从代码仓库中选择文件。（学员评测基本任务时名称，查看效果页上需要编辑的文件类型） ",-1))]),_:1,__:[72]}),a(r,{label:"评测执行文件",name:"testValidateFiles",required:""},{default:o(()=>[n("div",Wo,[a(T,{type:"primary",onClick:e[24]||(e[24]=l=>we.value=!0)},{default:o(()=>e[73]||(e[73]=[v("点击选择")])),_:1,__:[73]}),n("div",Zo,[(d(!0),m(q,null,S(s(te),l=>(d(),h(ut,{key:l.uid,closable:"",onClose:()=>{te.value=s(te).filter(g=>g.uid!==l.uid),s(b).testValidateFiles=[...s(te)]},style:{margin:"4px"}},{default:o(()=>[v(x(l.name),1)]),_:2},1032,["onClose"]))),128))])]),e[74]||(e[74]=n("div",{class:"upload-hint"},' 说明：从代码仓库中选择文件。（点击评测按钮时调用的文件，用于检验学员任务结果是否正确，可与"学员任务文件"一致） ',-1))]),_:1,__:[74]}),a(r,{label:"评测执行命令",name:"testValidateSh",required:""},{default:o(()=>[a(c,{value:s(b).testValidateSh,"onUpdate:value":e[25]||(e[25]=l=>s(b).testValidateSh=l),placeholder:"请输入评测执行命令，例如：python main.py"},null,8,["value"]),e[75]||(e[75]=n("div",{class:"upload-hint"}," （执行评测文件的命令，如：python、python main.py、node index.js、java Main 等） ",-1))]),_:1,__:[75]})]),_:1},8,["model","rules"])]),n("div",Xo,[e[83]||(e[83]=n("div",{class:"section-header"},"评测规则",-1)),a(j,{layout:"horizontal","label-col":{span:4},"wrapper-col":{span:18}},{default:o(()=>[a(r,{label:"通关判定"},{default:o(()=>[a(M,{value:s(b).passType,"onUpdate:value":e[26]||(e[26]=l=>s(b).passType=l),class:"custom-radio"},{default:o(()=>[a(w,{value:1},{default:o(()=>e[77]||(e[77]=[v("实际输出与期望输出对比")])),_:1,__:[77]}),a(w,{value:2},{default:o(()=>e[78]||(e[78]=[v("实际输出满足规则")])),_:1,__:[78]})]),_:1},8,["value"])]),_:1}),s(b).passType===2?(d(),h(r,{key:0,label:"判定规则"},{default:o(()=>[a(c,{value:s(b).passTypeRule,"onUpdate:value":e[27]||(e[27]=l=>s(b).passTypeRule=l),placeholder:"请输入判定规则"},null,8,["value"]),e[79]||(e[79]=n("div",{class:"upload-hint"}," （请输入实际输出满足的规则描述） ",-1))]),_:1,__:[79]})):k("",!0),a(r,{label:"空格处理"},{default:o(()=>[a(M,{value:s(b).blankCode,"onUpdate:value":e[28]||(e[28]=l=>s(b).blankCode=l),class:"custom-radio"},{default:o(()=>[a(w,{value:1},{default:o(()=>e[80]||(e[80]=[v("不忽略空格")])),_:1,__:[80]}),a(w,{value:2},{default:o(()=>e[81]||(e[81]=[v("忽略首尾空格")])),_:1,__:[81]}),a(w,{value:3},{default:o(()=>e[82]||(e[82]=[v("忽略所有空格(仅通过空格中自动添加所有空格进行对比)")])),_:1,__:[82]})]),_:1},8,["value"])]),_:1})]),_:1})]),n("div",Yo,[e[90]||(e[90]=n("div",{class:"section-header"},"测试集",-1)),a(j,{layout:"horizontal","label-col":{span:4},"wrapper-col":{span:18}},{default:o(()=>[a(r,{label:"得分规则"},{default:o(()=>[a(M,{value:s(b).scoreRule,"onUpdate:value":e[29]||(e[29]=l=>s(b).scoreRule=l),class:"custom-radio"},{default:o(()=>[a(w,{value:1},{default:o(()=>e[84]||(e[84]=[v("通过全部测试集（所有测试集都正确，才获取对应积分；否则得0学分）")])),_:1,__:[84]}),a(w,{value:2},{default:o(()=>e[85]||(e[85]=[v("通过部分测试集（选中的测试集全部正确，获取任务学分；否则得0学分）")])),_:1,__:[85]})]),_:1},8,["value"])]),_:1}),a(r,{label:"用例类型"},{default:o(()=>[n("div",es,[a(M,{value:s(b).testValidateType,"onUpdate:value":e[30]||(e[30]=l=>s(b).testValidateType=l),class:"custom-radio"},{default:o(()=>[a(w,{value:1},{default:o(()=>e[86]||(e[86]=[v("文本")])),_:1,__:[86]}),a(w,{value:2},{default:o(()=>e[87]||(e[87]=[v("文件")])),_:1,__:[87]})]),_:1},8,["value"]),s(b).testValidateType===1?(d(),m("div",ts,[a(T,{type:"primary",onClick:s(Gt)},{default:o(()=>e[88]||(e[88]=[v("新增测试集")])),_:1,__:[88]},8,["onClick"]),a(T,{onClick:s(Wt)},{default:o(()=>e[89]||(e[89]=[v("一键删除测试用例")])),_:1,__:[89]},8,["onClick"])])):k("",!0)])]),_:1}),s(b).testValidateType===1&&s(b).testContent.length>0?(d(),m("div",ls,[(d(!0),m(q,null,S(s(b).testContent,(l,g)=>(d(),m("div",{key:l.id,class:"test-case-item"},[a(Ll,{checked:l.select===1,onChange:U=>Pl(l,U.target.checked),class:"test-case-checkbox"},null,8,["checked","onChange"]),n("span",as,"测试集"+x(g+1),1),a(dt,{value:l.arg,"onUpdate:value":U=>l.arg=U,placeholder:"请输入输入内容",class:"test-case-input","auto-size":{minRows:3}},null,8,["value","onUpdate:value"]),a(dt,{value:l.answer,"onUpdate:value":U=>l.answer=U,placeholder:"请输入期望输出",class:"test-case-output","auto-size":{minRows:3}},null,8,["value","onUpdate:value"]),a(s(ue),{class:"delete-test-case",onClick:U=>s(Jt)(l.id)},null,8,["onClick"])]))),128))])):k("",!0)]),_:1})])])]),_:1})):k("",!0)]),_:2},[s(he)&&s(B)==="questions"?{name:"tabBarExtraContent",fn:o(()=>[a(T,{type:"primary",onClick:hl},{default:o(()=>[a(s(_t)),e[64]||(e[64]=v(" 新增题目 "))]),_:1,__:[64]})]),key:"0"}:void 0]),1032,["activeKey"]),s(B)!=="questions"?(d(),m("div",os,[s(_).taskId?k("",!0):(d(),h(T,{key:0,onClick:s(zt)},{default:o(()=>e[91]||(e[91]=[v("重置")])),_:1,__:[91]},8,["onClick"])),a(T,{type:"primary",onClick:s(Ht)},{default:o(()=>[v(x(s(_).taskId?"更新":"保存"),1)]),_:1},8,["onClick"])])):k("",!0)])):(d(),m("div",ss,[a(rt,{description:"请先添加任务关卡"})]))])])])])):k("",!0),R.value===3?(d(),m("div",ns,[Ge.value?(d(),m("div",is,[n("div",rs,[e[93]||(e[93]=n("h3",{class:"environment-title"},"实验环境",-1)),n("div",us,[a(T,{type:"primary",onClick:ql},{default:o(()=>e[92]||(e[92]=[v("添加实验环境")])),_:1,__:[92]})])]),a(j,{ref_key:"experimentFormRef",ref:Z,model:Ve.value,rules:Rt,"label-col":{span:4},"wrapper-col":{span:18}},{default:o(()=>[a(ct,{activeKey:$.value,"onUpdate:activeKey":e[36]||(e[36]=l=>$.value=l)},{default:o(()=>[(d(!0),m(q,null,S(F.value,l=>(d(),h(ie,{key:l.id},{tab:o(()=>[n("div",ds,[l.isEditing?(d(),h(c,{key:0,value:z.value,"onUpdate:value":e[31]||(e[31]=g=>z.value=g),size:"small",style:{width:"120px"},onPressEnter:g=>st(l),onBlur:g=>st(l)},null,8,["value","onPressEnter","onBlur"])):(d(),m(q,{key:1},[n("span",{onDblclick:g=>ot(l)},x(l.name),41,cs),a(it,{trigger:["click"]},{overlay:o(()=>[a(nt,null,{default:o(()=>[a(J,{onClick:g=>ot(l)},{default:o(()=>[a(s(kt)),e[94]||(e[94]=v(" 重命名 "))]),_:2,__:[94]},1032,["onClick"]),a(J,{onClick:g=>Fl(l.id)},{default:o(()=>[a(s(ue)),e[95]||(e[95]=v(" 删除 "))]),_:2,__:[95]},1032,["onClick"])]),_:2},1024)]),default:o(()=>[a(s($a),{class:"tab-more-icon",onClick:e[32]||(e[32]=vt(()=>{},["stop"]))})]),_:2},1024)],64))])]),default:o(()=>[a(r,{label:"实验镜像",name:"dockerImage",required:""},{default:o(()=>[n("div",ps," 系统实验镜像默认为"+x(Tt())+"。 ",1)]),_:1}),a(r,{label:"实验界面",name:"viewTypes",required:""},{default:o(()=>[n("div",vs,[n("div",{class:A(["interface-card",{active:l.config.viewTypes.includes(1)}]),onClick:e[33]||(e[33]=g=>Ue(1))},e[96]||(e[96]=[n("div",{class:"card-title"},"代码编辑器",-1),n("div",{class:"card-desc"},"提供代码编辑器，编辑器，调试器等工具",-1)]),2),n("div",{class:A(["interface-card",{active:l.config.viewTypes.includes(2)}]),onClick:e[34]||(e[34]=g=>Ue(2))},e[97]||(e[97]=[n("div",{class:"card-title"},"命令行终端",-1),n("div",{class:"card-desc"},"提供命令行窗口",-1)]),2),n("div",{class:A(["interface-card",{active:l.config.viewTypes.includes(3)}]),onClick:e[35]||(e[35]=g=>Ue(3))},e[98]||(e[98]=[n("div",{class:"card-title"},"容器内服务",-1),n("div",{class:"card-desc"},"直接预览容器内部Web服务",-1)]),2)])]),_:2},1024),a(r,{label:"任务关卡",name:"taskId",required:""},{default:o(()=>[a(I,{value:l.config.taskId,"onUpdate:value":g=>l.config.taskId=g,placeholder:"请选择任务关卡",allowClear:""},{default:o(()=>[(d(!0),m(q,null,S(Qe.value,g=>(d(),h(Ie,{key:g.taskId||g.id,value:g.taskId?String(g.taskId):void 0,disabled:!g.taskId||at(l.id,g.taskId)},{default:o(()=>[v(x(g.name)+" ",1),g.taskId?at(l.id,g.taskId)?(d(),m("span",gs," (已被使用)")):k("",!0):(d(),m("span",fs," (未保存)"))]),_:2},1032,["value","disabled"]))),128))]),_:2},1032,["value","onUpdate:value"])]),_:2},1024),l.config.viewTypes.includes(1)?(d(),h(r,{key:0,label:"编程语言",name:"codeType",required:""},{default:o(()=>[a(I,{value:l.config.codeType,"onUpdate:value":g=>l.config.codeType=g,placeholder:"请选择编程语言",options:s(fe).options.value,loading:s(fe).loading.value,allowClear:""},null,8,["value","onUpdate:value","options","loading"])]),_:2},1024)):k("",!0),l.config.viewTypes.includes(2)?(d(),h(r,{key:1,label:"开启时触发命令",name:"shellBegin",required:""},{default:o(()=>[a(I,{value:l.config.shellBegin,"onUpdate:value":g=>l.config.shellBegin=g,placeholder:"请选择终端类型"},{default:o(()=>[a(Ie,{value:"bash"},{default:o(()=>e[99]||(e[99]=[v("bash")])),_:1,__:[99]}),a(Ie,{value:"sh"},{default:o(()=>e[100]||(e[100]=[v("sh")])),_:1,__:[100]})]),_:2},1032,["value","onUpdate:value"])]),_:2},1024)):k("",!0),l.config.viewTypes.includes(3)?(d(),h(r,{key:2,label:"容器端口",name:"containerPort",required:""},{default:o(()=>[a(c,{value:l.config.containerPort,"onUpdate:value":g=>l.config.containerPort=g,placeholder:"请输入容器端口"},null,8,["value","onUpdate:value"])]),_:2},1024)):k("",!0),l.config.viewTypes.includes(3)?(d(),h(r,{key:3,label:"路由"},{default:o(()=>[a(c,{value:l.config.containerPath,"onUpdate:value":g=>l.config.containerPath=g,placeholder:"请输入路由（选填）"},null,8,["value","onUpdate:value"])]),_:2},1024)):k("",!0),a(r,{"wrapper-col":{offset:4,span:18}},{default:o(()=>[a(T,{class:"w-full",type:"primary",onClick:g=>xe(l)},{default:o(()=>[v(x(l.isSaved?"更新":"保存"),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["activeKey"])]),_:1},8,["model"])])):(d(),m("div",ms,e[101]||(e[101]=[n("div",{class:"no-env-content"},[n("div",{class:"no-env-badge"},"实验环境配置"),n("h3",null,"当前无编程任务，无需配置实验环境"),n("p",{class:"no-env-desc"}," 当你添加并保存编程任务后，可在此一步选择对应关卡并配置实验镜像、界面与端口。 "),n("p",{class:"no-env-hint"},"点击完成创建即可完成整个项目配置。")],-1)])))])):k("",!0),n("div",ys,[R.value===0?(d(),h(T,{key:0,onClick:tt},{default:o(()=>e[102]||(e[102]=[v("返回")])),_:1,__:[102]})):(d(),h(T,{key:1,onClick:tt},{default:o(()=>e[103]||(e[103]=[v("上一步")])),_:1,__:[103]})),R.value===3?(d(),h(T,{key:2,type:"primary",onClick:yl},{default:o(()=>e[104]||(e[104]=[v("完成创建")])),_:1,__:[104]})):(d(),h(T,{key:3,type:"primary",onClick:gl},{default:o(()=>e[105]||(e[105]=[v("下一步")])),_:1,__:[105]}))])]),n("input",{ref_key:"fileUploadInput",ref:Je,type:"file",style:{display:"none"},onChange:pl},null,544),a(ra,{open:D.value,"onUpdate:open":e[37]||(e[37]=l=>D.value=l),onConfirm:nl,onCancel:Ze},null,8,["open"]),a(ua,{open:ae.value,"onUpdate:open":e[38]||(e[38]=l=>ae.value=l),"parent-path":K.value,onConfirm:vl},null,8,["open","parent-path"]),a(da,{open:oe.value,"onUpdate:open":e[39]||(e[39]=l=>oe.value=l),"parent-path":Q.value,onConfirm:fl},null,8,["open","parent-path"]),a(ca,{open:se.value,"onUpdate:open":e[40]||(e[40]=l=>se.value=l),question:O.value,"project-id":P.value??void 0,"task-id":s(_).taskId,"existing-questions":s(le),onConfirm:Cl},null,8,["open","question","project-id","task-id","existing-questions"]),a(yt,{open:Te.value,"onUpdate:open":e[41]||(e[41]=l=>Te.value=l),title:"选择学员任务文件","git-url":i.value.gitUrl,onConfirm:s(Kt)},null,8,["open","git-url","onConfirm"]),a(yt,{open:we.value,"onUpdate:open":e[42]||(e[42]=l=>we.value=l),title:"选择评测执行文件","git-url":i.value.gitUrl,onConfirm:s(Qt)},null,8,["open","git-url","onConfirm"])])}}}),Is=Ba(_s,[["__scopeId","data-v-e9ac1c95"]]);export{Is as default};
