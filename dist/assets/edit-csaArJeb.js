import{d as Y,ak as $,am as Q,f as c,w as X,c as E,o as Z,_ as k,a1 as m,$ as v,k as o,a7 as s,G as i,ac as h,F as C,a9 as I,a6 as P,u as M}from"./vue-PnzzEkKE.js";import{R as ee}from"./RichTextEditor-PyLxNtnK.js";import{g as ae,a as te}from"./dictionary-CcjQOA1a.js";import{e as oe,a as ne}from"./index-AM_XADjJ.js";import{a as re,d as se}from"./dictionary-CjWZKCFP.js";import{a1 as u,a7 as le,a8 as ue,K as ie,z as de,I as ce,J as pe,a6 as ve,ac as me,H as fe,Y as _e}from"./antd-Cme2pY03.js";import{_ as ye}from"./index-BiYfe02N.js";const ge={class:"edit-project-page"},ke={class:"page-content"},be={class:"project-type-section"},Te={class:"project-type-desc"},he={class:"project-form-section"},je={class:"form-title"},qe={key:0},we={class:"page-footer"},Re=Y({name:"EditRainingProject",__name:"edit",setup(De){const g=$(),V=Q(),f=c(),x=c(),j=c(!1),q=c(!1),w=c(!1),n=c(1),d=c(null),a=c({name:"",description:"",difficulty:void 0,environment:void 0,secondType:void 0,classHour:0,showTaskRequire:!1}),B={name:[{required:!0,message:"请输入名称",trigger:"blur"}],description:[{required:!0,validator:(t,e)=>{if(!e)return Promise.reject("请输入简介");const r=/<img\s+[^>]*src\s*=\s*["'][^"']+["'][^>]*>/i.test(e),_=e.replace(/<[^>]*>/g,"").trim();return!r&&!_?Promise.reject("请输入简介"):Promise.resolve()},trigger:"blur"}],difficulty:[{required:!0,message:"请选择难度",trigger:"change"}],environment:[{required:!0,message:"请选择实验环境",trigger:"change"}],secondType:[{required:!0,message:"请选择小类别",trigger:"change"}]},R=re(),N=se(),b=c({1:[],2:[],3:[]}),J=()=>(b.value[n.value]||[]).map(r=>({label:r.name,value:r.value})),H=async t=>{if(!(b.value[t].length>0))try{q.value=!0;const e=ae(t);if(!e)return;const r=await te({code:e});r&&r.list&&(b.value[t]=r.list)}catch{u.error("加载实验环境选项失败")}finally{q.value=!1}},S=()=>n.value!==2&&n.value!==3?[]:N.options.value,F=async()=>{if(!f.value){u.error("缺少项目ID"),g.back();return}try{j.value=!0;const t=await oe({id:f.value});d.value=t,t.projectType&&(n.value=t.projectType,await H(t.projectType)),a.value={name:t.name||"",description:t.description||"",difficulty:t.difficulty||void 0,environment:t.environment||void 0,secondType:t.secondType||void 0,classHour:t.classHour?Number(t.classHour):0,showTaskRequire:t.showTaskRequire===1}}catch(t){u.error(t.message||"获取项目详情失败"),g.back()}finally{j.value=!1}},O=()=>{g.back()},A=async()=>{var _;try{await((_=x.value)==null?void 0:_.validate())}catch{return}if(!a.value.name){u.error("请输入名称");return}const t=a.value.description||"",e=/<img\s+[^>]*src\s*=\s*["'][^"']+["'][^>]*>/i.test(t),r=t.replace(/<[^>]*>/g,"").trim();if(!e&&!r){u.error("请输入简介");return}if(!a.value.difficulty){u.error("请选择难度");return}if(!a.value.environment){u.error("请选择实验环境");return}if((n.value===2||n.value===3)&&!a.value.secondType){u.error("请选择小类别");return}if(!f.value||!d.value){u.error("项目信息缺失");return}try{w.value=!0;const y={id:f.value,name:a.value.name,tag:d.value.tag||"",fieldType:a.value.secondType,difficulty:a.value.difficulty,classHour:a.value.classHour,topCover:d.value.topCover||"",cover:d.value.cover||"",description:a.value.description,showTaskRequire:a.value.showTaskRequire?1:2,authType:d.value.authType||1,enableCodeRepository:d.value.enableCodeRepository||!1,repositoryType:d.value.repositoryType||"",gitUrl:d.value.gitUrl||"",environment:a.value.environment};await ne(y),u.success("保存成功");const T={1:"/dashboard/raining-project-management/edit-full-stack",2:"/dashboard/raining-project-management/edit-jupyter-notebook",3:"/dashboard/raining-project-management/edit-jupyter-lab"}[n.value];T?g.push({path:T,query:{id:f.value}}):u.error("未知的项目类型")}catch(y){u.error(y.message||"保存失败")}finally{w.value=!1}};X(n,t=>{a.value.environment=void 0,a.value.secondType=void 0,a.value.showTaskRequire=!1,H(t)});const z=E(()=>({1:"全栈环境",2:"JupyterNotebook环境",3:"JupyterLab环境"})[n.value]||""),G=E(()=>{if(!a.value.environment)return"";const e=(b.value[n.value]||[]).find(r=>r.value===a.value.environment);return(e==null?void 0:e.name)||""});return Z(()=>{R.load(),N.load();const t=V.query.id;t?(f.value=Number(t),F()):(u.error("缺少项目ID"),g.back())}),(t,e)=>{const r=ue,_=le,y=ce,p=de,T=pe,D=ve,L=me,K=ie,U=fe,W=_e;return m(),k("div",ge,[e[14]||(e[14]=v("div",{class:"page-header"},[v("h2",null,"编辑实训项目")],-1)),o(W,{spinning:j.value},{default:s(()=>[v("div",ke,[v("div",be,[o(_,{value:n.value,"onUpdate:value":e[0]||(e[0]=l=>n.value=l),class:"custom-radio",disabled:""},{default:s(()=>[o(r,{value:1},{default:s(()=>e[8]||(e[8]=[i("全栈环境实训项目")])),_:1,__:[8]}),o(r,{value:2},{default:s(()=>e[9]||(e[9]=[i("JupyterNotebook环境实训项目")])),_:1,__:[9]}),o(r,{value:3},{default:s(()=>e[10]||(e[10]=[i("JupyterLab环境实训项目")])),_:1,__:[10]})]),_:1},8,["value"])]),v("div",Te,[n.value===1?(m(),k(C,{key:0},[i(" 多功能新型实战项目模式，支持图形化桌面、Web IDE、命令行、提供仿真拟真等种实验场景，适用于各类复杂工程项目研发。 ")],64)):n.value===2?(m(),k(C,{key:1},[i(" 多功能实时交互实验模式，支持实时代码、数学方程、可视化和MarkDown等。 适用于数据清理、数值模拟、统计建模、机器学习等系列实验。 ")],64)):n.value===3?(m(),k(C,{key:2},[i(" 多功能实时交互实验模式，支持实时代码、数学方程、可视化和MarkDown等。 适用于数据清理、数值模拟、统计建模、机器学习等系列实验。 ")],64)):h("",!0)]),v("div",he,[v("div",je,[i(I(z.value)+"实训项目 ",1),a.value.environment?(m(),k("span",qe," 实验环境: "+I(G.value),1)):h("",!0)]),o(K,{ref_key:"formRef",ref:x,model:a.value,rules:B,layout:"horizontal","label-col":{span:3},"wrapper-col":{span:18}},{default:s(()=>[o(p,{label:"名称",name:"name",required:""},{default:s(()=>[o(y,{value:a.value.name,"onUpdate:value":e[1]||(e[1]=l=>a.value.name=l),placeholder:"请输入名称"},null,8,["value"])]),_:1}),o(p,{label:"简介",name:"description",required:""},{default:s(()=>[o(ee,{modelValue:a.value.description,"onUpdate:modelValue":e[2]||(e[2]=l=>a.value.description=l),placeholder:"请输入简介内容",height:200},null,8,["modelValue"])]),_:1}),n.value===2?(m(),P(p,{key:0,label:"任务要求",name:"showTaskRequire"},{default:s(()=>[o(T,{checked:a.value.showTaskRequire,"onUpdate:checked":e[3]||(e[3]=l=>a.value.showTaskRequire=l)},{default:s(()=>e[11]||(e[11]=[i(" 显示任务要求（勾选后，将简介作为任务要求显示在实践项目挑战页面） ")])),_:1,__:[11]},8,["checked"])]),_:1})):h("",!0),o(p,{label:"难度",name:"difficulty",required:""},{default:s(()=>[o(D,{value:a.value.difficulty,"onUpdate:value":e[4]||(e[4]=l=>a.value.difficulty=l),placeholder:"请选择难度",options:M(R).options.value,loading:M(R).loading.value},null,8,["value","options","loading"])]),_:1}),o(p,{label:"实验环境",name:"environment",required:""},{default:s(()=>[o(D,{value:a.value.environment,"onUpdate:value":e[5]||(e[5]=l=>a.value.environment=l),placeholder:"请选择实验环境",options:J(),loading:q.value},null,8,["value","options","loading"])]),_:1}),n.value===2||n.value===3?(m(),P(p,{key:1,label:"小类别",name:"secondType",required:""},{default:s(()=>[o(D,{value:a.value.secondType,"onUpdate:value":e[6]||(e[6]=l=>a.value.secondType=l),placeholder:"请选择小类别",options:S()},null,8,["value","options"])]),_:1})):h("",!0),o(p,{label:"学时",name:"classHour"},{default:s(()=>[o(L,{min:0,class:"w-full",value:a.value.classHour,"onUpdate:value":e[7]||(e[7]=l=>a.value.classHour=l),disabled:"",placeholder:"配置任务后自动计算"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),v("div",we,[o(U,{onClick:O},{default:s(()=>e[12]||(e[12]=[i("返回")])),_:1,__:[12]}),o(U,{type:"primary",loading:w.value,onClick:A},{default:s(()=>e[13]||(e[13]=[i("下一步")])),_:1,__:[13]},8,["loading"])])])]),_:1},8,["spinning"])])}}}),Me=ye(Re,[["__scopeId","data-v-0809f513"]]);export{Me as default};
