import{d as K,ak as W,am as Y,f as d,w as $,c as E,o as Q,_ as k,a1 as g,$ as p,k as o,a7 as r,G as u,ac as q,F as D,a9 as I,a6 as X,u as P}from"./vue-PnzzEkKE.js";import{R as Z}from"./RichTextEditor-BNMG-gu7.js";import{g as ee,a as ae}from"./dictionary-BQdphWrD.js";import{e as te,a as oe}from"./index-BXiLZYq-.js";import{a as ne,e as re}from"./dictionary-Dnp66e0n.js";import{a1 as i,a7 as se,a8 as le,K as ie,z as ue,I as ce,J as de,a6 as pe,ac as ve,H as me,Y as fe}from"./antd-Cme2pY03.js";import{_ as _e}from"./index-PVXIpLUY.js";const ge={class:"edit-project-page"},ye={class:"page-content"},ke={class:"project-type-section"},be={class:"project-type-desc"},he={class:"project-form-section"},Te={class:"form-title"},je={key:0},we={class:"page-footer"},Re=K({name:"EditRainingProject",__name:"edit",setup(qe){const y=W(),U=Y(),m=d(),C=d(),T=d(!1),j=d(!1),w=d(!1),l=d(1),c=d(null),a=d({name:"",description:"",difficulty:void 0,environment:void 0,secondType:void 0,classHour:0,showTaskRequire:!0}),M={name:[{required:!0,message:"请输入名称",trigger:"blur"}],description:[{required:!0,validator:(t,e)=>{if(!e)return Promise.reject("请输入简介");const n=/<img\s+[^>]*src\s*=\s*["'][^"']+["'][^>]*>/i.test(e),f=e.replace(/<[^>]*>/g,"").trim();return!n&&!f?Promise.reject("请输入简介"):Promise.resolve()},trigger:"blur"}],difficulty:[{required:!0,message:"请选择难度",trigger:"change"}],environment:[{required:!0,message:"请选择实验环境",trigger:"change"}]},R=ne(),V=re(),b=d({1:[],2:[],3:[]}),B=()=>(b.value[l.value]||[]).map(n=>({label:n.name,value:n.value})),x=async t=>{if(!(b.value[t].length>0))try{j.value=!0;const e=ee(t);if(!e)return;const n=await ae({code:e});n&&n.list&&(b.value[t]=n.list)}catch{i.error("加载实验环境选项失败")}finally{j.value=!1}},J=async()=>{if(!m.value){i.error("缺少项目ID"),y.back();return}try{T.value=!0;const t=await te({id:m.value});c.value=t,t.projectType&&(l.value=t.projectType,await x(t.projectType)),a.value={name:t.name||"",description:t.description||"",difficulty:t.difficulty||void 0,environment:t.environment||void 0,secondType:t.secondType||void 0,classHour:t.classHour?Number(t.classHour):0,showTaskRequire:t.showTaskRequire===1}}catch(t){i.error(t.message||"获取项目详情失败"),y.back()}finally{T.value=!1}},F=()=>{y.back()},S=async()=>{var f;try{await((f=C.value)==null?void 0:f.validate())}catch{return}if(!a.value.name){i.error("请输入名称");return}const t=a.value.description||"",e=/<img\s+[^>]*src\s*=\s*["'][^"']+["'][^>]*>/i.test(t),n=t.replace(/<[^>]*>/g,"").trim();if(!e&&!n){i.error("请输入简介");return}if(!a.value.difficulty){i.error("请选择难度");return}if(!a.value.environment){i.error("请选择实验环境");return}if(!m.value||!c.value){i.error("项目信息缺失");return}try{w.value=!0;const _={id:m.value,name:a.value.name,tag:c.value.tag||"",fieldType:a.value.secondType,difficulty:a.value.difficulty,classHour:a.value.classHour,topCover:c.value.topCover||"",cover:c.value.cover||"",description:a.value.description,showTaskRequire:a.value.showTaskRequire?1:2,authType:c.value.authType||1,enableCodeRepository:c.value.enableCodeRepository||!1,repositoryType:c.value.repositoryType||"",gitUrl:c.value.gitUrl||"",environment:a.value.environment};await oe(_),i.success("保存成功");const h={1:"/dashboard/raining-project-management/edit-full-stack",2:"/dashboard/raining-project-management/edit-jupyter-notebook",3:"/dashboard/raining-project-management/edit-jupyter-lab"}[l.value];h?y.push({path:h,query:{id:m.value}}):i.error("未知的项目类型")}catch(_){i.error(_.message||"保存失败")}finally{w.value=!1}};$(l,t=>{a.value.environment=void 0,a.value.secondType=void 0,a.value.showTaskRequire=!0,x(t)});const A=E(()=>({1:"全栈环境",2:"JupyterNotebook环境",3:"JupyterLab环境"})[l.value]||""),O=E(()=>{if(!a.value.environment)return"";const e=(b.value[l.value]||[]).find(n=>n.value===a.value.environment);return(e==null?void 0:e.name)||""});return Q(()=>{R.load(),V.load();const t=U.query.id;t?(m.value=Number(t),J()):(i.error("缺少项目ID"),y.back())}),(t,e)=>{const n=le,f=se,_=ce,v=ue,h=de,N=pe,z=ve,G=ie,H=me,L=fe;return g(),k("div",ge,[e[13]||(e[13]=p("div",{class:"page-header"},[p("h2",null,"编辑实训项目")],-1)),o(L,{spinning:T.value},{default:r(()=>[p("div",ye,[p("div",ke,[o(f,{value:l.value,"onUpdate:value":e[0]||(e[0]=s=>l.value=s),class:"custom-radio",disabled:""},{default:r(()=>[o(n,{value:1},{default:r(()=>e[7]||(e[7]=[u("全栈环境实训项目")])),_:1,__:[7]}),o(n,{value:2},{default:r(()=>e[8]||(e[8]=[u("JupyterNotebook环境实训项目")])),_:1,__:[8]}),o(n,{value:3},{default:r(()=>e[9]||(e[9]=[u("JupyterLab环境实训项目")])),_:1,__:[9]})]),_:1},8,["value"])]),p("div",be,[l.value===1?(g(),k(D,{key:0},[u(" 多功能新型实战项目模式，支持图形化桌面、Web IDE、命令行、提供仿真拟真等种实验场景，适用于各类复杂工程项目研发。 ")],64)):l.value===2?(g(),k(D,{key:1},[u(" 多功能实时交互实验模式，支持实时代码、数学方程、可视化和MarkDown等。 适用于数据清理、数值模拟、统计建模、机器学习等系列实验。 ")],64)):l.value===3?(g(),k(D,{key:2},[u(" 多功能实时交互实验模式，支持实时代码、数学方程、可视化和MarkDown等。 适用于数据清理、数值模拟、统计建模、机器学习等系列实验。 ")],64)):q("",!0)]),p("div",he,[p("div",Te,[u(I(A.value)+"实训项目 ",1),a.value.environment?(g(),k("span",je," 实验环境: "+I(O.value),1)):q("",!0)]),o(G,{ref_key:"formRef",ref:C,model:a.value,rules:M,layout:"horizontal","label-col":{span:3},"wrapper-col":{span:18}},{default:r(()=>[o(v,{label:"名称",name:"name",required:""},{default:r(()=>[o(_,{value:a.value.name,"onUpdate:value":e[1]||(e[1]=s=>a.value.name=s),placeholder:"请输入名称"},null,8,["value"])]),_:1}),o(v,{label:"简介",name:"description",required:""},{default:r(()=>[o(Z,{modelValue:a.value.description,"onUpdate:modelValue":e[2]||(e[2]=s=>a.value.description=s),placeholder:"请输入简介内容",height:200},null,8,["modelValue"])]),_:1}),l.value===2?(g(),X(v,{key:0,label:"任务要求",name:"showTaskRequire"},{default:r(()=>[o(h,{checked:a.value.showTaskRequire,"onUpdate:checked":e[3]||(e[3]=s=>a.value.showTaskRequire=s),disabled:""},{default:r(()=>e[10]||(e[10]=[u(" 显示任务要求（勾选后，将简介作为任务要求显示在实践项目挑战页面） ")])),_:1,__:[10]},8,["checked"])]),_:1})):q("",!0),o(v,{label:"难度",name:"difficulty",required:""},{default:r(()=>[o(N,{value:a.value.difficulty,"onUpdate:value":e[4]||(e[4]=s=>a.value.difficulty=s),placeholder:"请选择难度",options:P(R).options.value,loading:P(R).loading.value},null,8,["value","options","loading"])]),_:1}),o(v,{label:"实验环境",name:"environment",required:""},{default:r(()=>[o(N,{value:a.value.environment,"onUpdate:value":e[5]||(e[5]=s=>a.value.environment=s),placeholder:"请选择实验环境",options:B(),loading:j.value},null,8,["value","options","loading"])]),_:1}),o(v,{label:"学时",name:"classHour"},{default:r(()=>[o(z,{min:0,class:"w-full",value:a.value.classHour,"onUpdate:value":e[6]||(e[6]=s=>a.value.classHour=s),disabled:"",placeholder:"配置任务后自动计算"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),p("div",we,[o(H,{onClick:F},{default:r(()=>e[11]||(e[11]=[u("返回")])),_:1,__:[11]}),o(H,{type:"primary",loading:w.value,onClick:S},{default:r(()=>e[12]||(e[12]=[u("下一步")])),_:1,__:[12]},8,["loading"])])])]),_:1},8,["spinning"])])}}}),Ue=_e(Re,[["__scopeId","data-v-43325262"]]);export{Ue as default};
