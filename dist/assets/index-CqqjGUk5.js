import{d as W,ak as X,f as y,c as A,o as Y,_ as m,a1 as v,$ as n,k as o,a7 as c,G as f,a9 as g,a6 as Z,ac as ee,F as h,ab as E}from"./vue-PnzzEkKE.js";import{n as te,a as ae,o as ne}from"./index-CFRqEQtr.js";import{a as oe}from"./dictionary-Dgbn3Qqw.js";import{g as se}from"./organization-Cgbh5m4g.js";import{$ as ie,a0 as le,z as ce,I as re,a1 as ue,H as pe,K as _e,af as ve,x as me,al as de,ae as C,M as L}from"./antd-Drh1eHWx.js";import{_ as ge}from"./index-L25N5W2M.js";const he={class:"raining-project-management"},ke={class:"search-section"},ye={class:"table-section"},fe={class:"table-header"},Ce={class:"table-tabs"},be={class:"tabs-left"},ze={class:"data-count"},$e={class:"tabs-right"},Ne={key:4,class:"public-scope-cell"},je={key:5,class:"action-links"},Te=["onClick"],Se=["onClick"],we=["onClick"],xe=["onClick"],Ie=["onClick"],Pe=["onClick"],Ae=["onClick"],Ee=["onClick"],Le=["onClick"],Me=["onClick"],Oe=["onClick"],De=["onClick"],Fe=W({name:"RainingProjectManagement",__name:"index",setup(Be){const $=X(),b=y([]),N=y([]),M=async()=>{try{const e=["project#environment_1","project#environment_2","project#environment_3"],t=await Promise.all(e.map(s=>oe({code:s}))),r=[];t.forEach(s=>{s&&s.list&&r.push(...s.list)});const p=new Map;r.forEach(s=>{p.has(s.value)||p.set(s.value,s)}),b.value=Array.from(p.values())}catch(e){console.error("获取环境字典失败：",e),b.value=[]}},O=async()=>{try{const e=await se({limit:1e4,page:1,startNum:0,orderbyFiled:"orgCode:asc"});e&&e.data&&e.data.list&&(N.value=e.data.list)}catch(e){console.error("获取组织列表失败：",e),N.value=[]}},D=e=>{if(!e&&e!==0)return"-";const t=String(e),r=b.value.find(p=>p.value===t);return r?r.name:"-"},u=y({projectName:"",environment:void 0,organizer:void 0}),F=A(()=>b.value.map(e=>({label:e.name,value:e.value}))),B=A(()=>{const e=new Map;return N.value.forEach(t=>{t.orgName&&!e.has(t.orgName)&&e.set(t.orgName,t.orgName)}),Array.from(e.values()).sort().map(t=>({label:t,value:t}))}),i=y({current:1,pageSize:10,total:0}),q=[{title:"项目名称",dataIndex:"projectName",key:"projectName"},{title:"实验环境",dataIndex:"environment",key:"environment"},{title:"技能标签",dataIndex:"skillTag",key:"skillTag",ellipsis:!0},{title:"主办单位",dataIndex:"organizer",key:"organizer"},{title:"公开范围",dataIndex:"publicScope",key:"publicScope"},{title:"操作",key:"action",width:280}],z=y([]),j=y(!1),k=async()=>{j.value=!0;try{const e={page:i.value.current,limit:i.value.pageSize,startNum:(i.value.current-1)*i.value.pageSize,name:u.value.projectName||void 0,orgName:u.value.organizer||void 0,environment:u.value.environment||void 0,orderbyFiled:"createTime:desc"},t=await te(e);z.value=t.list,i.value.total=t.count}catch(e){C.error(e.message||"获取项目列表失败"),z.value=[],i.value.total=0}finally{j.value=!1}},R=e=>{i.value.current=e.current,i.value.pageSize=e.pageSize,k()},U=()=>{u.value={projectName:"",environment:void 0,organizer:void 0},i.value.current=1,k()},G=()=>{i.value.current=1,k()};Y(()=>{M(),O(),k()});const V=()=>{$.push("/dashboard/raining-project-management/create")},T=e=>{$.push({path:"/dashboard/raining-project-management/statistics",query:{id:e.id,name:e.name}})},S=e=>{const t=e.status===10,r=t?"取消发布":"发布",p=t?2:10;L.confirm({title:`确认${r}`,content:`确定要${r}项目"${e.name}"吗？`,okText:"确认",cancelText:"取消",onOk:async()=>{try{await ae({id:e.id,status:p}),C.success(`${r}成功`),k()}catch(s){console.error(`${r}失败：`,s),C.error(s.message||`${r}失败`)}}})},w=e=>{$.push({path:"/dashboard/raining-project-management/edit",query:{id:e.id}})},x=e=>{L.confirm({title:"确认删除",content:`确定要删除项目"${e.name}"吗？删除后数据将无法恢复！`,okText:"确认删除",okType:"danger",cancelText:"取消",onOk:async()=>{try{await ne({id:e.id}),C.success("删除成功"),z.value.length===1&&i.value.current>1&&(i.value.current-=1),k()}catch(t){console.error("删除失败：",t),C.error(t.message||"删除失败")}}})};return(e,t)=>{const r=re,p=ce,s=le,P=ue,I=pe,H=ie,J=_e,K=ve,d=me,Q=de;return v(),m("div",he,[n("div",ke,[t[5]||(t[5]=n("h3",{class:"section-title"},"筛选查询",-1)),o(J,{model:u.value,layout:"horizontal",class:"search-form"},{default:c(()=>[o(H,{gutter:24},{default:c(()=>[o(s,{span:6},{default:c(()=>[o(p,{label:"项目名称：",name:"projectName"},{default:c(()=>[o(r,{value:u.value.projectName,"onUpdate:value":t[0]||(t[0]=l=>u.value.projectName=l),placeholder:"请输入项目名称"},null,8,["value"])]),_:1})]),_:1}),o(s,{span:6},{default:c(()=>[o(p,{label:"实验环境：",name:"environment"},{default:c(()=>[o(P,{value:u.value.environment,"onUpdate:value":t[1]||(t[1]=l=>u.value.environment=l),placeholder:"请选择实验环境",options:F.value,"allow-clear":""},null,8,["value","options"])]),_:1})]),_:1}),o(s,{span:6},{default:c(()=>[o(p,{label:"主办单位：",name:"organizer"},{default:c(()=>[o(P,{value:u.value.organizer,"onUpdate:value":t[2]||(t[2]=l=>u.value.organizer=l),placeholder:"请选择主办单位",options:B.value,"allow-clear":""},null,8,["value","options"])]),_:1})]),_:1}),o(s,{span:6,class:"form-actions"},{default:c(()=>[o(I,{type:"primary",onClick:G},{default:c(()=>t[3]||(t[3]=[f("查询")])),_:1,__:[3]}),o(I,{onClick:U},{default:c(()=>t[4]||(t[4]=[f("重置")])),_:1,__:[4]})]),_:1})]),_:1})]),_:1},8,["model"])]),n("div",ye,[n("div",fe,[n("div",Ce,[n("div",be,[t[6]||(t[6]=n("span",{class:"tab-item active"},"数据列表",-1)),n("span",ze,"数据共 "+g(i.value.total)+" 条",1)]),n("div",$e,[o(I,{type:"primary",onClick:V},{default:c(()=>t[7]||(t[7]=[f("新建项目")])),_:1,__:[7]})])])]),o(Q,{columns:q,"data-source":z.value,loading:j.value,"row-key":l=>l.id,pagination:{current:i.value.current,pageSize:i.value.pageSize,total:i.value.total,showSizeChanger:!0,showQuickJumper:!0,showTotal:l=>`共 ${l} 条`},onChange:R,bordered:""},{bodyCell:c(({column:l,record:a})=>[l.key==="projectName"?(v(),m(h,{key:0},[f(g(a.name),1)],64)):l.key==="environment"?(v(),m(h,{key:1},[f(g(D(a.environment)),1)],64)):l.key==="skillTag"?(v(),Z(K,{key:2,title:a.tag,placement:"topLeft"},{default:c(()=>[n("span",null,g(a.tag),1)]),_:2},1032,["title"])):l.key==="organizer"?(v(),m(h,{key:3},[f(g(a.orgName||"-"),1)],64)):l.key==="publicScope"?(v(),m("div",Ne,[n("div",{class:E(["status-badge",{"status-published":a.status===10,"status-unpublished":a.status!==10}])},g(a.status===10?"已发布":a.status===2?"已取消发布":(a.status===1,"已中断")),3),n("div",{class:E(["scope-badge",{"scope-full":a.authType===1,"scope-academy":a.authType===2,"scope-unit":a.authType===3,"scope-private":a.authType===4}])},g(a.authType===1?"完全公开":a.authType===2?"全院公开":a.authType===3?"本单位公开":a.authType===4?"不公开":"-"),3)])):l.key==="action"?(v(),m("div",je,[a.status===1?(v(),m(h,{key:0},[n("a",{onClick:_=>w(a)},"编辑",8,Te),o(d,{type:"vertical"}),n("a",{class:"danger-link",onClick:_=>x(a)},"删除",8,Se)],64)):a.status===10?(v(),m(h,{key:1},[n("a",{onClick:_=>T(a)},"统计",8,we),o(d,{type:"vertical"}),n("a",{onClick:_=>S(a)},"取消发布",8,xe)],64)):a.status===2?(v(),m(h,{key:2},[n("a",{onClick:_=>T(a)},"统计",8,Ie),o(d,{type:"vertical"}),n("a",{onClick:_=>S(a)},"发布",8,Pe),o(d,{type:"vertical"}),n("a",{onClick:_=>w(a)},"编辑",8,Ae),o(d,{type:"vertical"}),n("a",{class:"danger-link",onClick:_=>x(a)},"删除",8,Ee)],64)):(v(),m(h,{key:3},[n("a",{onClick:_=>T(a)},"统计",8,Le),o(d,{type:"vertical"}),n("a",{onClick:_=>S(a)},"发布",8,Me),o(d,{type:"vertical"}),n("a",{onClick:_=>w(a)},"编辑",8,Oe),o(d,{type:"vertical"}),n("a",{class:"danger-link",onClick:_=>x(a)},"删除",8,De)],64))])):ee("",!0)]),_:1},8,["data-source","loading","row-key","pagination"])])])}}}),Je=ge(Fe,[["__scopeId","data-v-c96039d2"]]);export{Je as default};
