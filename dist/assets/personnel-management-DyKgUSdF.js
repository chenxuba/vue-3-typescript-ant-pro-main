import{g as oe}from"./personnel-D-EgHm-A.js";import{g as F}from"./organization-BOp2Ae43.js";import{at as le,H as ne,ar as re,I as ie,Y as de,ad as ce,ai as ue,al as pe,z as _e,S as me,K as ge,ag as ve,an as fe,a1 as c}from"./antd-BAFH3H32.js";import{d as he,f as p,r as ye,o as ke,_ as g,a1 as _,$ as o,k as n,u as M,a7 as i,G as k,a6 as O,ac as T,a9 as v}from"./vue-PnzzEkKE.js";import{_ as Ne}from"./index-B86OkuRG.js";const we={class:"personnel-management"},xe={class:"content-wrapper"},Ie={class:"left-panel"},be={class:"panel-header"},Se={class:"header-title"},De={class:"title-icon"},Ce={class:"search-box"},ze={key:0,class:"loading-container"},Le={key:1,class:"empty-search"},Ee={key:2,class:"tree-container"},Ke={class:"tree-node-title"},$e={class:"node-name"},Ae={class:"panel-footer"},Fe={class:"stats-info"},Oe={class:"stat-item"},Te={class:"stat-label"},Ue={class:"stat-value"},Be={key:0,class:"search-tip"},Pe={class:"right-panel"},Re={class:"query-form"},Ve={class:"table-header"},qe={class:"table-info"},Me={class:"info-value"},Qe={class:"table-container"},Ge={key:0,class:"user-link"},He={key:1},Je={key:2},Ye={key:3},je=he({name:"PersonnelManagement",__name:"personnel-management",setup(We){const u=p([]),L=p(null),y=p([]),N=p([]),f=p(!1),b=p(new Set),w=p(""),S=p(!1),E=p(new Set),s=ye({userID:"",operatorName:"",orgName:"",page:1,pageSize:10,orderbyFiled:"createTime:desc"}),K=p(!1),U=p([]),$=p(0),Q=[{title:"用户编号",dataIndex:"operatorID",key:"operatorID",width:160},{title:"用户昵称",dataIndex:"operatorName",key:"operatorName",width:140},{title:"单位",dataIndex:"orgName",key:"orgName",width:200,ellipsis:!0},{title:"是否管理人",dataIndex:"isAdmin",key:"isAdmin",width:120},{title:"手机号",dataIndex:"mobileNO",key:"mobileNO",width:140},{title:"邮箱",dataIndex:"oEmail",key:"oEmail",width:200,ellipsis:!0},{title:"状态",dataIndex:"status",key:"status",width:100},{title:"操作",key:"action",width:150,fixed:"right"}],G=a=>{let e=0;const t=r=>{r.forEach(d=>{e++,d.children&&d.children.length>0&&t(d.children)})};return t(a),e},B=(a,e)=>{for(const t of a){if(t.orgID===e)return t;if(t.children&&t.children.length>0){const r=B(t.children,e);if(r)return r}}return null},P=async(a=0)=>{const e=await F({limit:1e4,page:1,startNum:0,orderbyFiled:"orgCode:asc",parentOrgID:a});return e&&e.data&&e.data.list?e.data.list.map(t=>({...t,key:t.orgID,title:t.orgName,children:[],isLeaf:!1})):[]},R=async()=>{try{f.value=!0;const a=await P(0);if(u.value=a,a.length>0){const e=[];let t=0;for(const r of a){const d=await P(r.orgID);if(d.length>0){const h=A=>A.map(I=>I.orgID===r.orgID?(b.value.add(r.orgID),e.push(r.orgID),t+=d.length,{...I,children:d,isLeaf:!1}):I);u.value=h(u.value)}}y.value=e,t>0?c.success(`成功加载 ${a.length} 个顶级组织和 ${t} 个子组织`):c.success(`成功加载 ${a.length} 个顶级组织`)}else c.warning("未获取到组织数据")}catch(a){console.error("获取组织列表失败:",a),c.error("获取组织列表失败，请稍后重试")}finally{f.value=!1}},H=async(a,e=!1)=>{try{E.value.add(a);const t=await F({limit:1e4,page:1,startNum:0,orderbyFiled:"orgCode:asc",parentOrgID:a});if(t&&t.data&&t.data.list){const r=t.data.list.map(h=>({...h,key:h.orgID,title:h.orgName,children:[],isLeaf:!1})),d=B(u.value,a);return d&&(d.children=r,r.length===0&&(d.isLeaf=!0),b.value.add(a)),u.value=[...u.value],r.length}return 0}catch(t){return console.error("加载子节点失败:",t),e||c.error("加载子节点失败"),0}finally{E.value.delete(a)}},J=async(a,e)=>{if(y.value=a,e.expanded){const t=e.node.dataRef,r=t.orgID;if(t.children&&t.children.length===0&&!t.isLeaf&&!b.value.has(r)){const d=await H(r);d>0&&c.success(`加载了 ${d} 个子组织`)}}},Y=(a,e)=>{a.length>0&&(N.value=a,L.value=e.node.dataRef,s.orgName=e.node.dataRef.orgName||"",x())},j=async()=>{const a=w.value.trim();if(!a){D();return}try{S.value=!0,f.value=!0;const e=await F({limit:1e4,page:1,startNum:0,orderbyFiled:"orgCode:asc",orgName:a});e&&e.data&&e.data.list?(u.value=e.data.list.map(t=>({...t,key:t.orgID,title:t.orgName,children:[],isLeaf:!0})),N.value=[],L.value=null,y.value=[],c.success(`找到 ${u.value.length} 个匹配的组织`)):(u.value=[],c.warning("未找到匹配的组织"))}catch(e){console.error("搜索组织失败:",e),c.error("搜索失败，请稍后重试")}finally{f.value=!1}},D=async()=>{w.value="",S.value=!1,N.value=[],L.value=null,y.value=[],b.value.clear(),await R()},V=()=>{w.value.trim()?j():D()},W=()=>{D()},C=async()=>{K.value=!0;try{const a={limit:s.pageSize,page:s.page,startNum:(s.page-1)*s.pageSize,orderbyFiled:s.orderbyFiled};s.orgName&&(a.orgName=s.orgName),s.operatorName&&(a.operatorName=s.operatorName),s.userID&&(a.operatorID=Number(s.userID));const e=await oe(a);console.log(e),e.result===1&&e.data?(U.value=e.data.list,$.value=e.data.total,c.success(`成功加载 ${e.data.list.length} 条用户数据`)):c.error(e.msg||"获取用户列表失败")}catch(a){console.error("获取全量用户列表失败:",a),c.error("获取用户列表失败，请稍后重试")}finally{K.value=!1}},x=()=>{s.page=1,C()},X=()=>{s.userID="",s.operatorName="",s.orgName="",s.page=1,s.pageSize=10,C()},Z=async a=>{try{const e=a.status===1?0:1;a.status=e,c.success(e===1?"启用成功":"禁用成功")}catch{c.error("操作失败")}},ee=a=>{s.page=a.current,s.pageSize=a.pageSize,C()};return ke(()=>{R(),C()}),(a,e)=>{const t=ne,r=ie,d=de,h=ce,A=ue,I=pe,z=_e,q=me,ae=ge,te=ve,se=fe;return _(),g("div",we,[o("div",xe,[o("div",Ie,[o("div",be,[o("div",Se,[o("div",De,[n(M(le))]),e[6]||(e[6]=o("span",{class:"title-text"}," 组织架构 ",-1))])]),o("div",Ce,[n(r,{value:w.value,"onUpdate:value":e[0]||(e[0]=l=>w.value=l),placeholder:"搜索组织名称...","allow-clear":"",class:"modern-search",disabled:f.value,onPressEnter:V,onClear:W},{prefix:i(()=>[n(M(re))]),suffix:i(()=>[n(t,{type:"primary",size:"small",loading:f.value,onClick:V},{default:i(()=>e[7]||(e[7]=[k(" 搜索 ")])),_:1,__:[7]},8,["loading"])]),_:1},8,["value","disabled"])]),f.value?(_(),g("div",ze,[n(d,{size:"large",tip:"加载中..."})])):u.value.length===0?(_(),g("div",Le,[n(h,{description:"未找到匹配的组织"})])):(_(),g("div",Ee,[n(I,{"expanded-keys":y.value,"onUpdate:expandedKeys":e[1]||(e[1]=l=>y.value=l),"selected-keys":N.value,"onUpdate:selectedKeys":e[2]||(e[2]=l=>N.value=l),"tree-data":u.value,"field-names":{title:"orgName",key:"orgID",children:"children"},"show-line":"",onExpand:J,onSelect:Y},{title:i(({orgName:l,orgID:m})=>[n(A,{title:l,placement:"topLeft"},{default:i(()=>[o("div",Ke,[o("span",$e,v(l),1),E.value.has(m)?(_(),O(d,{key:0,size:"small",class:"ml-2"})):T("",!0)])]),_:2},1032,["title"])]),_:1},8,["expanded-keys","selected-keys","tree-data"])])),o("div",Ae,[o("div",Fe,[o("div",Oe,[o("span",Te,v(S.value?"搜索结果":"已加载"),1),o("span",Ue,v(G(u.value)),1)])]),S.value?(_(),g("div",Be,[n(t,{type:"link",size:"small",onClick:D},{default:i(()=>e[8]||(e[8]=[k(" 清空搜索，返回树形结构 ")])),_:1,__:[8]})])):T("",!0)])]),o("div",Pe,[e[14]||(e[14]=o("div",{class:"query-header"},[o("h3",null,"筛选查询")],-1)),o("div",Re,[n(ae,{layout:"inline"},{default:i(()=>[n(z,{label:"用户ID"},{default:i(()=>[n(r,{value:s.userID,"onUpdate:value":e[3]||(e[3]=l=>s.userID=l),placeholder:"请输入","allow-clear":"",style:{width:"180px"},onPressEnter:x},null,8,["value"])]),_:1}),n(z,{label:"姓名"},{default:i(()=>[n(r,{value:s.operatorName,"onUpdate:value":e[4]||(e[4]=l=>s.operatorName=l),placeholder:"请输入","allow-clear":"",style:{width:"180px"},onPressEnter:x},null,8,["value"])]),_:1}),n(z,{label:"组织名称"},{default:i(()=>[n(r,{value:s.orgName,"onUpdate:value":e[5]||(e[5]=l=>s.orgName=l),placeholder:"请输入","allow-clear":"",style:{width:"200px"},onPressEnter:x},null,8,["value"])]),_:1}),n(z,null,{default:i(()=>[n(q,null,{default:i(()=>[n(t,{type:"primary",onClick:x},{default:i(()=>e[9]||(e[9]=[k(" 查询 ")])),_:1,__:[9]}),n(t,{onClick:X},{default:i(()=>e[10]||(e[10]=[k(" 重置 ")])),_:1,__:[10]})]),_:1})]),_:1})]),_:1})]),o("div",Ve,[o("div",qe,[e[11]||(e[11]=o("span",{class:"info-label"},"数据列表",-1)),e[12]||(e[12]=o("span",{class:"info-divider"},"数据共",-1)),o("span",Me,v($.value),1),e[13]||(e[13]=o("span",{class:"info-unit"},"条",-1))])]),o("div",Qe,[n(se,{columns:Q,"data-source":U.value,loading:K.value,pagination:{current:s.page,pageSize:s.pageSize,total:$.value,showSizeChanger:!0,showQuickJumper:!0,showTotal:l=>`共 ${l} 条`},scroll:{x:1400},"row-key":"operatorID",onChange:ee},{bodyCell:i(({column:l,record:m})=>[l.key==="operatorName"?(_(),g("a",Ge,v(m.operatorName),1)):l.key==="isAdmin"?(_(),g("span",He,"-")):l.key==="mobileNO"?(_(),g("span",Je,v(m.mobileNO||"-"),1)):l.key==="oEmail"?(_(),g("span",Ye,v(m.oEmail||"-"),1)):l.key==="status"?(_(),O(te,{key:4,color:m.status===1?"green":"red"},{default:i(()=>[k(v(m.status===1?"启用":"禁用"),1)]),_:2},1032,["color"])):l.key==="action"?(_(),O(q,{key:5},{default:i(()=>[n(t,{type:"link",size:"small",onClick:Xe=>Z(m)},{default:i(()=>[k(v(m.status===1?"禁用":"启用"),1)]),_:2},1032,["onClick"])]),_:2},1024)):T("",!0)]),_:1},8,["data-source","loading","pagination"])])])])])}}}),oa=Ne(je,[["__scopeId","data-v-15285602"]]);export{oa as default};
