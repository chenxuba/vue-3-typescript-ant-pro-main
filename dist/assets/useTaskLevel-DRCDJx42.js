import{R as me,u as fe}from"./RichTextEditor-BdL1JLaO.js";import{h as Z,i as pe,j as ge,k as ye,l as he,m as we,b as G,d as ke}from"./index-BPwwnzuA.js";import{K as Ce,z as Fe,H as Te,I as Ie,aj as be,ab as Ae,ak as _e,a1 as i,M as J}from"./antd-DHaIpRVu.js";import{d as Se,f as C,w as Ve,a6 as z,a1 as D,a7 as S,k as V,$ as Q,G as K,_ as W,F as qe,ag as xe,ac as X,ab as Le,a9 as $e,u as Y,c as E}from"./vue-PnzzEkKE.js";import{_ as Re}from"./index-CHw3NtI0.js";const Ue={class:"ai-buttons-bar"},De={class:"options-list"},Qe=["onClick"],Ke=Se({__name:"QuestionModal",props:{open:{type:Boolean},question:{},projectId:{},taskId:{},existingQuestions:{}},emits:["update:open","confirm"],setup(y,{emit:p}){const l=y,b=p,A=C(),o=C({id:"",name:"",options:[{id:"1",label:"A",content:"",isCorrect:!1},{id:"2",label:"B",content:"",isCorrect:!1},{id:"3",label:"C",content:"",isCorrect:!1},{id:"4",label:"D",content:"",isCorrect:!1}],answerKey:""}),x={name:[{required:!0,message:"请输入题干"},{validator:(c,r)=>!r||!r.replace(/<[^>]*>/g,"").trim()?Promise.reject("请输入内容"):Promise.resolve()}],answerKey:[{required:!0,message:"请输入答案解析",trigger:"blur"}]},d=c=>{let r=[];try{r=JSON.parse(c.selects||"[]").map((g,F)=>{const T=Object.keys(g)[0];return{id:(F+1).toString(),label:T,content:g[T],isCorrect:c.answer.includes(T)}})}catch{r=[{id:"1",label:"A",content:"",isCorrect:!1},{id:"2",label:"B",content:"",isCorrect:!1},{id:"3",label:"C",content:"",isCorrect:!1},{id:"4",label:"D",content:"",isCorrect:!1}]}return{id:c.id,name:c.name,options:r,answerKey:c.answerKey}};Ve(()=>l.open,c=>{c&&(l.question?o.value=d(l.question):o.value={id:Date.now().toString(),name:"",options:[{id:"1",label:"A",content:"",isCorrect:!1},{id:"2",label:"B",content:"",isCorrect:!1},{id:"3",label:"C",content:"",isCorrect:!1},{id:"4",label:"D",content:"",isCorrect:!1}],answerKey:""})});const I=()=>{var c;b("update:open",!1),(c=A.value)==null||c.resetFields()},_=c=>{var F,T;const r=c.options.filter(u=>u.content.trim()).map(u=>({[u.label]:u.content})),v=c.options.filter(u=>u.isCorrect).map(u=>u.label).join(",");let g=1;return l.question&&l.question.weight?g=l.question.weight:l.existingQuestions&&l.existingQuestions.length>0&&(g=Math.max(...l.existingQuestions.map(q=>q.weight||0))+1),{id:c.id,name:c.name,answer:v,answerKey:c.answerKey,selects:JSON.stringify(r),projectId:l.projectId||((F=l.question)==null?void 0:F.projectId),taskId:l.taskId||((T=l.question)==null?void 0:T.taskId),weight:g}},M=async()=>{var c,r,v,g;try{if(await((c=A.value)==null?void 0:c.validate()),!o.value.options.some(f=>f.content.trim())){i.error("请至少填写一个选项");return}if(!o.value.options.some(f=>f.isCorrect)){i.error("请至少设置一个正确答案");return}if(!l.projectId){i.error("项目ID不存在");return}if(!l.taskId){i.error("任务关卡ID不存在，请先保存任务关卡");return}const u=_(o.value),q=l.question&&l.question.id;console.log("=== 题目参数 ==="),console.log("操作模式:",q?"编辑":"新增"),console.log("题目ID (id):",u.id),console.log("题目数据:",u),console.log("项目ID (projectId):",u.projectId),console.log("任务ID (taskId):",u.taskId),console.log("排序权重 (weight):",u.weight),console.log("已有题目数量:",((r=l.existingQuestions)==null?void 0:r.length)||0),console.log("==================");try{if(q){console.log("编辑模式：调用更新接口");const f=await Z({id:parseInt(u.id),name:u.name,answer:u.answer,answerKey:u.answerKey,selects:u.selects,projectId:u.projectId,taskId:u.taskId,weight:u.weight});console.log("题目更新成功，返回数据:",f),i.success("题目更新成功"),b("confirm",u),b("update:open",!1),(v=A.value)==null||v.resetFields()}else{const f=await pe({name:u.name,answer:u.answer,answerKey:u.answerKey,selects:u.selects,projectId:u.projectId,taskId:u.taskId,weight:u.weight});console.log("题目创建成功，返回数据:",f),i.success("题目创建成功"),u.id=f.id.toString(),b("confirm",u),b("update:open",!1),(g=A.value)==null||g.resetFields()}}catch(f){console.error(q?"题目更新失败:":"题目创建失败:",f),i.error(f.message||(q?"题目更新失败，请重试":"题目创建失败，请重试"))}}catch{i.error("请完善必填信息")}},j=c=>{o.value.options.forEach(v=>{v.isCorrect=!1});const r=o.value.options.find(v=>v.id===c);r&&(r.isCorrect=!0)},P=c=>{if(o.value.options.length<=2){i.warning("至少保留2个选项");return}const r=o.value.options.findIndex(v=>v.id===c);r!==-1&&(o.value.options.splice(r,1),o.value.options.forEach((v,g)=>{v.label=String.fromCharCode(65+g)}))},O=()=>{if(o.value.options.length>=10){i.warning("最多添加10个选项");return}const c=String.fromCharCode(65+o.value.options.length);o.value.options.push({id:Date.now().toString(),label:c,content:"",isCorrect:!1})},$=C(!1),L=C(!1),H=async()=>{if(!o.value.name){i.warning("请先输入题干内容");return}if(!o.value.name.replace(/<[^>]*>/g,"").trim()){i.warning("请先输入题干内容");return}try{L.value=!0,i.loading("AI正在润色题干，请稍候...",0);const r=await ge(o.value.name);i.destroy(),o.value.name=r,i.success("AI润色成功")}catch(r){i.destroy(),console.error("AI润色失败:",r),i.error(r.message||"AI润色失败，请重试")}finally{L.value=!1}},B=async()=>{if(!o.value.name){i.warning("请先输入题干内容");return}if(!o.value.name.replace(/<[^>]*>/g,"").trim()){i.warning("请先输入题干内容");return}try{$.value=!0,i.loading("AI正在生成题目，请稍候...",0);const r=await ye(o.value.name);if(i.destroy(),console.log("=== AI出题返回数据 ==="),console.log("返回结果:",r),r.title&&(o.value.name=r.title),r.options&&Array.isArray(r.options)&&r.options.length>0){const v=r.options.map((g,F)=>{const T=String.fromCharCode(65+F);return{id:(F+1).toString(),label:T,content:g,isCorrect:!1}});o.value.options=v}if(r.answer){const v=r.answer.split(",").map(g=>g.trim());o.value.options.forEach(g=>{g.isCorrect=v.includes(g.label)})}r.analysis&&(o.value.answerKey=r.analysis),i.success("AI出题成功")}catch(r){i.destroy(),console.error("AI出题失败:",r),i.error(r.message||"AI出题失败，请重试")}finally{$.value=!1}};return(c,r)=>{const v=Te,g=Fe,F=Ie,T=_e,u=Ce,q=J;return D(),z(q,{open:c.open,title:c.question?"编辑题目":"添加题目",width:"900px","mask-closable":!1,onCancel:I},{footer:S(()=>[V(v,{onClick:I},{default:S(()=>r[5]||(r[5]=[K("取消")])),_:1,__:[5]}),V(v,{type:"primary",onClick:M},{default:S(()=>r[6]||(r[6]=[K("保存")])),_:1,__:[6]})]),default:S(()=>[V(u,{ref_key:"formRef",ref:A,model:o.value,rules:x,layout:"vertical"},{default:S(()=>[V(g,{label:"题干",name:"name",required:""},{default:S(()=>[Q("div",Ue,[V(v,{type:"primary",onClick:B,loading:$.value,size:"small"},{default:S(()=>r[2]||(r[2]=[K(" AI出题 ")])),_:1,__:[2]},8,["loading"]),V(v,{type:"primary",onClick:H,loading:L.value,size:"small"},{default:S(()=>r[3]||(r[3]=[K(" AI润色 ")])),_:1,__:[3]},8,["loading"])]),V(me,{modelValue:o.value.name,"onUpdate:modelValue":r[0]||(r[0]=f=>o.value.name=f),placeholder:"请您输入题干",height:150,"show-ai-embellish":!1},null,8,["modelValue"])]),_:1}),V(g,{required:""},{label:S(()=>r[4]||(r[4]=[Q("span",null,[K("答案选项 "),Q("span",{class:"options-hint ml-12px"},"点击字母设置正确答案（单选）")],-1)])),default:S(()=>[Q("div",De,[(D(!0),W(qe,null,xe(o.value.options,f=>(D(),W("div",{key:f.id,class:"option-item"},[Q("div",{class:Le(["option-label",{"is-correct":f.isCorrect}]),onClick:R=>j(f.id)},$e(f.label),11,Qe),V(F,{value:f.content,"onUpdate:value":R=>f.content=R,placeholder:"请输入选项内容",class:"option-input"},null,8,["value","onUpdate:value"]),o.value.options.length>2?(D(),z(Y(be),{key:0,class:"remove-icon",onClick:R=>P(f.id)},null,8,["onClick"])):X("",!0),f.id===o.value.options[o.value.options.length-1].id&&o.value.options.length<10?(D(),z(Y(Ae),{key:1,class:"add-icon",onClick:O})):X("",!0)]))),128))])]),_:1}),V(g,{label:"答案解析",name:"answerKey",required:""},{default:S(()=>[V(T,{value:o.value.answerKey,"onUpdate:value":r[1]||(r[1]=f=>o.value.answerKey=f),placeholder:"请输入答案解析",rows:1},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title"])}}}),He=Re(Ke,[["__scopeId","data-v-403b19b6"]]);function Be(y){const p=C([]),l=C(""),b=C("task"),A=C(),o=C(),w=C({name:"",source:"",require:"",referenceAnswer:"",difficulty:2,tag:"",classHour:"",jumpUrl:"",type:1,projectId:(y==null?void 0:y.value)||void 0}),x=C([]),d=C({timeLimitM:0,userFiles:[],testValidateFiles:[],testValidateSh:"",passType:1,passTypeRule:"",blankCode:1,scoreRule:1,testValidateType:1,testContent:[]}),I=C([]),_=C([]),M=(s,e)=>!e||!e.replace(/<[^>]*>/g,"").trim()?Promise.reject("请输入内容"):Promise.resolve(),j={name:[{required:!0,message:"请输入任务名称",trigger:"blur"}],source:[{required:!0,message:"请上传学习资源",trigger:"change"}],require:[{required:!0,message:""},{validator:M}],referenceAnswer:[{required:!0,message:""},{validator:M}],difficulty:[{required:!0,message:"请选择难度系数",trigger:"change"}],tag:[{required:!0,message:"请输入技能标签",trigger:"blur"}],classHour:[{required:!0,message:"请输入任务学时",trigger:"blur"}],jumpUrl:[{required:!0,message:"请输入内嵌链接",trigger:"blur"}]},P={timeLimitM:[{required:!0,message:"请输入评测时长限制",trigger:"blur"}],userFiles:[{required:!0,message:"请上传学员任务文件",trigger:"change",type:"array",min:1}],testValidateFiles:[{required:!0,message:"请上传评测执行文件",trigger:"change",type:"array",min:1}],testValidateSh:[{required:!0,message:"请输入评测执行命令",trigger:"blur"}]},O=E(()=>{if(!l.value)return!1;const s=p.value.find(e=>e.id===l.value);return(s==null?void 0:s.type)==="kernel"}),$=E(()=>{if(!l.value)return!1;const s=p.value.find(e=>e.id===l.value);return(s==null?void 0:s.type)==="choice"}),L=E(()=>{if(!l.value)return!1;const s=p.value.find(e=>e.id===l.value);return(s==null?void 0:s.type)==="programming"}),H=s=>{if(p.value.some(n=>!n.taskId)){i.warning("请先保存当前未保存的任务关卡，再添加新关卡");return}if(l.value){const n=p.value.find(m=>m.id===l.value);if(n&&n.taskId){if(n.type==="choice"&&(!n.questions||n.questions.length===0)){i.warning("请至少新增一条题目"),b.value="questions";return}if(n.type==="programming"&&(!n.evaluationSettings||!n.evaluationSettings.testContent||n.evaluationSettings.testContent.length===0)){i.warning("请先配置评测设置后再添加新关卡"),b.value="evaluation";return}}}const t={programming:"编程实训任务关卡",choice:"选择题实训任务关卡",kernel:"内核链接实训任务关卡"},a={id:Date.now().toString(),name:`第${p.value.length+1}关：${t[s]}`,type:s,source:"",require:"",referenceAnswer:"",difficulty:2,tag:"",classHour:""};p.value.push(a),l.value=a.id,b.value="task",r(a.id),i.success("任务关卡添加成功")},B=s=>{var t;const e=p.value.findIndex(a=>a.id===s);e!==-1&&(p.value.splice(e,1),p.value.forEach((a,n)=>{const m=a.name.match(/^第\d+关：(.+)$/);if(m)a.name=`第${n+1}关：${m[1]}`;else{const k=a.name.indexOf("：");if(k!==-1){const U=a.name.substring(k+1);a.name=`第${n+1}关：${U}`}else a.name=`第${n+1}关：${a.name}`}}),l.value===s&&(l.value=((t=p.value[0])==null?void 0:t.id)||""),l.value&&r(l.value),i.success("任务关卡删除成功"))},c=async s=>{l.value&&l.value!==s&&v(l.value),l.value=s,b.value="task",r(s);const e=p.value.find(t=>t.id===s);e&&e.type==="choice"&&e.taskId&&await N(e.taskId)},r=s=>{const e=p.value.find(t=>t.id===s);if(e){if(e.source){const a=e.source.split(",").filter(n=>n.trim());x.value=a.map((n,m)=>{const k=n.trim();return{uid:`${Date.now()}-${m}`,name:k.substring(k.lastIndexOf("/")+1),status:"done",url:k}})}else x.value=[];const t={programming:1,choice:2,kernel:4};w.value={name:e.name,source:e.source||"",require:e.require,referenceAnswer:e.referenceAnswer,difficulty:e.difficulty,tag:e.tag,classHour:e.classHour,jumpUrl:e.jumpUrl||"",type:t[e.type]||3,projectId:(y==null?void 0:y.value)||void 0,taskId:e.taskId},e.evaluationSettings?(d.value={...e.evaluationSettings},e.evaluationSettings.userFiles&&Array.isArray(e.evaluationSettings.userFiles)?I.value=e.evaluationSettings.userFiles:I.value=[],e.evaluationSettings.testValidateFiles&&Array.isArray(e.evaluationSettings.testValidateFiles)?_.value=e.evaluationSettings.testValidateFiles:_.value=[]):(d.value={timeLimitM:0,userFiles:[],testValidateFiles:[],testValidateSh:"",passType:1,passTypeRule:"",blankCode:1,scoreRule:1,testValidateType:1,testContent:[]},I.value=[],_.value=[])}},v=s=>{const e=p.value.find(t=>t.id===s);if(e){const t=e.questions;e.source=w.value.source,e.require=w.value.require,e.referenceAnswer=w.value.referenceAnswer,e.difficulty=w.value.difficulty,e.tag=w.value.tag,e.classHour=w.value.classHour,e.jumpUrl=w.value.jumpUrl,w.value.taskId&&(e.taskId=w.value.taskId),e.questions=t,e.evaluationSettings={...d.value}}},g=async s=>{const{file:e,onSuccess:t,onError:a}=s;try{const n=await fe(e);t({url:n},e)}catch(n){a(n)}},F=s=>{var n;const{file:e,fileList:t}=s;e.status==="done"?i.success(`${e.name} 文件上传成功`):e.status==="error"&&i.error(`${e.name} 文件上传失败`),x.value=t.map(m=>{var k;return{uid:m.uid,name:m.name,status:m.status,url:((k=m.response)==null?void 0:k.url)||m.url||""}});const a=x.value.filter(m=>m.url).map(m=>m.url).join(",");w.value.source=a,(n=A.value)==null||n.validateFields(["source"])},T=async()=>{var s,e,t;try{if(O.value||$.value)await((s=A.value)==null?void 0:s.validate());else if(L.value){if(await Promise.all([(e=A.value)==null?void 0:e.validate(),(t=o.value)==null?void 0:t.validate()]),w.value.taskId&&d.value.testValidateType===1&&d.value.testContent.length===0)throw i.error("用例类型为文本时，必须至少创建一条测试集"),new Error("用例类型为文本时，必须至少创建一条测试集");if(w.value.taskId&&d.value.testValidateType===1&&d.value.testContent.length>0&&d.value.testContent.find(k=>!k.arg.trim()||!k.answer.trim()))throw i.error("测试集的输入内容和期望输出不能为空"),new Error("测试集的输入内容和期望输出不能为空")}let a={...w.value};if(L.value){const m=d.value.testContent.map(h=>({arg:h.arg,answer:h.answer,select:h.select})),k=d.value.userFiles.filter(h=>h.url).map(h=>h.url).join(","),U=d.value.testValidateFiles.filter(h=>h.url).map(h=>h.url).join(",");a={...a,timeLimitM:d.value.timeLimitM,userFiles:k,testValidateFiles:U,passType:d.value.passType,passTypeRule:d.value.passTypeRule,blankCode:d.value.blankCode,scoreRule:d.value.scoreRule,testValidateSh:d.value.testValidateSh,testValidateType:d.value.testValidateType,testContent:JSON.stringify(m)}}console.log("准备提交的数据:",a);let n;w.value.taskId?(n=await G({...a,taskId:w.value.taskId}),console.log("任务关卡更新成功，返回数据:",n),i.success("更新成功")):(n=await ke(a),console.log("任务关卡创建成功，返回数据:",n),n.taskId&&(w.value.taskId=n.taskId,console.log("已保存 taskId:",n.taskId)),i.success("保存成功")),l.value&&v(l.value)}catch(a){throw console.error("保存任务关卡失败:",a),i.error("请完善必填信息"),a}},u=async()=>{l.value&&(v(l.value),console.log("已同步当前选中关卡的表单数据到本地状态"));const s=p.value.filter(t=>t.taskId);if(s.length===0){console.log("没有需要更新的任务关卡");return}console.log(`开始批量更新 ${s.length} 个任务关卡`);const e=[];for(const t of s)try{let a={taskId:t.taskId,name:t.name,source:t.source,require:t.require,referenceAnswer:t.referenceAnswer,difficulty:t.difficulty,tag:t.tag,classHour:t.classHour,jumpUrl:t.jumpUrl,projectId:(y==null?void 0:y.value)||void 0};if(t.type==="kernel")a.type=4;else if(t.type==="choice")a.type=2;else if(t.type==="programming"&&(a.type=1,t.evaluationSettings)){const n=t.evaluationSettings,m=n.testContent.map(h=>({arg:h.arg,answer:h.answer,select:h.select})),k=n.userFiles.filter(h=>h.url).map(h=>h.url).join(","),U=n.testValidateFiles.filter(h=>h.url).map(h=>h.url).join(",");a={...a,timeLimitM:n.timeLimitM,userFiles:k,testValidateFiles:U,passType:n.passType,passTypeRule:n.passTypeRule,blankCode:n.blankCode,scoreRule:n.scoreRule,testValidateSh:n.testValidateSh,testValidateType:n.testValidateType,testContent:JSON.stringify(m)}}await G(a),console.log(`任务关卡 "${t.name}" 更新成功`)}catch(a){const n=`任务关卡 "${t.name}" 更新失败: ${a.message||"未知错误"}`;console.error(n,a),e.push(n)}if(e.length===0)i.success(`成功更新 ${s.length} 个任务关卡`);else throw e.length<s.length?(i.warning(`部分任务关卡更新失败：${e.join("; ")}`),new Error("部分任务关卡更新失败")):(i.error("所有任务关卡更新失败"),new Error("所有任务关卡更新失败"))},q=()=>{J.confirm({title:"确认重置",content:"确定要重置表单吗？所有未保存的数据将会丢失。",okText:"确定",cancelText:"取消",onOk:()=>{var e,t;let s=1;if(l.value){const a=p.value.find(n=>n.id===l.value);a&&(s={programming:1,choice:2,kernel:4}[a.type]||1)}w.value={name:"",source:"",require:"",referenceAnswer:"",difficulty:2,tag:"",classHour:"",jumpUrl:"",type:s,projectId:(y==null?void 0:y.value)||void 0},d.value={timeLimitM:0,userFiles:[],testValidateFiles:[],testValidateSh:"",passType:1,passTypeRule:"",blankCode:1,scoreRule:1,testValidateType:1,testContent:[]},x.value=[],I.value=[],_.value=[],(e=A.value)==null||e.clearValidate(),(t=o.value)==null||t.clearValidate(),i.success("已重置")}})},f=s=>{var a;const{file:e,fileList:t}=s;e.status==="done"?i.success(`${e.name} 文件上传成功`):e.status==="error"&&i.error(`${e.name} 文件上传失败`),I.value=t.map(n=>{var m;return{uid:n.uid,name:n.name,status:n.status,url:((m=n.response)==null?void 0:m.url)||n.url||""}}),d.value.userFiles=[...I.value],(a=o.value)==null||a.validateFields(["userFiles"])},R=s=>{var a;const{file:e,fileList:t}=s;e.status==="done"?i.success(`${e.name} 文件上传成功`):e.status==="error"&&i.error(`${e.name} 文件上传失败`),_.value=t.map(n=>{var m;return{uid:n.uid,name:n.name,status:n.status,url:((m=n.response)==null?void 0:m.url)||n.url||""}}),d.value.testValidateFiles=[..._.value],(a=o.value)==null||a.validateFields(["testValidateFiles"])},ee=s=>{var t;const e=s.map((a,n)=>({uid:`${Date.now()}-${n}`,name:a.name,status:"done",url:a.path}));I.value=e,d.value.userFiles=[...I.value],(t=o.value)==null||t.validateFields(["userFiles"]),i.success(`已选择 ${s.length} 个文件`)},te=s=>{var t;const e=s.map((a,n)=>({uid:`${Date.now()}-${n}`,name:a.name,status:"done",url:a.path}));_.value=e,d.value.testValidateFiles=[..._.value],(t=o.value)==null||t.validateFields(["testValidateFiles"]),i.success(`已选择 ${s.length} 个文件`)},se=()=>{d.value.testContent.push({id:Date.now().toString(),arg:"",answer:"",select:1})},ae=s=>{const e=d.value.testContent.findIndex(t=>t.id===s);e!==-1&&(d.value.testContent.splice(e,1),i.success("删除成功"))},ne=()=>{d.value.testContent=[],i.success("已清空所有测试用例")},le=()=>{i.info("下载功能开发中...")},re=()=>{i.info("批量上传功能开发中...")},ie=E(()=>{if(!l.value)return[];const s=p.value.find(e=>e.id===l.value);return(s==null?void 0:s.questions)||[]}),oe=s=>{if(!l.value)return;const e=p.value.find(t=>t.id===l.value);e&&(e.questions||(e.questions=[]),e.questions.push(s),i.success("题目添加成功"))},ue=async s=>{l.value&&J.confirm({title:"确认删除",content:"确定要删除这道题目吗？删除后无法恢复。",okText:"确定",cancelText:"取消",async onOk(){try{console.log("开始删除题目，ID:",s),await we({id:parseInt(s)}),console.log("题目删除成功"),i.success("题目删除成功");const e=p.value.find(t=>t.id===l.value);if(e&&e.questions){const t=e.questions.findIndex(a=>a.id===s);t!==-1&&e.questions.splice(t,1)}e&&e.taskId&&await N(e.taskId)}catch(e){console.error("题目删除失败:",e),i.error(e.message||"题目删除失败，请重试")}}})},ce=s=>{if(!l.value)return;const e=p.value.find(t=>t.id===l.value);if(e&&e.questions){const t=e.questions.findIndex(a=>a.id===s.id);t!==-1&&(e.questions[t]=s,i.success("题目更新成功"))}},de=s=>{if(!l.value)return;const e=p.value.find(t=>t.id===l.value);e&&(e.questions=s)},ve=async s=>{if(!(y!=null&&y.value))throw new Error("项目ID不存在");try{console.log("批量更新题目排序，共",s.length,"个题目");const e=s.map(t=>Z({id:parseInt(t.id),name:t.name,answer:t.answer,answerKey:t.answerKey,selects:t.selects,projectId:t.projectId||y.value,taskId:t.taskId,weight:t.weight}));await Promise.all(e),console.log("题目排序保存成功")}catch(e){throw console.error("保存题目排序失败:",e),e}},N=async s=>{if(!(y!=null&&y.value)){console.error("项目ID不存在");return}try{console.log("开始加载题目列表，参数:",{projectId:y.value,taskId:s});const e=await he({projectId:y.value,taskId:s});console.log("题目列表加载成功:",e);const t=e.map(a=>({id:a.id.toString(),name:a.name,answer:a.answer,answerKey:a.answerKey,selects:a.selects,projectId:a.projectId,taskId:a.taskId,weight:a.weight})).sort((a,n)=>(a.weight||0)-(n.weight||0));if(l.value){const a=p.value.find(n=>n.id===l.value);a&&(a.questions=t,console.log("题目列表已更新到任务关卡:",a.name,"题目数量:",t.length))}}catch(e){console.error("加载题目列表失败:",e),i.error(e.message||"加载题目列表失败")}};return{taskLevels:p,selectedTaskLevelId:l,currentTab:b,taskLevelFormRef:A,evaluationFormRef:o,taskLevelFormData:w,evaluationFormData:d,learningResourceFileList:x,taskLevelFormRules:j,evaluationFormRules:P,isKernelTask:O,isChoiceTask:$,isProgrammingTask:L,addTaskLevel:H,deleteTaskLevel:B,selectTaskLevel:c,saveTaskLevel:T,saveAllTaskLevels:u,resetTaskLevel:q,handleLearningResourceCustomRequest:g,handleLearningResourceUpload:F,handleUserFilesUpload:f,handleTestValidateFilesUpload:R,handleUserFilesSelect:ee,handleTestValidateFilesSelect:te,userFileList:I,testValidateFileList:_,addTestCase:se,removeTestCase:ae,clearAllTestCases:ne,downloadTemplate:le,batchUploadTestCases:re,getCurrentQuestions:ie,addQuestion:oe,deleteQuestion:ue,updateQuestion:ce,updateQuestionsOrder:de,loadQuestions:N,saveQuestionsOrder:ve}}export{He as Q,Be as u};
