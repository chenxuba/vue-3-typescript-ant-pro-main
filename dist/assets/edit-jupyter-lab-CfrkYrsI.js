const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./antd-DHaIpRVu.js","./vue-PnzzEkKE.js"])))=>i.map(i=>d[i]);
import{m as Ot,_ as Bt}from"./index-CHw3NtI0.js";import{d as Gt,ak as zt,am as Jt,f as p,c as Ge,w as ke,o as Kt,_ as g,a1 as m,$ as r,k as a,a7 as o,ac as x,F as R,ag as K,u as C,a6 as W,G as f,a9 as M,H as Wt,ab as ze,y as Ce}from"./vue-PnzzEkKE.js";import{R as Je,u as Te,g as Ke,a as Yt,d as Qt,s as Xt,c as Zt}from"./RichTextEditor-BdL1JLaO.js";import{e as ea,f as ta,a as aa,b as Ue,g as la,s as oa}from"./index-BPwwnzuA.js";import{g as sa,a as na}from"./dictionary-D-KQQSws.js";import{u as ra,a as ia,d as ua}from"./dictionary-Cm8rd2TS.js";import{H as j,j as da,t as va,x as Se,c as ca,a as pa,m as fa,u as ma,F as ga,b as ya,R as _a,N as ha,d as wa,e as ba}from"./useFileTree-hVzi9foA.js";import{a1 as i,a3 as ka,a2 as Ca,K as Ta,z as Ua,I as Sa,a4 as xa,a5 as Ra,a6 as Fa,a7 as La,a8 as Ma,ac as Pa,a9 as Aa,H as Ia,J as ja,aa as Va,D as qa,ab as Na,f as Ea,e as $a,ai as Da,Y as Ha,T as Oa,s as Ba,ag as Ga,af as za}from"./antd-DHaIpRVu.js";const Ja={class:"edit-jupyter-lab-page"},Ka={class:"page-container"},Wa={class:"steps-section"},Ya={key:0},Qa={class:"form-section"},Xa={class:"flex items-top gap-16px"},Za={class:"flex flex-col gap-12px"},el={key:0,class:"image-preview"},tl=["src"],al={class:"flex items-top gap-16px"},ll={class:"flex flex-col gap-12px"},ol={key:0,class:"image-preview"},sl=["src"],nl={class:"form-section"},rl={key:1},il={class:"form-section repository-section"},ul={class:"repository-top-bar flex items-center gap-16px justify-between"},dl={class:"repository-url-group"},vl={class:"repository-main-area"},cl={class:"repository-left"},pl={class:"repository-switch-box flex items-center justify-between"},fl={class:"flex items-center gap-12px"},ml={key:1,class:"repository-tips"},gl={class:"repository-right"},yl={key:1,class:"empty-area"},_l={key:2,class:"step-content"},hl={class:"jupyter-header"},wl={class:"jupyter-actions"},bl={class:"jupyter-iframe-wrapper"},kl={key:0,class:"loading-container"},Cl=["src"],Tl={key:3,class:"step-content evaluation-step"},Ul={class:"evaluation-section"},Sl={class:"section-block"},xl={class:"block-content"},Rl={class:"file-select-wrapper"},Fl={class:"selected-files-list"},Ll={style:{display:"flex","align-items":"center",gap:"8px"}},Ml={key:0,class:"section-block"},Pl={class:"block-header"},Al={class:"header-actions"},Il={class:"block-content"},jl={class:"test-set-label"},Vl={class:"tab-footer-buttons"},ql={class:"reference-section"},Nl={class:"section-block"},El={class:"block-content"},$l={class:"tab-footer-buttons"},Dl={key:4,class:"step-content environment-step"},Hl={class:"environment-section"},Ol={class:"environment-container"},Bl={class:"environment-left"},Gl={class:"search-box"},zl={class:"environment-list"},Jl=["onClick"],Kl={class:"environment-right"},Wl={class:"environment-config-header"},Yl={style:{display:"flex","align-items":"center",gap:"8px"}},Ql={class:"page-footer"},de="http://101.200.13.193",Xl=Gt({name:"EditJupyterLab",__name:"edit-jupyter-lab",setup(Zl){j.registerLanguage("javascript",da),j.registerLanguage("typescript",va),j.registerLanguage("xml",Se),j.registerLanguage("html",Se),j.registerLanguage("vue",Se),j.registerLanguage("css",ca),j.registerLanguage("json",pa),j.registerLanguage("markdown",fa);const H=zt(),We=Jt(),L=p(null),b=p(null),y=p(0),q=p(!1),Y=p(),xe=p(),l=p({name:"",tag:"",fieldType:void 0,difficulty:1,environment:void 0,secondType:void 0,classHour:"",topCover:"",cover:"",description:"",showTaskRequire:!1,authType:1,enableCodeRepository:!1,repositoryType:"代码仓库",gitUrl:""}),Q=p(""),X=p(""),Z=p(!1),ee=p(!1),ve=p(""),N=p(!1),ce=p(!1),Ye=()=>{N.value=!N.value},Re={name:[{required:!0,message:"请输入名称",trigger:"blur"}],tag:[{required:!0,message:"请输入技能标签",trigger:"blur"}],fieldType:[{required:!0,message:"请选择领域类别",trigger:"change"}],difficulty:[{required:!0,message:"请选择难度",trigger:"change"}],environment:[{required:!0,message:"请选择实验环境",trigger:"change"}],secondType:[{required:!0,message:"请选择小类别",trigger:"change"}],classHour:[{required:!0,message:"请输入学时",trigger:"blur"}],topCover:[{required:!0,message:"请上传顶部背景图",trigger:"change"}],cover:[{required:!0,message:"请上传封面图",trigger:"change"}],authType:[{required:!0,message:"请选择培训公开范围",trigger:"change"}]},pe=ra(),Fe=ia(),O=ua(),S=p([]),fe=p(!1),Qe=async()=>{try{fe.value=!0;const t=sa(3),e=await na({code:t});e&&e.list&&(S.value=e.list.map(n=>({label:n.name,value:String(n.value)})),console.log("加载环境选项:",{environmentOptions:S.value,currentEnvironment:l.value.environment}),l.value.environment?(U.value=String(l.value.environment),w.value.dockerImage=String(l.value.environment),console.log("使用第一步的环境:",l.value.environment)):!U.value&&S.value.length>0&&(U.value=S.value[0].value,w.value.dockerImage=S.value[0].value,l.value.environment=S.value[0].value,console.log("默认选中第一个环境:",S.value[0])))}catch(t){console.error("加载实验环境选项失败：",t),i.error("加载实验环境选项失败")}finally{fe.value=!1}},Xe=[{label:"切换仓库",value:"切换仓库"},{label:"代码仓库",value:"代码仓库"},{label:"私密代码仓库",value:"私密代码仓库"}],E=p(!1),me=p(new Set),Ze=[{title:"基本信息"},{title:"代码仓库"},{title:"实验内容"},{title:"评测设置"},{title:"实验环境"}],{fileTreeData:te,expandedKeys:ge,selectedFile:et,highlightedCode:tt,dynamicFileContents:at,handleSelectFile:lt,getNodePath:Le,addFileToTree:Me,addFolderToTree:ot,handleRenameNode:st,handleCopyPath:nt,loadRemoteFileTree:rt,loadChildrenData:it,getNodePathFromMap:ye}=ma(),B=p(!1),ae=p(!1),le=p(!1),oe=p(!1),G=p("/"),z=p("/"),Pe=p(null),se=p("/"),Ae=p("settings"),c=p({openTestValidate:1,testValidateFiles:"",testValidateSh:"",timeLimitM:"",scoreRule:1,evaluationSetting:1,testSets:[]}),T=p({showAnswer:1,prohibitCopyAnswer:1,referenceAnswer:""}),ne=p(!1),re=p(!1);let _e=1;const ut=()=>{c.value.testSets.push({id:_e++,arg:"",answer:"",select:1})},dt=t=>{if(c.value.testSets.length===1){i.warning("至少保留一个测试集");return}c.value.testSets=c.value.testSets.filter(e=>e.id!==t),i.success("删除成功")},vt=(t,e)=>{t.select=e?1:2},P=p([]),ct=t=>{const{onSuccess:e}=t;setTimeout(()=>{e("ok")},0)},pt=async t=>{const{fileList:e}=t,n=e.filter(u=>u.status==="uploading"||u.status==="done"||!u.status);P.value=n;const d=n.filter(u=>u.originFileObj&&!u.url).map(async u=>{try{const v=await Te(u.originFileObj);return u.url=v,v}catch(v){return console.error("文件上传失败:",v),i.error(`文件 ${u.name} 上传失败`),null}});if(d.length>0){const v=(await Promise.all(d)).filter(k=>k!==null);if(v.length>0){const k=n.filter(_=>_.url).map(_=>_.url).join(",");c.value.testValidateFiles=k,i.success(`成功上传 ${v.length} 个文件`)}}},ft=t=>{P.value=t.map(n=>({uid:n.uid,name:n.name,status:"done",url:n.path}));const e=t.map(n=>n.path).join(",");c.value.testValidateFiles=e,i.success(`已选择 ${t.length} 个文件`),oe.value=!1},U=p(""),ie=p(""),mt=Ge(()=>ie.value?S.value.filter(t=>t.label.toLowerCase().includes(ie.value.toLowerCase())):S.value),gt=Ge(()=>{const t=S.value.find(e=>e.value===U.value);return t?t.label:"未选择"}),w=p({dockerImage:"",secondType:"Css",timeLimitM:""}),yt=t=>{U.value=t,w.value.dockerImage=t,l.value.environment!==t&&(l.value.environment=t)},_t=async()=>{if(!L.value){i.error("缺少项目ID"),H.back();return}try{q.value=!0;const t=await ea({id:L.value});l.value={name:t.name||"",tag:t.tag||"",fieldType:t.fieldType,difficulty:t.difficulty||1,environment:t.environment,secondType:t.secondType,classHour:t.classHour||"",topCover:t.topCover||"",cover:t.cover||"",description:t.description||"",showTaskRequire:t.showTaskRequire===1,authType:t.authType||1,enableCodeRepository:t.gitUrl?!0:t.enableCodeRepository||!1,repositoryType:t.repositoryType||"代码仓库",gitUrl:t.gitUrl||""},t.topCover&&(Q.value=de+t.topCover),t.cover&&(X.value=de+t.cover),t.gitUrl&&(E.value=!0),t.environment&&(await Ce(),U.value=String(t.environment),w.value.dockerImage=String(t.environment),console.log("同步环境到第四步:",{environment:t.environment,selectedEnvironment:U.value,environmentOptions:S.value})),await ht()}catch(t){console.error("获取项目详情失败：",t),i.error(t.message||"获取项目详情失败"),H.back()}finally{q.value=!1}},ht=async()=>{if(L.value)try{const t=await ta({projectId:L.value});let e=[];if(Array.isArray(t)?e=t:t&&typeof t=="object"&&(e=t.list||t.data||t.tasks||[]),e&&e.length>0){const n=e[0];if(n){if(b.value=n.taskId,c.value={openTestValidate:n.openTestValidate||1,testValidateFiles:n.testValidateFiles||"",testValidateSh:n.testValidateSh||"",timeLimitM:n.timeLimitM||"",scoreRule:n.scoreRule||1,evaluationSetting:n.evaluationSetting||1,testSets:[]},n.testContent)try{const d=JSON.parse(n.testContent);c.value.testSets=d.map((u,v)=>({id:v+1,arg:u.arg||"",answer:u.answer||"",select:u.select||1})),_e=c.value.testSets.length+1}catch(d){console.error("解析测试集失败:",d)}c.value.testSets.length===0&&(c.value.testSets=[{id:1,arg:"",answer:"",select:1},{id:2,arg:"",answer:"",select:1}],_e=3),n.testValidateFiles&&(P.value=n.testValidateFiles.split(",").map((d,u)=>({uid:`${u}`,name:d.split("/").pop()||`文件${u+1}`,status:"done",url:d,response:d}))),T.value={showAnswer:n.showAnswer||1,prohibitCopyAnswer:n.prohibitCopyAnswer||1,referenceAnswer:n.referenceAnswer||""},n.secondType&&(w.value.secondType=n.secondType),n.timeLimitM&&(w.value.timeLimitM=n.timeLimitM),ne.value=!0,re.value=!0}}}catch(t){console.error("获取任务列表失败：",t)}},wt=async t=>{var d;if(!(t.size/1024/1024<12))return i.error("图片大小不能超过 12MB!"),!1;if(!(t.type==="image/jpeg"||t.type==="image/png"))return i.error("只能上传 JPG/PNG 格式的图片!"),!1;try{Z.value=!0;const u=await Te(t);Q.value=de+u,l.value.topCover=u,(d=Y.value)==null||d.validateFields(["topCover"]),i.success("顶部背景图上传成功")}catch{i.error("顶部背景图上传失败")}finally{Z.value=!1}return!1},bt=async t=>{var d;if(!(t.size/1024/1024<12))return i.error("图片大小不能超过 12MB!"),!1;if(!(t.type==="image/jpeg"||t.type==="image/png"))return i.error("只能上传 JPG/PNG 格式的图片!"),!1;try{ee.value=!0;const u=await Te(t);X.value=de+u,l.value.cover=u,(d=Y.value)==null||d.validateFields(["cover"]),i.success("封面图上传成功")}catch{i.error("封面图上传失败")}finally{ee.value=!1}return!1},kt=t=>{(typeof t=="boolean"?t:!!t)?B.value=!0:l.value.enableCodeRepository=!1},ue=async()=>{try{const t=i.loading("正在查询仓库文件...",0),e=await Ke(l.value.gitUrl,"");rt(e),me.value.clear(),t(),i.success("仓库文件查询成功"),console.log("查询仓库地址：",l.value.gitUrl),console.log("获取到的文件列表：",e)}catch(t){i.error(t.message||"仓库文件查询失败"),console.error("仓库文件查询失败：",t)}},Ct=async()=>{if(!l.value.gitUrl||!l.value.gitUrl.trim()){i.error("请先配置仓库地址"),Ie();return}l.value.enableCodeRepository=!0,B.value=!1,E.value=!0,await ue()},Ie=()=>{l.value.enableCodeRepository=!1,B.value=!1};ke(()=>l.value.repositoryType,t=>{t==="切换仓库"&&l.value.enableCodeRepository&&(E.value=!1,i.info("已解锁仓库地址，请重新输入"),Ce(()=>{l.value.repositoryType="代码仓库"}))}),ke(()=>l.value.environment,t=>{console.log("formData.environment 变化:",t,"当前 selectedEnvironment:",U.value),t&&String(t)!==U.value&&(U.value=String(t),w.value.dockerImage=String(t),console.log("已同步到第四步:",U.value))}),ke(()=>U.value,t=>{console.log("selectedEnvironment 变化为:",t)});const Tt=()=>{var t;l.value.enableCodeRepository&&!E.value&&((t=l.value.gitUrl)!=null&&t.trim())&&(E.value=!0,ue())},Ut=async(t,e)=>{const{expanded:n,node:d}=e;if(n&&!d.isLeaf){const u=String(d.key);if(me.value.has(u)){console.log("文件夹已加载，跳过：",u);return}try{const v=ye(u);console.log("加载文件夹：",v,"节点key:",u);const k=i.loading(`正在加载 ${d.title}...`,0),_=await Ke(l.value.gitUrl,v);it(u,_),me.value.add(u),k(),console.log("文件夹加载成功：",v,_)}catch(v){i.error(v.message||"加载文件夹失败"),console.error("加载文件夹失败：",v)}}},St=t=>{switch(String(t.key)){case"newFile":Ve();break;case"newFolder":qe();break;case"upload":je("/");break}},xt=(t,e)=>{const n=String(t.key),d=ye(e.key)||Le(e.key);switch(n){case"newFile":Ve(d);break;case"newFolder":qe(d);break;case"upload":je(d);break;case"rename":st(e);break;case"copyPath":nt(e);break;case"delete":Pt(e);break}},je=t=>{var e;se.value=t,(e=Pe.value)==null||e.click()},Rt=async t=>{var d;const e=t.target,n=(d=e.files)==null?void 0:d[0];if(n)try{let u=se.value==="/"?"":se.value.replace(/^\//,"");const v=i.loading(`正在上传 ${n.name}...`,0);await Yt(n,l.value.gitUrl,u);const k=new FileReader;k.onload=_=>{var h;const A=(h=_.target)==null?void 0:h.result;Me(n.name,A,se.value)},k.readAsText(n),v(),i.success(`文件 ${n.name} 上传成功`),console.log("文件上传成功：",{fileName:n.name,path:u})}catch(u){i.error(u.message||"文件上传失败"),console.error("文件上传失败：",u)}finally{e&&(e.value="")}},Ve=(t="/")=>{ae.value=!0,G.value=t},Ft=async t=>{try{let e=G.value==="/"?"":G.value.replace(/^\//,"");const n=i.loading("正在保存文件...",0);await Xt({fileContent:t.fileContent,fileName:t.fileName,gitUrl:l.value.gitUrl,path:e,commit:t.commitMessage}),Me(t.fileName,t.fileContent,G.value),n(),i.success("文件创建成功"),ae.value=!1,console.log("文件保存成功：",{fileName:t.fileName,path:e})}catch(e){i.error(e.message||"文件创建失败"),console.error("文件创建失败：",e)}},qe=(t="/")=>{le.value=!0,z.value=t},Lt=async t=>{try{let e=z.value==="/"?t.folderName:`${z.value.replace(/^\//,"")}/${t.folderName}`;const n=i.loading("正在创建文件夹...",0);await Zt({commit:t.commitMessage,gitUrl:l.value.gitUrl,path:e}),ot(t.folderName,z.value),n(),i.success("文件夹创建成功"),le.value=!1,console.log("文件夹创建成功：",{folderName:t.folderName,path:e})}catch(e){i.error(e.message||"文件夹创建失败"),console.error("文件夹创建失败：",e)}},Mt=t=>{const e=n=>{const d=n.findIndex(u=>u.key===t);if(d!==-1)return n.splice(d,1),!0;for(const u of n)if(u.children&&e(u.children))return!0;return!1};e(te.value)},Pt=async t=>{const e=t.children!==void 0||t.isLeaf===!1,n=t.title,u=(ye(t.key)||Le(t.key)).split("/");u.pop();const v=u.join("/")||"",{Modal:k}=await Ot(async()=>{const{Modal:_}=await import("./antd-DHaIpRVu.js").then(A=>A.av);return{Modal:_}},__vite__mapDeps([0,1]),import.meta.url);k.confirm({title:"确认删除",content:`确定要删除${e?"文件夹":"文件"} "${n}" 吗？${e?"文件夹下的所有内容也会被删除。":""}`,okText:"确定",cancelText:"取消",okType:"danger",onOk:async()=>{let _=null;try{_=i.loading("正在删除...",0),await Qt({fileName:n,gitUrl:l.value.gitUrl,path:v}),Mt(t.key),_(),i.success("删除成功"),console.log("删除成功：",{fileName:n,path:v})}catch(A){_&&_(),i.error(A.message||"删除失败"),console.error("删除失败：",A)}}})},$=()=>{Ce(()=>{window.scrollTo({top:0,behavior:"smooth"}),document.documentElement.scrollTop=0,document.body.scrollTop=0;const t=document.querySelector(".page-content");t&&(t.scrollTop=0);const e=document.querySelector(".ant-layout-content");e&&(e.scrollTop=0),document.querySelectorAll("*").forEach(d=>{d.scrollTop>0&&(d.scrollTop=0)})})},At=async()=>{y.value>0?(y.value--,$(),y.value===1&&l.value.gitUrl&&l.value.enableCodeRepository&&te.value.length===0&&await ue(),y.value===2&&b.value&&await De()):H.back()},It=async()=>{var t,e;if(y.value===0)try{await Promise.all([(t=Y.value)==null?void 0:t.validate(),(e=xe.value)==null?void 0:e.validate()]),y.value=1,$(),l.value.gitUrl&&l.value.enableCodeRepository&&te.value.length===0&&await ue()}catch{i.error("请完善必填信息"),$()}else if(y.value===1){if(l.value.enableCodeRepository&&(!l.value.gitUrl||l.value.gitUrl.trim()==="")){i.error("请输入仓库地址");return}await Ne(!1),y.value=2,$(),b.value&&await De()}else if(y.value===2)b.value&&await Vt(),y.value=3,$();else if(y.value===3){try{await Ee()}catch{return}try{await $e()}catch{return}y.value=4,$()}else y.value===4&&await jt()},Ne=async(t=!1)=>{try{q.value=!0;const e={id:L.value,projectType:3,environment:l.value.environment,name:l.value.name,tag:l.value.tag,fieldType:l.value.fieldType,difficulty:l.value.difficulty,classHour:l.value.classHour,topCover:l.value.topCover,cover:l.value.cover,description:l.value.description,showTaskRequire:l.value.showTaskRequire?1:2,authType:l.value.authType,enableCodeRepository:l.value.enableCodeRepository,secondType:l.value.secondType};t&&(e.status=10),l.value.enableCodeRepository&&(e.repositoryType=l.value.repositoryType,e.gitUrl=l.value.gitUrl),await aa(e),t?(i.success("项目更新成功！"),setTimeout(()=>{H.push("/dashboard/analysis")},500)):i.success("保存成功！")}catch(e){throw console.error("更新失败：",e),i.error(e.message||"项目更新失败，请稍后重试"),e}finally{q.value=!1}},Ee=async()=>{if(!b.value)throw i.error("任务ID不存在，请重新创建任务"),new Error("任务ID不存在");if(c.value.openTestValidate===1){if(!c.value.testValidateFiles||c.value.testValidateFiles.trim()==="")throw i.error("请上传评测文件"),new Error("请上传评测文件");if(!c.value.testValidateSh||c.value.testValidateSh.trim()==="")throw i.error("请输入评测执行命令"),new Error("请输入评测执行命令");if(!c.value.timeLimitM)throw i.error("请输入评测时长限制"),new Error("请输入评测时长限制");if(!c.value.testSets||c.value.testSets.length===0)throw i.error("请至少添加一个测试集"),new Error("请至少添加一个测试集");const n=c.value.testSets.filter(d=>d.select===1);if(n.length===0)throw i.error("请至少选中一个测试集"),new Error("请至少选中一个测试集");for(let d=0;d<n.length;d++){const u=n[d];if(!u.arg||u.arg.trim()==="")throw i.error(`测试集${d+1}的输入内容不能为空`),new Error(`测试集${d+1}的输入内容不能为空`);if(!u.answer||u.answer.trim()==="")throw i.error(`测试集${d+1}的期望输出不能为空`),new Error(`测试集${d+1}的期望输出不能为空`)}}const t=c.value.testSets.map(n=>({arg:n.arg,answer:n.answer,select:n.select})),e={taskId:b.value,projectId:L.value,openTestValidate:c.value.openTestValidate,testValidateFiles:c.value.testValidateFiles,testValidateSh:c.value.testValidateSh,timeLimitM:c.value.timeLimitM,scoreRule:c.value.scoreRule,evaluationSetting:c.value.evaluationSetting,testContent:JSON.stringify(t)};try{await Ue(e),ne.value=!0}catch(n){throw i.error("评测设置保存失败，请重试"),n}},$e=async()=>{if(!b.value)throw i.error("任务ID不存在，请重新创建任务"),new Error("任务ID不存在");if(!T.value.referenceAnswer||T.value.referenceAnswer.trim()==="")throw i.error("请输入参考答案内容"),new Error("请输入参考答案内容");if(!T.value.referenceAnswer.replace(/<[^>]*>/g,"").trim())throw i.error("请输入参考答案内容"),new Error("请输入参考答案内容");const e={taskId:b.value,projectId:L.value,showAnswer:T.value.showAnswer,prohibitCopyAnswer:T.value.prohibitCopyAnswer,referenceAnswer:T.value.referenceAnswer};try{await Ue(e),re.value=!0}catch(n){throw i.error("参考答案保存失败，请重试"),n}},jt=async()=>{try{if(!L.value||!b.value){i.error("项目ID或任务ID不存在");return}if(!ne.value){i.error("请先保存评测设置后再完成更新");return}if(!re.value){i.error("请先保存参考答案后再完成更新");return}if(!w.value.dockerImage){i.error("请选择实验环境");return}if(!w.value.timeLimitM){i.error("请输入实验环境使用时长");return}await Ue({taskId:b.value,projectId:L.value,dockerImage:w.value.dockerImage,secondType:w.value.secondType,timeLimitM:w.value.timeLimitM}),await Ne(!0)}catch(t){console.error("完成更新失败：",t),i.error("完成更新失败，请重试")}},De=async()=>{if(!b.value){console.log("taskId不存在，无法获取Pod配置");return}try{ce.value=!0,console.log("正在获取Pod配置，taskId:",b.value);const t=await la({taskId:b.value});console.log("获取到Pod数据：",t),t&&t.config&&t.config.url?(ve.value=t.config.url,console.log("更新Jupyter URL为：",ve.value),i.success("实验环境加载成功！")):(console.error("Pod配置中没有url字段"),i.warning("未获取到实验环境URL"))}catch(t){console.error("获取Pod配置失败：",t),i.error("获取实验环境失败，请稍后重试")}finally{ce.value=!1}},Vt=async()=>{if(!b.value){console.log("taskId不存在，无法停止Pod");return}try{console.log("正在停止Pod，taskId:",b.value),await oa({taskId:b.value}),console.log("Pod停止成功"),i.success("实验环境已停止")}catch(t){console.error("停止Pod失败：",t),i.error("停止实验环境失败，请稍后重试")}};return Kt(async()=>{pe.load(),Fe.load(),O.load();const t=We.query.id;t?(L.value=Number(t),await Qe(),await _t()):(i.error("缺少项目ID"),H.back())}),(t,e)=>{const n=Ca,d=ka,u=Sa,v=Ua,k=Ra,_=Fa,A=xa,h=Ma,V=La,he=Pa,F=Ia,we=Aa,He=ja,J=Ta,qt=Va,be=$a,Nt=Ea,Et=qa,$t=Da,Oe=Ha,Dt=Ga,Be=Ba,Ht=Oa;return m(),g("div",Ja,[e[71]||(e[71]=r("div",{class:"page-header"},[r("h2",null,"编辑JupyterLab环境实训项目")],-1)),a(Oe,{spinning:q.value},{default:o(()=>[r("div",Ka,[r("div",Wa,[a(d,{current:y.value,class:"custom-steps"},{default:o(()=>[(m(),g(R,null,K(Ze,(s,I)=>a(n,{key:I,title:s.title},null,8,["title"])),64))]),_:1},8,["current"])]),y.value===0?(m(),g("div",Ya,[e[38]||(e[38]=r("div",{class:"section-title"},[r("h3",null,"基本信息")],-1)),r("div",Qa,[a(J,{ref_key:"formRef",ref:Y,model:l.value,rules:Re,layout:"horizontal","label-col":{span:2},"wrapper-col":{span:18}},{default:o(()=>[a(v,{label:"名称",name:"name",required:""},{default:o(()=>[a(u,{value:l.value.name,"onUpdate:value":e[0]||(e[0]=s=>l.value.name=s),placeholder:"请输入名称"},null,8,["value"])]),_:1}),a(A,null,{default:o(()=>[a(k,{span:12},{default:o(()=>[a(v,{label:"技能标签",name:"tag",required:"","label-col":{span:4},"wrapper-col":{span:20}},{default:o(()=>[a(u,{value:l.value.tag,"onUpdate:value":e[1]||(e[1]=s=>l.value.tag=s),placeholder:"请输入技能标签"},null,8,["value"])]),_:1})]),_:1}),a(k,{span:12},{default:o(()=>[a(v,{label:"领域类别",name:"fieldType",required:"","label-col":{span:4},"wrapper-col":{span:12}},{default:o(()=>[a(_,{value:l.value.fieldType,"onUpdate:value":e[2]||(e[2]=s=>l.value.fieldType=s),placeholder:"请选择领域类别",options:C(pe).options.value,loading:C(pe).loading.value},null,8,["value","options","loading"])]),_:1})]),_:1})]),_:1}),a(v,{label:"难度",name:"difficulty",required:""},{default:o(()=>[a(V,{value:l.value.difficulty,"onUpdate:value":e[3]||(e[3]=s=>l.value.difficulty=s),class:"custom-radio"},{default:o(()=>[(m(!0),g(R,null,K(C(Fe).data.value,s=>(m(),W(h,{key:s.value,value:Number(s.value)},{default:o(()=>[f(M(s.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),a(A,null,{default:o(()=>[a(k,{span:12},{default:o(()=>[a(v,{label:"实验环境",name:"environment",required:"","label-col":{span:4},"wrapper-col":{span:20}},{default:o(()=>[a(_,{value:l.value.environment,"onUpdate:value":e[4]||(e[4]=s=>l.value.environment=s),placeholder:"请选择实验环境",options:S.value,loading:fe.value},null,8,["value","options","loading"])]),_:1})]),_:1}),a(k,{span:12},{default:o(()=>[a(v,{label:"小类别",name:"secondType",required:"","label-col":{span:4},"wrapper-col":{span:12}},{default:o(()=>[a(_,{value:l.value.secondType,"onUpdate:value":e[5]||(e[5]=s=>l.value.secondType=s),placeholder:"请选择小类别",options:C(O).options.value,loading:C(O).loading.value},null,8,["value","options","loading"])]),_:1})]),_:1})]),_:1}),a(v,{label:"学时",name:"classHour",required:""},{default:o(()=>[a(he,{min:0,class:"w-full",value:l.value.classHour,"onUpdate:value":e[6]||(e[6]=s=>l.value.classHour=s),placeholder:"请输入学时"},null,8,["value"])]),_:1}),a(v,{label:"顶部背景图",name:"topCover",required:""},{default:o(()=>[r("div",Xa,[r("div",Za,[a(we,{"before-upload":wt,"show-upload-list":!1,accept:"image/png,image/jpeg"},{default:o(()=>[a(F,{loading:Z.value},{default:o(()=>[Z.value?(m(),g(R,{key:1},[f("上传中...")],64)):(m(),g(R,{key:0},[f("选择文件")],64))]),_:1},8,["loading"])]),_:1}),Q.value?(m(),g("div",el,[r("img",{src:Q.value,alt:"顶部背景图预览",style:{"max-width":"290px","max-height":"218px","border-radius":"4px"}},null,8,tl)])):x("",!0)]),e[31]||(e[31]=r("div",{class:"upload-hint"}," 说明：支持上传png/jpeg等格式文件，文件大小不能超过12M,建议使用290*218像素。 ",-1))])]),_:1}),a(v,{label:"封面图",name:"cover",required:""},{default:o(()=>[r("div",al,[r("div",ll,[a(we,{"before-upload":bt,"show-upload-list":!1,accept:"image/png,image/jpeg"},{default:o(()=>[a(F,{loading:ee.value},{default:o(()=>[ee.value?(m(),g(R,{key:1},[f("上传中...")],64)):(m(),g(R,{key:0},[f("选择文件")],64))]),_:1},8,["loading"])]),_:1}),X.value?(m(),g("div",ol,[r("img",{src:X.value,alt:"封面图预览",style:{"max-width":"290px","max-height":"218px","border-radius":"4px"}},null,8,sl)])):x("",!0)]),e[32]||(e[32]=r("div",{class:"upload-hint"}," 说明：支持上传png/jpeg等格式文件，文件大小不能超过12M,建议使用290*218像素。 ",-1))])]),_:1}),a(v,{label:"简介",name:"description"},{default:o(()=>[a(Je,{modelValue:l.value.description,"onUpdate:modelValue":e[7]||(e[7]=s=>l.value.description=s)},null,8,["modelValue"])]),_:1}),a(v,{label:"任务要求",name:"showTaskRequire"},{default:o(()=>[a(He,{checked:l.value.showTaskRequire,"onUpdate:checked":e[8]||(e[8]=s=>l.value.showTaskRequire=s)},{default:o(()=>e[33]||(e[33]=[f(" 显示任务要求（勾选后，将帮作为任务要求显示在任务项目政策面） ")])),_:1,__:[33]},8,["checked"])]),_:1})]),_:1},8,["model"])]),e[39]||(e[39]=r("div",{class:"section-title"},[r("h3",null,"培训公开范围")],-1)),r("div",nl,[a(J,{ref_key:"trainingScopeFormRef",ref:xe,model:l.value,rules:Re,layout:"horizontal","label-col":{span:2},"wrapper-col":{span:18}},{default:o(()=>[a(v,{label:"培训公开范围",name:"authType",required:""},{default:o(()=>[a(V,{value:l.value.authType,"onUpdate:value":e[9]||(e[9]=s=>l.value.authType=s),class:"custom-radio"},{default:o(()=>[a(h,{value:1},{default:o(()=>e[34]||(e[34]=[f("完全公开")])),_:1,__:[34]}),a(h,{value:2},{default:o(()=>e[35]||(e[35]=[f("全院公开")])),_:1,__:[35]}),a(h,{value:3},{default:o(()=>e[36]||(e[36]=[f("本单位公开")])),_:1,__:[36]}),a(h,{value:4},{default:o(()=>e[37]||(e[37]=[f("不公开")])),_:1,__:[37]})]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])])])):x("",!0),y.value===1?(m(),g("div",rl,[r("div",il,[r("div",ul,[a(_,{value:l.value.repositoryType,"onUpdate:value":e[10]||(e[10]=s=>l.value.repositoryType=s),options:Xe,class:"repository-type-select"},null,8,["value"]),r("div",dl,[e[40]||(e[40]=r("span",{class:"url-label"},"仓库地址：",-1)),a(u,{value:l.value.gitUrl,"onUpdate:value":e[11]||(e[11]=s=>l.value.gitUrl=s),placeholder:"请输入仓库地址",class:"url-input",disabled:E.value,onBlur:Tt},null,8,["value","disabled"])])]),r("div",vl,[r("div",cl,[r("div",pl,[r("div",fl,[e[41]||(e[41]=r("span",{class:"switch-label"},"代码仓库",-1)),a(qt,{checked:l.value.enableCodeRepository,disabled:l.value.enableCodeRepository,onChange:kt},null,8,["checked","disabled"])]),l.value.enableCodeRepository?(m(),W(Et,{key:0},{overlay:o(()=>[a(Nt,{onClick:St},{default:o(()=>[a(be,{key:"newFile"},{default:o(()=>e[42]||(e[42]=[f("新建文件")])),_:1,__:[42]}),a(be,{key:"newFolder"},{default:o(()=>e[43]||(e[43]=[f("新建文件夹")])),_:1,__:[43]}),a(be,{key:"upload"},{default:o(()=>e[44]||(e[44]=[f("上传")])),_:1,__:[44]})]),_:1})]),default:o(()=>[a(F,{type:"primary",size:"small"},{default:o(()=>[a(C(Na)),e[45]||(e[45]=f(" 新建 "))]),_:1,__:[45]})]),_:1})):x("",!0)]),l.value.enableCodeRepository?(m(),W(ga,{key:0,"file-tree-data":C(te),"expanded-keys":C(ge),"onUpdate:expandedKeys":e[12]||(e[12]=s=>Wt(ge)?ge.value=s:null),onSelect:C(lt),onMenuClick:xt,onExpand:Ut},null,8,["file-tree-data","expanded-keys","onSelect"])):x("",!0),l.value.enableCodeRepository?(m(),g("div",ml,e[46]||(e[46]=[r("div",{class:"tips-title"},"提示：",-1),r("div",{class:"tips-content"}," 此处存放本实训所需的所有代码等相关文件，你可以通过以下： ",-1),r("div",{class:"tips-list"},[f(" 1、"),r("a",{href:"#",class:"tips-link"},"Gitee客户端"),f(" 上传已有文件来开始使用。 ")],-1),r("div",{class:"tips-list"}," 2、直接在平台上创建文件目录以及相关代码文件。 ",-1)]))):x("",!0)]),r("div",gl,[l.value.enableCodeRepository?(m(),W(ya,{key:0,"selected-file":C(et),"highlighted-code":C(tt),"dynamic-file-contents":C(at)},null,8,["selected-file","highlighted-code","dynamic-file-contents"])):(m(),g("div",yl," 在左侧代码仓库区域点击目录打开文件 "))])])])])):x("",!0),y.value===2?(m(),g("div",_l,[r("div",{class:ze(["jupyter-container",{fullscreen:N.value}])},[r("div",hl,[e[47]||(e[47]=r("h3",null,"Jupyter Lab 编辑器",-1)),r("div",wl,[a($t,{title:N.value?"退出全屏":"全屏"},{default:o(()=>[a(F,{type:"text",icon:N.value?"fullscreen-exit":"fullscreen",onClick:Ye},{default:o(()=>[f(M(N.value?"退出全屏":"全屏"),1)]),_:1},8,["icon"])]),_:1},8,["title"])])]),r("div",bl,[ce.value?(m(),g("div",kl,[a(Oe,{size:"large",tip:"正在加载实验环境..."})])):(m(),g("iframe",{key:1,src:ve.value,class:"jupyter-iframe",frameborder:"0",allowfullscreen:""},null,8,Cl))])],2)])):x("",!0),y.value===3?(m(),g("div",Tl,[a(Ht,{activeKey:Ae.value,"onUpdate:activeKey":e[23]||(e[23]=s=>Ae.value=s),class:"evaluation-tabs"},{default:o(()=>[a(Be,{key:"settings",tab:"评测设置"},{default:o(()=>[r("div",Ul,[r("div",Sl,[e[60]||(e[60]=r("div",{class:"block-header"},"评测文件",-1)),r("div",xl,[a(J,{layout:"horizontal","label-col":{span:3},"wrapper-col":{span:20}},{default:o(()=>[a(v,{label:"是否启用评测功能",required:""},{default:o(()=>[a(V,{value:c.value.openTestValidate,"onUpdate:value":e[13]||(e[13]=s=>c.value.openTestValidate=s),class:"custom-radio"},{default:o(()=>[a(h,{value:1},{default:o(()=>e[48]||(e[48]=[f("是")])),_:1,__:[48]}),a(h,{value:2},{default:o(()=>e[49]||(e[49]=[f("否")])),_:1,__:[49]})]),_:1},8,["value"])]),_:1}),c.value.openTestValidate===1?(m(),g(R,{key:0},[a(v,{label:"评测文件",required:""},{default:o(()=>[l.value.enableCodeRepository?(m(),g(R,{key:1},[r("div",Rl,[a(F,{type:"primary",onClick:e[15]||(e[15]=s=>oe.value=!0)},{default:o(()=>e[52]||(e[52]=[f("点击选择")])),_:1,__:[52]}),r("div",Fl,[(m(!0),g(R,null,K(P.value,s=>(m(),W(Dt,{key:s.uid,closable:"",onClose:()=>{P.value=P.value.filter(I=>I.uid!==s.uid),c.value.testValidateFiles=P.value.map(I=>I.url).join(",")},style:{margin:"4px"}},{default:o(()=>[f(M(s.name),1)]),_:2},1032,["onClose"]))),128))])]),e[53]||(e[53]=r("div",{class:"upload-hint"}," 说明：从代码仓库中选择文件。（点击评测按钮时调用的文件，用于检验学员任务结果是否正确） ",-1))],64)):(m(),g(R,{key:0},[a(we,{"file-list":P.value,"onUpdate:fileList":e[14]||(e[14]=s=>P.value=s),"custom-request":ct,onChange:pt,"max-count":10},{default:o(()=>[a(F,{type:"primary"},{default:o(()=>e[50]||(e[50]=[f("点击上传")])),_:1,__:[50]})]),_:1},8,["file-list"]),e[51]||(e[51]=r("div",{class:"upload-hint"}," 说明：支持上传多个文件，每个文件大小不能超过300M。 ",-1))],64))]),_:1}),a(v,{label:"评测执行命令",required:""},{default:o(()=>[a(u,{value:c.value.testValidateSh,"onUpdate:value":e[16]||(e[16]=s=>c.value.testValidateSh=s),placeholder:"请输入评测执行命令，例如：python main.py"},null,8,["value"]),e[54]||(e[54]=r("div",{class:"upload-hint"}," （执行评测文件的命令，如：python main.py、node index.js、java Main 等） ",-1))]),_:1,__:[54]}),a(v,{label:"评测时长限制",required:""},{default:o(()=>[r("div",Ll,[a(he,{value:c.value.timeLimitM,"onUpdate:value":e[17]||(e[17]=s=>c.value.timeLimitM=s),min:1,placeholder:"请输入评测时长（分钟）",style:{width:"580px"}},null,8,["value"]),e[55]||(e[55]=r("span",null,"分钟",-1))])]),_:1}),a(v,{label:"系统评分规则"},{default:o(()=>[a(V,{value:c.value.scoreRule,"onUpdate:value":e[18]||(e[18]=s=>c.value.scoreRule=s),class:"custom-radio"},{default:o(()=>[a(h,{value:1},{default:o(()=>e[56]||(e[56]=[f(" 通过全部测试集（仅当所有测试集都正确时，获得项目学时） ")])),_:1,__:[56]}),a(h,{value:2},{default:o(()=>e[57]||(e[57]=[f(" 通过部分测试集（任意一个测试集正确时，获得项目学时） ")])),_:1,__:[57]})]),_:1},8,["value"])]),_:1}),a(v,{label:"评测设置",required:""},{default:o(()=>[a(V,{value:c.value.evaluationSetting,"onUpdate:value":e[19]||(e[19]=s=>c.value.evaluationSetting=s),class:"custom-radio"},{default:o(()=>[a(h,{value:1},{default:o(()=>e[58]||(e[58]=[f(" 通过所有代码块评测（对学员任务文件的所有非空代码块进行评测） ")])),_:1,__:[58]}),a(h,{value:2},{default:o(()=>e[59]||(e[59]=[f(" 通过指定代码块评测（对学员任务文件的指定非空代码块进行评测） ")])),_:1,__:[59]})]),_:1},8,["value"])]),_:1})],64)):x("",!0)]),_:1})])]),c.value.openTestValidate===1?(m(),g("div",Ml,[r("div",Pl,[e[62]||(e[62]=r("span",null,"测试集",-1)),r("div",Al,[a(F,{onClick:ut},{default:o(()=>e[61]||(e[61]=[f("新增测试集")])),_:1,__:[61]})])]),r("div",Il,[(m(!0),g(R,null,K(c.value.testSets,(s,I)=>(m(),g("div",{key:s.id,class:"test-set-item"},[a(He,{checked:s.select===1,onChange:D=>vt(s,D.target.checked),class:"test-set-checkbox"},null,8,["checked","onChange"]),r("span",jl,"测试集"+M(I+1),1),a(u,{value:s.arg,"onUpdate:value":D=>s.arg=D,placeholder:"请输入输入内容",class:"test-set-input"},null,8,["value","onUpdate:value"]),a(u,{value:s.answer,"onUpdate:value":D=>s.answer=D,placeholder:"请输入期望输出",class:"test-set-input"},null,8,["value","onUpdate:value"]),a(C(za),{class:"delete-test-set-icon",onClick:D=>dt(s.id)},null,8,["onClick"])]))),128))])])):x("",!0),r("div",Vl,[a(F,{type:"primary",onClick:Ee},{default:o(()=>[f(M(ne.value?"更新":"保存"),1)]),_:1})])])]),_:1}),a(Be,{key:"reference",tab:"参考答案"},{default:o(()=>[r("div",ql,[r("div",Nl,[e[67]||(e[67]=r("div",{class:"block-header"},"参考答案",-1)),r("div",El,[a(J,{layout:"horizontal","label-col":{span:3},"wrapper-col":{span:20}},{default:o(()=>[a(v,{label:"是否显示参考答案模块",required:""},{default:o(()=>[a(V,{value:T.value.showAnswer,"onUpdate:value":e[20]||(e[20]=s=>T.value.showAnswer=s),class:"custom-radio"},{default:o(()=>[a(h,{value:1},{default:o(()=>e[63]||(e[63]=[f("是")])),_:1,__:[63]}),a(h,{value:2},{default:o(()=>e[64]||(e[64]=[f("否")])),_:1,__:[64]})]),_:1},8,["value"])]),_:1}),a(v,{label:"是否禁止复制参考答案",required:""},{default:o(()=>[a(V,{value:T.value.prohibitCopyAnswer,"onUpdate:value":e[21]||(e[21]=s=>T.value.prohibitCopyAnswer=s),class:"custom-radio"},{default:o(()=>[a(h,{value:1},{default:o(()=>e[65]||(e[65]=[f("是")])),_:1,__:[65]}),a(h,{value:2},{default:o(()=>e[66]||(e[66]=[f("否")])),_:1,__:[66]})]),_:1},8,["value"])]),_:1}),a(v,{label:"参考答案",required:""},{default:o(()=>[a(Je,{modelValue:T.value.referenceAnswer,"onUpdate:modelValue":e[22]||(e[22]=s=>T.value.referenceAnswer=s)},null,8,["modelValue"])]),_:1})]),_:1})])]),r("div",$l,[a(F,{type:"primary",onClick:$e},{default:o(()=>[f(M(re.value?"更新":"保存"),1)]),_:1})])])]),_:1})]),_:1},8,["activeKey"])])):x("",!0),y.value===4?(m(),g("div",Dl,[r("div",Hl,[e[70]||(e[70]=r("h3",{class:"section-main-title"},"实验环境",-1)),r("div",Ol,[r("div",Bl,[r("div",Gl,[a(u,{value:ie.value,"onUpdate:value":e[24]||(e[24]=s=>ie.value=s),placeholder:"搜索需要的实验环境","allow-clear":""},{suffix:o(()=>e[68]||(e[68]=[r("span",{class:"search-icon"},"🔍",-1)])),_:1},8,["value"])]),r("div",zl,[(m(!0),g(R,null,K(mt.value,s=>(m(),g("div",{key:s.value,class:ze(["environment-item",{active:U.value===s.value}]),onClick:I=>yt(s.value)},M(s.label),11,Jl))),128))])]),r("div",Kl,[r("div",Wl," 实验环境: "+M(gt.value),1),a(J,{model:w.value,layout:"horizontal","label-col":{span:6},"wrapper-col":{span:16}},{default:o(()=>[a(v,{label:"附带环境"},{default:o(()=>[a(_,{value:w.value.secondType,"onUpdate:value":e[25]||(e[25]=s=>w.value.secondType=s),placeholder:"请选择附带环境",options:C(O).options.value,loading:C(O).loading.value},null,8,["value","options","loading"])]),_:1}),a(v,{label:"实验环境使用时长"},{default:o(()=>[r("div",Yl,[a(he,{value:w.value.timeLimitM,"onUpdate:value":e[26]||(e[26]=s=>w.value.timeLimitM=s),min:1,placeholder:"请输入实验环境使用时长",style:{flex:"1"}},null,8,["value"]),e[69]||(e[69]=r("span",null,"分",-1))])]),_:1})]),_:1},8,["model"])])])])])):x("",!0),r("div",Ql,[a(F,{onClick:At},{default:o(()=>[f(M(y.value===0?"返回":"上一步"),1)]),_:1}),a(F,{type:"primary",loading:q.value,onClick:It},{default:o(()=>[f(M(y.value===4?"完成":"下一步"),1)]),_:1},8,["loading"])])])]),_:1},8,["spinning"]),r("input",{ref_key:"fileUploadInput",ref:Pe,type:"file",style:{display:"none"},onChange:Rt},null,544),a(_a,{open:B.value,"onUpdate:open":e[27]||(e[27]=s=>B.value=s),onConfirm:Ct,onCancel:Ie},null,8,["open"]),a(ha,{open:ae.value,"onUpdate:open":e[28]||(e[28]=s=>ae.value=s),"parent-path":G.value,onConfirm:Ft},null,8,["open","parent-path"]),a(wa,{open:le.value,"onUpdate:open":e[29]||(e[29]=s=>le.value=s),"parent-path":z.value,onConfirm:Lt},null,8,["open","parent-path"]),a(ba,{open:oe.value,"onUpdate:open":e[30]||(e[30]=s=>oe.value=s),title:"选择评测文件","git-url":l.value.gitUrl,onConfirm:ft},null,8,["open","git-url"])])}}}),io=Bt(Xl,[["__scopeId","data-v-3f9b9fff"]]);export{io as default};
