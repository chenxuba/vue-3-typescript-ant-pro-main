import{d as ie,ak as re,am as ue,f as d,c as de,o as ce,_ as c,a1 as p,$ as o,k as s,a9 as v,a7 as l,G as i,ac as q,F as y,ab as A,ag as pe}from"./vue-PnzzEkKE.js";import{f as ve,p as me,q as _e}from"./index-qgaYDQbP.js";import{g as ke}from"./organization-Ds7Qo46I.js";import{H as fe,s as ge,a3 as ye,a4 as be,z as Ne,I as we,a5 as he,an as Se,T as Te,a0 as j}from"./antd-C-FgyWyA.js";import{_ as Ie}from"./index-D3w9uP0F.js";const Ce={class:"project-statistics-page"},xe={class:"page-header"},Le={class:"page-content"},je={class:"filter-section"},ze={class:"filter-form"},$e={class:"filter-actions"},Pe={class:"table-section"},Ue={class:"table-header"},De={class:"table-info"},Ae={class:"total-info"},Ee={class:"total-number"},Fe={key:0,class:"user-link"},Me={key:2,class:"status-cell"},Be={class:"filter-section"},Ke={class:"filter-form"},Oe={class:"filter-actions"},Ve={class:"task-completion-container"},qe={class:"task-level-sidebar"},Re={class:"task-level-search"},He={class:"task-level-list"},Je=["onClick"],Qe={class:"task-table-area"},Ge={class:"table-header"},Ye={class:"table-info"},We={class:"total-info"},Xe={class:"total-number"},Ze={key:1,class:"user-link"},et=ie({name:"ProjectStatistics",__name:"statistics",setup(tt){const R=re(),E=ue(),H=d(E.query.name||"实训项目管理详情"),N=d("participation"),n=d({userNumber:"",userName:"",unit:void 0,status:void 0}),z=d([]),J=async()=>{try{const t=await ke({limit:1e4,page:1,startNum:0,orderbyFiled:"orgCode:asc"});t&&t.data&&t.data.list&&(z.value=t.data.list.map(e=>({label:e.orgName,value:e.orgName})))}catch(t){console.error("获取组织列表失败:",t),j.error("获取组织列表失败")}},Q=[{label:"已完成",value:"1"},{label:"进行中",value:"2"},{label:"未开始",value:"3"}],S=d([]),w=d(null),I=d(""),G=de(()=>I.value?S.value.filter(t=>t.name.toLowerCase().includes(I.value.toLowerCase())):S.value),Y=t=>{w.value=t,k.value.current=1,T()},W=[{title:"用户编号",dataIndex:"userId",key:"userId",width:150},{title:"用户姓名",dataIndex:"nickName",key:"nickName",width:150},{title:"单位",dataIndex:"orgName",key:"orgName",width:300},{title:"参训时间",dataIndex:"joinTime",key:"joinTime",width:200},{title:"参训状态",dataIndex:"currentTask",key:"currentTask",width:150,align:"center"}],X=[{title:"用户编号",dataIndex:"userNumber",key:"userNumber",width:150},{title:"用户姓名",dataIndex:"userName",key:"userName",width:150},{title:"单位",dataIndex:"unit",key:"unit",width:250},{title:"任务开始时间",dataIndex:"taskStartTime",key:"taskStartTime",width:180},{title:"任务结束时间",dataIndex:"taskEndTime",key:"taskEndTime",width:180},{title:"累计时间",dataIndex:"totalTime",key:"totalTime",width:120},{title:"实验状态",dataIndex:"experimentStatus",key:"experimentStatus",width:120}],F=d([]),M=d([]),f=d({current:1,pageSize:20,total:0,showSizeChanger:!0,showQuickJumper:!0,showTotal:t=>`数据共 ${t} 条`}),k=d({current:1,pageSize:20,total:0,showSizeChanger:!0,showQuickJumper:!0,showTotal:t=>`数据共 ${t} 条`}),$=d(!1),P=d(!1),U=d(Number(E.query.id)||0),C=d(0),Z=async()=>{try{const t={projectId:U.value},e=await ve(t);e&&Array.isArray(e)&&(C.value=e.length,S.value=e.map(r=>({taskId:r.taskId,name:r.name})),S.value.length>0&&(w.value=S.value[0].taskId))}catch(t){console.error("获取项目任务列表失败:",t),j.error("获取项目任务列表失败")}},D=t=>{if(!t)return"-";const e=t<1e10?t*1e3:t,r=new Date(e),g=r.getFullYear(),m=String(r.getMonth()+1).padStart(2,"0"),_=String(r.getDate()).padStart(2,"0"),b=String(r.getHours()).padStart(2,"0"),h=String(r.getMinutes()).padStart(2,"0"),L=String(r.getSeconds()).padStart(2,"0");return`${g}-${m}-${_} ${b}:${h}:${L}`},x=async()=>{$.value=!0;try{const t={limit:f.value.pageSize,page:f.value.current,projectId:U.value};n.value.userNumber&&(t.userId=n.value.userNumber),n.value.userName&&(t.nickName=n.value.userName),n.value.unit&&(t.orgName=n.value.unit),n.value.status&&(t.status=n.value.status);const e=await me(t);e&&e.list&&(F.value=e.list,f.value.total=e.count)}catch(t){console.error("获取参训数据失败:",t),j.error("获取参训数据失败")}finally{$.value=!1}},ee=(t,e)=>{if(!t||!e)return"-";const r=t<1e10?t*1e3:t,g=e<1e10?e*1e3:e,m=Math.floor((g-r)/1e3);if(m<0)return"-";const _=Math.floor(m/3600),b=Math.floor(m%3600/60),h=m%60;return`${String(_).padStart(2,"0")}:${String(b).padStart(2,"0")}:${String(h).padStart(2,"0")}`},te=t=>t===10?"已完成":t>0&&t<10?"进行中":"未开始",ae=t=>t===10?"completed":t>0&&t<10?"inProgress":"notStarted",T=async()=>{if(w.value){P.value=!0;try{const t={limit:k.value.pageSize,page:k.value.current,projectId:U.value,taskId:w.value,orderbyFiled:"id:desc"};n.value.userNumber&&(t.userId=n.value.userNumber),n.value.userName&&(t.nickName=n.value.userName),n.value.unit&&(t.orgName=n.value.unit);const e=await _e(t);e&&e.list&&(M.value=e.list,k.value.total=e.count)}catch(t){console.error("获取任务完成情况失败:",t),j.error("获取任务完成情况失败")}finally{P.value=!1}}},B=()=>{console.log("查询",n.value),N.value==="participation"?(f.value.current=1,x()):N.value==="task"&&(k.value.current=1,T())},K=()=>{n.value={userNumber:"",userName:"",unit:void 0,status:void 0},N.value==="participation"?(f.value.current=1,x()):N.value==="task"&&(k.value.current=1,T())},O=()=>{console.log("导出数据")},se=()=>{R.back()},le=t=>{f.value.current=t.current,f.value.pageSize=t.pageSize,x()},ne=t=>{k.value.current=t.current,k.value.pageSize=t.pageSize,T()};return ce(async()=>{J(),await Z(),x(),w.value&&T()}),(t,e)=>{const r=fe,g=we,m=Ne,_=be,b=he,h=ye,L=Se,V=ge,oe=Te;return p(),c("div",Ce,[o("div",xe,[o("h2",null,v(H.value),1),s(r,{onClick:se},{default:l(()=>e[9]||(e[9]=[i("返回")])),_:1,__:[9]})]),o("div",Le,[s(oe,{activeKey:N.value,"onUpdate:activeKey":e[8]||(e[8]=a=>N.value=a),class:"statistics-tabs"},{default:l(()=>[s(V,{key:"participation",tab:"参训整体情况"},{default:l(()=>[o("div",je,[e[12]||(e[12]=o("div",{class:"filter-title"},"筛选查询",-1)),o("div",ze,[s(h,{gutter:16,align:"middle"},{default:l(()=>[s(_,{span:5},{default:l(()=>[s(m,{label:"用户编号：","label-col":{span:9},"wrapper-col":{span:15}},{default:l(()=>[s(g,{value:n.value.userNumber,"onUpdate:value":e[0]||(e[0]=a=>n.value.userNumber=a),placeholder:"请输入"},null,8,["value"])]),_:1})]),_:1}),s(_,{span:5},{default:l(()=>[s(m,{label:"用户姓名：","label-col":{span:9},"wrapper-col":{span:15}},{default:l(()=>[s(g,{value:n.value.userName,"onUpdate:value":e[1]||(e[1]=a=>n.value.userName=a),placeholder:"请输入"},null,8,["value"])]),_:1})]),_:1}),s(_,{span:5},{default:l(()=>[s(m,{label:"单位：","label-col":{span:6},"wrapper-col":{span:18}},{default:l(()=>[s(b,{value:n.value.unit,"onUpdate:value":e[2]||(e[2]=a=>n.value.unit=a),placeholder:"请选择",options:z.value,"allow-clear":""},null,8,["value","options"])]),_:1})]),_:1}),s(_,{span:5},{default:l(()=>[s(m,{label:"参训状态：","label-col":{span:9},"wrapper-col":{span:15}},{default:l(()=>[s(b,{value:n.value.status,"onUpdate:value":e[3]||(e[3]=a=>n.value.status=a),placeholder:"请选择",options:Q,"allow-clear":""},null,8,["value"])]),_:1})]),_:1}),s(_,{span:4},{default:l(()=>[o("div",$e,[s(r,{type:"primary",onClick:B},{default:l(()=>e[10]||(e[10]=[i("查询")])),_:1,__:[10]}),s(r,{onClick:K},{default:l(()=>e[11]||(e[11]=[i("重置")])),_:1,__:[11]})])]),_:1})]),_:1})])]),o("div",Pe,[o("div",Ue,[o("div",De,[e[15]||(e[15]=i(" 数据列表 ")),o("span",Ae,[e[13]||(e[13]=i("数据共 ")),o("span",Ee,v(f.value.total),1),e[14]||(e[14]=i(" 条"))])]),s(r,{type:"primary",onClick:O},{default:l(()=>e[16]||(e[16]=[i("导出")])),_:1,__:[16]})]),s(L,{columns:W,"data-source":F.value,pagination:f.value,loading:$.value,"row-key":a=>a.id,scroll:{x:1e3},onChange:le},{bodyCell:l(({column:a,record:u})=>[a.key==="nickName"?(p(),c("a",Fe,v(u.nickName),1)):a.key==="joinTime"?(p(),c(y,{key:1},[i(v(D(u.joinTime)),1)],64)):a.key==="currentTask"?(p(),c("div",Me,[o("span",null,v(u.currentTask)+" / "+v(C.value),1),o("span",{class:A(["status-icon",u.currentTask>=C.value?"completed":"inProgress"])},[u.currentTask>=C.value?(p(),c(y,{key:0},[i("✓")],64)):(p(),c(y,{key:1},[i("⟳")],64))],2)])):q("",!0)]),_:1},8,["data-source","pagination","loading","row-key"])])]),_:1}),s(V,{key:"task",tab:"任务完成情况"},{default:l(()=>[o("div",Be,[e[19]||(e[19]=o("div",{class:"filter-title"},"筛选查询",-1)),o("div",Ke,[s(h,{gutter:16,align:"middle"},{default:l(()=>[s(_,{span:6},{default:l(()=>[s(m,{label:"用户编号：","label-col":{span:8},"wrapper-col":{span:16}},{default:l(()=>[s(g,{value:n.value.userNumber,"onUpdate:value":e[4]||(e[4]=a=>n.value.userNumber=a),placeholder:"请输入"},null,8,["value"])]),_:1})]),_:1}),s(_,{span:6},{default:l(()=>[s(m,{label:"用户姓名：","label-col":{span:8},"wrapper-col":{span:16}},{default:l(()=>[s(g,{value:n.value.userName,"onUpdate:value":e[5]||(e[5]=a=>n.value.userName=a),placeholder:"请输入"},null,8,["value"])]),_:1})]),_:1}),s(_,{span:6},{default:l(()=>[s(m,{label:"单位：","label-col":{span:6},"wrapper-col":{span:18}},{default:l(()=>[s(b,{value:n.value.unit,"onUpdate:value":e[6]||(e[6]=a=>n.value.unit=a),placeholder:"请选择",options:z.value,"allow-clear":""},null,8,["value","options"])]),_:1})]),_:1}),s(_,{span:6},{default:l(()=>[o("div",Oe,[s(r,{type:"primary",onClick:B},{default:l(()=>e[17]||(e[17]=[i("查询")])),_:1,__:[17]}),s(r,{onClick:K},{default:l(()=>e[18]||(e[18]=[i("重置")])),_:1,__:[18]})])]),_:1})]),_:1})])]),o("div",Ve,[o("div",qe,[o("div",Re,[s(g,{value:I.value,"onUpdate:value":e[7]||(e[7]=a=>I.value=a),placeholder:"请输入内容","allow-clear":""},{suffix:l(()=>e[20]||(e[20]=[o("span",{class:"search-icon"},"🔍",-1)])),_:1},8,["value"])]),o("div",He,[(p(!0),c(y,null,pe(G.value,a=>(p(),c("div",{key:a.taskId,class:A(["task-level-item",{active:w.value===a.taskId}]),onClick:u=>Y(a.taskId)},v(a.name),11,Je))),128))])]),o("div",Qe,[o("div",Ge,[o("div",Ye,[e[23]||(e[23]=i(" 数据列表 ")),o("span",We,[e[21]||(e[21]=i("数据共 ")),o("span",Xe,v(k.value.total),1),e[22]||(e[22]=i(" 条"))])]),s(r,{type:"primary",onClick:O},{default:l(()=>e[24]||(e[24]=[i("导出")])),_:1,__:[24]})]),s(L,{columns:X,"data-source":M.value,pagination:k.value,loading:P.value,"row-key":a=>a.id,scroll:{x:1200},onChange:ne},{bodyCell:l(({column:a,record:u})=>[a.key==="userNumber"?(p(),c(y,{key:0},[i(v(u.userId),1)],64)):a.key==="userName"?(p(),c("a",Ze,v(u.nickName),1)):a.key==="unit"?(p(),c(y,{key:2},[i(v(u.orgName||"-"),1)],64)):a.key==="taskStartTime"?(p(),c(y,{key:3},[i(v(D(u.beginTime)),1)],64)):a.key==="taskEndTime"?(p(),c(y,{key:4},[i(v(D(u.endTime)),1)],64)):a.key==="totalTime"?(p(),c(y,{key:5},[i(v(ee(u.beginTime,u.endTime)),1)],64)):a.key==="experimentStatus"?(p(),c("span",{key:6,class:A(["status-tag",ae(u.status)])},v(te(u.status)),3)):q("",!0)]),_:1},8,["data-source","pagination","loading","row-key"])])])]),_:1})]),_:1},8,["activeKey"])])])}}}),it=Ie(et,[["__scopeId","data-v-3412208a"]]);export{it as default};
