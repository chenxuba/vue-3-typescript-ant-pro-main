import{g as me,a as ve}from"./personnel-BI00Q7Cf.js";import{g as M}from"./organization-Bbw6HZQQ.js";import{at as ge,H as he,ar as ye,I as Ne,Y as ke,ad as be,aj as we,ak as De,z as Ie,S as xe,K as Ce,ag as Se,an as ze,av as Le,au as Ee,M as Ue,a1 as f}from"./antd-Cme2pY03.js";import{d as Oe,f as m,r as Te,o as Ae,_ as h,a1 as v,$ as n,k as t,u as J,a7 as s,G as c,a6 as P,ac as R,a9 as i}from"./vue-PnzzEkKE.js";import{_ as Fe}from"./index-PVXIpLUY.js";const Ke={class:"personnel-management"},$e={class:"content-wrapper"},Be={class:"left-panel"},Me={class:"panel-header"},Pe={class:"header-title"},Re={class:"title-icon"},Ve={class:"search-box"},qe={key:0,class:"loading-container"},Ge={key:1,class:"empty-search"},Qe={key:2,class:"tree-container"},je={class:"tree-node-title"},He={class:"node-name"},Je={class:"panel-footer"},Ye={class:"stats-info"},We={class:"stat-item"},Xe={class:"stat-label"},Ze={class:"stat-value"},ea={key:0,class:"search-tip"},aa={class:"right-panel"},ta={class:"query-form"},la={class:"table-header"},sa={class:"table-info"},oa={class:"info-value"},na={class:"table-container"},ra=["onClick"],ia={key:1},da={key:2},ua={key:3},ca={key:0,class:"detail-content"},pa=Oe({name:"PersonnelManagement",__name:"personnel-management",setup(_a){const g=m([]),O=m(null),b=m([]),w=m([]),k=m(!1),C=m(new Set),D=m(""),S=m(!1),T=m(new Set),o=Te({userID:"",operatorName:"",orgName:"",page:1,pageSize:10,orderbyFiled:"createTime:desc"}),A=m(!1),V=m([]),F=m(0),z=m(!1),K=m(!1),u=m(null),Y=[{title:"用户编号",dataIndex:"operatorID",key:"operatorID",width:160},{title:"用户昵称",dataIndex:"operatorName",key:"operatorName",width:140},{title:"单位",dataIndex:"orgName",key:"orgName",width:200,ellipsis:!0},{title:"是否管理人",dataIndex:"isAdmin",key:"isAdmin",width:120},{title:"手机号",dataIndex:"mobileNO",key:"mobileNO",width:140},{title:"邮箱",dataIndex:"oEmail",key:"oEmail",width:200,ellipsis:!0},{title:"状态",dataIndex:"status",key:"status",width:100}],W=a=>{let e=0;const l=d=>{d.forEach(p=>{e++,p.children&&p.children.length>0&&l(p.children)})};return l(a),e},q=(a,e)=>{for(const l of a){if(l.orgID===e)return l;if(l.children&&l.children.length>0){const d=q(l.children,e);if(d)return d}}return null},G=async(a=0)=>{const e=await M({limit:1e4,page:1,startNum:0,orderbyFiled:"orgCode:asc",parentOrgID:a});return e&&e.data&&e.data.list?e.data.list.map(l=>({...l,key:l.orgID,title:l.orgName,children:[],isLeaf:!1})):[]},Q=async()=>{try{k.value=!0;const a=await G(0);if(g.value=a,a.length>0){const e=[];let l=0;for(const d of a){const p=await G(d.orgID);if(p.length>0){const y=B=>B.map(x=>x.orgID===d.orgID?(C.value.add(d.orgID),e.push(d.orgID),l+=p.length,{...x,children:p,isLeaf:!1}):x);g.value=y(g.value)}}b.value=e,l>0?f.success(`成功加载 ${a.length} 个顶级组织和 ${l} 个子组织`):f.success(`成功加载 ${a.length} 个顶级组织`)}else f.warning("未获取到组织数据")}catch(a){console.error("获取组织列表失败:",a),f.error("获取组织列表失败，请稍后重试")}finally{k.value=!1}},X=async(a,e=!1)=>{try{T.value.add(a);const l=await M({limit:1e4,page:1,startNum:0,orderbyFiled:"orgCode:asc",parentOrgID:a});if(l&&l.data&&l.data.list){const d=l.data.list.map(y=>({...y,key:y.orgID,title:y.orgName,children:[],isLeaf:!1})),p=q(g.value,a);return p&&(p.children=d,d.length===0&&(p.isLeaf=!0),C.value.add(a)),g.value=[...g.value],d.length}return 0}catch(l){return console.error("加载子节点失败:",l),e||f.error("加载子节点失败"),0}finally{T.value.delete(a)}},Z=async(a,e)=>{if(b.value=a,e.expanded){const l=e.node.dataRef,d=l.orgID;if(l.children&&l.children.length===0&&!l.isLeaf&&!C.value.has(d)){const p=await X(d);p>0&&f.success(`加载了 ${p} 个子组织`)}}},ee=(a,e)=>{a.length>0&&(w.value=a,O.value=e.node.dataRef,o.orgName=e.node.dataRef.orgName||"",I())},ae=async()=>{const a=D.value.trim();if(!a){L();return}try{S.value=!0,k.value=!0;const e=await M({limit:1e4,page:1,startNum:0,orderbyFiled:"orgCode:asc",orgName:a});e&&e.data&&e.data.list?(g.value=e.data.list.map(l=>({...l,key:l.orgID,title:l.orgName,children:[],isLeaf:!0})),w.value=[],O.value=null,b.value=[],f.success(`找到 ${g.value.length} 个匹配的组织`)):(g.value=[],f.warning("未找到匹配的组织"))}catch(e){console.error("搜索组织失败:",e),f.error("搜索失败，请稍后重试")}finally{k.value=!1}},L=async()=>{D.value="",S.value=!1,w.value=[],O.value=null,b.value=[],C.value.clear(),await Q()},j=()=>{D.value.trim()?ae():L()},te=()=>{L()},E=async()=>{A.value=!0;try{const a={limit:o.pageSize,page:o.page,startNum:(o.page-1)*o.pageSize,orderbyFiled:o.orderbyFiled};o.orgName&&(a.orgName=o.orgName),o.operatorName&&(a.operatorName=o.operatorName),o.userID&&(a.operatorID=Number(o.userID));const e=await me(a);console.log(e),e.result===1&&e.data?(V.value=e.data.list,F.value=e.data.total,f.success(`成功加载 ${e.data.list.length} 条用户数据`)):f.error(e.msg||"获取用户列表失败")}catch(a){console.error("获取全量用户列表失败:",a),f.error("获取用户列表失败，请稍后重试")}finally{A.value=!1}},le=a=>a===1?"男":a===2?"女":"-",se=a=>a===1?"启用":a===0?"禁用":"-",oe=a=>a===1?"green":a===0?"red":"",$=a=>a===1?"是":a===0?"否":"-",ne=async a=>{if(!(a!=null&&a.operatorID)){f.warning("无法获取该用户的编号");return}z.value=!0,K.value=!0,u.value=null;try{const e=await ve(a.operatorID);e.result===1&&e.data?u.value=e.data:f.error(e.msg||"获取用户详情失败")}catch(e){console.error("获取用户详情失败:",e),f.error("获取用户详情失败，请稍后重试")}finally{K.value=!1}},re=()=>{z.value=!1},I=()=>{o.page=1,E()},ie=()=>{o.userID="",o.operatorName="",o.orgName="",o.page=1,o.pageSize=10,E()},de=a=>{o.page=a.current,o.pageSize=a.pageSize,E()};return Ae(()=>{Q(),E()}),(a,e)=>{const l=he,d=Ne,p=ke,y=be,B=we,x=De,U=Ie,ue=xe,ce=Ce,H=Se,pe=ze,_=Ee,_e=Le,fe=Ue;return v(),h("div",Ke,[n("div",$e,[n("div",Be,[n("div",Me,[n("div",Pe,[n("div",Re,[t(J(ge))]),e[7]||(e[7]=n("span",{class:"title-text"}," 组织架构 ",-1))])]),n("div",Ve,[t(d,{value:D.value,"onUpdate:value":e[0]||(e[0]=r=>D.value=r),placeholder:"搜索组织名称...","allow-clear":"",class:"modern-search",disabled:k.value,onPressEnter:j,onClear:te},{prefix:s(()=>[t(J(ye))]),suffix:s(()=>[t(l,{type:"primary",size:"small",loading:k.value,onClick:j},{default:s(()=>e[8]||(e[8]=[c(" 搜索 ")])),_:1,__:[8]},8,["loading"])]),_:1},8,["value","disabled"])]),k.value?(v(),h("div",qe,[t(p,{size:"large",tip:"加载中..."})])):g.value.length===0?(v(),h("div",Ge,[t(y,{description:"未找到匹配的组织"})])):(v(),h("div",Qe,[t(x,{"expanded-keys":b.value,"onUpdate:expandedKeys":e[1]||(e[1]=r=>b.value=r),"selected-keys":w.value,"onUpdate:selectedKeys":e[2]||(e[2]=r=>w.value=r),"tree-data":g.value,"field-names":{title:"orgName",key:"orgID",children:"children"},"show-line":"",onExpand:Z,onSelect:ee},{title:s(({orgName:r,orgID:N})=>[t(B,{title:r,placement:"topLeft"},{default:s(()=>[n("div",je,[n("span",He,i(r),1),T.value.has(N)?(v(),P(p,{key:0,size:"small",class:"ml-2"})):R("",!0)])]),_:2},1032,["title"])]),_:1},8,["expanded-keys","selected-keys","tree-data"])])),n("div",Je,[n("div",Ye,[n("div",We,[n("span",Xe,i(S.value?"搜索结果":"已加载"),1),n("span",Ze,i(W(g.value)),1)])]),S.value?(v(),h("div",ea,[t(l,{type:"link",size:"small",onClick:L},{default:s(()=>e[9]||(e[9]=[c(" 清空搜索，返回树形结构 ")])),_:1,__:[9]})])):R("",!0)])]),n("div",aa,[e[15]||(e[15]=n("div",{class:"query-header"},[n("h3",null,"筛选查询")],-1)),n("div",ta,[t(ce,{layout:"inline"},{default:s(()=>[t(U,{label:"用户ID"},{default:s(()=>[t(d,{value:o.userID,"onUpdate:value":e[3]||(e[3]=r=>o.userID=r),placeholder:"请输入","allow-clear":"",style:{width:"180px"},onPressEnter:I},null,8,["value"])]),_:1}),t(U,{label:"姓名"},{default:s(()=>[t(d,{value:o.operatorName,"onUpdate:value":e[4]||(e[4]=r=>o.operatorName=r),placeholder:"请输入","allow-clear":"",style:{width:"180px"},onPressEnter:I},null,8,["value"])]),_:1}),t(U,{label:"组织名称"},{default:s(()=>[t(d,{value:o.orgName,"onUpdate:value":e[5]||(e[5]=r=>o.orgName=r),placeholder:"请输入","allow-clear":"",style:{width:"200px"},onPressEnter:I},null,8,["value"])]),_:1}),t(U,null,{default:s(()=>[t(ue,null,{default:s(()=>[t(l,{type:"primary",onClick:I},{default:s(()=>e[10]||(e[10]=[c(" 查询 ")])),_:1,__:[10]}),t(l,{onClick:ie},{default:s(()=>e[11]||(e[11]=[c(" 重置 ")])),_:1,__:[11]})]),_:1})]),_:1})]),_:1})]),n("div",la,[n("div",sa,[e[12]||(e[12]=n("span",{class:"info-label"},"数据列表",-1)),e[13]||(e[13]=n("span",{class:"info-divider"},"数据共",-1)),n("span",oa,i(F.value),1),e[14]||(e[14]=n("span",{class:"info-unit"},"条",-1))])]),n("div",na,[t(pe,{columns:Y,"data-source":V.value,loading:A.value,pagination:{current:o.page,pageSize:o.pageSize,total:F.value,showSizeChanger:!0,showQuickJumper:!0,showTotal:r=>`共 ${r} 条`},scroll:{x:1400},"row-key":"operatorID",onChange:de},{bodyCell:s(({column:r,record:N})=>[r.key==="operatorName"?(v(),h("a",{key:0,class:"user-link",onClick:fa=>ne(N)},i(N.operatorName),9,ra)):r.key==="isAdmin"?(v(),h("span",ia,"-")):r.key==="mobileNO"?(v(),h("span",da,i(N.mobileNO||"-"),1)):r.key==="oEmail"?(v(),h("span",ua,i(N.oEmail||"-"),1)):r.key==="status"?(v(),P(H,{key:4,color:N.status===1?"green":"red"},{default:s(()=>[c(i(N.status===1?"启用":"禁用"),1)]),_:2},1032,["color"])):R("",!0)]),_:1},8,["data-source","loading","pagination"])])])]),t(fe,{open:z.value,"onUpdate:open":e[6]||(e[6]=r=>z.value=r),title:"人员基本信息",width:720,footer:null,"destroy-on-close":"",class:"user-detail-modal",onCancel:re},{default:s(()=>[t(p,{spinning:K.value},{default:s(()=>[u.value?(v(),h("div",ca,[t(_e,{bordered:"",column:2,size:"small"},{default:s(()=>[t(_,{label:"昵称"},{default:s(()=>[c(i(u.value.operatorName||"-"),1)]),_:1}),t(_,{label:"用户ID"},{default:s(()=>[c(i(u.value.userID||"-"),1)]),_:1}),t(_,{label:"手机号"},{default:s(()=>[c(i(u.value.mobileNO||"-"),1)]),_:1}),t(_,{label:"性别"},{default:s(()=>[c(i(le(u.value.gender)),1)]),_:1}),t(_,{label:"所属单位",span:2},{default:s(()=>[c(i(u.value.orgName||"-"),1)]),_:1}),t(_,{label:"所属租户",span:2},{default:s(()=>[c(i(u.value.tenantOrgName||u.value.tenantName||"-"),1)]),_:1}),t(_,{label:"工号"},{default:s(()=>[c(i(u.value.empCode||"-"),1)]),_:1}),t(_,{label:"注册时间"},{default:s(()=>[c(i(u.value.regDate||"-"),1)]),_:1}),t(_,{label:"出生日期"},{default:s(()=>[c(i(u.value.birthDate||"-"),1)]),_:1}),t(_,{label:"状态"},{default:s(()=>[t(H,{color:oe(u.value.status)},{default:s(()=>[c(i(se(u.value.status)),1)]),_:1},8,["color"])]),_:1}),t(_,{label:"是否实名"},{default:s(()=>[c(i($(u.value.isreal)),1)]),_:1}),t(_,{label:"是否党员"},{default:s(()=>[c(i($(u.value.isCpc)),1)]),_:1}),t(_,{label:"继续教育要求"},{default:s(()=>[c(i($(u.value.isCtnEduRequire)),1)]),_:1}),t(_,{label:"创建时间"},{default:s(()=>[c(i(u.value.createTime||"-"),1)]),_:1}),t(_,{label:"最后修改时间"},{default:s(()=>[c(i(u.value.lastModifyTime||"-"),1)]),_:1})]),_:1})])):(v(),P(y,{key:1,description:"暂无用户信息"}))]),_:1},8,["spinning"])]),_:1},8,["open"])])}}}),Na=Fe(pa,[["__scopeId","data-v-ed787eb2"]]);export{Na as default};
