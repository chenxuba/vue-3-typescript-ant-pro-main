import{k as A,_ as ee}from"./index-CTId23k1.js";import{g as ae}from"./role-DM0DaEWk.js";import{g as te}from"./personnel-BDQSxAjd.js";import{z as le,I as oe,S as se,H as ne,K as re,ab as ie,af as ue,ag as de,an as ce,a6 as me,M as O,a1 as c,al as pe}from"./antd-Cme2pY03.js";import{d as ge,r as $,f as i,o as ve,_,a1 as g,$ as n,k as l,a7 as s,G as v,a9 as w,u as q,ac as fe,F as V,a6 as _e,l as ye}from"./vue-PnzzEkKE.js";async function Ne(m){return A("/admin/api/roleUser/getListPager",m,{customDev:!0})}async function he(m){return A("/admin/api/roleUser/create",m,{customDev:!0})}async function ke(m){return A("/role-assignment/batch-delete",{ids:m})}const we={class:"role-assignment"},Ie={class:"content-wrapper"},be={class:"main-panel"},xe={class:"query-form"},Ce={class:"table-header"},Se={class:"table-info"},Ue={class:"info-value"},Ae={class:"table-actions"},Re={class:"table-container"},De={key:0,class:"user-link"},ze={key:1},Te=ge({name:"RoleAssignment",__name:"role-assignment",setup(m){const o=$({nickName:"",roleName:"",pageNum:1,pageSize:10}),I=i(!1),R=i([]),b=i(0),u=i([]),y=i([]),E=[{title:"用户ID",dataIndex:"userId",key:"userId"},{title:"用户姓名",dataIndex:"nickName",key:"nickName"},{title:"单位",dataIndex:"orgName",key:"orgName",ellipsis:!0},{title:"角色名称",dataIndex:"roleName",key:"roleName"}],N=i(!1),x=i(!1),D=i([]),C=i([]),h=i(!1),r=$({userId:void 0,roleId:void 0}),p=async()=>{I.value=!0;try{const t={nickName:o.nickName,roleName:o.roleName,page:o.pageNum,limit:o.pageSize},e=await Ne(t);e.data&&e.data.list&&(R.value=e.data.list,b.value=e.data.count)}catch{c.error("获取角色分配列表失败")}finally{I.value=!1}},F=async()=>{try{const t=await ae({page:1,limit:1e3,startNum:0});t.data&&t.data.list&&(D.value=t.data.list)}catch(t){console.error("获取角色列表失败:",t)}},z=async(t="")=>{h.value=!0;try{const e=await te({page:1,limit:50,startNum:0,operatorName:t||void 0});e.data&&e.data.list&&(C.value=e.data.list)}catch(e){console.error("获取用户列表失败:",e),C.value=[]}finally{h.value=!1}};let S=null;const K=t=>{S&&clearTimeout(S),S=setTimeout(()=>{z(t)},300)},U=()=>{o.pageNum=1,u.value=[],y.value=[],p()},M=()=>{o.nickName="",o.roleName="",o.pageNum=1,o.pageSize=10,u.value=[],y.value=[],p()},Q=(t,e)=>{u.value=t,y.value=e},G=()=>{r.userId=void 0,r.roleId=void 0,N.value=!0,z()},H=async()=>{if(!r.userId||!r.roleId){c.error("请填写所有必填项");return}x.value=!0;try{await he({roleId:Number(r.roleId),userId:Number(r.userId)}),c.success("分配成功"),N.value=!1,p()}catch{c.error("分配失败")}finally{x.value=!1}},J=()=>{if(u.value.length===0){c.warning("请选择要删除的角色分配");return}O.confirm({title:"确认批量删除",icon:ye(pe),content:`确定要删除选中的 ${u.value.length} 条角色分配记录吗？`,okText:"确定",cancelText:"取消",onOk:async()=>{try{await ke(u.value),c.success("批量删除成功"),u.value=[],y.value=[],p()}catch{c.error("批量删除失败")}}})},j=t=>{o.pageNum=t.current,o.pageSize=t.pageSize,p()};return ve(()=>{p(),F()}),(t,e)=>{const T=oe,f=le,k=ne,W=se,L=re,X=de,Y=ce,P=me,Z=O;return g(),_("div",we,[n("div",Ie,[n("div",be,[e[12]||(e[12]=n("div",{class:"query-header"},[n("h3",null,"筛选查询")],-1)),n("div",xe,[l(L,{layout:"inline"},{default:s(()=>[l(f,{label:"用户姓名"},{default:s(()=>[l(T,{value:o.nickName,"onUpdate:value":e[0]||(e[0]=a=>o.nickName=a),placeholder:"请输入","allow-clear":"",style:{width:"200px"},onPressEnter:U},null,8,["value"])]),_:1}),l(f,{label:"角色名称"},{default:s(()=>[l(T,{value:o.roleName,"onUpdate:value":e[1]||(e[1]=a=>o.roleName=a),placeholder:"请输入","allow-clear":"",style:{width:"200px"},onPressEnter:U},null,8,["value"])]),_:1}),l(f,null,{default:s(()=>[l(W,null,{default:s(()=>[l(k,{type:"primary",onClick:U},{default:s(()=>e[5]||(e[5]=[v(" 查询 ")])),_:1,__:[5]}),l(k,{onClick:M},{default:s(()=>e[6]||(e[6]=[v(" 重置 ")])),_:1,__:[6]})]),_:1})]),_:1})]),_:1})]),n("div",Ce,[n("div",Se,[e[7]||(e[7]=n("span",{class:"info-label"},"数据列表",-1)),e[8]||(e[8]=n("span",{class:"info-divider"},"数据共",-1)),n("span",Ue,w(b.value),1),e[9]||(e[9]=n("span",{class:"info-unit"},"条",-1))]),n("div",Ae,[l(k,{type:"primary",onClick:G},{icon:s(()=>[l(q(ie))]),default:s(()=>[e[10]||(e[10]=v(" 新增分配 "))]),_:1,__:[10]}),l(k,{danger:"",disabled:u.value.length===0,onClick:J},{icon:s(()=>[l(q(ue))]),default:s(()=>[e[11]||(e[11]=v(" 批量删除 "))]),_:1,__:[11]},8,["disabled"])])]),n("div",Re,[l(Y,{columns:E,"data-source":R.value,loading:I.value,pagination:{current:o.pageNum,pageSize:o.pageSize,total:b.value,showSizeChanger:!0,showQuickJumper:!0,showTotal:a=>`共 ${a} 条`},"row-selection":{selectedRowKeys:u.value,onChange:Q},scroll:{x:1e3},"row-key":"id",onChange:j},{bodyCell:s(({column:a,record:d})=>[a.key==="nickName"?(g(),_("a",De,w(d.nickName||"-"),1)):a.key==="roleName"?(g(),_(V,{key:1},[d.roleName?(g(),_e(X,{key:0,color:"blue"},{default:s(()=>[v(w(d.roleName),1)]),_:2},1024)):(g(),_("span",ze,"-"))],64)):a.key==="orgName"?(g(),_(V,{key:2},[v(w(d.orgName||"-"),1)],64)):fe("",!0)]),_:1},8,["data-source","loading","pagination","row-selection"])])])]),l(Z,{open:N.value,"onUpdate:open":e[4]||(e[4]=a=>N.value=a),title:"新增角色分配",width:600,"confirm-loading":x.value,onOk:H},{default:s(()=>[l(L,{model:r,"label-col":{span:6},"wrapper-col":{span:16},style:{"margin-top":"24px"}},{default:s(()=>[l(f,{label:"选择用户",name:"userId",rules:[{required:!0,message:"请选择用户",trigger:"change"}]},{default:s(()=>[l(P,{value:r.userId,"onUpdate:value":e[2]||(e[2]=a=>r.userId=a),placeholder:"请输入用户姓名搜索","allow-clear":"","show-search":"","filter-option":!1,loading:h.value,"not-found-content":h.value?"加载中...":"暂无数据",onSearch:K,options:C.value.map(a=>({label:`${a.operatorName} - ${a.userID} - ${a.orgName}`,value:a.operatorID}))},null,8,["value","loading","not-found-content","options"])]),_:1}),l(f,{label:"授予角色",name:"roleId",rules:[{required:!0,message:"请选择角色",trigger:"change"}]},{default:s(()=>[l(P,{value:r.roleId,"onUpdate:value":e[3]||(e[3]=a=>r.roleId=a),placeholder:"请选择角色","allow-clear":"","show-search":"","filter-option":(a,d)=>{var B;return((B=d==null?void 0:d.label)==null?void 0:B.toLowerCase().indexOf(a.toLowerCase()))>=0},options:D.value.map(a=>({label:a.name,value:a.roleId}))},null,8,["value","filter-option","options"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","confirm-loading"])])}}}),qe=ee(Te,[["__scopeId","data-v-5734d19a"]]);export{qe as default};
